<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raluca Korean â€” Exercises</title>

  <link rel="stylesheet" href="style.css" />

  <!-- DATE EXERCIÈšII (OBLIGATORIU) -->
  <script src="data/topik4_quiz_particles_500.js"></script>
</head>

<body class="pastel-theme">
<div class="app-shell">

  <header class="rk-header">
    <h1>ExerciÈ›ii TOPIK</h1>
    <p>Antrenament real: quiz Â· particule Â· puzzle</p>
  </header>

  <!-- SELECT TIP EXERCIÈšIU -->
  <div class="card">
    <div class="row">
      <label class="small-label">Tip exerciÈ›iu</label>
      <select id="exerciseType">
        <option value="verb">Alege VERBUL corect</option>
        <option value="particle">Alege PARTICULA corectÄƒ</option>
        <option value="particlePlus">Particule multiple</option>
        <option value="conjug">Alege CONJUGAREA</option>
        <option value="puzzle">ðŸ§© Puzzle propoziÈ›ie</option>
      </select>
    </div>

    <div class="exercise-question" id="exerciseQuestion">
      â€”
    </div>

    <div class="exercise-options" id="exerciseOptions"></div>

    <div class="btn-group">
      <button id="checkAnswerBtn">VerificÄƒ</button>
      <button id="nextQuestionBtn" class="secondary">UrmÄƒtoarea</button>
    </div>

    <div class="exercise-feedback" id="exerciseFeedback"></div>
  </div>

</div>

<!-- LOGICÄ‚ EXERCIÈšII -->
<script>
/* ======================================================
   RALUCA KOREAN â€” EXERCISES (1:1 DIN ZIP)
   ====================================================== */

const LS_KEY = "rk_exercises_state_topik4";

const state = JSON.parse(localStorage.getItem(LS_KEY)) || {
  type: "verb",
  idx: 0,
  correct: 0,
  total: 0
};

const typeSelect = document.getElementById("exerciseType");
const questionEl = document.getElementById("exerciseQuestion");
const optionsEl  = document.getElementById("exerciseOptions");
const feedbackEl = document.getElementById("exerciseFeedback");
const checkBtn   = document.getElementById("checkAnswerBtn");
const nextBtn    = document.getElementById("nextQuestionBtn");

let current = null;
let selected = null;

/* =========================
   UTILS
========================= */
function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}

/* =========================
   LOAD QUESTION
========================= */
function loadQuestion(){
  feedbackEl.textContent = "";
  selected = null;

  const type = typeSelect.value;
  state.type = type;

  let source;

  if(type === "verb"){
    source = TOPIK4_QUIZ_500;
    current = source[state.idx % source.length];

    questionEl.textContent = current.ko;
    renderOptions(
      shuffle([
        current.ro,
        ...shuffle(source.filter(x=>x.ro!==current.ro)).slice(0,3).map(x=>x.ro)
      ]),
      current.ro
    );
  }

  if(type === "particle"){
    source = TOPIK4_PARTICLES_500;
    current = source[state.idx % source.length];

    questionEl.textContent = current.text;
    renderOptions(current.choices, current.answer);
  }

  if(type === "puzzle"){
    source = TOPIK4_PUZZLES_500;
    current = source[state.idx % source.length];

    questionEl.textContent = "ConstruieÈ™te propoziÈ›ia";
    renderPuzzle(current);
  }

  save();
}

/* =========================
   RENDER OPTIONS
========================= */
function renderOptions(list, correct){
  optionsEl.innerHTML = "";

  list.forEach(opt=>{
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = opt;
    btn.onclick = ()=>{ selected = opt; };
    optionsEl.appendChild(btn);
  });

  checkBtn.onclick = ()=>{
    if(!selected) return;

    state.total++;
    if(selected === correct){
      state.correct++;
      feedbackEl.textContent = "âœ… Corect";
    } else {
      feedbackEl.textContent = "âŒ GreÈ™it. Corect: " + correct;
    }
    save();
  };
}

/* =========================
   PUZZLE
========================= */
function renderPuzzle(pz){
  optionsEl.innerHTML = "";

  let built = [];

  const bank = document.createElement("div");
  const line = document.createElement("div");

  bank.className = "wordBank";
  line.className = "sentenceLine";

  shuffle([...pz.words]).forEach(w=>{
    const c = document.createElement("span");
    c.className = "chip";
    c.textContent = w;
    c.onclick = ()=>{
      built.push(w);
      line.appendChild(c);
    };
    bank.appendChild(c);
  });

  optionsEl.appendChild(bank);
  optionsEl.appendChild(line);

  checkBtn.onclick = ()=>{
    const res = built.join(" ");
    state.total++;
    if(res === pz.answer){
      state.correct++;
      feedbackEl.textContent = "âœ… Corect";
    } else {
      feedbackEl.textContent = "âŒ Corect era: " + pz.answer;
    }
    save();
  };
}

/* =========================
   EVENTS
========================= */
typeSelect.onchange = ()=>{
  state.idx = 0;
  loadQuestion();
};

nextBtn.onclick = ()=>{
  state.idx++;
  loadQuestion();
};

loadQuestion();
</script>
</body>
</html>
