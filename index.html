<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean ‚Äì Builder P2 Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ===== Pastel simplu ‚Äì doar pentru test ===== */
    :root{
      --bg1:#dff3ff;
      --bg2:#ffe9ff;
      --bg3:#f4fffc;
      --bg4:#e8f0ff;

      --accent:#7b5dff;
      --accent-soft:#f6b5ff;
      --card-bg:#ffffffcc;
      --text-main:#2f343b;
      --text-soft:#7a8088;
      --border:#e1d7c7;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text-main);
      background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
      background-size:380% 380%;
      animation:bgFlow 28s ease-in-out infinite;
    }
    @keyframes bgFlow{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .app{
      max-width:1040px;
      margin:0 auto;
      padding:18px 14px 80px;
    }

    .rk-header{
      position:relative;
      padding:12px 16px 16px;
      border-radius:26px;
      background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
      color:#fff;
      box-shadow:0 18px 45px rgba(77,93,255,0.4);
    }
    .rk-header-main{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .rk-header-main h1{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    .rk-badge{
      font-size:11px;
      font-weight:600;
      padding:4px 9px;
      border-radius:999px;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.4);
    }
    #subtitle{
      margin:8px 0 0;
      font-size:12px;
    }

    .card{
      margin-top:16px;
      padding:16px 18px 18px;
      border-radius:22px;
      background:var(--card-bg);
      backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 18px 40px rgba(0,0,0,0.12);
    }
    .card h2{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      letter-spacing:0.03em;
    }

    textarea{
      width:100%;
      border-radius:16px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:14px;
      resize:vertical;
      min-height:70px;
      color:var(--text-main);
      background:#fff;
    }
    textarea:focus{
      outline:none;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.9),
        0 0 0 3px rgba(149,120,255,0.5);
      border-color:rgba(149,120,255,0.7);
    }

    .btn-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    button{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      color:#fff;
      background:linear-gradient(135deg,#6b8cff,#9b6bff);
      box-shadow:
        0 10px 24px rgba(108,110,210,0.4),
        0 0 0 1px rgba(255,255,255,0.7) inset;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    button.secondary{
      background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(0,0,0,0.18);
      filter:brightness(1.03);
    }
    button:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
      filter:brightness(0.97);
    }

    .section-title{
      margin-top:18px;
      margin-bottom:6px;
      font-size:13px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#4b607d;
    }

    .table-block{
      margin-top:6px;
      padding:10px 10px 12px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 14px 30px rgba(0,0,0,0.1);
    }
    .table-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      font-weight:700;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .table-horizontal{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding-bottom:4px;
    }

    .col{
      min-width:110px;
      max-width:140px;
      flex:0 0 auto;
      border-radius:16px;
      padding:7px 7px 9px;
      background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
      border:1px solid #e2d7c8;
      box-shadow:0 10px 22px rgba(95,78,58,0.16);
    }
    .col-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:4px;
      font-size:10px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#7b5dff;
      border-bottom:1px solid rgba(208,196,255,0.8);
      padding-bottom:2px;
      margin-bottom:3px;
    }
    .col-header::before{
      content:"";
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:16px;
      height:16px;
      border-radius:6px;
      background:#fff;
      font-size:11px;
      box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    .col[data-key="subject"] .col-header::before{content:"üë§";}
    .col[data-key="time"]    .col-header::before{content:"‚è∞";}
    .col[data-key="place"]   .col-header::before{content:"üìç";}
    .col[data-key="mod"]     .col-header::before{content:"‚ú®";}
    .col[data-key="object"]  .col-header::before{content:"üéØ";}
    .col[data-key="numeral"] .col-header::before{content:"#Ô∏è‚É£";}
    .col[data-key="counter"] .col-header::before{content:"üî¢";}
    .col[data-key="verb"]    .col-header::before{content:"üöÄ";}

    .col-body-label{
      font-size:10px;
      color:#938777;
      margin-bottom:1px;
    }
    .col-body-main{
      font-size:15px;
      font-weight:700;
      min-height:1.4em;
    }
    .col-body-main[contenteditable="true"]{
      outline:none;
      cursor:text;
    }
    .col-body-main:focus{
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.8),
        0 0 0 2px rgba(149,120,255,0.7);
      border-radius:6px;
    }

    .builder-enable-p2{
      margin-top:6px;
      padding-top:6px;
      border-top:1px dashed var(--border);
      font-size:11px;
      display:flex;
      justify-content:flex-end;
      color:var(--text-soft);
    }
    .builder-enable-p2 label{
      display:flex;
      align-items:center;
      gap:4px;
    }

    .hidden{display:none !important;}

    .preview-card{
      margin-top:14px;
      padding:12px 14px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 16px 32px rgba(0,0,0,0.12);
    }
    .preview-title{
      font-size:12px;
      font-weight:700;
      color:#4b607d;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .preview-sentence{
      font-size:22px;
      font-weight:800;
      line-height:1.6;
      margin-bottom:4px;
    }
    .preview-ro{
      font-size:12px;
      color:var(--text-soft);
    }

    @media (max-width:600px){
      .rk-header-main h1{font-size:17px;}
      .col{min-width:95px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="rk-header">
      <div class="rk-header-main">
        <h1>RALUCA KOREAN</h1>
        <span class="rk-badge">Builder P2 ‚Äì test</span>
      </div>
      <p id="subtitle">
        Versiune micƒÉ de test pentru Propozi»õia 2, fraze lungi »ôi Rom√¢nƒÉ ‚Üí CoreeanƒÉ.
      </p>
    </header>

    <!-- Rom√¢nƒÉ ‚Üí CoreeanƒÉ (builder automat) -->
    <section class="card" id="roCard">
      <h2>Rom√¢nƒÉ ‚Üí CoreeanƒÉ (Builder automat)</h2>
      <p style="font-size:12px;color:var(--text-soft);margin-top:0;margin-bottom:6px;">
        Scrie o propozi»õie simplƒÉ √Æn rom√¢nƒÉ (ex: <em>AstƒÉzi merg la cafenea »ôi beau o cafea.</em>), apoi apasƒÉ pe buton.
      </p>
      <textarea id="roInput" placeholder="Scrie aici propozi»õia ta √Æn rom√¢nƒÉ‚Ä¶"></textarea>

      <div class="btn-row">
        <button id="autoFillBtn">CompleteazƒÉ automat builder-ul</button>
        <button id="clearBtn" class="secondary">CurƒÉ»õƒÉ tot</button>
      </div>
    </section>

    <!-- PROPOZI»öIA 1 -->
    <h3 class="section-title">Propozi»õia 1 ‚Äì pƒÉr»õi de vorbire</h3>
    <section class="table-block">
      <div class="table-title">
        <span>Propozi»õia 1 (clauza principalƒÉ)</span>
        <span style="font-size:11px;color:var(--text-soft);">Se poate edita manual</span>
      </div>

      <div id="tableP1" class="table-horizontal">
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/ea‚Ä¶</div>
          <div class="col-body-main" contenteditable="true">Ï†Ä</div>
        </div>

        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, m√¢ine‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasƒÉ, la »ôcoalƒÉ‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, √Æncet‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carte‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douƒÉ, trei‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">Í∞ú, Í∂å‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">Í∞ÄÏöî, ÎßàÏÖîÏöî‚Ä¶</div>
          <div class="col-body-main" contenteditable="true">Í∞ÄÏöî</div>
        </div>
      </div>

      <!-- Bifa Propozi»õia 2 -->
      <div class="builder-enable-p2">
        <label>
          <input type="checkbox" id="enableP2" />
          ActiveazƒÉ Propozi»õia 2 (continuare / frazƒÉ)
        </label>
      </div>
    </section>

    <!-- PROPOZI»öIA 2 -->
    <h3 class="section-title" id="titleP2" class="hidden">Propozi»õia 2 ‚Äì continuare</h3>
    <section class="table-block hidden" id="blockP2">
      <div class="table-title">
        <span>Propozi»õia 2 (clauza secundarƒÉ)</span>
        <span style="font-size:11px;color:var(--text-soft);">Manual only (deocamdatƒÉ)</span>
      </div>

      <div id="tableP2" class="table-horizontal">
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/ea‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, m√¢ine‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasƒÉ, la »ôcoalƒÉ‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, √Æncet‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carte‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douƒÉ, trei‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">Í∞ú, Í∂å‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">Í∞ÄÏöî, ÏôÄÏöî‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>
      </div>
    </section>

    <!-- PREVIEW FINAL ‚Äì FRAZƒÇ LUNGƒÇ -->
    <section class="preview-card">
      <div class="preview-title">
        <span>Propozi»õia finalƒÉ √Æn coreeanƒÉ (P1 + Í∑∏Î¶¨Í≥† + P2)</span>
      </div>
      <div id="previewSentence" class="preview-sentence">Ï†Ä Í∞ÄÏöî</div>
      <div id="previewRo" class="preview-ro">
        (Aici vei vedea propozi»õia finalƒÉ √Æn coreeanƒÉ, generatƒÉ din sloturi.)
      </div>
    </section>
  </div>

  <!-- ===================== JS ===================== -->
  <script>
    /* ========= 1. Normalizare text rom√¢nƒÉ ========= */
    function normalizeRo(text) {
      if (!text) return "";
      let t = text.toLowerCase();
      t = t.replace(/≈ü/g,"»ô").replace(/≈£/g,"»õ");
      t = t.replace(/[.,!?;:]/g," ");
      t = t.replace(/\s+/g," ").trim();
      return t;
    }

    /* ========= 2. Reguli RO ‚Üí sloturi ========= */
    const RO_RULES = {
      subject: [
        { re:/\\beu\\s*\\(formal\\)|eu\\s*-\\s*formal\\b/, value:"Ï†Ä" },
        { re:/\\beu\\s*\\(informal\\)|eu\\s*-\\s*informal\\b/, value:"ÎÇò" },
        { re:/\\beu\\b/, value:"Ï†Ä" },
        { re:/\\btu\\b/, value:"ÎÑà" }
      ],
      time: [
        { re:/\\bazi\\b|\\bastƒÉzi\\b|\\bastazi\\b/, value:"Ïò§Îäò" },
        { re:/\\bm√¢ine\\b|\\bmaine\\b/, value:"ÎÇ¥Ïùº" },
        { re:/\\bieri\\b/, value:"Ïñ¥Ï†ú" },
        { re:/\\bacum\\b/, value:"ÏßÄÍ∏à" }
      ],
      place: [
        { re:/acas[ƒÉa]\\b/, value:"Ïßë" },
        { re:/la\\s+»ôcoal[ƒÉa]|la\\s+scoala|»ôcoal[ƒÉa]\\b|scoala\\b/, value:"ÌïôÍµê" },
        { re:/la\\s+firm[ƒÉa]|la\\s+serviciu|la\\s+companie|firm[ƒÉa]\\b|serviciu\\b|companie\\b/, value:"ÌöåÏÇ¨" },
        { re:/cafenea|cafene[al]/, value:"Ïπ¥Ìéò" }
      ],
      mod: [
        { re:/\\bbine\\b|frumos\\b|ok\\b/, value:"Ïûò" },
        { re:/√Æn\\s+lini»ôte|in\\s+liniste|lini»ôte|liniste/, value:"Ï°∞Ïö©Ìûà" },
        { re:/cu\\s+s√¢rguint[ƒÉa]|cu\\s+sarguinta|harnic|cu\\s+mult\\s+efort/, value:"Ïó¥Ïã¨Ìûà" },
        { re:/√Æncet|incet/, value:"Ï≤úÏ≤úÌûà" },
        { re:/repede|rapid/, value:"Îπ®Î¶¨" }
      ],
      object: [
        { re:/cafea/, value:"Ïª§Ìîº" },
        { re:/\\bap[ƒÉa]\\b/, value:"Î¨º" },
        { re:/carte|c[ƒÉa]r»õi|c[ƒÉa]rti\\b/, value:"Ï±Ö" },
        { re:/m[ƒÉa]ncare|pr[ƒÉa]nzul|cina|mic\\s+dejun/, value:"ÏùåÏãù" },
        { re:/ceai\\b/, value:"Ï∞®" }
      ],
      numeral: [
        { re:/\\bo\\s+carte\\b|o\\s+cafea\\b/, value:"Ìïú" },
        { re:/dou[ƒÉa]\\s+car»õi|dou[ƒÉa]\\s+cafele/, value:"Îëê" },
        { re:/trei\\s+car»õi|trei\\s+cafele/, value:"ÏÑ∏" }
      ],
      counter: [
        { re:/carte|c[ƒÉa]rti\\b/, value:"Í∂å" },
        { re:/cafea|ap[ƒÉa]\\b|ceai\\b|m[ƒÉa]ncare/, value:"Í∞ú" }
      ],
      verb: [
        { re:/merg\\b|a merge|s[ƒÉa]\\s+merg/, value:"Í∞ÄÏöî" },
        { re:/vin\\b|a veni|s[ƒÉa]\\s+vin/, value:"ÏôÄÏöî" },
        { re:/beau\\b|a bea|s[ƒÉa]\\s+beau/, value:"ÎßàÏÖîÏöî" },
        { re:/m[ƒÉa]n[√¢a]nc|mananc|a m[ƒÉa]nca/, value:"Î®πÏñ¥Ïöî" },
        { re:/citesc|a citi|s[ƒÉa]\\s+citesc/, value:"ÏùΩÏñ¥Ïöî" },
        { re:/lucrez|a lucra/, value:"ÏùºÌï¥Ïöî" }
      ]
    };

    function matchSlot(rules,text){
      if(!rules) return null;
      for(const rule of rules){
        if(rule.re.test(text)) return rule.value;
      }
      return null;
    }

    function parseRomanianToSlots(text){
      const t = normalizeRo(text);
      return {
        subject: matchSlot(RO_RULES.subject,t),
        time:    matchSlot(RO_RULES.time,t),
        place:   matchSlot(RO_RULES.place,t),
        mod:     matchSlot(RO_RULES.mod,t),
        object:  matchSlot(RO_RULES.object,t),
        numeral: matchSlot(RO_RULES.numeral,t),
        counter: matchSlot(RO_RULES.counter,t),
        verb:    matchSlot(RO_RULES.verb,t)
      };
    }

    /* ========= 3. Aplicare sloturi pe Propozi»õia 1 ========= */
    function applySlotsToBuilderP1(slots){
      const table = document.getElementById("tableP1");
      if(!table || !slots) return;
      const setCol = (key,value)=>{
        if(!value) return;
        const col = table.querySelector('.col[data-key="'+key+'"] .col-body-main');
        if(col) col.textContent = value;
      };
      setCol("subject",slots.subject);
      setCol("time",   slots.time);
      setCol("place",  slots.place);
      setCol("mod",    slots.mod);
      setCol("object", slots.object);
      setCol("numeral",slots.numeral);
      setCol("counter",slots.counter);
      // verb √Æl folosim direct √Æn reconstruc»õie
      if(slots.verb){
        const vCol = table.querySelector('.col[data-key="verb"] .col-body-main');
        if(vCol) vCol.textContent = slots.verb;
      }
    }

    /* ========= 4. Construim o propozi»õie dintr-un tabel ========= */
    function sentenceFromTable(tableId){
      const table = document.getElementById(tableId);
      if(!table) return "";

      const pick = (key)=>{
        const col = table.querySelector('.col[data-key="'+key+'"] .col-body-main');
        return col ? col.textContent.trim() : "";
      };

      const subject = pick("subject") || "Ï†Ä";
      const time    = pick("time");
      const place   = pick("place");
      const mod     = pick("mod");
      const numeral = pick("numeral");
      const counter = pick("counter");
      const object  = pick("object");
      const verb    = pick("verb") || "Í∞ÄÏöî";

      let objectChunk = "";
      if(object && numeral && counter){
        objectChunk = object + " " + numeral + " " + counter;
      } else if(object){
        objectChunk = object;
      }

      const pieces = [subject,time,place,mod,objectChunk,verb].filter(Boolean);
      return pieces.join(" ");
    }

    /* ========= 5. Preview final (P1 + Í∑∏Î¶¨Í≥† + P2) ========= */
    function rebuildCombinedPreview(){
      const enableP2 = document.getElementById("enableP2");
      const preview = document.getElementById("previewSentence");

      const s1 = sentenceFromTable("tableP1");
      let finalSentence = s1;

      if(enableP2 && enableP2.checked){
        const s2 = sentenceFromTable("tableP2");
        if(s2){
          finalSentence = s1 + " Í∑∏Î¶¨Í≥† " + s2;
        }
      }

      if(preview) preview.textContent = finalSentence.trim();
    }

    /* ========= 6. INIT ========= */
    document.addEventListener("DOMContentLoaded", () => {
      const roInput   = document.getElementById("roInput");
      const autoFill  = document.getElementById("autoFillBtn");
      const clearBtn  = document.getElementById("clearBtn");
      const enableP2  = document.getElementById("enableP2");
      const titleP2   = document.getElementById("titleP2");
      const blockP2   = document.getElementById("blockP2");

      // toate celulele editabile actualizeazƒÉ preview
      document.querySelectorAll(".col-body-main[contenteditable='true']")
        .forEach(el=>{
          el.addEventListener("input", rebuildCombinedPreview);
        });

      if(autoFill){
        autoFill.addEventListener("click", () => {
          const text  = roInput.value;
          const slots = parseRomanianToSlots(text);
          applySlotsToBuilderP1(slots);
          rebuildCombinedPreview();
        });
      }

      if(clearBtn){
        clearBtn.addEventListener("click", () => {
          roInput.value = "";
          document.querySelectorAll(".col-body-main[contenteditable='true']")
            .forEach(el => el.textContent = "");
          // resetƒÉm subject P1 + verb default
          const subj = document.querySelector('#tableP1 .col[data-key="subject"] .col-body-main');
          if(subj) subj.textContent = "Ï†Ä";
          const verb = document.querySelector('#tableP1 .col[data-key="verb"] .col-body-main');
          if(verb) verb.textContent = "Í∞ÄÏöî";
          rebuildCombinedPreview();
        });
      }

      if(enableP2){
        const syncP2 = () => {
          const on = enableP2.checked;
          if(titleP2) titleP2.classList.toggle("hidden", !on);
          if(blockP2) blockP2.classList.toggle("hidden", !on);
          rebuildCombinedPreview();
        };
        enableP2.addEventListener("change", syncP2);
        syncP2();
      }

      // preview ini»õial
      rebuildCombinedPreview();
    });
  </script>
</body>
</html>
