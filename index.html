<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f3ff;
      --card-bg: #ffffff;
      --accent: #9b5fff;
      --accent-strong: #7b3cff;
      --text-main: #333333;
      --text-soft: #666666;
      --border: #e0d7ff;
      --dimmed-bg: #f2eefc;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #fefbff 0, #f1ecff 45%, #ede7ff 100%);
      color: var(--text-main);
    }
    .app {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px 10px 40px;
    }
    header {
      margin-bottom: 10px;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 800;
      color: var(--accent-strong);
    }
    header p {
      margin: 4px 0 0;
      font-size: 13px;
      color: var(--text-soft);
    }
    .nav-bar {
      display: flex;
      gap: 6px;
      margin: 10px 0 12px;
    }
    .nav-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.9);
      padding: 6px 10px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: var(--text-soft);
    }
    .nav-btn.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .nav-btn span.icon {
      font-size: 14px;
    }

    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }

    .card {
      background: var(--card-bg);
      border-radius: 14px;
      border: 1px solid var(--border);
      box-shadow: 0 3px 8px rgba(67, 31, 120, 0.06);
      padding: 12px 10px;
      margin-bottom: 12px;
    }
    .card-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-strong);
      margin-bottom: 6px;
    }
    .small-label {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 3px 9px;
      font-size: 11px;
      background: #fdfbff;
      color: var(--text-soft);
    }
    .chip input {
      width: 12px;
      height: 12px;
    }

    .mode-buttons {
      display: inline-flex;
      gap: 4px;
      border-radius: 999px;
      padding: 2px;
      background: #f1e9ff;
      margin-bottom: 6px;
    }
    .small-mode-btn {
      border-radius: 999px;
      border: none;
      font-size: 11px;
      padding: 3px 10px;
      background: transparent;
      color: var(--text-soft);
    }
    .small-mode-btn.active {
      background: #fff;
      color: var(--accent-strong);
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }

    .builder-layout {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .row-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 4px;
      gap: 8px;
    }
    .row-header strong {
      color: var(--accent-strong);
    }
    .row-header .right {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .toggle-p2 {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }
    .toggle-p2 input {
      width: 12px;
      height: 12px;
    }

    .table-row {
      display: grid;
      grid-template-columns: repeat(9, minmax(0,1fr));
      gap: 6px;
    }
    @media (max-width: 900px) {
      .table-row {
        grid-template-columns: repeat(3, minmax(0,1fr));
      }
    }

    .col {
      position: relative;
      min-height: 58px;
      border-radius: 12px;
      padding: 6px 6px 8px;
      background: var(--dimmed-bg);
      border: 1px dashed rgba(155,95,255,0.4);
      cursor: pointer;
      overflow: hidden;
    }
    .col.dimmed {
      opacity: 0.28;
    }
    .col-header {
      font-size: 10px;
      color: var(--accent-strong);
      font-weight: 700;
      margin-bottom: 2px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .col-body-label {
      font-size: 10px;
      color: var(--text-soft);
      margin-bottom: 3px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .col-body-main {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .col-body-extra {
      font-size: 9px;
      color: var(--accent-strong);
      margin-top: 2px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .preview-area {
      margin-top: 6px;
    }
    #previewKo {
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    #previewRo {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }
    #naturalHint {
      font-size: 11px;
      color: #2f7e3a;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }
    .btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 11px;
      padding: 5px 10px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      color: var(--text-soft);
    }
    .btn.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      box-shadow: 0 2px 6px rgba(0,0,0,0.12);
    }
    .btn.green {
      background: #29a36a;
      color: #fff;
      border-color: #1f925e;
    }
    .btn.small {
      padding: 3px 8px;
      font-size: 10px;
    }
    .btn:disabled {
      opacity: 0.4;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 4px;
    }
    #pageInfo { font-weight: 600; }

    /* Overlay panel */
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,0,40,0.35);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 40;
    }
    #overlay.visible {
      display: flex;
    }
    #panel {
      width: 100%;
      max-width: 650px;
      max-height: 70vh;
      background: #ffffff;
      border-radius: 18px 18px 0 0;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.18);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    #panelTitle {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent-strong);
    }
    #panelSub {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 4px;
    }
    #panelTopRow {
      display: flex;
      gap: 6px;
      margin-bottom: 4px;
    }
    #panelTopRow input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 5px 9px;
      font-size: 11px;
    }
    #panelList {
      flex: 1;
      overflow-y: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f8f5ff;
      padding: 4px;
    }
    .panel-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 6px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      margin-bottom: 2px;
    }
    .panel-item:hover {
      background: #ede4ff;
    }
    .panel-item-main {
      font-weight: 600;
    }
    .panel-item-extra {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: flex-end;
    }
    .panel-item-tag {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid var(--border);
      color: var(--text-soft);
    }
    #panelAddRow {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }
    #panelAddRow input {
      flex: 1;
      min-width: 90px;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 4px 8px;
      font-size: 11px;
    }

    /* Glossary + favorites */
    #glossarySearch {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 5px 9px;
      font-size: 11px;
      margin-bottom: 8px;
    }
    #glossaryList {
      max-height: 360px;
      overflow-y: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f8f5ff;
      padding: 4px;
      font-size: 12px;
    }
    .glossary-item {
      display: flex;
      justify-content: space-between;
      padding: 4px 6px;
      border-radius: 8px;
      margin-bottom: 3px;
    }
    .glossary-item:nth-child(odd) {
      background: #f1ebff;
    }
    .glossary-ko {
      font-weight: 600;
    }
    .glossary-ro {
      font-size: 11px;
      color: var(--text-soft);
    }
    .glossary-cat {
      font-size: 10px;
      padding-left: 6px;
      color: var(--accent-strong);
      white-space: nowrap;
    }

    #favoritesList {
      max-height: 180px;
      overflow-y: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f8f5ff;
      padding: 4px;
      font-size: 12px;
    }
    .fav-item {
      padding: 4px 6px;
      border-radius: 8px;
      margin-bottom: 3px;
      background: #f1ebff;
    }
    .fav-ko {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .fav-ro {
      font-size: 11px;
      color: var(--text-soft);
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Raluca Korean Sentence Builder</h1>
      <p id="subtitle">Builder propozi»õii + particule + audio + conjugƒÉri</p>
    </header>

    <div class="nav-bar">
      <button class="nav-btn active" data-target="builder">
        <span class="icon">üß±</span> Builder
      </button>
      <button class="nav-btn" data-target="exercises">
        <span class="icon">üìù</span> Exerci»õii TOPIK
      </button>
      <button class="nav-btn" data-target="glossary">
        <span class="icon">üìö</span> Glosar & Favorite
      </button>
    </div>

    <!-- SCREEN BUILDER -->
    <div id="screen-builder" class="screen active">
      <div class="card">
        <div class="row-header">
          <div>
            <div class="card-title">Mod afi»ôare</div>
            <div class="small-label">Po»õi schimba √Æntre ‚Äûsimplu‚Äù (doar SUBJ‚ÄìTIMP‚ÄìOBIECT‚ÄìVERB) sau ‚ÄûTOPIK‚Äù (toate coloanele).</div>
          </div>
          <div class="mode-buttons">
            <button class="small-mode-btn" data-mode="simple">Simplu</button>
            <button class="small-mode-btn active" data-mode="topik">TOPIK complet</button>
          </div>
        </div>

        <div class="builder-layout">
          <div>
            <div class="row-header">
              <strong>Propozi»õia 1 ‚Äì ce pƒÉr»õi folose»ôte?</strong>
              <div class="right">
                <span class="small-label">BifeazƒÉ / debifeazƒÉ coloanele folosite</span>
              </div>
            </div>
            <div class="chips-row" id="togglesP1"></div>
          </div>

          <div>
            <div class="row-header">
              <strong>
                <label class="toggle-p2">
                  <input type="checkbox" id="enableP2" />
                  <span>ActiveazƒÉ Propozi»õia 2 (frazƒÉ)</span>
                </label>
              </strong>
              <div class="small-label">P2 este pentru legƒÉturi de tip ‚Äû√Æn timp ce..., dupƒÉ ce..., pentru cƒÉ...‚Äù</div>
            </div>
            <div class="chips-row" id="togglesP2"></div>
          </div>

          <div>
            <div class="row-header">
              <strong>Propozi»õia 1</strong>
              <span class="small-label">Tap scurt pe coloanƒÉ = treci la urmƒÉtorul cuv√¢nt. »öine apƒÉsat = listƒÉ completƒÉ + adƒÉugare cuv√¢nt nou.</span>
            </div>
            <div id="tableP1" class="table-row"></div>
          </div>

          <div>
            <div class="row-header hidden" id="titleP2">
              <strong>Propozi»õia 2 (continuare / frazƒÉ)</strong>
              <span class="small-label">Se activeazƒÉ automat pentru conjugƒÉri de tip ‚Äû-Î©¥ÏÑú, -Í≥† ÎÇòÏÑú, -Í∏∞ Ï†ÑÏóê...‚Äù</span>
            </div>
            <div id="tableP2" class="table-row hidden"></div>
          </div>

          <div class="preview-area">
            <div class="card-title">Propozi»õia / fraza (coreeanƒÉ, cu particule »ôi verb conjugat)</div>
            <div id="previewKo">(alege cuvinte din tabel)</div>
            <div id="previewRo"></div>
            <div id="naturalHint"></div>

            <div class="btn-row">
              <button class="btn" id="toggleRoBtn">Ascunde traducerea</button>
              <button class="btn" id="resetBtn">Reset coloane</button>
            </div>

            <div class="info-row">
              <div id="pageInfo">R√¢nd model: 1 / 1</div>
              <div>
                <button class="btn small" id="prevBtn">‚óÄ Prev (r√¢nd model)</button>
                <button class="btn small" id="nextBtn">Next (r√¢nd model) ‚ñ∂</button>
              </div>
            </div>

            <div class="btn-row">
              <button class="btn" id="randomBtn">üé≤ Random propozi»õie</button>
              <button class="btn" id="speakBtn">üîä Audio coreeanƒÉ</button>
              <button class="btn primary" id="favBtn">‚≠ê SalveazƒÉ propozi»õia</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SCREEN EXERCISES (simplu, deocamdatƒÉ doar mesaj) -->
    <div id="screen-exercises" class="screen">
      <div class="card">
        <div class="card-title">Exerci»õii TOPIK (√Æn pregƒÉtire)</div>
        <p class="small-label">
          Aici vom pune mai t√¢rziu exerci»õii de tip:
          ‚Äûalege verbul corect‚Äù, ‚ÄûcompleteazƒÉ particula‚Äù, ‚Äûalege timpul corect‚Äù.
          Momentan builder-ul este 100% func»õional »ôi optimizat pentru studiu.
        </p>
      </div>
    </div>

    <!-- SCREEN GLOSSARY -->
    <div id="screen-glossary" class="screen">
      <div class="card">
        <div class="card-title">Propozi»õii favorite</div>
        <div id="favoritesList"></div>
      </div>

      <div class="card">
        <div class="card-title">Glosar coreean‚Äìrom√¢n (din toate coloanele)</div>
        <input id="glossarySearch" placeholder="CautƒÉ dupƒÉ coreeanƒÉ sau rom√¢nƒÉ..." />
        <div id="glossaryList"></div>
      </div>
    </div>
  </div>

  <!-- OVERLAY PANEL SELECTOR -->
  <div id="overlay">
    <div id="panel">
      <div class="row-header">
        <div>
          <div id="panelTitle"></div>
          <div id="panelSub"></div>
        </div>
        <button class="btn small" id="closePanelBtn">√énchide</button>
      </div>
      <div id="panelTopRow">
        <input id="panelSearchInput" placeholder="FiltreazƒÉ dupƒÉ coreeanƒÉ / rom√¢nƒÉ..." />
      </div>
      <div id="panelList"></div>
      <div id="panelAddRow">
        <input id="newWordInput" placeholder="Cuv√¢nt nou (coreeanƒÉ)" />
        <input id="newWordTransInput" placeholder="Traducere √Æn rom√¢nƒÉ (op»õional)" />
        <button class="btn small" id="addWordBtn">AdaugƒÉ</button>
      </div>
    </div>
  </div>

  <script>
    /* === LISTE DE CUVINTE (de bazƒÉ) === */
    const subjects = [
      "Ï†Ä","ÎÇò","ÎÑà","Ïö∞Î¶¨","ÎÑàÌù¨","ÏÇ¨Îûå","ÌïôÏÉù","ÏÑ†ÏÉùÎãò","ÏßÅÏõê","Ï†ÑÎ¨∏Í∞Ä","ÏßÄÏõêÏûê","Í¥ÄÎ¶¨Ïûê",
      "Î∂ÄÎ™®Îãò","ÏïÑÏù¥","Ïñ¥Î•∏","ÏãúÎØº","Í≥†Í∞ù","ÏùòÏÇ¨","Í∞ÑÌò∏ÏÇ¨","Ïó∞Íµ¨Ïûê","Í¥ÄÍ≥ÑÏûê","ÎåÄÌëú","ÌöåÏû•",
      "ÏÇ¨Ïö©Ïûê","Ï∞∏Í∞ÄÏûê","Ïö¥Ï†ÑÏûê","Ï£ºÎØº","ÌôòÏûê"
    ];
    const times = [
      "Ïò§Îäò","Ïñ¥Ï†ú","ÎÇ¥Ïùº","ÏßÄÍ∏à","Î∞©Í∏à","Ï°∞Í∏à ÌõÑÏóê","Í≥ß","ÏµúÍ∑ºÏóê","ÏöîÏ¶ò","ÎßàÏπ®ÎÇ¥","Í≤∞Íµ≠",
      "Ïù¥Ï†ÑÏóê","Ïù¥ÌõÑÏóê","ÎãπÏãúÏóê","ÌïúÎèôÏïà","Í≥ÑÏÜç","Í∞ÄÎÅî","Ìï≠ÏÉÅ","ÏûêÏ£º","Ï†êÏ†ê","Ï∞®Ï∏∞","ÏùºÏ∞ç","Îä¶Í≤å"
    ];
    const places = [
      "Ïßë","ÌïôÍµê","ÌöåÏÇ¨","ÏãùÎãπ","Ïπ¥Ìéò","ÎèÑÏÑúÍ¥Ä","Î≥ëÏõê","ÏãúÏû•","Î∞±ÌôîÏ†ê","Í≥µÌï≠","Í∏∞Ï∞®Ïó≠",
      "Î≤ÑÏä§Ï†ïÎ•òÏû•","Ïó∞Íµ¨ÏÜå","Í∏∞Í¥Ä","ÏßÄÏó≠ÏÇ¨Ìöå","ÌôòÍ≤Ω","ÎåÄÍ∏∞ÏóÖ","ÌöåÏùòÏã§","Î≤ïÏõê","Í≤ΩÏ∞∞ÏÑú",
      "Ìï¥Î≥Ä","ÏÇ∞","Í≥µÏõê","ÏùÄÌñâ"
    ];
    const mods = [
      "Ïûò","Ïó¥Ïã¨Ìûà","Ï°∞Ïö©Ìûà","Ï≤úÏ≤úÌûà","Îπ®Î¶¨","Ï†ïÎßê","ÏïÑÏ£º","ÎÑàÎ¨¥","ÎßéÏù¥","Ï°∞Í∏à","Í∞ëÏûêÍ∏∞","ÎØ∏Î¶¨",
      "Î≤åÏç®","ÏïÑÍπå","Î∞©Í∏à","Í∏àÎ∞©","Í≥ß","Ìï≠ÏÉÅ","ÏûêÏ£º","Í∞ÄÎÅî","ÎìúÎ¨ºÍ≤å","ÏÉÅÎãπÌûà","ÍΩ§","ÎèÑÎåÄÏ≤¥","Ï†àÎåÄÎ°ú",
      "Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú","Ï∂©Î∂ÑÌûà","ÌäπÌûà","Ïò§ÌûàÎ†§","Ï†êÏ†ê","Ï∞®Ï∏∞","Í≥ÑÏÜç"
    ];
    const objects = [
      "Ï±Ö","Ïª§Ìîº","Î¨º","ÏùåÏãù","ÏòÅÌôî","Í∞ÄÎ∞©","Ï†ÑÌôî","Ïò∑","ÏûêÎ£å","Îç∞Ïù¥ÌÑ∞","Í≥ÑÌöç","Ï°∞Í±¥","ÏÉÅÌô©","Î¨∏Ï†ú",
      "Ìï¥Í≤∞Ï±Ö","ÏöîÏïΩ","Î≥¥Í≥†ÏÑú","Î¨∏ÏÑú","Ïª¥Ìì®ÌÑ∞","ÎÖ∏Ìä∏Î∂Å","Ìé∏ÏßÄ","ÏÑ†Î¨º","ÏùòÍ≤¨","Ï†ïÎ≥¥","Í¥ÄÍ≥Ñ","Í≤∞Í≥º",
      "ÏõêÏù∏","Î∞©Î≤ï","Ï†úÌíà","ÏÑúÎπÑÏä§","Ï†ïÏ±Ö","Î¨∏Ìôî"
    ];
    const numerals = new Array(60).fill("");
    const counters = [
      "Í∞ú","Î™Ö","Í∂å","Ïû•","ÎåÄ","Î≥ë","Ïûî","ÎßàÎ¶¨","Î≤à","ÏÇ¥","ÏÜ°Ïù¥","Ï§Ñ","Ï†ê","Í±¥","Ìöå","Í∞ÄÏßÄ","Ï™Ω"
    ];
    const verbs = [
      "Í∞ÄÎã§","Ïò§Îã§","Î®πÎã§","ÎßàÏãúÎã§","Î≥¥Îã§","ÏùΩÎã§","Ïì∞Îã§","Î∞∞Ïö∞Îã§","ÏÇ¨Îã§","Ï£ºÎã§","Î∞õÎã§","ÏùºÌïòÎã§",
      "Í≥µÎ∂ÄÌïòÎã§","ÏöîÎ¶¨ÌïòÎã§","Ï≤≠ÏÜåÌïòÎã§","Ï§ÄÎπÑÌïòÎã§","ÎèÑÏôÄÏ£ºÎã§","ÏÇ¨Ïö©ÌïòÎã§","ÌïÑÏöîÌïòÎã§","Ï¢ãÏïÑÌïòÎã§",
      "Ïã´Ïñ¥ÌïòÎã§","Í∏∞Îã§Î¶¨Îã§","Ïâ¨Îã§","ÎßåÎÇòÎã§","Í±∑Îã§","Îã¨Î¶¨Îã§","ÏïâÎã§","ÏÑúÎã§","Í≤∞Ï†ïÌïòÎã§","Ï†úÏïàÌïòÎã§",
      "Ï†ÑÎã¨ÌïòÎã§","Ïú†ÏßÄÌïòÎã§","Î∞úÏÉùÌïòÎã§","Ï¶ùÍ∞ÄÌïòÎã§","Í∞êÏÜåÌïòÎã§","Ïù∏Ï†ïÌïòÎã§","Î∂ÑÏÑùÌïòÎã§","Í¥ÄÏ∞∞ÌïòÎã§",
      "Ìï¥Í≤∞ÌïòÎã§","Ïó∞Íµ¨ÌïòÎã§","ÌòëÎ†•ÌïòÎã§","ÏöîÏ≤≠ÌïòÎã§","Ï∂©Ï°±ÌïòÎã§","ÎπÑÍµêÌïòÎã§","ÏÑ§Î™ÖÌïòÎã§","ÏòàÏÉÅÌïòÎã§"
    ];
    const conjugations = [
      "-ÏïÑÏöî/Ïñ¥Ïöî","-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî","-Í≥† ÏûàÏñ¥Ïöî","-Í≥† Ïã∂Ïñ¥Ïöî","-(Ïúº)ÏÑ∏Ïöî","-(Ïúº)„Ñπ Í±∞ÏòàÏöî",
      "-ÏßÄ ÎßàÏÑ∏Ïöî","-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî","-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî","-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî","-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî",
      "-ÎçîÎùºÍ≥†Ïöî","-ÎÑ§Ïöî","-Íµ∞Ïöî","-Í≥† ÎÇòÏÑú","-Í∏∞ Ï†ÑÏóê","-(Ïúº)Î©¥ÏÑú","-(Ïúº)Î©∞",
      "-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî","-(Ïúº)„ÑπÍ≤åÏöî","-(Ïúº)„ÑπÎûòÏöî?","-(Ïúº)„ÑπÍπåÏöî?","-Îäî Í≤å Ïñ¥ÎïåÏöî?",
      "-Îäî Ï§ëÏù¥ÏóêÏöî","-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî","-(Ïúº)Î©¥ Ïïà ÎèºÏöî","-(Ïúº)ÎÇò","-(Ïúº)ÎØÄÎ°ú","-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº",
      "-(Ïúº)„ÑπÏàòÎ°ù","-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ","-(Ïúº)„ÑπÏßÄÎùºÎèÑ","-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê","-ÎèÑÎ°ù ÌïòÎã§",
      "-Í≤å ÎêòÎã§","-ÏïÑ/Ïñ¥ÏßÄÎã§","-Í∏∞ ÎßàÎ†®Ïù¥Îã§","-Í∏∞Ïóê","-Í∏∏Îûò","-Í≥† ÎßêÎã§","-Í≥†Ïûê ÌïòÎã§","-(Ïúº)„Ñπ ÎøêÏù¥Îã§"
    ];

    /* === TRADUCERI (coreeanƒÉ ‚Üí rom√¢nƒÉ, pe cuvinte) === */
    const translations = {
      subject:{
        "Ï†Ä":"eu (formal)","ÎÇò":"eu (informal)","ÎÑà":"tu","Ïö∞Î¶¨":"noi","ÎÑàÌù¨":"voi",
        "ÏÇ¨Îûå":"persoanƒÉ","ÌïôÏÉù":"student/ƒÉ","ÏÑ†ÏÉùÎãò":"profesor","ÏßÅÏõê":"angajat",
        "Î∂ÄÎ™®Îãò":"pƒÉrin»õi","ÏïÑÏù¥":"copil","Ïñ¥Î•∏":"adult","Í≥†Í∞ù":"client","ÏùòÏÇ¨":"medic",
        "Í∞ÑÌò∏ÏÇ¨":"asistentƒÉ","Ïó∞Íµ¨Ïûê":"cercetƒÉtor","ÎåÄÌëú":"reprezentant","ÌôòÏûê":"pacient"
      },
      time:{
        "Ïò§Îäò":"astƒÉzi","Ïñ¥Ï†ú":"ieri","ÎÇ¥Ïùº":"m√¢ine","ÏßÄÍ∏à":"acum","Î∞©Í∏à":"chiar acum",
        "Ï°∞Í∏à ÌõÑÏóê":"pu»õin mai t√¢rziu","Í≥ß":"√Æn cur√¢nd","ÏµúÍ∑ºÏóê":"recent","ÏöîÏ¶ò":"√Æn ultima vreme",
        "ÎßàÏπ®ÎÇ¥":"√Æn cele din urmƒÉ","Í≤∞Íµ≠":"p√¢nƒÉ la urmƒÉ","Ïù¥Ï†ÑÏóê":"√Ænainte","Ïù¥ÌõÑÏóê":"dupƒÉ",
        "ÎãπÏãúÏóê":"atunci","ÌïúÎèôÏïà":"o perioadƒÉ","Í≥ÑÏÜç":"continuƒÉ","Í∞ÄÎÅî":"din c√¢nd √Æn c√¢nd",
        "Ìï≠ÏÉÅ":"mereu","ÏûêÏ£º":"des","Ï†êÏ†ê":"din ce √Æn ce","Ï∞®Ï∏∞":"treptat",
        "ÏùºÏ∞ç":"devreme","Îä¶Í≤å":"t√¢rziu"
      },
      place:{
        "Ïßë":"acasƒÉ","ÌïôÍµê":"»ôcoalƒÉ","ÌöåÏÇ¨":"firmƒÉ / companie","ÏãùÎãπ":"restaurant","Ïπ¥Ìéò":"cafenea",
        "ÎèÑÏÑúÍ¥Ä":"bibliotecƒÉ","Î≥ëÏõê":"spital","ÏãúÏû•":"pia»õƒÉ","Î∞±ÌôîÏ†ê":"magazin universal",
        "Í≥µÌï≠":"aeroport","Í∏∞Ï∞®Ïó≠":"garƒÉ","Î≤ÑÏä§Ï†ïÎ•òÏû•":"sta»õie de autobuz","Ïó∞Íµ¨ÏÜå":"laborator",
        "Í∏∞Í¥Ä":"institu»õie","ÏßÄÏó≠ÏÇ¨Ìöå":"comunitate","ÌôòÍ≤Ω":"mediu","ÎåÄÍ∏∞ÏóÖ":"corpora»õie mare",
        "ÌöåÏùòÏã§":"salƒÉ de »ôedin»õe","Î≤ïÏõê":"instan»õƒÉ","Í≤ΩÏ∞∞ÏÑú":"sec»õie de poli»õie",
        "Ìï¥Î≥Ä":"plajƒÉ","ÏÇ∞":"munte","Í≥µÏõê":"parc","ÏùÄÌñâ":"bancƒÉ"
      },
      mod:{
        "Ïûò":"bine","Ïó¥Ïã¨Ìûà":"cu s√¢rguin»õƒÉ","Ï°∞Ïö©Ìûà":"√Æn lini»ôte","Ï≤úÏ≤úÌûà":"√Æncet",
        "Îπ®Î¶¨":"repede","Ï†ïÎßê":"cu adevƒÉrat","ÏïÑÏ£º":"foarte","ÎÑàÎ¨¥":"prea / foarte",
        "ÎßéÏù¥":"mult","Ï°∞Í∏à":"pu»õin","Í∞ëÏûêÍ∏∞":"brusc","ÎØ∏Î¶¨":"√Æn avans","Î≤åÏç®":"deja",
        "ÏïÑÍπå":"mai devreme","Î∞©Í∏à":"chiar acum","Í∏àÎ∞©":"imediat","Í≥ß":"√Æn cur√¢nd",
        "Ìï≠ÏÉÅ":"mereu","ÏûêÏ£º":"des","Í∞ÄÎÅî":"din c√¢nd √Æn c√¢nd","ÎìúÎ¨ºÍ≤å":"rar",
        "ÏÉÅÎãπÌûà":"destul de","ÍΩ§":"bini»ôor","ÎèÑÎåÄÏ≤¥":"(√Æn √ÆntrebƒÉri, ‚Äûoare deloc?‚Äù)",
        "Ï†àÎåÄÎ°ú":"niciodatƒÉ (interdic»õie)","Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú":"activ","Ï∂©Î∂ÑÌûà":"suficient",
        "ÌäπÌûà":"√Æn special","Ïò§ÌûàÎ†§":"mai degrabƒÉ","Ï†êÏ†ê":"din ce √Æn ce","Ï∞®Ï∏∞":"treptat",
        "Í≥ÑÏÜç":"√Æn mod continuu"
      },
      object:{
        "Ï±Ö":"carte","Ïª§Ìîº":"cafea","Î¨º":"apƒÉ","ÏùåÏãù":"m√¢ncare","ÏòÅÌôî":"film",
        "Í∞ÄÎ∞©":"geantƒÉ","Ï†ÑÌôî":"telefon","Ïò∑":"haine","ÏûêÎ£å":"materiale","Îç∞Ïù¥ÌÑ∞":"date",
        "Í≥ÑÌöç":"plan","Ï°∞Í±¥":"condi»õie","ÏÉÅÌô©":"situa»õie","Î¨∏Ï†ú":"problemƒÉ",
        "Ìï¥Í≤∞Ï±Ö":"solu»õie","ÏöîÏïΩ":"rezumat","Î≥¥Í≥†ÏÑú":"raport","Î¨∏ÏÑú":"document",
        "Ïª¥Ìì®ÌÑ∞":"calculator","ÎÖ∏Ìä∏Î∂Å":"laptop","Ìé∏ÏßÄ":"scrisoare","ÏÑ†Î¨º":"cadou",
        "ÏùòÍ≤¨":"opinie","Ï†ïÎ≥¥":"informa»õie","Í¥ÄÍ≥Ñ":"rela»õie","Í≤∞Í≥º":"rezultat",
        "ÏõêÏù∏":"cauzƒÉ","Î∞©Î≤ï":"metodƒÉ","Ï†úÌíà":"produs","ÏÑúÎπÑÏä§":"serviciu",
        "Ï†ïÏ±Ö":"politicƒÉ","Î¨∏Ìôî":"culturƒÉ"
      },
      numeral:{},
      counter:{
        "Í∞ú":"bucatƒÉ","Î™Ö":"persoanƒÉ","Í∂å":"volum (carte)","Ïû•":"foaie / paginƒÉ",
        "ÎåÄ":"aparat / vehicul","Î≥ë":"sticlƒÉ","Ïûî":"canƒÉ / pahar",
        "ÎßàÎ¶¨":"animal","Î≤à":"datƒÉ","ÏÇ¥":"ani (v√¢rstƒÉ)","ÏÜ°Ïù¥":"buchet / ciorchine",
        "Ï§Ñ":"r√¢nd / »ôir","Ï†ê":"punct","Í±¥":"caz","Ìöå":"datƒÉ (ocazie)",
        "Í∞ÄÏßÄ":"fel / tip","Ï™Ω":"paginƒÉ / direc»õie"
      },
      verb:{
        "Í∞ÄÎã§":"a merge","Ïò§Îã§":"a veni","Î®πÎã§":"a m√¢nca","ÎßàÏãúÎã§":"a bea","Î≥¥Îã§":"a vedea / a se uita",
        "ÏùΩÎã§":"a citi","Ïì∞Îã§":"a scrie","Î∞∞Ïö∞Îã§":"a √ÆnvƒÉ»õa","ÏÇ¨Îã§":"a cumpƒÉra","Ï£ºÎã§":"a da",
        "Î∞õÎã§":"a primi","ÏùºÌïòÎã§":"a lucra","Í≥µÎ∂ÄÌïòÎã§":"a studia","ÏöîÎ¶¨ÌïòÎã§":"a gƒÉti",
        "Ï≤≠ÏÜåÌïòÎã§":"a face curat","Ï§ÄÎπÑÌïòÎã§":"a pregƒÉti","ÎèÑÏôÄÏ£ºÎã§":"a ajuta",
        "ÏÇ¨Ïö©ÌïòÎã§":"a folosi","ÌïÑÏöîÌïòÎã§":"a fi necesar","Ï¢ãÏïÑÌïòÎã§":"a plƒÉcea",
        "Ïã´Ïñ¥ÌïòÎã§":"a nu plƒÉcea / a ur√Æ","Í∏∞Îã§Î¶¨Îã§":"a a»ôtepta","Ïâ¨Îã§":"a se odihni",
        "ÎßåÎÇòÎã§":"a se √Ænt√¢lni","Í±∑Îã§":"a merge pe jos","Îã¨Î¶¨Îã§":"a alerga",
        "ÏïâÎã§":"a se a»ôeza","ÏÑúÎã§":"a sta √Æn picioare","Í≤∞Ï†ïÌïòÎã§":"a decide",
        "Ï†úÏïàÌïòÎã§":"a propune","Ï†ÑÎã¨ÌïòÎã§":"a transmite","Ïú†ÏßÄÌïòÎã§":"a men»õine",
        "Î∞úÏÉùÌïòÎã§":"a se produce","Ï¶ùÍ∞ÄÌïòÎã§":"a cre»ôte","Í∞êÏÜåÌïòÎã§":"a scƒÉdea",
        "Ïù∏Ï†ïÌïòÎã§":"a recunoa»ôte","Î∂ÑÏÑùÌïòÎã§":"a analiza","Í¥ÄÏ∞∞ÌïòÎã§":"a observa",
        "Ìï¥Í≤∞ÌïòÎã§":"a rezolva","Ïó∞Íµ¨ÌïòÎã§":"a cerceta","ÌòëÎ†•ÌïòÎã§":"a colabora",
        "ÏöîÏ≤≠ÌïòÎã§":"a solicita","Ï∂©Ï°±ÌïòÎã§":"a satisface","ÎπÑÍµêÌïòÎã§":"a compara",
        "ÏÑ§Î™ÖÌïòÎã§":"a explica","ÏòàÏÉÅÌïòÎã§":"a anticipa"
      },
      conjug:{
        "-ÏïÑÏöî/Ïñ¥Ïöî":"prezent politicos",
        "-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî":"trecut politicos",
        "-Í≥† ÏûàÏñ¥Ïöî":"ac»õiune √Æn desfƒÉ»ôurare",
        "-Í≥† Ïã∂Ïñ¥Ïöî":"vreau sƒÉ...",
        "-(Ïúº)ÏÑ∏Ïöî":"imperativ / onorific",
        "-(Ïúº)„Ñπ Í±∞ÏòàÏöî":"viitor",
        "-ÏßÄ ÎßàÏÑ∏Ïöî":"nu face»õi..., vƒÉ rog",
        "-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî":"vƒÉ rog sƒÉ...",
        "-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî":"trebuie sƒÉ...",
        "-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî":"pot sƒÉ...",
        "-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî":"nu pot sƒÉ...",
        "-ÎçîÎùºÍ≥†Ïöî":"am observat cƒÉ...",
        "-ÎÑ§Ïöî":"exclamativ (observativ)",
        "-Íµ∞Ïöî":"exclamativ (constatare)",
        "-Í≥† ÎÇòÏÑú":"dupƒÉ ce...",
        "-Í∏∞ Ï†ÑÏóê":"√Ænainte sƒÉ...",
        "-(Ïúº)Î©¥ÏÑú":"√Æn timp ce...",
        "-(Ïúº)Î©∞":"»ôi (√Æn timp ce)",
        "-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî":"s-ar putea sƒÉ...",
        "-(Ïúº)„ÑπÍ≤åÏöî":"voi face (pentru tine)",
        "-(Ïúº)„ÑπÎûòÏöî?":"ai chef sƒÉ...? / vreau sƒÉ...",
        "-(Ïúº)„ÑπÍπåÏöî?":"sƒÉ facem...?",
        "-Îäî Í≤å Ïñ¥ÎïåÏöî?":"ce-ar fi sƒÉ...?",
        "-Îäî Ï§ëÏù¥ÏóêÏöî":"sunt √Æn curs de a...",
        "-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî":"po»õi sƒÉ..., e √Æn regulƒÉ",
        "-(Ïúº)Î©¥ Ïïà ÎèºÏöî":"nu ai voie sƒÉ...",
        "-ÎèÑÎ°ù ÌïòÎã§":"a face √Æn a»ôa fel √Ænc√¢t sƒÉ...",
        "-Í≤å ÎêòÎã§":"ajungi sƒÉ...",
        "-ÏïÑ/Ïñ¥ÏßÄÎã§":"a deveni...",
        "-Í∏∞Ïóê":"pentru cƒÉ..., fiindcƒÉ",
        "-Í∏∏Îûò":"pentru cƒÉ (a»ôa am vƒÉzut / sim»õit)",
        "-Í≥† ÎßêÎã§":"√Æn cele din urmƒÉ ajunge sƒÉ...",
        "-Í≥†Ïûê ÌïòÎã§":"a inten»õiona sƒÉ...",
        "-(Ïúº)„Ñπ ÎøêÏù¥Îã§":"doar..., nimic altceva"
      }
    };

    /* === SALVARE CUVINTE NOI === */
    const STORAGE_KEY="ralucaKoreanCustomWords_v2";
    const customData={
      subject:[],time:[],place:[],mod:[],object:[],
      numeral:[],counter:[],verb:[],conjug:[]
    };
    function loadCustomData(){
      try{
        const raw=localStorage.getItem(STORAGE_KEY);
        if(!raw)return;
        const saved=JSON.parse(raw);
        Object.keys(customData).forEach(k=>{
          if(Array.isArray(saved[k]))customData[k]=saved[k];
        });
        Object.entries(customData).forEach(([key,arr])=>{
          arr.forEach(entry=>{
            if(!entry||!entry.word)return;
            const w=entry.word,ro=entry.ro||"";
            let ref=null;
            if(key==="subject")ref=subjects;
            else if(key==="time")ref=times;
            else if(key==="place")ref=places;
            else if(key==="mod")ref=mods;
            else if(key==="object")ref=objects;
            else if(key==="numeral")ref=numerals;
            else if(key==="counter")ref=counters;
            else if(key==="verb")ref=verbs;
            else if(key==="conjug")ref=conjugations;
            if(ref&&!ref.includes(w))ref.push(w);
            if(!translations[key])translations[key]={};
            if(ro)translations[key][w]=ro;
          });
        });
      }catch(e){}
    }
    function saveCustomData(){
      try{localStorage.setItem(STORAGE_KEY,JSON.stringify(customData));}catch(e){}
    }
    loadCustomData();

    /* === HANGUL helperi pt conjugare === */
    const H_BASE=0xAC00;
    const JONG=["","„Ñ±","„Ñ≤","„Ñ≥","„Ñ¥","„Ñµ","„Ñ∂","„Ñ∑","„Ñπ","„Ñ∫","„Ñª","„Ñº","„ÑΩ","„Ñæ","„Ñø","„ÖÄ",
                "„ÖÅ","„ÖÇ","„ÖÑ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öä","„Öã","„Öå","„Öç","„Öé"];
    const JUNG=["„Öè","„Öê","„Öë","„Öí","„Öì","„Öî","„Öï","„Öñ","„Öó","„Öò","„Öô","„Öö","„Öõ",
                "„Öú","„Öù","„Öû","„Öü","„Ö†","„Ö°","„Ö¢","„Ö£"];

    function decomposeLastSyl(word){
      if(!word)return null;
      const ch=word.charCodeAt(word.length-1);
      const code=ch-H_BASE;
      if(code<0||code>11171)return null;
      const jong=code%28;
      const jung=((code-jong)/28)%21;
      const cho=Math.floor((code-jong)/28/21);
      return{cho,jung,jong,prefix:word.slice(0,-1)};
    }
    function hasBatchim(s){
      const d=decomposeLastSyl(s);
      return d?d.jong!==0:false;
    }
    function getVerbStem(dict){
      if(!dict)return"";
      return dict.endsWith("Îã§")?dict.slice(0,-1):dict;
    }

    /* verbe speciale */
    const specialVerbMap={
      "Í∞ÄÎã§":{present:"Í∞ÄÏöî",past:"Í∞îÏñ¥Ïöî"},
      "Ïò§Îã§":{present:"ÏôÄÏöî",past:"ÏôîÏñ¥Ïöî"},
      "Î≥¥Îã§":{present:"Î¥êÏöî",past:"Î¥§Ïñ¥Ïöî"},
      "ÌïòÎã§":{present:"Ìï¥Ïöî",past:"ÌñàÏñ¥Ïöî"},
      "Î®πÎã§":{past:"Î®πÏóàÏñ¥Ïöî"},
      "ÏùΩÎã§":{past:"ÏùΩÏóàÏñ¥Ïöî"},
      "ÎßàÏãúÎã§":{past:"ÎßàÏÖ®Ïñ¥Ïöî"},
      "ÏÇ¥Îã§":{past:"ÏÇ¥ÏïòÏñ¥Ïöî"}
    };

    function presentPolite(dict){
      if(specialVerbMap[dict]?.present)return specialVerbMap[dict].present;
      if(dict==="ÌïòÎã§")return"Ìï¥Ïöî";
      const stem=getVerbStem(dict);
      const d=decomposeLastSyl(stem);
      if(!d)return stem+"Ïöî";
      const v=JUNG[d.jung];
      const aGroup=["„Öè","„Öë","„Öó","„Öõ","„Öò","„Öô","„Öö"].includes(v);
      if(stem.length===1&&aGroup)return stem+"Ïöî";
      return stem+(aGroup?"ÏïÑÏöî":"Ïñ¥Ïöî");
    }
    function pastPolite(dict){
      if(specialVerbMap[dict]?.past)return specialVerbMap[dict].past;
      if(dict==="ÌïòÎã§")return"ÌñàÏñ¥Ïöî";
      const stem=getVerbStem(dict);
      const d=decomposeLastSyl(stem);
      if(!d)return stem+"ÏóàÏñ¥Ïöî";
      const v=JUNG[d.jung];
      const aGroup=["„Öè","„Öë","„Öó","„Öõ","„Öò","„Öô","„Öö"].includes(v);
      if(aGroup)return stem+"ÏïòÏñ¥Ïöî";
      return stem+"ÏóàÏñ¥Ïöî";
    }
    function stemPlusAeo(dict){
      if(dict==="ÌïòÎã§")return"Ìï¥";
      const stem=getVerbStem(dict);
      const d=decomposeLastSyl(stem);
      if(!d)return stem;
      const v=JUNG[d.jung];
      const aGroup=["„Öè","„Öë","„Öó","„Öõ","„Öò","„Öô","„Öö"].includes(v);
      if(stem.length===1&&aGroup)return stem;
      return stem+(aGroup?"ÏïÑ":"Ïñ¥");
    }

    /* FUTUR -(Ïúº)„Ñπ‚Ä¶ */
    function futureL(dict){
      const stem=getVerbStem(dict);
      const d=decomposeLastSyl(stem);
      if(!d)return stem+"·ÜØ";
      if(d.jong===0){
        const newCode=H_BASE + d.cho*21*28 + d.jung*28 + 8; // „Ñπ
        const ch=String.fromCharCode(newCode);
        return d.prefix+ch;
      }else{
        return stem+"ÏùÑ";
      }
    }

    /* conjugƒÉri legƒÉturƒÉ / timp */
    const linkingConjugations=new Set([
      "-Í≥† ÎÇòÏÑú","-Í∏∞ Ï†ÑÏóê","-(Ïúº)Î©¥ÏÑú","-(Ïúº)Î©∞",
      "-(Ïúº)ÎÇò","-(Ïúº)ÎØÄÎ°ú","-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº",
      "-(Ïúº)„ÑπÏàòÎ°ù","-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ","-(Ïúº)„ÑπÏßÄÎùºÎèÑ",
      "-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê","-ÎèÑÎ°ù ÌïòÎã§","-Í∏∞Ïóê","-Í∏∏Îûò","-Í≥† ÎßêÎã§","-Í≥†Ïûê ÌïòÎã§"
    ]);
    const isLinkingConj=v=>linkingConjugations.has(v);

    const timePastWords=new Set(["Ïñ¥Ï†ú","Ïù¥Ï†ÑÏóê","ÎãπÏãúÏóê","ÌïúÎèôÏïà","ÏµúÍ∑ºÏóê","ÎßàÏπ®ÎÇ¥","Í≤∞Íµ≠","Î∞©Í∏à"]);
    const timeFutureWords=new Set(["ÎÇ¥Ïùº","Ï°∞Í∏à ÌõÑÏóê","Í≥ß","Ïù¥ÌõÑÏóê"]);
    const conjPastLike=new Set(["-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî","-ÎçîÎùºÍ≥†Ïöî"]);
    const conjFutureLike=new Set(["-(Ïúº)„Ñπ Í±∞ÏòàÏöî","-(Ïúº)„ÑπÍ≤åÏöî","-(Ïúº)„ÑπÎûòÏöî?","-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî"]);
    function conjugationType(cj){
      if(!cj)return"none";
      if(conjPastLike.has(cj))return"past";
      if(conjFutureLike.has(cj))return"future";
      return"present";
    }

    /* === VERB + CONJUGARE ‚Üí expresie finalƒÉ coreeanƒÉ === */
    function buildVerbPhrase(dictVerb,cj){
      if(!dictVerb&&!cj)return"";
      if(!dictVerb)return cj||"";
      if(!cj)return dictVerb;

      // finale cunoscute
      if(cj==="-ÏïÑÏöî/Ïñ¥Ïöî")return presentPolite(dictVerb);
      if(cj==="-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî")return pastPolite(dictVerb);
      if(cj==="-(Ïúº)ÏÑ∏Ïöî")return futureL(dictVerb)+"ÏÑ∏Ïöî";
      if(cj==="-(Ïúº)„Ñπ Í±∞ÏòàÏöî")return futureL(dictVerb)+" Í±∞ÏòàÏöî";
      if(cj==="-(Ïúº)„ÑπÍ≤åÏöî")return futureL(dictVerb)+"Í≤åÏöî";
      if(cj==="-(Ïúº)„ÑπÎûòÏöî?")return futureL(dictVerb)+"ÎûòÏöî?";
      if(cj==="-(Ïúº)„ÑπÍπåÏöî?")return futureL(dictVerb)+"ÍπåÏöî?";
      if(cj==="-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî")return futureL(dictVerb)+" Ïàò ÏûàÏñ¥Ïöî";
      if(cj==="-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî")return futureL(dictVerb)+" Ïàò ÏóÜÏñ¥Ïöî";
      if(cj==="-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî")return futureL(dictVerb)+"ÏßÄÎèÑ Î™∞ÎùºÏöî";

      if(cj==="-Í≥† ÏûàÏñ¥Ïöî")return getVerbStem(dictVerb)+"Í≥† ÏûàÏñ¥Ïöî";
      if(cj==="-Í≥† Ïã∂Ïñ¥Ïöî")return getVerbStem(dictVerb)+"Í≥† Ïã∂Ïñ¥Ïöî";
      if(cj==="-ÏßÄ ÎßàÏÑ∏Ïöî")return getVerbStem(dictVerb)+"ÏßÄ ÎßàÏÑ∏Ïöî";
      if(cj==="-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî")return stemPlusAeo(dictVerb)+" Ï£ºÏÑ∏Ïöî";
      if(cj==="-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî")return stemPlusAeo(dictVerb)+"Ïïº ÎèºÏöî";
      if(cj==="-Îäî Ï§ëÏù¥ÏóêÏöî")return getVerbStem(dictVerb)+"Îäî Ï§ëÏù¥ÏóêÏöî";
      if(cj==="-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî")return stemPlusAeo(dictVerb)+"ÎèÑ ÎèºÏöî";

      if(cj==="-Í≤å ÎêòÎã§")return getVerbStem(dictVerb)+"Í≤å ÎèºÏöî";
      if(cj==="-ÏïÑ/Ïñ¥ÏßÄÎã§")return stemPlusAeo(dictVerb)+"ÏßÄÎã§";

      // conjugƒÉri de legƒÉturƒÉ
      if(isLinkingConj(cj)){
        if(cj==="-Í≥† ÎÇòÏÑú")return getVerbStem(dictVerb)+"Í≥† ÎÇòÏÑú";
        if(cj==="-Í∏∞ Ï†ÑÏóê")return getVerbStem(dictVerb)+"Í∏∞ Ï†ÑÏóê";
        if(cj.includes("Î©¥ÏÑú"))return getVerbStem(dictVerb)+"Î©¥ÏÑú";
        if(cj.includes("Î©∞"))return getVerbStem(dictVerb)+"Î©∞";
        if(cj==="-ÎèÑÎ°ù ÌïòÎã§")return getVerbStem(dictVerb)+"ÎèÑÎ°ù Ìï¥Ïöî";
        if(cj==="-Í≥† ÎßêÎã§")return getVerbStem(dictVerb)+"Í≥† ÎßêÏïòÏñ¥Ïöî";
        if(cj==="-Í≥†Ïûê ÌïòÎã§")return getVerbStem(dictVerb)+"Í≥†Ïûê Ìï¥Ïöî";
        if(cj==="-Í∏∞Ïóê")return getVerbStem(dictVerb)+"Í∏∞Ïóê";
        if(cj==="-Í∏∏Îûò")return getVerbStem(dictVerb)+"Í∏∏Îûò";
        return getVerbStem(dictVerb)+cj.replace(/^-/, "");
      }

      // FINAL NOU adƒÉugat de utilizator:
      // - scoatem "-" de la √Ænceput
      // - dacƒÉ √Æncepe cu hangul ‚Üí lipim direct (Í∞Ä + Í≥† ÏûàÏóàÏñ¥Ïöî ‚Üí Í∞ÄÍ≥† ÏûàÏóàÏñ¥Ïöî)
      // - altfel ‚Üí punem spa»õiu
      let raw=cj.replace(/^-/, "");
      raw=raw.trimStart();
      const stem=getVerbStem(dictVerb);
      if(!raw)return stem;
      if(/^[Í∞Ä-Ìû£]/.test(raw[0])){
        return stem+raw;
      }
      return stem+" "+raw;
    }

    /* === RESTUL APP-ULUI (builder, preview etc.) === */

    const glossaryEntries=[];
    const columns=[
      {key:"subject",title:"SUBJECT",ko:"Ï£ºÏñ¥",data:subjects,hint:"Cine?",allowCustom:true},
      {key:"time",title:"TIME",ko:"ÏãúÍ∞Ñ",data:times,hint:"C√¢nd?",allowCustom:true},
      {key:"place",title:"PLACE",ko:"Ïû•ÏÜå",data:places,hint:"Unde?",allowCustom:true},
      {key:"mod",title:"MOD",ko:"Î∞©Î≤ï",data:mods,hint:"Cum?",allowCustom:true},
      {key:"object",title:"OBJECT",ko:"Î™©Ï†ÅÏñ¥",data:objects,hint:"Ce?",allowCustom:true},
      {key:"numeral",title:"NUMERAL",ko:"",data:numerals,hint:"NumƒÉr",allowCustom:true},
      {key:"counter",title:"COUNTER",ko:"ÏàòÎüâÏÇ¨",data:counters,hint:"Clasificator",allowCustom:true},
      {key:"verb",title:"VERB",ko:"ÎèôÏÇ¨",data:verbs,hint:"Ac»õiune",allowCustom:true},
      {key:"conjug",title:"CONJUGƒÇRI",ko:"",data:conjugations,hint:"FormƒÉ verbalƒÉ",allowCustom:true}
    ];
    const maxLen=Math.max(...columns.map(c=>c.data.length));

    let index=0;
    const stateP1={},stateP2={},activeP1={},activeP2={};
    columns.forEach(col=>{
      stateP1[col.key]=col.data[0]||"";
      stateP2[col.key]=col.data[0]||"";
      activeP1[col.key]=true;
      activeP2[col.key]=true;
    });

    const tableP1=document.getElementById("tableP1");
    const tableP2=document.getElementById("tableP2");
    const titleP2=document.getElementById("titleP2");
    const togglesP1=document.getElementById("togglesP1");
    const togglesP2=document.getElementById("togglesP2");
    const enableP2=document.getElementById("enableP2");
    const prevBtn=document.getElementById("prevBtn");
    const nextBtn=document.getElementById("nextBtn");
    const resetBtn=document.getElementById("resetBtn");
    const pageInfoEl=document.getElementById("pageInfo");
    const previewKo=document.getElementById("previewKo");
    const previewRo=document.getElementById("previewRo");
    const naturalHint=document.getElementById("naturalHint");
    const toggleRoBtn=document.getElementById("toggleRoBtn");
    const randomBtn=document.getElementById("randomBtn");
    const speakBtn=document.getElementById("speakBtn");
    const favBtn=document.getElementById("favBtn");
    const overlay=document.getElementById("overlay");
    const panelTitle=document.getElementById("panelTitle");
    const panelSub=document.getElementById("panelSub");
    const panelList=document.getElementById("panelList");
    const closePanelBtn=document.getElementById("closePanelBtn");
    const panelSearchInput=document.getElementById("panelSearchInput");
    const newWordInput=document.getElementById("newWordInput");
    const newWordTransInput=document.getElementById("newWordTransInput");
    const addWordBtn=document.getElementById("addWordBtn");
    const modeButtons=document.querySelectorAll(".small-mode-btn");
    const subtitleEl=document.getElementById("subtitle");
    const screens={
      builder:document.getElementById("screen-builder"),
      exercises:document.getElementById("screen-exercises"),
      glossary:document.getElementById("screen-glossary")
    };
    const navButtons=document.querySelectorAll(".nav-btn");
    const favoritesListEl=document.getElementById("favoritesList");
    const favorites=[];
    const glossarySearch=document.getElementById("glossarySearch");
    const glossaryList=document.getElementById("glossaryList");

    /* mod simplu / TOPIK */
    let currentMode="topik";
    const simpleColumnsSet={subject:true,time:true,object:true,verb:true,conjug:true};
    function isColumnVisible(key){
      return currentMode==="topik"||!!simpleColumnsSet[key];
    }
    modeButtons.forEach(btn=>{
      btn.addEventListener("click",()=>{
        currentMode=btn.dataset.mode;
        modeButtons.forEach(b=>b.classList.toggle("active",b===btn));
        render();
      });
    });

    /* navigare ecrane */
    function setScreen(name){
      Object.entries(screens).forEach(([k,el])=>{
        el.classList.toggle("active",k===name);
      });
      navButtons.forEach(btn=>btn.classList.toggle("active",btn.dataset.target===name));
      if(name==="builder")subtitleEl.textContent="Builder propozi»õii + particule + audio + conjugƒÉri";
      else if(name==="exercises")subtitleEl.textContent="Exerci»õii TOPIK ‚Äì √Æn lucru";
      else subtitleEl.textContent="Glosar + propozi»õii favorite";
    }
    navButtons.forEach(btn=>btn.addEventListener("click",()=>setScreen(btn.dataset.target)));

    /* toggles P1 / P2 */
    function createToggleChips(){
      columns.forEach(col=>{
        const chip1=document.createElement("label");
        chip1.className="chip";
        const cb1=document.createElement("input");
        cb1.type="checkbox";cb1.checked=true;cb1.dataset.key=col.key;cb1.dataset.clause="p1";
        chip1.appendChild(cb1);chip1.append(col.title);togglesP1.appendChild(chip1);

        const chip2=document.createElement("label");
        chip2.className="chip";
        const cb2=document.createElement("input");
        cb2.type="checkbox";cb2.checked=true;cb2.dataset.key=col.key;cb2.dataset.clause="p2";
        chip2.appendChild(cb2);chip2.append(col.title);togglesP2.appendChild(chip2);
      });
      const sync=(wrapper,map)=>{
        wrapper.addEventListener("change",e=>{
          const cb=e.target;if(cb.tagName!=="INPUT")return;
          map[cb.dataset.key]=cb.checked;render();
        });
      };
      sync(togglesP1,activeP1);
      sync(togglesP2,activeP2);
    }
    createToggleChips();

    enableP2.addEventListener("change",()=>{
      const on=enableP2.checked;
      if(on){titleP2.classList.remove("hidden");tableP2.classList.remove("hidden");}
      else{titleP2.classList.add("hidden");tableP2.classList.add("hidden");}
      updatePreview();
    });

    /* helper particule */
    const pronouns=new Set(["Ï†Ä","ÎÇò","ÎÑà","Ïö∞Î¶¨","ÎÑàÌù¨"]);
    function addSubjectWithParticle(word){
      if(!word)return"";
      const b=hasBatchim(word);
      if(pronouns.has(word))return word+(b?"ÏùÄ":"Îäî");
      return word+(b?"Ïù¥":"Í∞Ä");
    }
    const timeAdverbsNoParticle=new Set(["Ïò§Îäò","Ïñ¥Ï†ú","ÎÇ¥Ïùº","ÏßÄÍ∏à","Î∞©Í∏à","ÏöîÏ¶ò","Ìï≠ÏÉÅ","ÏûêÏ£º","Í∞ÄÎÅî","Í≥ÑÏÜç","Ï†êÏ†ê","Ï∞®Ï∏∞"]);
    function addTimeWithParticle(word){
      if(!word)return"";
      if(timeAdverbsNoParticle.has(word))return word;
      return word+"Ïóê";
    }
    function addPlaceWithParticle(word){
      if(!word)return"";
      return word+"ÏóêÏÑú";
    }
    function addObjectWithParticle(word){
      if(!word)return"";
      return word+(hasBatchim(word)?"ÏùÑ":"Î•º");
    }

    /* desenare coloane */
    function renderClauseRow(container,activeMap,state,clauseId){
      container.innerHTML="";
      columns.forEach(col=>{
        if(!isColumnVisible(col.key))return;
        const colDiv=document.createElement("div");
        colDiv.className="col";
        if(!activeMap[col.key])colDiv.classList.add("dimmed");
        colDiv.dataset.key=col.key;
        colDiv.dataset.clause=clauseId;

        const header=document.createElement("div");
        header.className="col-header";
        header.textContent=col.title+(col.ko?` (${col.ko})`:"");
        colDiv.appendChild(header);

        const label=document.createElement("div");
        label.className="col-body-label";
        label.textContent=col.hint||"";
        colDiv.appendChild(label);

        const main=document.createElement("div");
        main.className="col-body-main";
        main.textContent=state[col.key]||"";
        colDiv.appendChild(main);

        const extra=document.createElement("div");
        extra.className="col-body-extra";
        if(col.key==="conjug"&&state[col.key]&&isLinkingConj(state[col.key]))extra.textContent="‚≠ê cere propozi»õia 2";
        colDiv.appendChild(extra);
        container.appendChild(colDiv);
      });
    }

    /* NATURALITATE simplƒÉ (timp vs timp verbal) */
    function analyzeNaturalnessP1(){
      const t=stateP1.time;
      const cj=stateP1.conjug;
      if(!t||!cj)return{ok:true,msg:"",suggestion:null};
      const tType=timePastWords.has(t)?"past":
                  timeFutureWords.has(t)?"future":"neutral";
      const cType=conjugationType(cj);
      if(tType==="past"&&cType==="future"){
        const suggested="-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî";
        const sent=buildClauseSentence(stateP1,activeP1,suggested);
        return{
          ok:false,
          msg:`‚Äû${t}‚Äù (trecut) cu final viitor ‚Äû${cj}‚Äù nu se prea folose»ôte. Exemplu mai natural:`,
          suggestion:sent.ko
        };
      }
      if(tType==="future"&&cType==="past"){
        const suggested="-(Ïúº)„Ñπ Í±∞ÏòàÏöî";
        const sent=buildClauseSentence(stateP1,activeP1,suggested);
        return{
          ok:false,
          msg:`‚Äû${t}‚Äù (viitor) cu final de trecut ‚Äû${cj}‚Äù poate suna nenatural. Exemplu mai natural:`,
          suggestion:sent.ko
        };
      }
      return{ok:true,msg:"",suggestion:null};
    }

    let showRo=true;

    /* construc»õie propozi»õie + traducere A (cursivƒÉ) */
    function buildClauseSentence(state,activeMap,conjOverride){
      const koParts=[];
      const use=k=>activeMap[k]!==false && isColumnVisible(k);

      let subjText=null,timeText=null,placeText=null,modText=null;
      let numText=null,counterText=null,objText=null,verbText=null;

      const subj=state.subject;
      if(subj&&use("subject")){
        koParts.push(addSubjectWithParticle(subj));
        subjText=(translations.subject&&translations.subject[subj])||subj;
      }

      const t=state.time;
      if(t&&use("time")){
        koParts.push(addTimeWithParticle(t));
        timeText=(translations.time&&translations.time[t])||t;
      }

      const p=state.place;
      if(p&&use("place")){
        koParts.push(addPlaceWithParticle(p));
        placeText=(translations.place&&translations.place[p])||p;
      }

      const m=state.mod;
      if(m&&use("mod")){
        koParts.push(m);
        modText=(translations.mod&&translations.mod[m])||m;
      }

      const obj=state.object;
      if(obj&&use("object")){
        koParts.push(addObjectWithParticle(obj));
        objText=(translations.object&&translations.object[obj])||obj;
      }

      const num=state.numeral;
      if(num&&use("numeral")){
        koParts.push(num);
        numText=(translations.numeral&&translations.numeral[num])||num;
      }

      const cnt=state.counter;
      if(cnt&&use("counter")){
        koParts.push(cnt);
        counterText=(translations.counter&&translations.counter[cnt])||cnt;
      }

      const v=state.verb;
      const cjUsed=conjOverride||state.conjug;
      if(v||cjUsed){
        const vp=buildVerbPhrase(v,cjUsed);
        if(vp){
          koParts.push(vp);
          const roVerb=(translations.verb&&translations.verb[v])||v||"";
          const cjExp=(translations.conjug&&translations.conjug[cjUsed])||"";
          if(roVerb){
            verbText = cjExp ? `${roVerb} (${cjExp})` : roVerb;
          }else{
            verbText = cjExp;
          }
        }
      }

      // propozi»õie cursivƒÉ √Æn rom√¢nƒÉ ‚Äì VARIANTA A
      const roPieces=[];
      if(timeText)  roPieces.push(timeText);
      if(subjText)  roPieces.push(subjText);
      if(placeText) roPieces.push(placeText);
      if(modText)   roPieces.push(modText);

      let objChunk="";
      if(numText)      objChunk += numText+" ";
      if(counterText)  objChunk += counterText+" ";
      if(objText)      objChunk += objText;
      objChunk=objChunk.trim();
      if(objChunk)roPieces.push(objChunk);

      let roSentence=roPieces.join(" ");
      if(verbText){
        if(roSentence)roSentence+=" ";
        roSentence+=verbText;
      }
      if(!roSentence){
        roSentence="(fƒÉrƒÉ traducere disponibilƒÉ √ÆncƒÉ)";
      }else{
        roSentence=roSentence.charAt(0).toUpperCase()+roSentence.slice(1);
      }

      return{
        ko:koParts.join(" "),
        roText:roSentence,
        time:t,
        conj:cjUsed
      };
    }

    function updatePreview(){
      const c1=buildClauseSentence(stateP1,activeP1,null);
      let koText=c1.ko;
      let roText=c1.roText;

      const conj1=stateP1.conjug;
      if(enableP2.checked && conj1 && isLinkingConj(conj1)){
        const c2=buildClauseSentence(stateP2,activeP2,null);
        if(c2.ko){
          koText += " / " + c2.ko;
          roText += " // " + c2.roText;
        }
      }

      if(!koText){
        previewKo.textContent="(alege cuvinte din tabel)";
        previewRo.textContent="";
        naturalHint.textContent="";
        return;
      }
      previewKo.textContent=koText;
      previewRo.textContent=showRo ? roText : "¬∑¬∑¬∑ traducere ascunsƒÉ ¬∑¬∑¬∑";

      const nat=analyzeNaturalnessP1();
      if(nat.ok){
        naturalHint.textContent="‚úÖ Naturalitate: OK (dupƒÉ regulile simple introduce √Æn aplica»õie)";
      }else{
        naturalHint.textContent=`‚ö† ${nat.msg} „Äå${nat.suggestion}„Äç`;
      }
    }

    function loadRow(i){
      columns.forEach(col=>{
        stateP1[col.key]=col.data[i]||"";
      });
    }

    prevBtn.addEventListener("click",()=>{
      if(index>0){index--;loadRow(index);render();}
    });
    nextBtn.addEventListener("click",()=>{
      if(index<maxLen-1){index++;loadRow(index);render();}
    });
    resetBtn.addEventListener("click",()=>{
      [...togglesP1.querySelectorAll("input")].forEach(cb=>{cb.checked=true;activeP1[cb.dataset.key]=true;});
      [...togglesP2.querySelectorAll("input")].forEach(cb=>{cb.checked=true;activeP2[cb.dataset.key]=true;});
      render();
    });
    toggleRoBtn.addEventListener("click",()=>{
      showRo=!showRo;
      toggleRoBtn.textContent=showRo?"Ascunde traducerea":"AratƒÉ traducerea";
      updatePreview();
    });

    /* panel liste + adƒÉugare cuv√¢nt nou */
    let panelClause="p1",panelKey="subject";
    function renderPanelList(col){
      panelList.innerHTML="";
      const key=col.key;
      const map=translations[key]||{};
      const filter=(panelSearchInput.value||"").trim().toLowerCase();
      const words=col.data.filter(w=>{
        if(!w)return false;
        if(!filter)return true;
        return w.toLowerCase().includes(filter) || (map[w]||"").toLowerCase().includes(filter);
      });
      if(!words.length){
        const empty=document.createElement("div");
        empty.className="panel-item";
        empty.textContent="Nu existƒÉ cuvinte pentru filtrul introdus.";
        panelList.appendChild(empty);
        return;
      }
      words.forEach(word=>{
        const item=document.createElement("div");
        item.className="panel-item";
        const main=document.createElement("div");
        main.className="panel-item-main";
        main.textContent=word;
        item.appendChild(main);

        const extra=document.createElement("div");
        extra.className="panel-item-extra";
        const ro=map[word];
        if(ro){
          const tag=document.createElement("div");
          tag.className="panel-item-tag";
          tag.textContent=ro;
          extra.appendChild(tag);
        }
        if(key==="conjug"&&isLinkingConj(word)){
          const star=document.createElement("div");
          star.className="panel-item-tag";
          star.textContent="‚≠ê P2";
          extra.appendChild(star);
        }
        item.appendChild(extra);

        item.addEventListener("click",()=>{
          const target=panelClause==="p1"?stateP1:stateP2;
          target[key]=word;
          if(key==="conjug"&&isLinkingConj(word)){
            enableP2.checked=true;
            titleP2.classList.remove("hidden");
            tableP2.classList.remove("hidden");
          }
          overlay.classList.remove("visible");
          render();
        });

        panelList.appendChild(item);
      });
    }
    function openPanel(clause,key){
      panelClause=clause;panelKey=key;
      const col=columns.find(c=>c.key===key);if(!col)return;
      panelTitle.textContent=(clause==="p1"?"Propozi»õia 1 ‚Äì ":"Propozi»õia 2 ‚Äì ")+col.title;
      panelSub.textContent=col.hint||"";
      panelSearchInput.value="";newWordInput.value="";newWordTransInput.value="";
      renderPanelList(col);
      overlay.classList.add("visible");
      panelSearchInput.focus();
    }
    closePanelBtn.addEventListener("click",()=>overlay.classList.remove("visible"));
    overlay.addEventListener("click",e=>{if(e.target===overlay)overlay.classList.remove("visible");});
    panelSearchInput.addEventListener("input",()=>{
      const col=columns.find(c=>c.key===panelKey);
      if(col)renderPanelList(col);
    });
    addWordBtn.addEventListener("click",()=>{
      const txt=newWordInput.value.trim();
      if(!txt)return;
      const roTxt=(newWordTransInput.value||"").trim();
      const col=columns.find(c=>c.key===panelKey);
      if(!col||!col.allowCustom)return;

      if(!col.data.includes(txt))col.data.push(txt);
      if(!translations[panelKey])translations[panelKey]={};
      if(roTxt)translations[panelKey][txt]=roTxt;

      if(!customData[panelKey])customData[panelKey]=[];
      const exists=customData[panelKey].some(e=>e.word===txt);
      if(!exists)customData[panelKey].push({word:txt,ro:roTxt});
      else customData[panelKey].forEach(e=>{if(e.word===txt)e.ro=roTxt;});
      saveCustomData();

      newWordInput.value="";newWordTransInput.value="";
      renderPanelList(col);
    });

    /* click scurt / long press pe coloanƒÉ */
    let longPressTimer=null,pressTarget=null;
    function cycleColumnValue(clause,key){
      const col=columns.find(c=>c.key===key);if(!col)return;
      const arr=col.data;
      const state=clause==="p1"?stateP1:stateP2;
      const cur=state[key];
      let idx=arr.indexOf(cur);
      if(idx===-1)idx=0;
      let nextIdx=(idx+1)%arr.length;
      state[key]=arr[nextIdx]||"";
      render();
    }
    function attachPressHandlers(tableEl){
      tableEl.addEventListener("pointerdown",e=>{
        const colDiv=e.target.closest(".col");if(!colDiv)return;
        e.preventDefault();
        pressTarget=colDiv;
        longPressTimer=setTimeout(()=>{
          if(pressTarget===colDiv){
            openPanel(colDiv.dataset.clause||"p1",colDiv.dataset.key);
            pressTarget=null;
          }
        },450);
      });
      tableEl.addEventListener("pointerup",e=>{
        const colDiv=e.target.closest(".col");
        if(longPressTimer){clearTimeout(longPressTimer);longPressTimer=null;}
        if(pressTarget&&colDiv===pressTarget){
          cycleColumnValue(colDiv.dataset.clause||"p1",colDiv.dataset.key);
        }
        pressTarget=null;
      });
      tableEl.addEventListener("pointerleave",()=>{
        if(longPressTimer){clearTimeout(longPressTimer);longPressTimer=null;}
        pressTarget=null;
      });
    }
    attachPressHandlers(tableP1);
    attachPressHandlers(tableP2);

    /* random, audio, favorite */
    randomBtn.addEventListener("click",()=>{
      columns.forEach(col=>{
        if(!activeP1[col.key]||!isColumnVisible(col.key))return;
        const arr=col.data.filter(x=>x!==""&&x!=null);
        if(!arr.length)return;
        stateP1[col.key]=arr[Math.floor(Math.random()*arr.length)];
      });
      render();
    });
    speakBtn.addEventListener("click",()=>{
      if(!("speechSynthesis"in window)){alert("Browserul nu suportƒÉ audio.");return;}
      const text=previewKo.textContent;
      if(!text||text.includes("alege cuvinte"))return;
      const u=new SpeechSynthesisUtterance(text);
      u.lang="ko-KR";
      const vs=window.speechSynthesis.getVoices();
      const koV=vs.find(v=>v.lang&&v.lang.toLowerCase().startsWith("ko"));
      if(koV)u.voice=koV;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    });
    function renderFavorites(){
      if(!favoritesListEl)return;
      favoritesListEl.innerHTML="";
      if(!favorites.length){
        const div=document.createElement("div");
        div.className="small-label";
        div.textContent="Nu ai salvat √ÆncƒÉ nicio propozi»õie.";
        favoritesListEl.appendChild(div);
        return;
      }
      favorites.forEach(f=>{
        const item=document.createElement("div");
        item.className="fav-item";
        const ko=document.createElement("div");
        ko.className="fav-ko";
        ko.textContent=f.ko;
        const ro=document.createElement("div");
        ro.className="fav-ro";
        ro.textContent=f.ro;
        item.appendChild(ko);item.appendChild(ro);
        favoritesListEl.appendChild(item);
      });
    }
    favBtn.addEventListener("click",()=>{
      const ko=previewKo.textContent.trim();
      let ro=previewRo.textContent.trim();
      if(!ko||ko.includes("alege cuvinte"))return;
      if(ro.startsWith("¬∑¬∑¬∑"))ro="";
      const exists=favorites.some(f=>f.ko===ko&&f.ro===ro);
      if(!exists)favorites.push({ko,ro});
      renderFavorites();
      favBtn.textContent="‚≠ê Salvat!";
      setTimeout(()=>{favBtn.textContent="‚≠ê SalveazƒÉ propozi»õia";},800);
    });

    /* glosar */
    function addGlossaryFrom(list,catKey,catLabel){
      const map=translations[catKey]||{};
      list.forEach(w=>{
        if(!w)return;
        const ro=map[w]||"(fƒÉrƒÉ traducere √ÆncƒÉ)";
        glossaryEntries.push({ko:w,ro,category:catLabel});
      });
    }
    addGlossaryFrom(subjects,"subject","SUBJECT");
    addGlossaryFrom(times,"time","TIME");
    addGlossaryFrom(places,"place","PLACE");
    addGlossaryFrom(mods,"mod","MOD");
    addGlossaryFrom(objects,"object","OBJECT");
    addGlossaryFrom(counters,"counter","COUNTER");
    addGlossaryFrom(verbs,"verb","VERB");
    addGlossaryFrom(conjugations,"conjug","CONJUGƒÇRI");

    function renderGlossary(filter){
      if(!glossaryList)return;
      filter=(filter||"").toLowerCase();
      glossaryList.innerHTML="";
      const filtered=glossaryEntries.filter(e=>{
        if(!filter)return true;
        return e.ko.toLowerCase().includes(filter)||e.ro.toLowerCase().includes(filter);
      });
      if(!filtered.length){
        const div=document.createElement("div");
        div.className="small-label";
        div.textContent="Nu s-a gƒÉsit nimic pentru cƒÉutarea introdusƒÉ.";
        glossaryList.appendChild(div);
        return;
      }
      filtered.forEach(e=>{
        const item=document.createElement("div");
        item.className="glossary-item";
        const left=document.createElement("div");
        const ko=document.createElement("div");
        ko.className="glossary-ko";ko.textContent=e.ko;
        const ro=document.createElement("div");
        ro.className="glossary-ro";ro.textContent=e.ro;
        left.appendChild(ko);left.appendChild(ro);
        const cat=document.createElement("div");
        cat.className="glossary-cat";cat.textContent=e.category;
        item.appendChild(left);item.appendChild(cat);
        glossaryList.appendChild(item);
      });
    }
    if(glossarySearch)glossarySearch.addEventListener("input",()=>renderGlossary(glossarySearch.value));

    /* ini»õializare */
    function render(){
      renderClauseRow(tableP1,activeP1,stateP1,"p1");
      if(enableP2.checked)renderClauseRow(tableP2,activeP2,stateP2,"p2");
      pageInfoEl.textContent=`R√¢nd model: ${index+1} / ${maxLen}`;
      prevBtn.disabled=index===0;
      nextBtn.disabled=index===maxLen-1;
      updatePreview();
    }
    loadRow(index);
    setScreen("builder");
    render();
    renderFavorites();
    renderGlossary("");
  </script>
</body>
</html>
