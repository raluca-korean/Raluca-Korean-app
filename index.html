<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean ‚Äì Builder P2 Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ===== Pastel simplu ‚Äì doar pentru test ===== */
    :root{
      --bg1:#dff3ff;
      --bg2:#ffe9ff;
      --bg3:#f4fffc;
      --bg4:#e8f0ff;

      --accent:#7b5dff;
      --accent-soft:#f6b5ff;
      --card-bg:#ffffffcc;
      --text-main:#2f343b;
      --text-soft:#7a8088;
      --border:#e1d7c7;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text-main);
      background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
      background-size:380% 380%;
      animation:bgFlow 28s ease-in-out infinite;
    }
    @keyframes bgFlow{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .app{
      max-width:1040px;
      margin:0 auto;
      padding:18px 14px 80px;
    }

    .rk-header{
      position:relative;
      padding:12px 16px 16px;
      border-radius:26px;
      background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
      color:#fff;
      box-shadow:0 18px 45px rgba(77,93,255,0.4);
    }
    .rk-header-main{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .rk-header-main h1{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    .rk-badge{
      font-size:11px;
      font-weight:600;
      padding:4px 9px;
      border-radius:999px;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.4);
    }
    #subtitle{
      margin:8px 0 0;
      font-size:12px;
    }

    .card{
      margin-top:16px;
      padding:16px 18px 18px;
      border-radius:22px;
      background:var(--card-bg);
      backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 18px 40px rgba(0,0,0,0.12);
    }
    .card h2{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      letter-spacing:0.03em;
    }

    textarea{
      width:100%;
      border-radius:16px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:14px;
      resize:vertical;
      min-height:70px;
      color:var(--text-main);
      background:#fff;
    }
    textarea:focus{
      outline:none;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.9),
        0 0 0 3px rgba(149,120,255,0.5);
      border-color:rgba(149,120,255,0.7);
    }

    .btn-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    button{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      color:#fff;
      background:linear-gradient(135deg,#6b8cff,#9b6bff);
      box-shadow:
        0 10px 24px rgba(108,110,210,0.4),
        0 0 0 1px rgba(255,255,255,0.7) inset;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    button.secondary{
      background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(0,0,0,0.18);
      filter:brightness(1.03);
    }
    button:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
      filter:brightness(0.97);
    }

    .section-title{
      margin-top:18px;
      margin-bottom:6px;
      font-size:13px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#4b607d;
    }

    .table-block{
      margin-top:6px;
      padding:10px 10px 12px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 14px 30px rgba(0,0,0,0.1);
    }
    .table-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      font-weight:700;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .table-horizontal{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding-bottom:4px;
    }

    .col{
      min-width:110px;
      max-width:140px;
      flex:0 0 auto;
      border-radius:16px;
      padding:7px 7px 9px;
      background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
      border:1px solid #e2d7c8;
      box-shadow:0 10px 22px rgba(95,78,58,0.16);
    }
    .col-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:4px;
      font-size:10px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#7b5dff;
      border-bottom:1px solid rgba(208,196,255,0.8);
      padding-bottom:2px;
      margin-bottom:3px;
    }
    .col-header::before{
      content:"";
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:16px;
      height:16px;
      border-radius:6px;
      background:#fff;
      font-size:11px;
      box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    .col[data-key="subject"] .col-header::before{content:"üë§";}
    .col[data-key="time"]    .col-header::before{content:"‚è∞";}
    .col[data-key="place"]   .col-header::before{content:"üìç";}
    .col[data-key="mod"]     .col-header::before{content:"‚ú®";}
    .col[data-key="object"]  .col-header::before{content:"üéØ";}
    .col[data-key="numeral"] .col-header::before{content:"#Ô∏è‚É£";}
    .col[data-key="counter"] .col-header::before{content:"üî¢";}
    .col[data-key="verb"]    .col-header::before{content:"üöÄ";}
    .col[data-key="conjug"]    .col-header::before{content:"üîó";}

    .col-body-label{
      font-size:10px;
      color:#938777;
      margin-bottom:1px;
    }
    .col-body-main{
      font-size:15px;
      font-weight:700;
      min-height:1.4em;
    }
    .col-body-main[contenteditable="true"]{
      outline:none;
      cursor:text;
    }
    .col-body-main:focus{
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.8),
        0 0 0 2px rgba(149,120,255,0.7);
      border-radius:6px;
    }

    .col-body-extra.example{
      margin-top:2px;
      font-size:10px;
      color:#b09b83;
    }

    .builder-enable-p2{
      margin-top:6px;
      padding-top:6px;
      border-top:1px dashed var(--border);
      font-size:11px;
      display:flex;
      justify-content:flex-end;
      color:var(--text-soft);
    }
    .builder-enable-p2 label{
      display:flex;
      align-items:center;
      gap:4px;
    }

    .hidden{display:none !important;}

    .preview-card{
      margin-top:14px;
      padding:12px 14px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 16px 32px rgba(0,0,0,0.12);
    }
    .preview-title{
      font-size:12px;
      font-weight:700;
      color:#4b607d;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .preview-sentence{
      font-size:22px;
      font-weight:800;
      line-height:1.6;
      margin-bottom:4px;
    }
    .preview-ro{
      font-size:12px;
      color:var(--text-soft);
    }

    @media (max-width:600px){
      .rk-header-main h1{font-size:17px;}
      .col{min-width:95px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="rk-header">
      <div class="rk-header-main">
        <h1>RALUCA KOREAN</h1>
        <span class="rk-badge">Builder P2 ‚Äì test</span>
      </div>
      <p id="subtitle">
        Versiune micƒÉ de test pentru Propozi»õia 2, fraze lungi »ôi Rom√¢nƒÉ ‚Üí CoreeanƒÉ.
      </p>
    </header>

    <!-- Rom√¢nƒÉ ‚Üí CoreeanƒÉ (builder automat) -->
    <section class="card" id="roCard">
            <h2>Rom√¢nƒÉ ‚Üí CoreeanƒÉ (Builder automat)</h2>
      <p style="font-size:12px;color:var(--text-soft);margin-top:0;margin-bottom:4px;">
        Scrie o propozi»õie simplƒÉ √Æn rom√¢nƒÉ sau englezƒÉ (ex:
        <em>AstƒÉzi merg la cafenea »ôi beau o cafea. / Today I go to the cafe and drink a coffee.</em>),
        apoi apasƒÉ pe buton.
      </p>
      <div style="margin-bottom:6px;font-size:11px;color:var(--text-soft);display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <span>Limba propozi»õiei de mai sus:</span>
        <select id="langSelect" style="padding:2px 6px;border-radius:999px;border:1px solid var(--border);font-size:11px;">
          <option value="ro" selected>Rom√¢nƒÉ</option>
          <option value="en">English</option>
        </select>
      </div>
      <textarea id="roInput" placeholder="Scrie aici propozi»õia ta‚Ä¶"></textarea>

      <div class="btn-row">
        <button id="autoFillBtn">CompleteazƒÉ automat builder-ul</button>
        <button id="clearBtn" class="secondary">CurƒÉ»õƒÉ tot</button>
      </div>
    </section>

    <!-- PROPOZI»öIA 1 -->
    <h3 class="section-title">Propozi»õia 1 ‚Äì pƒÉr»õi de vorbire</h3>
    <section class="table-block">
      <div class="table-title">
        <span>Propozi»õia 1 (clauza principalƒÉ)</span>
        <span style="font-size:11px;color:var(--text-soft);">Se poate edita manual</span>
      </div>

      <div id="tableP1" class="table-horizontal">
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/ea‚Ä¶</div>
          <div class="col-body-main" contenteditable="true">Ï†Ä</div>
        </div>

        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, m√¢ine‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasƒÉ, la »ôcoalƒÉ‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, √Æncet‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carte‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douƒÉ, trei‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">Í∞ú, Í∂å‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">Í∞ÄÏöî, ÎßàÏÖîÏöî‚Ä¶</div>
          <div class="col-body-main" contenteditable="true">Í∞ÄÏöî</div>
        </div>

        <!-- CONJ / ENDING (P1) -->
        <div class="col" data-key="conjug">
          <div class="col-header">CONJUG / ENDING</div>
          <div class="col-body-label">conector, termina»õie‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Í∑∏Î¶¨Í≥†, Í∑∏ÎûòÏÑú, ~Í≥†, ~ÏïÑÏÑú‚Ä¶</div>
        </div>
      </div>
    </section>

    <!-- PROPOZI»öIA 2 ‚Äì CONTINUARE -->
    <section class="table-block" id="p2Block">
      <div class="table-title">
        <span>PROPOZI»öIA 2 ‚Äì CONTINUARE</span>
        <div class="builder-enable-p2">
          <label>
            <input type="checkbox" id="enableP2" checked />
            <span>ActiveazƒÉ Propozi»õia 2 (continuare / frazƒÉ)</span>
          </label>
        </div>
      </div>

      <div id="titleP2">
        <span>Propozi»õia 2 (clauza secundarƒÉ)</span>
      </div>

      <div id="tableP2" class="table-horizontal">
        <!-- SUBJECT -->
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/ea‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Ï†Ä, ÎÇò‚Ä¶</div>
        </div>

        <!-- TIME -->
        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, m√¢ine‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ÏßÄÍ∏à, Ïò§Îäò‚Ä¶</div>
        </div>

        <!-- PLACE -->
        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasƒÉ, la »ôcoalƒÉ‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ÏßëÏóê, ÌïôÍµêÏóê‚Ä¶</div>
        </div>

        <!-- MOD -->
        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, √Æncet‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Ï≤úÏ≤úÌûà, Îπ®Î¶¨‚Ä¶</div>
        </div>

        <!-- OBJECT -->
        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carte‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Ï±Ö, Ïª§Ìîº‚Ä¶</div>
        </div>

        <!-- NUMERAL -->
        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douƒÉ, trei‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Ìïú, Îëê, ÏÑ∏‚Ä¶</div>
        </div>

        <!-- COUNTER -->
        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">Í∞ú, Í∂å‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Í∂å, Í∞ú‚Ä¶</div>
        </div>

        <!-- VERB -->
        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">Í∞ÄÏöî, ÏôÄÏöî‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ÏùΩÏñ¥Ïöî, Î®πÏñ¥Ïöî‚Ä¶</div>
        </div>

        <!-- CONJ / ENDING (P2 ‚Äì dacƒÉ vrei sƒÉ continui mai departe) -->
        <div class="col" data-key="conjug">
          <div class="col-header">CONJUG / ENDING</div>
          <div class="col-body-label">conector, termina»õie‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: Í∑∏Î¶¨Í≥†, Í∑∏ÎûòÏÑú, ~Í≥†‚Ä¶</div>
        </div>
      </div>
    </section>

    <!-- PREVIEW FINAL ‚Äì FRAZƒÇ LUNGƒÇ -->
    <section class="preview-card">
      <div class="preview-title">
        <span>Propozi»õia finalƒÉ √Æn coreeanƒÉ (P1 + conector + P2)</span>
      </div>
      <div id="previewSentence" class="preview-sentence">Ï†Ä Í∞ÄÏöî</div>
      <div id="previewRo" class="preview-ro">
        (Aici vei vedea propozi»õia finalƒÉ √Æn coreeanƒÉ, generatƒÉ din sloturi.)
      </div>
    </section>
  </div>
  <script>
   <script>
(function () {
  // =========================
  // 0) Utils
  // =========================
  function normalizeText(text) {
    if (!text) return "";
    let t = text.toLowerCase();
    t = t.replace(/≈ü/g, "»ô").replace(/≈£/g, "»õ");
    t = t.replace(/[.,!?;:]/g, " ");
    t = t.replace(/\s+/g, " ").trim();
    return t;
  }

  // IMPORTANT: suportƒÉ »ôi data-key="conj" »ôi data-key="conjug"
  function getCell(tableId, key) {
    const table = document.getElementById(tableId);
    if (!table) return null;

    // 1) cheia cerutƒÉ
    let cell = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
    if (cell) return cell;

    // 2) fallback pentru vechiul HTML
    if (key === "conj") {
      cell = table.querySelector('.col[data-key="conjug"] .col-body-main');
      if (cell) return cell;
    }
    if (key === "conjug") {
      cell = table.querySelector('.col[data-key="conj"] .col-body-main');
      if (cell) return cell;
    }
    return null;
  }

  function readFromTable(tableId, key) {
    const cell = getCell(tableId, key);
    return cell ? (cell.textContent || "").trim() : "";
  }

  function writeToTable(tableId, key, value) {
    const cell = getCell(tableId, key);
    if (cell) cell.textContent = value || "";
  }

  function clearTable(tableId) {
    const table = document.getElementById(tableId);
    if (!table) return;
    table.querySelectorAll(".col-body-main").forEach(el => (el.textContent = ""));
  }

  // =========================
  // 1) Split P1 + conj + P2
  // =========================
  function splitSentence(raw) {
    const t = (raw || "").replace(/\s+/g, " ").trim();
    if (!t) return { p1: "", conj: "", p2: "" };

    // prinde: [P1] (»ôi|si|iar|apoi|and) [P2]
    // acceptƒÉ »ôi virgulƒÉ √Ænainte: "... , »ôi ..."
    const re = /^(.*?)(?:\s*[,.]?\s+)(»ôi|si|iar|apoi|and)\s+(.+)$/i;
    const m = t.match(re);

    if (m) {
      return {
        p1: (m[1] || "").trim(),
        conj: (m[2] || "").toLowerCase(),
        p2: (m[3] || "").trim()
      };
    }

    return { p1: t, conj: "", p2: "" };
  }

  // =========================
  // 2) Reguli simple RO/EN ‚Üí sloturi
  //    (le po»õi extinde dupƒÉ)
  // =========================
  const RO_RULES = {
    subject: [
      { re: /\beu\b/, value: "Ï†Ä" },
      { re: /\btu\b/, value: "ÎÑà" }
    ],
    time: [
      { re: /\bazi\b|\bastƒÉzi\b/, value: "Ïò§Îäò" },
      { re: /\bm√¢ine\b/, value: "ÎÇ¥Ïùº" },
      { re: /\bieri\b/, value: "Ïñ¥Ï†ú" },
      { re: /\bacum\b/, value: "ÏßÄÍ∏à" }
    ],
    place: [
      { re: /pia[t»õ]ƒÉ|market\b/, value: "ÏãúÏû•" },
      { re: /cafenea/, value: "Ïπ¥Ìéò" },
      { re: /\bacas[ƒÉa]\b/, value: "Ïßë" }
    ],
    object: [
      { re: /carte|c[ƒÉa]r»õ/i, value: "Ï±Ö" },
      { re: /cafea/, value: "Ïª§Ìîº" }
    ],
    numeral: [
      { re: /\bo\s+(carte|cafea)\b/, value: "Ìïú" }
    ],
    counter: [
      { re: /carte|c[ƒÉa]r»õ/i, value: "Í∂å" },
      { re: /cafea/, value: "Ïûî" }
    ],
    verb: [
      { re: /merg\b|sƒÉ merg|sa merg|a merge/, value: "Í∞ÄÎã§" },
      { re: /citesc|sƒÉ citesc|sa citesc|a citi/, value: "ÏùΩÎã§" },
      { re: /beau|sƒÉ beau|sa beau|a bea/, value: "ÎßàÏãúÎã§" }
    ]
  };

  const EN_RULES = {
    subject: [
      { re: /\bi\b/, value: "Ï†Ä" },
      { re: /\byou\b/, value: "ÎÑà" }
    ],
    time: [
      { re: /\btoday\b/, value: "Ïò§Îäò" },
      { re: /\btomorrow\b/, value: "ÎÇ¥Ïùº" },
      { re: /\byesterday\b/, value: "Ïñ¥Ï†ú" },
      { re: /\bnow\b/, value: "ÏßÄÍ∏à" }
    ],
    place: [
      { re: /\bmarket\b|mart\b/, value: "ÏãúÏû•" },
      { re: /\bcafe\b|coffee shop\b/, value: "Ïπ¥Ìéò" },
      { re: /\bhome\b/, value: "Ïßë" }
    ],
    object: [
      { re: /\bbook\b|books\b/, value: "Ï±Ö" },
      { re: /\bcoffee\b/, value: "Ïª§Ìîº" }
    ],
    numeral: [
      { re: /\ba\s+book\b|\bone\s+book\b|\ba\s+coffee\b|\bone\s+coffee\b/, value: "Ìïú" }
    ],
    counter: [
      { re: /\bbook\b|books\b/, value: "Í∂å" },
      { re: /\bcoffee\b/, value: "Ïûî" }
    ],
    verb: [
      { re: /\bgo\b|\bgoing\b/, value: "Í∞ÄÎã§" },
      { re: /\bread\b|\breading\b/, value: "ÏùΩÎã§" },
      { re: /\bdrink\b|\bdrinking\b/, value: "ÎßàÏãúÎã§" }
    ]
  };

  function matchSlot(rules, textNorm) {
    if (!rules) return "";
    for (const r of rules) if (r.re.test(textNorm)) return r.value;
    return "";
  }

  function parseToSlots(text, lang) {
    const t = normalizeText(text);
    const R = lang === "en" ? EN_RULES : RO_RULES;
    return {
      subject: matchSlot(R.subject, t),
      time: matchSlot(R.time, t),
      place: matchSlot(R.place, t),
      object: matchSlot(R.object, t),
      numeral: matchSlot(R.numeral, t),
      counter: matchSlot(R.counter, t),
      verb: matchSlot(R.verb, t)
    };
  }

  function applySlotsToTable(tableId, slots) {
    if (!slots) return;
    for (const k of ["subject","time","place","object","numeral","counter","verb"]) {
      if (slots[k]) writeToTable(tableId, k, slots[k]);
    }
  }

  // =========================
  // 3) Lipirea termina»õiei de verb (‚ÄìÍ≥† / ‚ÄìÏïÑÏÑú / ‚ÄìÏñ¥ÏÑú)
  // =========================
  function normalizeEnding(x) {
    let t = (x || "").trim();
    t = t.replace(/^[-~]/, "").trim();
    return t;
  }

  function isStandaloneConnector(x) {
    const t = (x || "").trim();
    return ["Í∑∏Î¶¨Í≥†","Í∑∏ÎûòÏÑú","ÌïòÏßÄÎßå","Îòê","ÎòêÎäî","Í∑∏ÎûòÎèÑ","Í∑∏Îü¨Î©¥"].includes(t);
  }

  function attachEndingToVerb(verb, endingRaw) {
    const e = normalizeEnding(endingRaw);
    const v = (verb || "").trim();
    if (!v || !e) return v;
    if (isStandaloneConnector(e)) return v;

    // ÌïòÎã§ hacks
    if (v === "ÌïòÎã§" && (e === "ÏïÑÏÑú" || e === "Ïñ¥ÏÑú")) return "Ìï¥ÏÑú";
    if (v === "ÌïòÎã§" && e === "Í≥†") return "ÌïòÍ≥†";

    // dic form: ~Îã§
    if (v.endsWith("Îã§")) {
      const stem = v.slice(0, -1);
      return stem + e;
    }

    // polite form: ~Ïöî (minimal safe)
    if (v.endsWith("Ïöî")) {
      const base = v.slice(0, -1);
      return base + e;
    }

    // altfel nu stricƒÉm
    return v;
  }

  // =========================
  // 4) Build clause + preview
  // =========================
  function buildClause(tableId) {
    const s = {
      subject: readFromTable(tableId, "subject"),
      time: readFromTable(tableId, "time"),
      place: readFromTable(tableId, "place"),
      object: readFromTable(tableId, "object"),
      numeral: readFromTable(tableId, "numeral"),
      counter: readFromTable(tableId, "counter"),
      verb: readFromTable(tableId, "verb"),
      conj: readFromTable(tableId, "conj") // ‚úÖ UNIC: conj (cu fallback intern)
    };

    let obj = "";
    if (s.object && s.numeral && s.counter) obj = s.object + " " + s.numeral + " " + s.counter;
    else if (s.object) obj = s.object;

    const verbOut = attachEndingToVerb(s.verb, s.conj);

    const parts = [s.subject, s.time, s.place, obj, verbOut].filter(Boolean);
    return parts.join(" ").trim();
  }

  function hasAnyContent(tableId) {
    return (
      readFromTable(tableId, "subject") ||
      readFromTable(tableId, "time") ||
      readFromTable(tableId, "place") ||
      readFromTable(tableId, "object") ||
      readFromTable(tableId, "numeral") ||
      readFromTable(tableId, "counter") ||
      readFromTable(tableId, "verb") ||
      readFromTable(tableId, "conj")
    );
  }

  function rebuildPreview() {
    const out = document.getElementById("previewSentence");
    if (!out) return;

    const enableP2 = document.getElementById("enableP2");
    const useP2 = !!(enableP2 && enableP2.checked);

    const p1 = buildClause("tableP1") || "Ï†Ä Í∞ÄÏöî";
    let finalSentence = p1;

    if (useP2 && hasAnyContent("tableP2")) {
      const p2 = buildClause("tableP2");
      finalSentence = (p1 + (p2 ? " " + p2 : "")).trim();
    }

    out.textContent = finalSentence;
  }

  // =========================
  // 5) Auto-fill din textarea + setare -Í≥†
  // =========================
  function autoFillFromInput() {
    const input = document.getElementById("roInput");
    const langSelect = document.getElementById("langSelect"); // value: "ro" / "en"
    if (!input) return;

    const lang = langSelect ? langSelect.value : "ro";
    const parts = splitSentence(input.value || "");

    // P1
    applySlotsToTable("tableP1", parseToSlots(parts.p1, lang));

    // P2
    if (parts.p2) {
      applySlotsToTable("tableP2", parseToSlots(parts.p2, lang));
    } else {
      clearTable("tableP2");
    }

    // DacƒÉ detectƒÉm un conector √Æntre douƒÉ verbe/propozi»õii: default = -Í≥† (lipit de verbul din P1)
    // IMPORTANT: punem -Í≥† doar dacƒÉ avem »ôi P2 (altfel nu)
    if (parts.conj && parts.p2) {
      writeToTable("tableP1", "conj", "-Í≥†");
    } else {
      // nu for»õƒÉm dacƒÉ user n-a scris »ôi P2
      writeToTable("tableP1", "conj", "");
    }

    // P2 checkbox ON doar c√¢nd avem P2 real
    const enableP2 = document.getElementById("enableP2");
    const p2Block = document.getElementById("p2Block");
    if (enableP2) {
      enableP2.checked = !!parts.p2;
      if (p2Block) p2Block.style.display = enableP2.checked ? "" : "none";
    }

    rebuildPreview();
  }

  function clearAll() {
    const input = document.getElementById("roInput");
    if (input) input.value = "";
    clearTable("tableP1");
    clearTable("tableP2");
    rebuildPreview();
  }

  // =========================
  // 6) Init + live preview
  // =========================
  function hookLivePreview() {
    // orice edit √Æn celule = refresh preview
    ["tableP1", "tableP2"].forEach(id => {
      const table = document.getElementById(id);
      if (!table) return;
      table.addEventListener("input", rebuildPreview, true);
      table.addEventListener("keyup", rebuildPreview, true);
    });

    const enableP2 = document.getElementById("enableP2");
    const p2Block = document.getElementById("p2Block");
    if (enableP2 && p2Block) {
      enableP2.addEventListener("change", function () {
        p2Block.style.display = enableP2.checked ? "" : "none";
        rebuildPreview();
      });
    }
  }

  window.addEventListener("DOMContentLoaded", function () {
    const autoFillBtn = document.getElementById("autoFillBtn");
    const clearBtn = document.getElementById("clearBtn");

    if (autoFillBtn) autoFillBtn.addEventListener("click", autoFillFromInput);
    if (clearBtn) clearBtn.addEventListener("click", clearAll);

    hookLivePreview();
    rebuildPreview();
  });
})();
</script> 
</body>
</html>
