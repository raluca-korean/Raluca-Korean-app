<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean ‚Äì Builder P2 Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ===== Pastel simplu ‚Äì doar pentru test ===== */
    :root{
      --bg1:#dff3ff;
      --bg2:#ffe9ff;
      --bg3:#f4fffc;
      --bg4:#e8f0ff;

      --accent:#7b5dff;
      --accent-soft:#f6b5ff;
      --card-bg:#ffffffcc;
      --text-main:#2f343b;
      --text-soft:#7a8088;
      --border:#e1d7c7;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text-main);
      background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
      background-size:380% 380%;
      animation:bgFlow 28s ease-in-out infinite;
    }
    @keyframes bgFlow{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .app{
      max-width:1040px;
      margin:0 auto;
      padding:18px 14px 80px;
    }

    .rk-header{
      position:relative;
      padding:12px 16px 16px;
      border-radius:26px;
      background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
      color:#fff;
      box-shadow:0 18px 45px rgba(77,93,255,0.4);
    }
    .rk-header-main{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .rk-header-main h1{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    .rk-badge{
      font-size:11px;
      font-weight:600;
      padding:4px 9px;
      border-radius:999px;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.4);
    }
    #subtitle{
      margin:8px 0 0;
      font-size:12px;
    }

    .card{
      margin-top:16px;
      padding:16px 18px 18px;
      border-radius:22px;
      background:var(--card-bg);
      backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 18px 40px rgba(0,0,0,0.12);
    }
    .card h2{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      letter-spacing:0.03em;
    }

    textarea{
      width:100%;
      border-radius:16px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:14px;
      resize:vertical;
      min-height:70px;
      color:var(--text-main);
      background:#fff;
    }
    textarea:focus{
      outline:none;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.9),
        0 0 0 3px rgba(149,120,255,0.5);
      border-color:rgba(149,120,255,0.7);
    }

    .btn-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    button{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      color:#fff;
      background:linear-gradient(135deg,#6b8cff,#9b6bff);
      box-shadow:
        0 10px 24px rgba(108,110,210,0.4),
        0 0 0 1px rgba(255,255,255,0.7) inset;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    button.secondary{
      background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(0,0,0,0.18);
      filter:brightness(1.03);
    }
    button:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
      filter:brightness(0.97);
    }

    .section-title{
      margin-top:18px;
      margin-bottom:6px;
      font-size:13px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#4b607d;
    }

    .table-block{
      margin-top:6px;
      padding:10px 10px 12px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 14px 30px rgba(0,0,0,0.1);
    }
    .table-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      font-weight:700;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .table-horizontal{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding-bottom:4px;
    }

    .col{
      min-width:110px;
      max-width:140px;
      flex:0 0 auto;
      border-radius:16px;
      padding:7px 7px 9px;
      background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
      border:1px solid #e2d7c8;
      box-shadow:0 10px 22px rgba(95,78,58,0.16);
    }
    .col-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:4px;
      font-size:10px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#7b5dff;
      border-bottom:1px solid rgba(208,196,255,0.8);
      padding-bottom:2px;
      margin-bottom:3px;
    }
    .col-header::before{
      content:"";
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:16px;
      height:16px;
      border-radius:6px;
      background:#fff;
      font-size:11px;
      box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    .col[data-key="subject"] .col-header::before{content:"üë§";}
    .col[data-key="time"]    .col-header::before{content:"‚è∞";}
    .col[data-key="place"]   .col-header::before{content:"üìç";}
    .col[data-key="mod"]     .col-header::before{content:"‚ú®";}
    .col[data-key="object"]  .col-header::before{content:"üéØ";}
    .col[data-key="numeral"] .col-header::before{content:"#Ô∏è‚É£";}
    .col[data-key="counter"] .col-header::before{content:"üî¢";}
    .col[data-key="verb"]    .col-header::before{content:"üöÄ";}

    .col-body-label{
      font-size:10px;
      color:#938777;
      margin-bottom:1px;
    }
    .col-body-main{
      font-size:15px;
      font-weight:700;
      min-height:1.4em;
    }
    .col-body-main[contenteditable="true"]{
      outline:none;
      cursor:text;
    }
    .col-body-main:focus{
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.8),
        0 0 0 2px rgba(149,120,255,0.7);
      border-radius:6px;
    }

    .builder-enable-p2{
      margin-top:6px;
      padding-top:6px;
      border-top:1px dashed var(--border);
      font-size:11px;
      display:flex;
      justify-content:flex-end;
      color:var(--text-soft);
    }
    .builder-enable-p2 label{
      display:flex;
      align-items:center;
      gap:4px;
    }

    .hidden{display:none !important;}

    .preview-card{
      margin-top:14px;
      padding:12px 14px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 16px 32px rgba(0,0,0,0.12);
    }
    .preview-title{
      font-size:12px;
      font-weight:700;
      color:#4b607d;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .preview-sentence{
      font-size:22px;
      font-weight:800;
      line-height:1.6;
      margin-bottom:4px;
    }
    .preview-ro{
      font-size:12px;
      color:var(--text-soft);
    }

    @media (max-width:600px){
      .rk-header-main h1{font-size:17px;}
      .col{min-width:95px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="rk-header">
      <div class="rk-header-main">
        <h1>RALUCA KOREAN</h1>
        <span class="rk-badge">Builder P2 ‚Äì test</span>
      </div>
      <p id="subtitle">
        Versiune micƒÉ de test pentru Propozi»õia 2, fraze lungi »ôi Rom√¢nƒÉ ‚Üí CoreeanƒÉ.
      </p>
    </header>

    <!-- Rom√¢nƒÉ ‚Üí CoreeanƒÉ (builder automat) -->
    <section class="card" id="roCard">
      <h2>Rom√¢nƒÉ ‚Üí CoreeanƒÉ (Builder automat)</h2>
      <p style="font-size:12px;color:var(--text-soft);margin-top:0;margin-bottom:6px;">
        Scrie o propozi»õie simplƒÉ √Æn rom√¢nƒÉ (ex: <em>AstƒÉzi merg la cafenea »ôi beau o cafea.</em>), apoi apasƒÉ pe buton.
      </p>
      <textarea id="roInput" placeholder="Scrie aici propozi»õia ta √Æn rom√¢nƒÉ‚Ä¶"></textarea>

      <div class="btn-row">
        <button id="autoFillBtn">CompleteazƒÉ automat builder-ul</button>
        <button id="clearBtn" class="secondary">CurƒÉ»õƒÉ tot</button>
      </div>
    </section>

    <!-- PROPOZI»öIA 1 -->
    <h3 class="section-title">Propozi»õia 1 ‚Äì pƒÉr»õi de vorbire</h3>
    <section class="table-block">
      <div class="table-title">
        <span>Propozi»õia 1 (clauza principalƒÉ)</span>
        <span style="font-size:11px;color:var(--text-soft);">Se poate edita manual</span>
      </div>

      <div id="tableP1" class="table-horizontal">
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/ea‚Ä¶</div>
          <div class="col-body-main" contenteditable="true">Ï†Ä</div>
        </div>

        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, m√¢ine‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasƒÉ, la »ôcoalƒÉ‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, √Æncet‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carte‚Ä¶)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douƒÉ, trei‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">Í∞ú, Í∂å‚Ä¶</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">Í∞ÄÏöî, ÎßàÏÖîÏöî‚Ä¶</div>
          <div class="col-body-main" contenteditable="true">Í∞ÄÏöî</div>
        </div>
      </div>
<!-- ===================================================== -->
<!-- PROPOZI»öIA 2 ‚Äì CONTINUARE                            -->
<!-- ===================================================== -->
<div class="table-block" id="p2Block">
  <div class="table-title">
    <span>PROPOZI»öIA 2 ‚Äì CONTINUARE</span>

    <div class="builder-enable-p2">
      <label>
        <input type="checkbox" id="enableP2" checked />
        <span>ActiveazƒÉ Propozi»õia 2 (continuare / frazƒÉ)</span>
      </label>
    </div>
  </div>

  <!-- Subtitlu mic pentru P2 -->
  <div id="titleP2">
    <span>Propozi»õia 2 (clauza secundarƒÉ)</span>
  </div>

  <!-- TABEL P2 ‚Äì se completeazƒÉ manual (deocamdatƒÉ) -->
  <div id="tableP2" class="table-horizontal">
    <!-- SUBJECT -->
    <div class="col" data-key="subject">
      <div class="col-header">SUBJECT</div>
      <div class="col-body-label">eu, tu, el/ea...</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: Ï†Ä, ÎÇò...</div>
    </div>

    <!-- TIME -->
    <div class="col" data-key="time">
      <div class="col-header">TIME</div>
      <div class="col-body-label">azi, m√¢ine...</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: ÏßÄÍ∏à, Ïò§Îäò...</div>
    </div>

    <!-- PLACE -->
    <div class="col" data-key="place">
      <div class="col-header">PLACE</div>
      <div class="col-body-label">acasƒÉ, la »ôcoalƒÉ...</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: ÏßëÏóê, ÌïôÍµêÏóê...</div>
    </div>

    <!-- MOD -->
    <div class="col" data-key="mod">
      <div class="col-header">MOD</div>
      <div class="col-body-label">cum? (bine, √Æncet...)</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: Ï≤úÏ≤úÌûà, Îπ®Î¶¨...</div>
    </div>

    <!-- OBJECT -->
    <div class="col" data-key="object">
      <div class="col-header">OBJECT</div>
      <div class="col-body-label">ce? (cafea, carte...)</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: Ï±Ö, Ïª§Ìîº...</div>
    </div>

    <!-- NUMERAL -->
    <div class="col" data-key="numeral">
      <div class="col-header">NUMERAL</div>
      <div class="col-body-label">una, douƒÉ, trei...</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: Ìïú, Îëê, ÏÑ∏...</div>
    </div>

    <!-- COUNTER -->
    <div class="col" data-key="counter">
      <div class="col-header">COUNTER</div>
      <div class="col-body-label">Í∞ú, Í∂å...</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: Í∂å, Í∞ú...</div>
    </div>

    <!-- VERB -->
    <div class="col" data-key="verb">
      <div class="col-header">VERB</div>
      <div class="col-body-label">Í∞ÄÏöî, ÏôÄÏöî...</div>
      <div class="col-body-main"></div>
      <div class="col-body-extra example">ex: ÏùΩÏñ¥Ïöî, Î®πÏñ¥Ïöî...</div>
    </div>
  </div>
</div>
    <!-- PREVIEW FINAL ‚Äì FRAZƒÇ LUNGƒÇ -->
    <section class="preview-card">
      <div class="preview-title">
        <span>Propozi»õia finalƒÉ √Æn coreeanƒÉ (P1 + Í∑∏Î¶¨Í≥† + P2)</span>
      </div>
      <div id="previewSentence" class="preview-sentence">Ï†Ä Í∞ÄÏöî</div>
      <div id="previewRo" class="preview-ro">
        (Aici vei vedea propozi»õia finalƒÉ √Æn coreeanƒÉ, generatƒÉ din sloturi.)
      </div>
    </section>
  </div>

  <script>
// =====================================================
// 0. Split propozi»õia rom√¢neascƒÉ √Æn P1 / P2 dupƒÉ ‚Äû»ôi‚Äù
// =====================================================
function splitRomanianSentence(text) {
  if (!text) return { clause1: "", clause2: "", connector: "" };

  const lower = text.toLowerCase();

  // conectori simpli pentru √Ænceput
  const candidates = [
    " »ôi ",
    " si ",
    " iar ",
    " apoi "
  ];

  let bestPos = -1;
  let bestConn = "";

  for (var i = 0; i < candidates.length; i++) {
    var c = candidates[i];
    var p = lower.indexOf(c);
    if (p !== -1 && (bestPos === -1 || p < bestPos)) {
      bestPos = p;
      bestConn = c;
    }
  }

  if (bestPos === -1) {
    // nu am gƒÉsit conector ‚Üí totul e doar P1
    return {
      clause1: text.trim(),
      clause2: "",
      connector: ""
    };
  }

  var clause1 = text.slice(0, bestPos).trim();
  var clause2 = text.slice(bestPos + bestConn.length).trim();
  return {
    clause1: clause1,
    clause2: clause2,
    connector: bestConn.trim()
  };
}

// =====================================================
// 1. Normalizare text rom√¢nƒÉ
// =====================================================
function normalizeRo(text) {
  if (!text) return "";
  var t = text.toLowerCase();

  // diacritice
  t = t.replace(/≈ü/g, "»ô").replace(/≈£/g, "»õ");
  // codƒÉri ciudate
  t = t.replace(/√É¬¢/g, "√¢").replace(/√É¬Æ/g, "√Æ");

  // scoatem punctua»õie de bazƒÉ
  t = t.replace(/[.,!?;:]/g, " ");

  // spa»õii multiple
  t = t.replace(/\s+/g, " ").trim();
  return t;
}

// =====================================================
// 2. Reguli RO ‚Üí KO pe sloturi (versiune extinsƒÉ)
// =====================================================
var RO_RULES = {
  subject: [
    { re: /\beu\s*\(formal\)|eu\s*-\s*formal\b/, value: "Ï†Ä" },
    { re: /\beu\s*\(informal\)|eu\s*-\s*informal\b/, value: "ÎÇò" },
    { re: /\beu\b/, value: "Ï†Ä" },       // default pentru ‚Äûeu‚Äù
    { re: /\btu\b/, value: "ÎÑà" },
    { re: /\bel\b+ea\b|el\b|ea\b/, value: "Í∑∏" },
    { re: /\bnoi\b/, value: "Ïö∞Î¶¨" }
  ],

  time: [
    { re: /\bazi\b|\bastƒÉzi\b/, value: "Ïò§Îäò" },
    { re: /\bm√¢ine\b/, value: "ÎÇ¥Ïùº" },
    { re: /\bieri\b/, value: "Ïñ¥Ï†ú" },
    { re: /\bacum\b/, value: "ÏßÄÍ∏à" },
    { re: /\bdiminea»õ[ƒÉa]\b/, value: "ÏïÑÏπ®Ïóê" },
    { re: /\bseara\b/, value: "Ï†ÄÎÖÅÏóê" },
    { re: /\bnoaptea\b/, value: "Î∞§Ïóê" },
    { re: /\bweekend\b|\bweek-end\b/, value: "Ï£ºÎßêÏóê" }
  ],

  place: [
    { re: /\bacas[ƒÉa]\b/, value: "Ïßë" },
    { re: /la\s+»ôcoal[ƒÉa]|la\s+scoala|»ôcoal[ƒÉa]\b|scoala\b/, value: "ÌïôÍµê" },
    { re: /la\s+firm[ƒÉa]|la\s+serviciu|la\s+companie|firm[ƒÉa]\b|serviciu\b|companie\b/, value: "ÌöåÏÇ¨" },
    { re: /la\s+pia[t»õ]ƒÉ|pia[t»õ]ƒÉ\b/, value: "ÏãúÏû•" },
    { re: /cafenea|cafene[al]/, value: "Ïπ¥Ìéò" },
    { re: /banc[ƒÉa]\b/, value: "ÏùÄÌñâ" },
    { re: /acas[ƒÉa]\s+la\s+prieteni|la\s+prieteni/, value: "ÏπúÍµ¨ Ïßë" }
  ],

  mod: [
    { re: /\bbine\b|frumos\b|ok\b/, value: "Ïûò" },
    { re: /√Æn\s+lini»ôte|in\s+liniste|lini»ôte|liniste/, value: "Ï°∞Ïö©Ìûà" },
    { re: /harnic|cu\s+mult\s+efort|cu\s+s√¢rguint[ƒÉa]|cu\s+sarguinta/, value: "Ïó¥Ïã¨Ìûà" },
    { re: /√Æncet|incet/, value: "Ï≤úÏ≤úÌûà" },
    { re: /repede|rapid/, value: "Îπ®Î¶¨" }
  ],

  object: [
    { re: /cafea/, value: "Ïª§Ìîº" },
    { re: /\bap[ƒÉa]\b|ap[ƒÉa]\s+mineral[ƒÉa]?/, value: "Î¨º" },
    { re: /carte|c[ƒÉa]r»õile|c[ƒÉa]rti\b/, value: "Ï±Ö" },
    { re: /m[ƒÉa]ncare|pr[ƒÉa]nzul|cina|mic\s+dejun/, value: "ÏùåÏãù" },
    { re: /ceai\b/, value: "Ï∞®" },
    { re: /k-pop|kpop/, value: "ÏºÄÏù¥Ìåù" },
    { re: /coreean[ƒÉa]\s+|limba\s+coreean[ƒÉa]/, value: "ÌïúÍµ≠Ïñ¥" }
  ],

  numeral: [
    { re: /\bo\s+carte\b|\bo\s+cafea\b/, value: "Ìïú" },
    { re: /\bdou[ƒÉa]\s+car»õi|dou[ƒÉa]\s+cafele/, value: "Îëê" },
    { re: /\btrei\s+car»õi|trei\s+cafele/, value: "ÏÑ∏" }
  ],

  counter: [
    { re: /carte|c[ƒÉa]rti\b/, value: "Í∂å" },           // pentru cƒÉr»õi
    { re: /cafea|ap[ƒÉa]\b|ceai\b|m[ƒÉa]ncare/, value: "Í∞ú" } // general
  ],

  verb: [
    { re: /merg\b|a merge|sƒÉ merg|sa merg|plec\b|m[ƒÉa]\s+duc/, value: "Í∞ÄÏöî" },
    { re: /vin\b|a veni|sƒÉ vin|sa vin|revin/, value: "ÏôÄÏöî" },
    { re: /beau\b|a bea|sƒÉ beau|sa beau/, value: "ÎßàÏÖîÏöî" },
    { re: /m[ƒÉa]n[√¢a]nc|m[ƒÉa]n√¢nc|mananc|a m[ƒÉa]nca/, value: "Î®πÏñ¥Ïöî" },
    { re: /citesc|a citi|sƒÉ citesc|sa citesc/, value: "ÏùΩÏñ¥Ïöî" },
    { re: /lucrez|a lucra/, value: "ÏùºÌï¥Ïöî" },
    { re: /stau\b|a sta\b/, value: "ÏûàÏñ¥Ïöî" },
    { re: /√Ænva[t»õ]|\bstudiez\b|\b√ÆnvƒÉ»õ\b|\binvat\b/, value: "Í≥µÎ∂ÄÌï¥Ïöî" }
  ]
};

function matchSlot(rules, text) {
  if (!rules) return null;
  for (var i = 0; i < rules.length; i++) {
    if (rules[i].re.test(text)) return rules[i].value;
  }
  return null;
}

function parseRomanianToSlots(text) {
  var t = normalizeRo(text);

  return {
    subject: matchSlot(RO_RULES.subject, t),
    time:    matchSlot(RO_RULES.time, t),
    place:   matchSlot(RO_RULES.place, t),
    mod:     matchSlot(RO_RULES.mod, t),
    object:  matchSlot(RO_RULES.object, t),
    numeral: matchSlot(RO_RULES.numeral, t),
    counter: matchSlot(RO_RULES.counter, t),
    verb:    matchSlot(RO_RULES.verb, t)
  };
}

// =====================================================
// 3. Helpers pentru coloane P1 / P2
// =====================================================
function setCol(tableId, key, value) {
  if (!value) return;
  var table = document.getElementById(tableId);
  if (!table) return;
  var cell = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
  if (cell) cell.textContent = value;
}

function pickCol(tableId, key) {
  var table = document.getElementById(tableId);
  if (!table) return "";
  var el = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
  return el ? el.textContent.trim() : "";
}

function clearTable(tableId) {
  var table = document.getElementById(tableId);
  if (!table) return;
  var cells = table.querySelectorAll(".col .col-body-main");
  cells.forEach(function (el) { el.textContent = ""; });
}

// =====================================================
// 4. Construim propozi»õie din tabel (P1 sau P2)
// =====================================================
function buildSentenceFromTable(tableId, slotsFromParserForVerb) {
  var subject = pickCol(tableId, "subject") || "Ï†Ä";
  var time    = pickCol(tableId, "time");
  var place   = pickCol(tableId, "place");
  var mod     = pickCol(tableId, "mod");
  var object  = pickCol(tableId, "object");
  var numeral = pickCol(tableId, "numeral");
  var counter = pickCol(tableId, "counter");
  var verb    = pickCol(tableId, "verb");

  if (!verb && slotsFromParserForVerb && slotsFromParserForVerb.verb) {
    verb = slotsFromParserForVerb.verb;
    setCol(tableId, "verb", verb);
  }

  var objectChunk = "";
  if (object && numeral && counter) {
    objectChunk = object + " " + numeral + " " + counter;
  } else if (object) {
    objectChunk = object;
  }

  var pieces = [subject, time, place, mod, objectChunk, verb].filter(Boolean);
  var sentence = pieces.join(" ");
  return sentence;
}

// =====================================================
// 5. Preview final (P1 [+ Í∑∏Î¶¨Í≥† + P2])
// =====================================================
var lastSlotsFromParserP1 = null;

function updateFinalPreview() {
  var enableP2 = document.getElementById("enableP2");

  var s1 = buildSentenceFromTable("tableP1", lastSlotsFromParserP1);
  var finalSentence = s1 || "";
  var hasP2 = false;

  if (enableP2 && enableP2.checked) {
    var s2 = buildSentenceFromTable("tableP2", null);
    if (s2) {
      finalSentence = s1 + " Í∑∏Î¶¨Í≥† " + s2;
      hasP2 = true;
    }
  }

  var out = document.getElementById("previewSentence") ||
            document.getElementById("previewKo") ||
            document.querySelector(".preview-sentence");
  if (out) out.textContent = finalSentence;

  return { finalSentence: finalSentence, hasP2: hasP2 };
}

// =====================================================
// 6. DOMContentLoaded ‚Äì legƒÉm butoane & checkbox P2
// =====================================================
document.addEventListener("DOMContentLoaded", function () {
  var autoFillBtn = document.getElementById("autoFillBtn");
  var clearBtn    = document.getElementById("clearBtn");
  var roInput     = document.getElementById("roInput");
  var enableP2    = document.getElementById("enableP2");
  var titleP2     = document.getElementById("titleP2");
  var tableP2     = document.getElementById("tableP2");

  var roTranslateBtn = document.getElementById("roTranslateBtn");
  var roToKoResult   = document.getElementById("roToKoResult");
  var roCorrected    = document.getElementById("roCorrected");

  // --- sync vizibilitate P2 (titlu + tabel) ---
  function syncP2Visibility() {
    if (!enableP2 || !titleP2 || !tableP2) return;
    var on = enableP2.checked;
    if (on) {
      titleP2.classList.remove("hidden");
      tableP2.classList.remove("hidden");
    } else {
      titleP2.classList.add("hidden");
      tableP2.classList.add("hidden");
    }
  }
  if (enableP2) {
    enableP2.addEventListener("change", function () {
      syncP2Visibility();
      updateFinalPreview();
    });
    syncP2Visibility();
  }

  // helper: umple P1 + P2 dintr-o propozi»õie √Æn rom√¢nƒÉ
  function fillBuilderFromRomanian(text) {
    var split = splitRomanianSentence(text);
    var clause1 = split.clause1;
    var clause2 = split.clause2;

    // --- P1 ---
    var slots1 = parseRomanianToSlots(clause1);
    lastSlotsFromParserP1 = slots1;

    clearTable("tableP1");
    setCol("tableP1", "subject", slots1.subject);
    setCol("tableP1", "time",    slots1.time);
    setCol("tableP1", "place",   slots1.place);
    setCol("tableP1", "mod",     slots1.mod);
    setCol("tableP1", "object",  slots1.object);
    setCol("tableP1", "numeral", slots1.numeral);
    setCol("tableP1", "counter", slots1.counter);
    setCol("tableP1", "verb",    slots1.verb);

    // --- P2 (dacƒÉ avem a doua clauzƒÉ) ---
    clearTable("tableP2");
    if (clause2) {
      var slots2 = parseRomanianToSlots(clause2);

      // subject: dacƒÉ nu gƒÉsim altceva √Æn P2, pƒÉstrƒÉm subiectul din P1
      setCol("tableP2", "subject", slots2.subject || slots1.subject);
      setCol("tableP2", "time",    slots2.time);
      setCol("tableP2", "place",   slots2.place);
      setCol("tableP2", "mod",     slots2.mod);
      setCol("tableP2", "object",  slots2.object);
      setCol("tableP2", "numeral", slots2.numeral);
      setCol("tableP2", "counter", slots2.counter);
      setCol("tableP2", "verb",    slots2.verb);

      if (enableP2) {
        enableP2.checked = true;
        syncP2Visibility();
      }
    } else {
      if (enableP2) {
        enableP2.checked = false;
        syncP2Visibility();
      }
    }

    var result = updateFinalPreview();

    if (roToKoResult) {
      roToKoResult.textContent = result.finalSentence;
    }
    if (roCorrected) {
      roCorrected.textContent = text;
    }
  }
function rebuildPreviewFromBuilderP1(slotsFromParser) {
  const tableP1 = document.getElementById("tableP1");
  if (!tableP1) return;

  const pick = (table, key) => {
    const col = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
    return col ? col.textContent.trim() : "";
  };

  // ---------- P1 ----------
  const subject1 = pick(tableP1, "subject") || "Ï†Ä";
  const time1    = pick(tableP1, "time");
  const place1   = pick(tableP1, "place");
  const mod1     = pick(tableP1, "mod");
  const numeral1 = pick(tableP1, "numeral");
  const counter1 = pick(tableP1, "counter");
  const object1  = pick(tableP1, "object");

  let objectChunk1 = "";
  if (object1 && numeral1 && counter1) {
    objectChunk1 = object1 + " " + numeral1 + " " + counter1;
  } else if (object1) {
    objectChunk1 = object1;
  }

  // verb P1 ‚Äì dacƒÉ parser-ul a gƒÉsit ceva, √Æl folosim, altfel Í∞ÄÏöî
  const verb1 =
    (slotsFromParser && slotsFromParser.verb) ||
    "Í∞ÄÏöî";

  const pieces1 = [subject1, time1, place1, mod1, objectChunk1, verb1].filter(Boolean);
  let sentence = pieces1.join(" ");

  // ---------- P2 (dacƒÉ e activatƒÉ) ----------
  const enableP2 = document.getElementById("enableP2");
  const tableP2  = document.getElementById("tableP2");

  if (enableP2 && enableP2.checked && tableP2) {
    const subject2 = pick(tableP2, "subject");
    const time2    = pick(tableP2, "time");
    const place2   = pick(tableP2, "place");
    const mod2     = pick(tableP2, "mod");
    const numeral2 = pick(tableP2, "numeral");
    const counter2 = pick(tableP2, "counter");
    const object2  = pick(tableP2, "object");
    const verb2    = pick(tableP2, "verb"); // P2 e manual deocamdatƒÉ

    let objectChunk2 = "";
    if (object2 && numeral2 && counter2) {
      objectChunk2 = object2 + " " + numeral2 + " " + counter2;
    } else if (object2) {
      objectChunk2 = object2;
    }

    const pieces2 = [subject2, time2, place2, mod2, objectChunk2, verb2].filter(Boolean);

    if (pieces2.length > 0) {
      // adƒÉugƒÉm Í∑∏Î¶¨Í≥† √Æntre P1 »ôi P2
      sentence += " Í∑∏Î¶¨Í≥† " + pieces2.join(" ");
    }
  }

  // ---------- scriem propozi»õia finalƒÉ ----------
  const out =
    document.getElementById("previewSentence") ||
    document.getElementById("previewKo") ||
    document.querySelector(".preview-sentence");

  if (out) {
    out.textContent = sentence;
  }
}
  // --- Buton: CompleteazƒÉ automat builder-ul ---
  if (autoFillBtn && roInput) {
    autoFillBtn.addEventListener("click", function () {
      var text = roInput.value.trim();
      if (!text) return;
      fillBuilderFromRomanian(text);
    });
  }

  // --- Buton: Tradu √Æn coreeanƒÉ (folose»ôte acela»ôi parser) ---
  if (roTranslateBtn && roInput) {
    roTranslateBtn.addEventListener("click", function () {
      var text = roInput.value.trim();
      if (!text) return;
      fillBuilderFromRomanian(text);
    });
  }

  // --- CLEAR: »ôterge tot ---
  if (clearBtn && roInput) {
    clearBtn.addEventListener("click", function () {
      roInput.value = "";
      lastSlotsFromParserP1 = null;
      clearTable("tableP1");
      clearTable("tableP2");

      var out = document.getElementById("previewSentence") ||
                document.getElementById("previewKo") ||
                document.querySelector(".preview-sentence");
      if (out) out.textContent = "";

      if (roToKoResult) roToKoResult.textContent = "";
      if (roCorrected)  roCorrected.textContent  = "";

      if (enableP2) {
        enableP2.checked = false;
        syncP2Visibility();
      }
    });
  }

  // ini»õializare micƒÉ
  updateFinalPreview();
});
</script>
</body>
</html>
