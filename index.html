<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean ‚Äì Study App v2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f3ff;
      --card-bg: #ffffff;
      --accent: #c9b5ff;
      --accent-strong: #9b7cff;
      --text-main: #333333;
      --text-soft: #666666;
      --border: #e0d7ff;
      --dimmed-bg: #f2eefc;
      --overlay-bg: rgba(0, 0, 0, 0.2);
    }
    header{text-align:center;padding:4px 8px 4px;}
    header h1{font-size:18px;margin:2px 0;font-weight:700;color:var(--accent-strong);}
    header p{margin:0;font-size:11px;color:var(--text-soft);}

    .screen{display:none;flex-direction:column;gap:10px;flex:1;min-height:0;}
    .screen.active{display:flex;}

    .mode-panel{
      background:var(--card-bg);border-radius:12px;border:1px solid var(--border);
      padding:6px 8px;font-size:11px;display:flex;flex-direction:column;gap:4px;
      box-shadow:0 4px 12px rgba(120,96,190,0.08);
    }
    .mode-row{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;
    }
    .mode-row label{font-size:11px;display:flex;align-items:center;gap:4px;}
    .part-toggles{display:flex;flex-wrap:wrap;gap:6px;}
    .chip{
      display:inline-flex;align-items:center;gap:3px;
      padding:3px 8px;border-radius:999px;background:#ede7ff;color:var(--accent-strong);
      font-size:10px;cursor:pointer;
    }
    .chip input{margin:0;}
    .section-label{font-size:11px;font-weight:600;color:var(--accent-strong);margin-top:2px;}

    .small-mode-btn{
      padding:3px 8px;
      font-size:10px;
    }
    .small-mode-btn.active{
      background:var(--accent-strong);
      color:#fff;
    }

    .table-block{
      background:var(--card-bg);border-radius:14px;padding:8px;
      box-shadow:0 6px 16px rgba(120,96,190,0.12);border:1px solid var(--border);
      display:flex;flex-direction:column;gap:6px;flex:1;min-height:0;
    }
    .table-title{
      font-size:11px;font-weight:600;color:var(--text-soft);
      display:flex;justify-content:space-between;align-items:center;
    }
    .table-horizontal{
      display:flex;flex-direction:row;overflow-x:auto;padding-bottom:4px;gap:6px;
    }
    .col{
      min-width:110px;max-width:140px;flex:0 0 auto;background:#faf8ff;border-radius:10px;
      border:1px solid var(--border);display:flex;flex-direction:column;
      padding:6px 6px 8px;transition:0.2s;cursor:pointer;
      touch-action:manipulation;
    }
    .col-header{
      font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;
      color:var(--accent-strong);margin-bottom:4px;border-bottom:1px solid var(--border);
      padding-bottom:3px;
    }
    /* Header de coloanƒÉ cu titlu + bifƒÉ ON/OFF */
.col-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:4px;
}

.col-header input.col-toggle{
  width:14px;
  height:14px;
  accent-color: var(--accent-strong);
  flex-shrink:0;
}
    .col-body-label{font-size:10px;color:var(--text-soft);margin-bottom:2px;}
    .col-body-main{font-size:15px;font-weight:600;margin-bottom:2px;}
    .col-body-extra{font-size:11px;color:var(--text-soft);}
    .dimmed{
      opacity:0.35;background-image:repeating-linear-gradient(
        -45deg,var(--dimmed-bg),var(--dimmed-bg) 4px,#fdfbff 4px,#fdfbff 8px
      );
    }

    .controls{
      display:flex;justify-content:space-between;align-items:center;gap:8px;
      padding-top:4px;border-top:1px dashed var(--border);
    }
    .btn-group{display:flex;gap:6px;}
    button{
      border-radius:999px;border:none;padding:6px 10px;font-size:12px;font-weight:600;
      cursor:pointer;background:var(--accent);color:#fff;display:inline-flex;
      align-items:center;gap:4px;box-shadow:0 2px 6px rgba(90,70,160,0.25);
    }
    button.secondary{background:#ede7ff;color:var(--accent-strong);box-shadow:none;}
    button:disabled{opacity:0.4;box-shadow:none;cursor:default;}
    .page-indicator{font-size:11px;color:var(--text-soft);}
    .legend{font-size:10px;color:var(--text-soft);text-align:center;padding:2px 4px 0;}
    .hidden{display:none !important;}

    .preview-card{
      margin-top:6px;padding:8px;border-radius:12px;
      background:#f9f7ff;border:1px solid var(--border);
      display:flex;flex-direction:column;gap:4px;
    }
    .preview-title{
      font-size:11px;font-weight:600;color:var(--accent-strong);
      display:flex;justify-content:space-between;align-items:center;
    }
    .preview-ko{
      font-size:14px;font-weight:600;margin-top:2px;
    }
    .preview-ro{
      font-size:12px;color:var(--text-soft);
    }
    .preview-natural{
      font-size:11px;
      color:#8e6cff;
      margin-top:2px;
    }
    .preview-buttons{
      display:flex;gap:6px;margin-top:4px;flex-wrap:wrap;
    }
  
  
    .overlay{
      position:fixed;inset:0;background:var(--overlay-bg);
      display:flex;justify-content:center;align-items:flex-end;z-index:1000;
    }
    .panel{
      width:100%;max-width:900px;background:var(--card-bg);
      border-radius:18px 18px 0 0;box-shadow:0 -6px 18px rgba(0,0,0,0.15);
      padding:10px 12px 14px;animation:slideUp 0.18s ease-out;
    }
    @keyframes slideUp{
      from{transform:translateY(40px);opacity:0;}
      to{transform:translateY(0);opacity:1;}
    }
    .panel-header{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;
    }
    .panel-title{font-size:13px;font-weight:600;color:var(--accent-strong);}
    .panel-sub{font-size:11px;color:var(--text-soft);}
    .panel-close{
      background:transparent;color:var(--text-soft);box-shadow:none;
      padding:4px 6px;font-size:14px;
    }
    .panel-input-row{display:flex;gap:6px;margin-bottom:6px;}
    .panel-input-row input{
      flex:1;border-radius:999px;border:1px solid var(--border);
      padding:6px 10px;font-size:12px;
    }
    .panel-list{
      max-height:260px;overflow-y:auto;border-radius:10px;
      border:1px solid var(--border);background:#faf8ff;padding:4px;
    }
    .panel-item{
      padding:4px 8px;border-radius:8px;display:flex;justify-content:space-between;
      align-items:center;font-size:13px;cursor:pointer;
    }
    .panel-item:hover{background:#ede7ff;}
    .panel-item-main{font-weight:600;}
    .panel-item-extra{
      display:flex;flex-direction:column;align-items:flex-end;gap:2px;
    }
    .panel-item-tag{font-size:10px;color:var(--accent-strong);}

    .bottom-nav{
      position:fixed;bottom:0;left:0;right:0;
      background:#ffffffee;border-top:1px solid var(--border);
      display:flex;justify-content:space-around;align-items:center;
      padding:6px 0;backdrop-filter:blur(8px);z-index:500;
    }
    .nav-btn{
      flex:1;text-align:center;border:none;background:transparent;
      font-size:11px;color:var(--text-soft);padding:4px 0;cursor:pointer;
      display:flex;flex-direction:column;align-items:center;gap:2px;
    }
    .nav-btn span.icon{font-size:18px;}
    .nav-btn.active{color:var(--accent-strong);font-weight:600;}
    .nav-btn.active span.icon{transform:translateY(-1px);}
    @media (max-width:600px){
      header h1{font-size:16px;}
      .col{min-width:95px;}
    }

    .card{
      background:var(--card-bg);border-radius:14px;padding:10px;
      box-shadow:0 4px 12px rgba(120,96,190,0.12);border:1px solid var(--border);
      display:flex;flex-direction:column;gap:6px;
    }
    .card h2{
      margin:0;font-size:14px;color:var(--accent-strong);
    }
    .small-label{font-size:11px;color:var(--text-soft);}
    select{
      border-radius:999px;border:1px solid var(--border);
      padding:4px 10px;font-size:12px;background:#fff;
    }
    .lesson-header{
  margin-bottom: 8px;
}
    .exercise-question{
      font-size:14px;font-weight:600;margin-top:4px;
    }
    .exercise-options{display:flex;flex-direction:column;gap:4px;margin-top:2px;}
    .exercise-options label{
      font-size:13px;display:flex;align-items:center;gap:6px;
    }
    .exercise-feedback{
      font-size:12px;margin-top:4px;
    }
/* ===== EXERCI»öII TOPIK ‚Äì stil "app" ===== */

#screen-exercises .card.ex-card{
  display:flex;
  flex-direction:column;
  gap:10px;
  padding:12px 14px 14px;
}

/* header de card */
.ex-header-row{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:8px;
}

.ex-header-row h2{
  margin:2px 0 0;
  font-size:15px;
  letter-spacing:0.04em;
  text-transform:uppercase;
  color:var(--accent-strong);
}

.ex-pill{
  display:inline-flex;
  align-items:center;
  padding:2px 8px;
  font-size:10px;
  border-radius:999px;
  background:rgba(111,134,168,0.12);
  color:var(--accent-strong);
  margin-bottom:2px;
}

.ex-mini-hint{
  font-size:11px;
  color:var(--text-soft);
  text-align:right;
}
/* stare implicitƒÉ ‚Äî text discret */
#screen-exercises .exercise-question.empty {
  color: var(--text-soft);
  font-weight: 400;
}
    /* linia cu select-ul */
.ex-type-row{
  margin-top:6px;
  padding:8px 10px;
  border-radius:12px;
  background:rgba(255,255,255,0.7);
  border:1px solid rgba(227,218,203,0.9);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  flex-wrap:wrap;
}

.ex-type-left{
  display:flex;
  flex-direction:column;
  gap:2px;
}

.ex-type-chip{
  font-size:11px;
  padding:2px 8px;
  border-radius:999px;
  background:rgba(241,211,160,0.22);
  color:#6f5430;
}

/* card interior cu √Æntrebarea */
.ex-question-shell{
  margin-top:6px;
  padding:10px 12px 12px;
  border-radius:16px;
  background:linear-gradient(145deg,#fdfbf7,#f0ebe3);
  border:1px solid rgba(227,218,203,0.9);
  box-shadow:0 8px 18px rgba(80,64,48,0.12);
  display:flex;
  flex-direction:column;
  gap:6px;
}

/* tag-uri de sus */
.ex-question-tag-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}

.ex-question-tag{
  font-size:11px;
  font-weight:600;
  padding:2px 8px;
  border-radius:999px;
  background:rgba(111,134,168,0.15);
  color:var(--accent-strong);
}

.ex-question-subtag{
  font-size:11px;
  color:var(--text-soft);
}

/* text √Æntrebare mai mare */
#screen-exercises .exercise-question{
  font-size:15px;
  font-weight:600;
  margin-top:4px;
}

/* op»õiuni ‚Äì arate ca ni»ôte carduri */
#screen-exercises .exercise-options label{
  padding:6px 8px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fbf8f1;
  box-shadow:0 3px 8px rgba(90,72,52,0.06);
}

/* butoane aliniate jos */
.ex-buttons{
  margin-top:4px;
  justify-content:flex-end;
}

/* feedback */
#screen-exercises .exercise-feedback{
  margin-top:2px;
  font-size:12px;
  min-height:18px;
}

/* legendƒÉ jos pentru Exerci»õii ‚Äì reactivƒÉm .legend aici */
#screen-exercises .ex-legend{
  display:block;
  margin-top:8px;
  padding:6px 8px;
  border-radius:10px;
  background:rgba(0,0,0,0.02);
  font-size:10px;
  color:var(--text-soft);
}
    .glossary-search{
      display:flex;gap:6px;align-items:center;margin-top:4px;
    }
    .glossary-search input{
      flex:1;border-radius:999px;border:1px solid var(--border);
      padding:6px 10px;font-size:12px;
    }
    textarea{
  width:100%;
  border-radius:14px;
  border:1px solid var(--border);
  background:#fff;
  padding:10px 12px;
  font-size:13px;
  line-height:1.35;
  color:var(--text-main);
  outline:none;
  resize:vertical;
  min-height:72px;
  box-shadow:0 2px 10px rgba(120,96,190,0.06) inset;
}

textarea::placeholder{
  color:#9a93b8;
}

textarea:focus{
  border-color:var(--accent-strong);
  box-shadow:0 0 0 3px rgba(155,124,255,0.18);
}
    .glossary-list{
      margin-top:6px;max-height:260px;overflow-y:auto;padding-right:2px;
    }
    .glossary-item{
      padding:6px 8px;border-radius:10px;border:1px solid var(--border);
      background:#faf8ff;margin-bottom:4px;font-size:12px;
      display:flex;justify-content:space-between;gap:8px;
    }
    .glossary-ko{font-weight:600;}
    .glossary-ro{color:var(--text-soft);}
    .glossary-cat{font-size:10px;color:var(--accent-strong);}

    .fav-list{
      margin-top:4px;max-height:140px;overflow-y:auto;padding-right:2px;
    }
    .fav-item{
      padding:4px 6px;border-radius:8px;border:1px solid var(--border);
      background:#fdfbff;margin-bottom:4px;font-size:11px;
    }
    .fav-ko{font-weight:600;margin-bottom:2px;}
    .fav-ro{color:var(--text-soft);}
    /* CARD GENERAL ‚Äì Rom√¢nƒÉ ‚Üí CoreeanƒÉ, Exerci»õii, Glosar */
.card{
  background: linear-gradient(145deg, #ffffff, #f5f0ff);
  border-radius: 18px;
  padding: 12px 14px;
  box-shadow: 0 10px 24px rgba(120,96,190,0.18);
  border: 1px solid rgba(201,181,255,0.6);
}

/* Titlurile cardurilor */
.card h2{
  margin: 0 0 6px;
  font-size: 15px;
  font-weight: 700;
  color: #7b5fff;
  letter-spacing: 0.03em;
}

/* Textarea rom√¢nƒÉ */
textarea#roInput{
  border-radius: 14px;
  border: 1px solid #d7c9ff;
  background: #fbf9ff;
  padding: 10px 12px;
  font-size: 13px;
  line-height: 1.45;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.7);
}

/* Buton ‚ÄûTradu √Æn coreeanƒÉ‚Äù */
#roTranslateBtn{
  margin-top: 6px;
  border-radius: 999px;
  padding: 7px 14px;
  font-size: 12px;
  font-weight: 600;
  background: linear-gradient(120deg, #b391ff, #8a6bff);
  color: #fff;
  border: none;
  box-shadow: 0 6px 14px rgba(125,99,210,0.35);
}
#roTranslateBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}

.translate-icon{
  font-size:14px;
  transform:translateY(0.5px);
}
    /* Rezultat KO + rom√¢na corectatƒÉ */
#roToKoResult{
  margin-top: 8px;
  font-size: 15px;
  font-weight: 700;
  color: #3a295d;
}

#roCorrected{
  margin-top: 2px;
  font-size: 12px;
  color: #7b7496;
}

/* Coloanele SUBJ/TIME/PLACE etc. */
.col{
  min-width: 110px;
  max-width: 140px;
  flex: 0 0 auto;
  background: radial-gradient(circle at top left,#fdfbff,#f1ecff);
  border-radius: 14px;
  border: 1px solid #ddd2ff;
  padding: 7px 7px 9px;
  box-shadow: 0 6px 16px rgba(118,95,205,0.16);
  transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s;
}

/* Efect la tap / hover (desktop) */
.col:active,
.col:hover{
  transform: translateY(-1px);
  box-shadow: 0 9px 20px rgba(118,95,205,0.24);
  border-color: #b09bff;
}

/* Headerul coloanei */
.col-header{
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #9a80ff;
  margin-bottom: 3px;
  border-bottom: 1px solid rgba(208,196,255,0.8);
  padding-bottom: 2px;
}

/* Cuv√¢ntul ales √Æn coloanƒÉ */
.col-body-main{
  font-size: 15px;
  font-weight: 700;
  color: #372449;
}

/* Hintul gri mic din coloanƒÉ */
.col-body-label{
  font-size: 10px;
  color: #8a849d;
}

/* Propozi»õia KO mare de jos */
#previewKo{
  font-size: 16px;
  font-weight: 700;
  color: #2f2948;
}

/* Traducere rom√¢nƒÉ */
#previewRo{
  font-size: 12px;
  color: #746f91;
}

/* Badge ‚Äûnatural‚Äù / aten»õionare */
#naturalHint{
  font-size: 11px;
  margin-top: 3px;
}

    /* =========================================================
   THEME v4 ‚Äì ‚Äûapp desenatƒÉ‚Äù pentru Raluca
   ‚Äì forme de fundal + iconi»õe pe coloane + carduri ilustrate
   (se pune ULTIMUL √Æn <style>)
========================================================= */

/* fundal cu ‚Äûbule‚Äù moi */
body{
  background-color:#f4efe4;
  background-image:
    radial-gradient(circle at 10% 0%, rgba(255,255,255,0.9) 0, rgba(255,255,255,0) 45%),
    radial-gradient(circle at 90% 0%, rgba(191,208,222,0.55) 0, rgba(191,208,222,0) 55%),
    radial-gradient(circle at 0% 80%, rgba(198,189,171,0.55) 0, rgba(198,189,171,0) 45%),
    radial-gradient(circle at 80% 100%, rgba(180,205,187,0.55) 0, rgba(180,205,187,0) 50%);
}

/* header cu ‚ÄûbandƒÉ‚Äù de app */
header{
  position:relative;
  padding:10px 10px 14px;
}
header::before{
  content:"";
  position:absolute;
  inset:0 8px auto;
  height:60px;
  border-radius:22px;
  background:linear-gradient(120deg,#fdfbf7,#e4eaf3);
  box-shadow:0 14px 30px rgba(120,111,90,0.18);
  z-index:-1;
}
header h1{
  font-size:17px;
  letter-spacing:0.12em;
  text-transform:uppercase;
}
header p{
  font-size:11px;
}

/* mic ‚Äûbadge‚Äù versiune */
header p::after{
  content:"v2.0";
  display:inline-flex;
  align-items:center;
  justify-content:center;
  margin-left:6px;
  padding:2px 8px;
  border-radius:999px;
  font-size:9px;
  font-weight:600;
  background:rgba(75,104,127,0.09);
  color:#4b687f;
}

/* carduri cu ornament √Æn col»õ */
.card,
.table-block,
.preview-card{
  position:relative;
  overflow:hidden;
}
.card::before,
.table-block::before,
.preview-card::before{
  content:"";
  position:absolute;
  right:-32px;
  top:-32px;
  width:90px;
  height:90px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.9),rgba(178,193,209,0.15));
  pointer-events:none;
}
.card::after,
.table-block::after,
.preview-card::after{
  content:"";
  position:absolute;
  left:-26px;
  bottom:-26px;
  width:70px;
  height:70px;
  border-radius:50%;
  background:radial-gradient(circle at 70% 70%,rgba(255,255,255,0.95),rgba(198,188,166,0.15));
  pointer-events:none;
}

/* con»õinutul cardurilor sƒÉ rƒÉm√¢nƒÉ deasupra ornamentelor */
.card > *,
.table-block > *,
.preview-card > *{
  position:relative;
  z-index:1;
}

/* titluri card cu barƒÉ sub»õire dedesubt */
.card h2{
  position:relative;
  padding-bottom:4px;
}
.card h2::after{
  content:"";
  position:absolute;
  left:0;
  bottom:0;
  width:42px;
  height:2px;
  border-radius:999px;
  background:linear-gradient(90deg,rgba(75,104,127,0.65),rgba(255,255,255,0));
}

/* chips ‚Äì mai ‚Äûtablete‚Äù */
.chip{
  position:relative;
  padding:4px 10px 4px 8px;
}
.chip::before{
  content:"";
  width:6px;
  height:6px;
  border-radius:50%;
  background:#c3b08f;
}

/* ========= ICONI»öE PE COLOANE (SUBJECT/TIME/PLACE etc.) ========= */

.col-header{
  display:flex;
  align-items:center;
  gap:4px;
}

/* icon placeholder */
.col-header::before{
  content:"";
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:16px;
  height:16px;
  border-radius:6px;
  background:rgba(255,255,255,0.8);
  font-size:11px;
  box-shadow:0 1px 3px rgba(0,0,0,0.06);
}

/* SUBJ üë§ */
.col[data-key="subject"] .col-header::before{
  content:"üë§";
}
/* TIME ‚è∞ */
.col[data-key="time"] .col-header::before{
  content:"‚è∞";
}
/* PLACE üìç */
.col[data-key="place"] .col-header::before{
  content:"üìç";
}
/* MOD ‚ú® */
.col[data-key="mod"] .col-header::before{
  content:"‚ú®";
}
/* OBJECT üéØ */
.col[data-key="object"] .col-header::before{
  content:"üéØ";
}
/* NUMERAL #Ô∏è‚É£ */
.col[data-key="numeral"] .col-header::before{
  content:"#Ô∏è‚É£";
}
/* COUNTER üî¢ */
.col[data-key="counter"] .col-header::before{
  content:"üî¢";
}
/* VERB üöÄ */
.col[data-key="verb"] .col-header::before{
  content:"üöÄ";
}
/* CONJUGƒÇRI üîó */
.col[data-key="conjug"] .col-header::before{
  content:"üîó";
}

/* c√¢nd coloana e ‚ÄûstinsƒÉ‚Äù (dimmed) ‚Äì iconi»õa devine gri */
.col.dimmed .col-header::before{
  filter:grayscale(0.9);
  opacity:0.6;
}

/* ========= ACCENTE DIFERITE PE FIECARE ECRAN ========= */

/* üèó Builder ‚Äì bandƒÉ sus de sec»õiune */
#screen-builder .mode-panel{
  border-top:3px solid rgba(186,166,126,0.85);
}
#screen-builder .preview-title span:first-child::before{
  content:"üèó ";
}

/* üìù Exerci»õii ‚Äì bandƒÉ albastrƒÉ */
#screen-exercises .card{
  border-top:3px solid rgba(118,147,183,0.95);
}
#screen-exercises h2::before{
  content:"üìù ";
}

/* üìö Glosar ‚Äì bandƒÉ verde salvie */
#screen-glossary > .card{
  border-top:3px solid rgba(138,170,142,0.95);
}
#screen-glossary h2::before{
  content:"üìö ";
}

/* lista de glosar ‚Äì ‚Äûfi»ôe‚Äù */
.glossary-item{
  background:rgba(255,255,255,0.9);
  box-shadow:0 6px 14px rgba(153,141,120,0.16);
}

/* card ‚Äû3 cuvinte/zi‚Äù ‚Äì mic timeline √Æn lateral */
#dailyWordsBox > div{
  position:relative;
}
#dailyWordsBox > div::before{
  content:"";
  position:absolute;
  left:-10px;
  top:10px;
  width:3px;
  height:60%;
  border-radius:999px;
  background:linear-gradient(to bottom,#9db8a3,#f4efe4);
}

/* ========= NAV BAR ‚Äì iconi»õe accentuate ========= */

.bottom-nav{
  border-top:1px solid rgba(205,195,176,0.8);
}
.nav-btn span.icon{
  font-size:19px;
}
.nav-btn.active span.icon{
  transform:translateY(-2px) scale(1.06);
}

/* ========= PREVIEW propozi»õie ========= */

.preview-card{
  margin-top:10px;
}
.preview-title span:first-child{
  display:flex;
  align-items:center;
  gap:6px;
}
.preview-title span:first-child::before{
  content:"üîä";
  width:18px;
  height:18px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  background:rgba(75,104,127,0.08);
}

/* hint naturalitate ‚Äì ‚Äûbadge‚Äù */
.preview-natural{
  padding:4px 8px;
  border-radius:999px;
  display:inline-block;
  background:rgba(185,207,192,0.35);
}

/* overlay panel ‚Äì divider subtil sus */
.panel-header{
  border-bottom:1px solid rgba(222,214,200,0.9);
  padding-bottom:6px;
}
    /* === THEME A ‚Äì Korean Minimal Chic & Cozy === */

:root{
  --bg: #f6f1e8;
  --card-bg: #fdfbf7;
  --accent: #6f86a8;          /* albastru-cernealƒÉ */
  --accent-strong: #4b607d;   /* albastru √Ænchis */
  --accent-soft: #f1d3a0;     /* auriu cald */
  --text-main: #2f343b;
  --text-soft: #7a8088;
  --border: #e3dacb;
  --dimmed-bg: #f0e6d7;
  --overlay-bg: rgba(40,32,24,0.25);
}

/* fundal general ‚Äì crem cald, tip ‚Äûcafea cu lapte‚Äù */
body{
  margin:0;
  padding:0;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at top,#fbf4e8 0,#f0ebe3 40%,#e9e2d7 100%);
  color:var(--text-main);
}

/* containerul aplica»õiei ‚Äì u»ôor ‚Äûcard‚Äù pe mijloc */
.app{
  max-width:1040px;
  margin:0 auto;
  padding:18px 14px calc(70px + env(safe-area-inset-bottom));
}
/* header ‚Äì mai ‚Äûbrand‚Äù »ôi mai premium */
header{
  padding:6px 10px 10px;
  text-align:left;
}
header h1{
  font-size:18px;
  font-weight:700;
  letter-spacing:0.03em;
  text-transform:uppercase;
  color:var(--accent-strong);
  display:flex;
  align-items:center;
  gap:6px;
}
header h1::before{
  content:"‚úçÔ∏è";
  font-size:16px;
}
header p{
  margin:2px 0 0;
  font-size:12px;
  color:var(--text-soft);
}

/* carduri mari ‚Äì efect de planner premium */
.card,
.table-block,
.preview-card{
  background:linear-gradient(145deg,#fdfbf7,#f4eee3);
  border-radius:18px;
  border:1px solid rgba(227,218,203,0.9);
  box-shadow:0 14px 30px rgba(80,64,48,0.12);
}

/* card standard (Rom√¢nƒÉ ‚Üí CoreeanƒÉ, Exerci»õii, Glosar) */
.card{
  padding:12px 14px;
}
.card h2{
  font-size:15px;
  color:var(--accent-strong);
  letter-spacing:0.04em;
}

/* bara de introducere propozi»õie */
textarea#roInput{
  background:#fbf8f1;
  border:1px solid #e1d5c5;
  box-shadow:0 0 0 1px rgba(255,255,255,0.7);
}

/* buton mare ‚ÄûTradu √Æn coreeanƒÉ‚Äù */
#roTranslateBtn{
  background:linear-gradient(115deg,#4b607d,#6f86a8);
  box-shadow:0 8px 18px rgba(75,96,125,0.35);
}

/* bara albastrƒÉ lungƒÉ (Tradu / Next etc.) */
button{
  border-radius:999px;
  border:none;
  padding:7px 14px;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(120deg,#4b607d,#6f86a8);
  color:#fff;
  box-shadow:0 8px 18px rgba(75,96,125,0.32);
}
button.secondary{
  background:#f3ebdd;
  color:var(--accent-strong);
  box-shadow:none;
}
button:disabled{
  opacity:0.45;
  box-shadow:none;
}

/* toggle-urile SUBJECT / TIME / ... ‚Äì chip-uri mai elegante */
.chip{
  background:#f4ece0;
  color:var(--accent-strong);
  border-radius:999px;
  padding:4px 10px;
  box-shadow:0 4px 8px rgba(180,162,136,0.25);
}
.chip input{
  accent-color:var(--accent-strong);
}

/* coloanele din tabel (SUBJECT / TIME / PLACE etc.) */
.col{
  background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
  border-radius:16px;
  border:1px solid #e2d7c8;
  box-shadow:0 10px 22px rgba(95,78,58,0.16);
  transform:translateY(0);
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease,
    background 0.15s ease;
}
.col-header{
  color:var(--accent-strong);
}
.col-body-main{
  color:#2f343b;
}
.col-body-label{
  color:#938777;
}
.col:hover{
  transform:translateY(-1px);
  box-shadow:0 14px 28px rgba(95,78,58,0.24);
  border-color:#d0c1aa;
}

/* c√¢nd coloana e dezactivatƒÉ */
.col.dimmed{
  opacity:0.4;
  background-image:none;
  background:#f1e7d8;
}

/* cardul de preview propozi»õie de jos */
.preview-card{
  margin-top:10px;
  padding:10px 12px;
}
.preview-title span{
  color:var(--accent-strong);
}
.preview-ko{
  font-size:16px;
  font-weight:700;
  color:#292f35;
}
.preview-ro{
  font-size:12px;
  color:var(--text-soft);
}
.preview-natural{
  color:#a97a2e; /* un auriu cald pentru mesajele de naturalitate */
}

/* legendƒÉ explicativƒÉ */
.legend{
  font-size:10px;
  color:#8b8476;
}

/* navbar-ul de jos ‚Äì barƒÉ de sticlƒÉ caldƒÉ */
.bottom-nav{
  background:rgba(248,242,233,0.96);
  border-top:1px solid #e1d7c7;
  backdrop-filter:blur(14px);
}
.nav-btn{
  color:#8b8476;
}
.nav-btn.active{
  color:var(--accent-strong);
}
.nav-btn span.icon{
  font-size:18px;
}

/* panelul de overlay (lista de cuvinte) ‚Äì ca un sertar de lemn deschis */
.panel{
  background:linear-gradient(145deg,#fdfbf7,#f2ebde);
  border-radius:20px 20px 0 0;
  border:1px solid #e1d7c7;
}
.panel-item{
  border-radius:12px;
}
.panel-item:hover{
  background:#f3ebdd;
}
    /* === Stepper 3 pa»ôi (Builder) === */

.builder-steps{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin:4px 0 10px;
  font-size:11px;
  color:var(--text-soft);
}

.builder-step{
  display:flex;
  align-items:center;
  gap:6px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(255,255,255,0.7);
  border:1px solid var(--border);
  box-shadow:0 2px 6px rgba(80,64,48,0.10);
}

.builder-step-number{
  width:16px;
  height:16px;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-weight:700;
  background:var(--accent-strong);
  color:#fff;
}

.builder-step-text{
  white-space:nowrap;
}

/* pasul curent (1) eviden»õiat pu»õin mai mult */
.builder-step.active{
  background:#fff7e4;
  border-color:var(--accent-soft);
}
    /* === HEADER BRAND + TABS DE CAIET === */

/* header general */
.rk-header{
  padding:8px 10px 12px;
  display:flex;
  flex-direction:column;
  gap:4px;
}

.rk-header-main{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.rk-header-main h1{
  margin:0;
  font-size:20px;
  font-weight:700;
  letter-spacing:0.06em;
  text-transform:uppercase;
  color:var(--accent-strong);
}

/* badge mic l√¢ngƒÉ titlu ‚Äì aratƒÉ ca o etichetƒÉ de agendƒÉ */
.rk-badge{
  font-size:11px;
  font-weight:600;
  padding:4px 9px;
  border-radius:999px;
  background:linear-gradient(120deg,#f1d3a0,#f6e3b9);
  color:#514029;
  border:1px solid rgba(210,175,112,0.7);
  box-shadow:0 4px 10px rgba(185,145,84,0.25);
}

/* subtitlu */
.rk-header #subtitle{
  margin:0;
  font-size:12px;
  color:var(--text-soft);
}

/* ===== TAB-URI DE JOS ‚Äì FILE DE CAIET ===== */

.bottom-nav{
  position:fixed;
  inset-inline:0;
  bottom:0;
  display:flex;
  justify-content:space-around;
  padding:8px 10px calc(8px + env(safe-area-inset-bottom));
  background:rgba(248,242,233,0.96);
  border-top:1px solid #e1d7c7;
  backdrop-filter:blur(16px);
}
/* fiecare tab */
.nav-btn{
  position:relative;
  flex:1;
  max-width:150px;
  border:none;
  background:transparent;
  padding:0;
  cursor:pointer;
  color:#8b8476;
  font-size:11px;
}

/* ‚Äûfilele‚Äù propriu-zise ‚Äì fundal rotunjit */
.nav-btn::before{
  content:"";
  position:absolute;
  inset:0;
  top:-4px;
  margin:0 4px;
  border-radius:14px 14px 0 0;
  background:rgba(255,252,246,0.65);
  border:1px solid transparent;
  border-bottom:none;
  box-shadow:none;
  transition:
    transform 0.16s ease,
    box-shadow 0.16s ease,
    border-color 0.16s ease,
    background 0.16s ease;
  z-index:-1;
}

/* con»õinutul tabului (icon + text) */
.nav-btn span.icon{
  display:block;
  font-size:17px;
  margin-bottom:1px;
}
.nav-btn span:last-child{
  position:relative;
  z-index:1;
}

/* tab activ ‚Äì pare ridicat de pe ‚Äûcaiet‚Äù */
.nav-btn.active{
  color:var(--accent-strong);
  font-weight:600;
}
.nav-btn.active::before{
  background:#fdfbf7;
  border-color:#ddcfb9;
  box-shadow:0 -4px 10px rgba(90,72,52,0.18);
  transform:translateY(-3px);
}

/* la hover pe desktop ‚Äì tab u»ôor ridicat */
@media (hover:hover){
  .nav-btn:hover::before{
    box-shadow:0 -3px 8px rgba(90,72,52,0.16);
  }
}
    
/* AdaugƒÉ √Æn <style> */
.legend{
  display:none;
}
    /* tot √Æn <style> */
#naturalHint{
  display:none;
}
    /* Chip-uri oprite (SUBJECT/TIME/PLACE etc. nefolosite √Æn propozi»õie) */
#screen-builder .chip-off{
  opacity: 0.45;
  background: #eee2d1;
  box-shadow: none;
  filter: grayscale(0.1);
}
    /* ===== STEPPER pentru Builder (3 pa»ôi vizuali) ===== */

.builder-steps{
  display:flex;
  gap:6px;
  margin-bottom:8px;
  padding:6px 6px 2px;
  border-radius:14px;
  background:rgba(255,252,246,0.9);
  border:1px solid rgba(223,210,190,0.9);
  box-shadow:0 6px 14px rgba(96,78,56,0.12);
}

.builder-step{
  flex:1;
  display:flex;
  align-items:center;
  gap:6px;
  padding:4px 6px;
  border-radius:999px;
  font-size:11px;
  color:var(--text-soft);
  opacity:0.9;
}

.builder-step-number{
  width:18px;
  height:18px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  font-weight:700;
  background:#f3ebdd;
  color:#70563a;
}

.builder-step-text{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* primul pas ‚Äì accent u»ôor (pare ‚Äûactiv‚Äù) */
.builder-step.active{
  background:linear-gradient(120deg,#f6efe3,#f1e2cc);
  color:var(--accent-strong);
  font-weight:600;
}

.builder-step.active .builder-step-number{
  background:var(--accent-strong);
  color:#fff;
}
    #screen-exercises .exercise-question.empty {
  color: var(--text-soft);
  font-weight: 400;
}
    .example{
  display:inline-block;
  font-size:12px;
  margin-top:2px;
  color:var(--text-soft);
}
    /* Ascunde rezultatul coreean + rom√¢na corectatƒÉ din blocul Rom√¢nƒÉ ‚Üí CoreeanƒÉ */
#roToKoResult,
#roCorrected {
  display: none;
}
    
    /* Ascund bara veche "Mod afi»ôare / Propozi»õia 1‚Äì2" */
#screen-builder > .mode-panel{
  display:none;
}
  /* ===== Fine tuning pentru Builder ‚Äì Propozi»õia 2 ===== */

/* r√¢ndul cu bifa P2, lipit de tabel, √Æn dreapta */
.builder-enable-p2{
  margin-top: 4px;
  padding-top: 4px;
  display: flex;
  justify-content: flex-end;
  border-top: 1px dashed var(--border);
  font-size: 11px;
  color: var(--text-soft);
}

.builder-enable-p2 label{
  display: flex;
  align-items: center;
  gap: 4px;
}

/* titlul "Propozi»õia 2 (continuare / frazƒÉ)" ‚Äì aratƒÉ ca sub-titlu elegant */
#titleP2{
  margin-top: 6px;
  padding-top: 4px;
  border-top: 1px dashed var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 11px;
  color: var(--text-soft);
}

#titleP2 span::before{
  content: "‚Ü≥ ";
  color: var(--accent-strong);
  font-weight: 600;
}  
   /* Ascund traducerea √Æn rom√¢nƒÉ DOAR √Æn preview-ul Builder */
.preview-card #previewRoTitle,
.preview-card #previewRo {
  display: none;
} 
   /* Ascund doar textul titlului "Traducere aproximativƒÉ (rom√¢nƒÉ ‚Äì pe pƒÉr»õi)" */
.preview-card #previewRoTitle > span {
  display: none;
} 
  /* ===== TEMA PASTEL GLOBALƒÇ (v2.0) ‚Äì Raluca Korean ===== */

/* fundal general aplica»õie */
body.pastel-theme {
  background: radial-gradient(circle at top left, #ffe4ff 0%, #d7f0ff 40%, #f0e5ff 75%, #f3d4ff 100%);
  font-weight: 500;
}

/* header sus */
body.pastel-theme .rk-header {
  background: linear-gradient(120deg, #6fb8ff, #a774ff, #ff7fd1);
  color: #fff;
  box-shadow: 0 18px 45px rgba(77, 93, 255, 0.4);
  border-radius: 26px;
}

body.pastel-theme .rk-header-main h1 {
  font-weight: 900;
  letter-spacing: 0.06em;
  text-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

body.pastel-theme .rk-badge {
  background: rgba(255, 255, 255, 0.18);
  border-radius: 999px;
  padding-inline: 14px;
  font-weight: 600;
}

/* card-urile mari (builder, exerci»õii, lec»õii, glosar) */
body.pastel-theme .card,
body.pastel-theme .table-block,
body.pastel-theme .preview-card {
  background: radial-gradient(circle at top left, #ffffff 5%, #f7f0ff 45%, #ffe9ff 85%);
  border-radius: 26px;
  box-shadow:
    0 18px 40px rgba(70, 85, 155, 0.22),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
  border: none;
}

/* zona Rom√¢nƒÉ ‚Üí CoreeanƒÉ */
body.pastel-theme #roInput,
body.pastel-theme textarea {
  border-radius: 18px;
  border: none;
  box-shadow:
    0 10px 25px rgba(120, 140, 200, 0.18),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
  background: linear-gradient(145deg, #ffffff, #f7f4ff);
}

/* titluri mai groase peste tot */
body.pastel-theme h1,
body.pastel-theme h2,
body.pastel-theme h3 {
  font-weight: 800;
}

/* butoane ‚Äû3D pill‚Äù generale */
body.pastel-theme button,
body.pastel-theme .bottom-nav .nav-btn {
  border-radius: 999px;
  border: none;
  font-weight: 600;
  padding-inline: 18px;
  padding-block: 8px;
  box-shadow:
    0 10px 25px rgba(80, 90, 160, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  background: linear-gradient(135deg, #4b8bff, #a55dff);
  color: #ffffff;
  transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, filter 0.1s ease-out;
}

/* butoane secundare (gri/galben/roz) ‚Äì folosim clasa existentƒÉ .secondary */
body.pastel-theme button.secondary {
  background: linear-gradient(135deg, #ffaf6b, #ff72b4);
}

/* hover/active 3D */
body.pastel-theme button:hover,
body.pastel-theme .bottom-nav .nav-btn:hover {
  transform: translateY(-1px);
  filter: brightness(1.05);
  box-shadow:
    0 14px 32px rgba(60, 80, 160, 0.42),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
}

body.pastel-theme button:active,
body.pastel-theme .bottom-nav .nav-btn:active {
  transform: translateY(1px);
  box-shadow:
    0 6px 16px rgba(50, 70, 130, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
}

/* bara de jos ‚Äì nav */
body.pastel-theme .bottom-nav {
  background: linear-gradient(120deg, #f3e6ff, #ffe8fb);
  box-shadow: 0 -10px 25px rgba(110, 120, 190, 0.25);
  border-radius: 24px 24px 0 0;
}

body.pastel-theme .bottom-nav .nav-btn {
  background: transparent;
  box-shadow: none;
  color: #5860b0;
}

/* buton activ din nav */
body.pastel-theme .bottom-nav .nav-btn.active {
  background: linear-gradient(135deg, #5f8cff, #be6dff);
  color: #fff;
  box-shadow:
    0 8px 20px rgba(90, 90, 190, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
}

/* mici iconi»õe rotunde (dacƒÉ folose»ôti .icon / emoji √Æn span) */
body.pastel-theme .icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 0%, #fff, rgba(255, 255, 255, 0));
  box-shadow: 0 6px 15px rgba(70, 70, 140, 0.35);
}  
    /* ===== Carduri 3D pastel pentru Builder (SUBJECT / TIME / PLACE / MOD / OBJECT / NUMERAL / COUNTER / VERB...) ===== */

body.pastel-theme #tableP1 > div {
  position: relative;
  border-radius: 22px;
  padding: 10px 12px;
  margin-bottom: 6px;
  background: radial-gradient(circle at top left, #ffffff 0%, #f3f3ff 55%, #ffe7ff 100%);
  box-shadow:
    0 12px 28px rgba(80, 90, 160, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
  overflow: hidden;
}

/* efect de highlight pe marginea de sus a fiecƒÉrui card */
body.pastel-theme #tableP1 > div::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(120deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0));
  opacity: 0.8;
  pointer-events: none;
}

/* textul din headerul cardului (SUBJECT, TIME, etc.) ‚Äì √Æl √Ængro»ôƒÉm */
body.pastel-theme #tableP1 > div > *:first-child {
  font-weight: 800;
  letter-spacing: 0.02em;
}

/* micƒÉ margine √Æntre header »ôi restul con»õinutului din card */
body.pastel-theme #tableP1 > div > *:nth-child(2) {
  margin-top: 4px;
}

/* nuan»õe diferite pe fiecare card, ca √Æn mockup (pe bazƒÉ de pozi»õie) */
body.pastel-theme #tableP1 > div:nth-child(1) {
  background: radial-gradient(circle at top left, #e0f0ff 0%, #b9d5ff 45%, #e3e6ff 100%);
}

body.pastel-theme #tableP1 > div:nth-child(2) {
  background: radial-gradient(circle at top left, #ffe1ea 0%, #ffc0d7 45%, #ffeaf5 100%);
}

body.pastel-theme #tableP1 > div:nth-child(3) {
  background: radial-gradient(circle at top left, #fff3d6 0%, #ffd68a 45%, #fff0d7 100%);
}

body.pastel-theme #tableP1 > div:nth-child(4) {
  background: radial-gradient(circle at top left, #d9ffe6 0%, #b4f4cf 45%, #e3fff0 100%);
}

body.pastel-theme #tableP1 > div:nth-child(5) {
  background: radial-gradient(circle at top left, #dde6ff 0%, #b5c5ff 45%, #e3e5ff 100%);
}

body.pastel-theme #tableP1 > div:nth-child(6),
body.pastel-theme #tableP1 > div:nth-child(7),
body.pastel-theme #tableP1 > div:nth-child(8) {
  background: radial-gradient(circle at top left, #f4e1ff 0%, #e3c1ff 45%, #f8e7ff 100%);
}
    /* Culori pastel Propozitia 2 (randul de jos) */
body.pastel-theme #tableP2 > div:nth-child(1) {
  background: radial-gradient(circle at top left, #ffe8ef 0%, #ffc7d9 45%, #ffeef5 100%);
}

body.pastel-theme #tableP2 > div:nth-child(2) {
  background: radial-gradient(circle at top left, #fff1da 0%, #ffe0a8 45%, #fff3dd 100%);
}

body.pastel-theme #tableP2 > div:nth-child(3) {
  background: radial-gradient(circle at top left, #e9ffe4 0%, #bfffd3 45%, #efffea 100%);
}

body.pastel-theme #tableP2 > div:nth-child(4) {
  background: radial-gradient(circle at top left, #e8f2ff 0%, #c8dcff 45%, #eef4ff 100%);
}

body.pastel-theme #tableP2 > div:nth-child(5) {
  background: radial-gradient(circle at top left, #f3e7ff 0%, #dcc4ff 45%, #f6ecff 100%);
}

body.pastel-theme #tableP2 > div:nth-child(6) {
  background: radial-gradient(circle at top left, #fff0f0 0%, #ffd6d6 45%, #fff4f4 100%);
}

body.pastel-theme #tableP2 > div:nth-child(7) {
  background: radial-gradient(circle at top left, #f0fff6 0%, #ccffe6 45%, #f2fff8 100%);
}

body.pastel-theme #tableP2 > div:nth-child(8) {
  background: radial-gradient(circle at top left, #f0f5ff 0%, #d6e3ff 45%, #f3f7ff 100%);
}
    /* ===== Butoane pastel 3D ===== */

body.pastel-theme .preview-buttons button,
body.pastel-theme #prevBtn,
body.pastel-theme #nextBtn,
body.pastel-theme #resetBtn,
body.pastel-theme #toggleRoBtn {
  border: none;
  border-radius: 18px;
  padding: 8px 14px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: #ffffff;
  box-shadow:
    0 10px 22px rgba(80, 80, 140, 0.28),
    0 0 0 1px rgba(255,255,255,.7) inset;
  transition: transform .15s ease, box-shadow .15s ease;
}

/* efect apƒÉsare */
body.pastel-theme .preview-buttons button:active,
body.pastel-theme #prevBtn:active,
body.pastel-theme #nextBtn:active,
body.pastel-theme #resetBtn:active,
body.pastel-theme #toggleRoBtn:active {
  transform: translateY(2px);
  box-shadow:
    0 4px 10px rgba(60, 60, 120, 0.25),
    0 0 0 1px rgba(255,255,255,.6) inset;
}
    /* Random propozi»õie */
body.pastel-theme #randomBtn {
  background: linear-gradient(135deg, #7a6cff, #6cc9ff);
}

/* Audio coreeanƒÉ */
body.pastel-theme #speakBtn {
  background: linear-gradient(135deg, #6cc9ff, #5be6c6);
}

/* SalveazƒÉ propozi»õia */
body.pastel-theme #favBtn {
  background: linear-gradient(135deg, #ff9a6c, #ff5f8c);
}

/* Reset pƒÉr»õi propozi»õie */
body.pastel-theme #resetBtn {
  background: linear-gradient(135deg, #ff6b6b, #ff9a6c);
}

/* Prev / Next */
body.pastel-theme #prevBtn {
  background: linear-gradient(135deg, #8aa4ff, #b1c2ff);
}
body.pastel-theme #nextBtn {
  background: linear-gradient(135deg, #9f77ff, #c188ff);
}

/* Ascunde traducerea */
body.pastel-theme #toggleRoBtn {
  background: linear-gradient(135deg, #ffa3a3, #ffc2a9);
}
    /* ===== Card Rom√¢nƒÉ ‚Üí CoreeanƒÉ ‚Äì glassmorphic ===== */

body.pastel-theme #roInput,
body.pastel-theme #roToKoResult,
body.pastel-theme #roCorrected {
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(14px);
  border-radius: 18px;
  box-shadow:
    0 12px 28px rgba(140, 130, 200, 0.25),
    0 0 0 1px rgba(255,255,255,.6) inset;
  font-weight: 600;
}
   /* Ascund DOAR textul titlului traducerii, pƒÉstrez butonul */
body.pastel-theme .preview-card #previewRoTitle span {
  display: none !important;
} 
   /* ===== Card Rom√¢nƒÉ ‚Üí CoreeanƒÉ ‚Äì glassmorphism pastel ===== */

#roCard {
  margin-top: 16px;
  padding: 16px 20px 20px;
  border-radius: 22px;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.75),
    rgba(255, 255, 255, 0.45)
  );
  box-shadow:
    0 18px 45px rgba(131, 112, 210, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  backdrop-filter: blur(18px);
}

#roCard h2 {
  font-size: 16px;
  font-weight: 800;
  letter-spacing: 0.03em;
  margin-bottom: 10px;
}

/* textarea de rom√¢nƒÉ */
#roCard textarea#roInput {
  width: 100%;
  border-radius: 18px;
  border: none;
  padding: 10px 14px;
  font-size: 14px;
  font-weight: 600;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: 0 8px 20px rgba(135, 130, 200, 0.25);
}

/* butonul 'Tradu √Æn coreeanƒÉ' ‚Äì capsulƒÉ pastel 3D */
#roCard #roTranslateBtn {
  margin-top: 10px;
  border-radius: 999px;
  border: none;
  padding: 8px 16px;
  font-weight: 700;
  color: #ffffff;
  cursor: pointer;
  background: linear-gradient(135deg, #6b8cff, #9b6bff);
  box-shadow:
    0 10px 24px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

#roCard #roTranslateBtn:active {
  transform: translateY(2px);
  box-shadow:
    0 5px 12px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}

/* rezultatul √Æn coreeanƒÉ + varianta corectatƒÉ */
#roCard #roToKoResult,
#roCard #roCorrected {
  margin-top: 10px;
  padding: 8px 12px;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  box-shadow: 0 6px 16px rgba(140, 135, 210, 0.25);
} 
  /* Ascund DOAR textul 'Traducere aproximativƒÉ (rom√¢nƒÉ ‚Äì pe pƒÉr»õi)' din Builder */
.preview-card #previewRoTitle span {
  display: none !important;
} 
   /* ===== Card Rom√¢nƒÉ ‚Üí CoreeanƒÉ ‚Äì glassmorphism pastel ===== */
#screen-builder .card {
  margin-top: 16px;
  padding: 16px 20px 20px;
  border-radius: 22px;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.8),
    rgba(255, 255, 255, 0.5)
  );
  box-shadow:
    0 18px 45px rgba(131, 112, 210, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  backdrop-filter: blur(18px);
}

/* titlul Rom√¢nƒÉ ‚Üí CoreeanƒÉ */
#screen-builder .card h2 {
  font-size: 16px;
  font-weight: 800;
  letter-spacing: 0.03em;
  margin-bottom: 10px;
}
/* TEXT MARE & BOLD ‚Äî bloc Rom√¢nƒÉ ‚Üí CoreeanƒÉ */
.translation-output,
#roToKrOutput,
.translation-box {
  font-size: 26px;
  font-weight: 800;
  line-height: 1.9;
  letter-spacing: 0.3px;
}
    /* textarea √Æn care scrii rom√¢na */
#screen-builder .card textarea#roInput {
  width: 100%;
  border-radius: 18px;
  border: none;
  padding: 10px 14px;
  font-size: 14px;
  font-weight: 600;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 8px 20px rgba(135, 130, 200, 0.25);
}

/* butonul 'Tradu √Æn coreeanƒÉ' ‚Äì capsulƒÉ 3D */
#screen-builder .card #roTranslateBtn {
  margin-top: 10px;
  border-radius: 999px;
  border: none;
  padding: 8px 16px;
  font-weight: 700;
  color: #ffffff;
  cursor: pointer;
  background: linear-gradient(135deg, #6b8cff, #9b6bff);
  box-shadow:
    0 10px 24px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

#screen-builder .card #roTranslateBtn:active {
  transform: translateY(2px);
  box-shadow:
    0 5px 12px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}

/* rezultatul √Æn coreeanƒÉ + varianta corectatƒÉ */
#screen-builder .card #roToKoResult,
#screen-builder .card #roCorrected {
  margin-top: 10px;
  padding: 8px 12px;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.95);
  font-weight: 600;
  box-shadow: 0 6px 16px rgba(140, 135, 210, 0.25);
} 
    /* Carduri pƒÉr»õi propozi»õie ‚Äì stil capsule 3D */
.table-block .table-title span,
.mode-row span.section-label {
  font-weight: 800;
  letter-spacing: 0.02em;
}

/* Butoane select ‚Äì bordurƒÉ interioarƒÉ + glow fin */
.part-option {
  font-weight: 700;
  box-shadow:
    0 10px 22px rgba(120, 120, 200, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.8) inset;
  border-radius: 16px;
  backdrop-filter: blur(6px);
}
    /* Butoane principale glossy gradient */
.preview-buttons button,
.btn-group button {
  border-radius: 16px;
  font-weight: 800;
  letter-spacing: 0.02em;
  border: none;
  color: white;
  padding: 8px 14px;

  background: linear-gradient(135deg,
    rgba(140, 170, 255, 1),
    rgba(200, 130, 255, 1)
  );

  box-shadow:
    0 14px 28px rgba(140, 120, 230, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;

  transition: transform .15s ease, box-shadow .15s ease;
}

.preview-buttons button:active,
.btn-group button:active {
  transform: translateY(2px);
  box-shadow:
    0 6px 16px rgba(140, 120, 230, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}
    /* Ascund doar textul titlului traducerii aproximative din Builder */
.preview-card .preview-title {
  visibility: hidden;
}

/* Dar pƒÉstrez butonul "Ascunde traducerea" vizibil */
.preview-card .preview-title button {
  visibility: visible;
}
    /* ==== 1. FONTURI MAI GROASE PENTRU TITLURI + BUTOANE ==== */

/* Titlul mare + subtitlul de sus */
h1 {
  font-weight: 800;
  letter-spacing: 0.04em;
}

#subtitle {
  font-weight: 500;
}

/* Titlurile de sec»õiune (ex: Rom√¢nƒÉ ‚Üí CoreeanƒÉ, Exerci»õii TOPIK etc.) */
h2,
.table-title span,
.preview-title span {
  font-weight: 700;
}

/* Text pe butoane (inclusiv butoane de jos: Builder / Exerci»õii / Lec»õii / Glosar) */
button,
.nav-btn span {
  font-weight: 600;
  letter-spacing: 0.02em;
}
    /* ==== 2. BUTOANE 3D + ANIMA»öIE ==== */

/* bazƒÉ pentru TOATE butoanele */
button,
.nav-btn {
  transition:
    transform 0.12s ease-out,
    box-shadow 0.12s ease-out,
    filter 0.12s ease-out;
  transform-origin: center;
}

/* efect ‚Äûplutire‚Äù la hover (pe desktop / c√¢nd atingi u»ôor) */
button:hover,
.nav-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.18);
  filter: brightness(1.03);
}

/* mic ‚ÄûapƒÉsat‚Äù la click */
button:active,
.nav-btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.24);
  filter: brightness(0.98);
}

/* un pic de glow √Æn plus pentru butoanele importante (random / audio / salveazƒÉ etc.) */
button.primary,
button#randomBtn,
button#speakBtn,
button#favBtn {
  box-shadow: 0 12px 28px rgba(255, 160, 220, 0.45);
}

/* tab-ul activ din bara de jos (Builder, Exerci»õii, Lec»õii, Glosar) mai ‚Äûridicat‚Äù */
.bottom-nav .nav-btn.active {
  transform: translateY(-2px);
  box-shadow: 0 14px 32px rgba(73, 46, 180, 0.45);
}/* ==== 3. CARDURI GLOSSY PENTRU EXERCI»öII / LEC»öII / GLOSAR ==== */

#screen-exercises .card,
#screen-lessons .card,
#screen-glossary .card {
  background: linear-gradient(145deg, rgba(255, 255, 255, 0.92), rgba(255, 220, 255, 0.88));
  border-radius: 26px;
  border: 1px solid rgba(255, 255, 255, 0.7);
  box-shadow:
    0 18px 40px rgba(40, 0, 80, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.5) inset;
  padding: 24px;
}

/* titlul lec»õiilor / glosarului un pic mai ‚Äûstatement‚Äù */
#screen-exercises h2,
#screen-lessons h2,
#screen-glossary h2 {
  font-weight: 800;
  letter-spacing: 0.03em;
}

/* un mic gradient »ôi pe header-ul de lec»õie, dacƒÉ existƒÉ .lesson-header */
#screen-lessons .lesson-header {
  padding: 14px 18px;
  border-radius: 18px;
  background: linear-gradient(120deg, rgba(153, 206, 255, 0.85), rgba(255, 188, 224, 0.9));
  box-shadow: 0 10px 24px rgba(90, 70, 180, 0.35);
}

/* glosarul ‚Äì lista principalƒÉ sƒÉ parƒÉ card, nu tabel simplu */
#screen-glossary #glossaryList {
  margin-top: 12px;
  padding: 14px 16px;
  border-radius: 20px;
  background: linear-gradient(160deg, rgba(255, 255, 255, 0.96), rgba(220, 240, 255, 0.92));
  box-shadow: 0 14px 28px rgba(60, 80, 140, 0.25);
}  
   /* Ascund DOAR textul ‚ÄûTraducere aproximativƒÉ (rom√¢nƒÉ ‚Äì pe pƒÉr»õi)‚Äù din Builder */
#screen-builder .preview-card #previewRoTitle {
  display: none !important;
} 
    #screen-builder .preview-card #previewRoTitle2 {
  display: none !important;
}
    :root{
  --glass-bg: linear-gradient(145deg,#ffffff80,#ffffff20);
  --glass-border: 1px solid rgba(255,255,255,0.45);
  --glass-shadow: 0 20px 40px rgba(0,0,0,0.08);

  --grad-top: linear-gradient(120deg,#9fd6ff,#c6a7ff,#ff9acb);
  --grad-bottom: linear-gradient(120deg,#b7e2ff,#e6c8ff,#ffd1e3);
}
    .card,
.preview-card,
.gloss-card,
.lesson-card,
.exercise-card {
  background: var(--glass-bg);
  border: var(--glass-border);
  border-radius: 22px;
  box-shadow: var(--glass-shadow);
  backdrop-filter: blur(14px);
}.rk-header{
  background: var(--grad-top);
  color:#0b1b3c;
  font-weight:700;
  letter-spacing:.5px;
}
    body{
  background: var(--grad-bottom);
}
    button,
.btn {
  border-radius: 14px;
  border: none;
  padding: 10px 16px;
  font-weight: 700;
  backdrop-filter: blur(6px);
  box-shadow: 0 8px 18px rgba(0,0,0,.12);
  transform: translateY(0);
  transition: .18s ease;
}

button:hover {
  transform: translateY(-2px);
}

.btn-blue  { background: linear-gradient(120deg,#82b5ff,#5fa8ff); color:#fff; }
.btn-green { background: linear-gradient(120deg,#8df2c8,#5ed6a8); color:#044; }
.btn-pink  { background: linear-gradient(120deg,#ff9acb,#ff7fae); color:#fff; }
.btn-orange{ background: linear-gradient(120deg,#ffb585,#ff8a46); color:#552200; }
   #screen-builder .card,
#screen-builder .preview-card {
  border-radius: 24px;
}
    #screen-glossary .card {
  border-radius: 24px;
}
  #screen-lessons .card {
  border-radius: 24px;
}
  #screen-exercises .card {
  border-radius: 24px;
}
   /* Iconi»õe + micro 3D pe butoanele principale din Builder */
#screen-builder #randomBtn::before,
#screen-builder #speakBtn::before,
#screen-builder #favBtn::before {
  display: inline-block;
  margin-right: 6px;
  transform: translateY(1px);
  transition: transform 0.15s ease, filter 0.15s ease;
}

/* Icon concrete */
#screen-builder #randomBtn::before  { content: "üé≤"; }
#screen-builder #speakBtn::before   { content: "üîä"; }
#screen-builder #favBtn::before     { content: "‚≠ê"; }

/* Micro 3D c√¢nd treci cu mouse-ul / atingi */
#screen-builder #randomBtn:hover::before,
#screen-builder #speakBtn:hover::before,
#screen-builder #favBtn:hover::before {
  transform: translateY(-1px) scale(1.08);
  filter: drop-shadow(0 2px 3px rgba(0,0,0,0.25));
}
   /* Card-uri care ‚Äûplutesc‚Äù u»ôor la hover */
.card,
.preview-card,
#screen-exercises .card,
#screen-lessons .card,
#screen-glossary .card {
  transition: transform 0.18s ease-out, box-shadow 0.18s ease-out;
}

.card:hover,
.preview-card:hover,
#screen-exercises .card:hover,
#screen-lessons .card:hover,
#screen-glossary .card:hover {
  transform: translateY(-3px);
  box-shadow: 0 22px 45px rgba(0,0,0,0.14);
}
 /* Neon focus pentru c√¢mpuri de text / select */
input:focus,
textarea:focus,
select:focus {
  outline: none;
  border-color: rgba(255,255,255,0.9);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.9),
    0 0 0 3px rgba(149, 120, 255, 0.7),
    0 0 16px rgba(149, 120, 255, 0.7);
  background-color: rgba(255,255,255,0.8);
}.bottom-nav {
  backdrop-filter: blur(18px);
}

/* pastilƒÉ iOS pentru nav */
.bottom-nav .nav-btn {
  border-radius: 999px;
  padding: 8px 18px 6px;
  font-weight: 600;
  background: linear-gradient(120deg,#f4e4ff,#fdf3ff);
  color: #4a3b73;
  box-shadow: 0 8px 20px rgba(0,0,0,0.10);
  transform: translateY(0);
  transition: transform 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
}

/* buton selectat */
.bottom-nav .nav-btn.active {
  background: linear-gradient(120deg,#8fd3ff,#c798ff);
  color: white;
  box-shadow: 0 14px 32px rgba(123, 104, 238, 0.5);
  transform: translateY(-2px);
}
   /* Header ‚Äì gradient care se mi»ôcƒÉ + glow subtil */
.rk-header {
  position: relative;
  z-index: 2;
  background-size: 220% 220%;          /* permite animarea gradientului existent */
  animation: headerGradient 18s ease-in-out infinite;
}

/* Aura coloratƒÉ moale √Æn jurul header-ului */
.rk-header::after {
  content: "";
  position: absolute;
  inset: -18px -26px;                  /* c√¢t de mare e ‚Äúaura‚Äù √Æn jur */
  border-radius: 32px;
  background: radial-gradient(circle at 0% 0%,  rgba(143,211,255,0.9), transparent 60%),
              radial-gradient(circle at 100% 0%, rgba(255,174,238,0.9), transparent 60%),
              radial-gradient(circle at 50% 100%, rgba(173,255,189,0.9), transparent 65%);
  filter: blur(32px);
  opacity: 0.24;
  pointer-events: none;
  z-index: -1;
  animation: headerGlow 8s ease-in-out infinite;
}

/* anima mi»ôcarea gradientului din header (folose»ôte gradientul pe care √Æl ai deja) */
@keyframes headerGradient {
  0%   { background-position: 0% 40%; }
  50%  { background-position: 100% 60%; }
  100% { background-position: 0% 40%; }
}

/* anima ‚Äúrespira»õia‚Äù aurei */
@keyframes headerGlow {
  0%, 100% {
    opacity: 0.18;
    transform: translateY(0);
  }
  50% {
    opacity: 0.32;
    transform: translateY(3px);
  }
}
    /* Containerul principal ‚Äì √Æl facem ‚Äúsuport‚Äù pentru fundalul animat */
.app {
  position: relative;
  z-index: 0;
  overflow-x: hidden;
}

/* Stratul de fundal animat, foarte subtil (sub toatƒÉ aplica»õia) */
.app::before {
  content: "";
  position: fixed;      /* rƒÉm√¢ne pe loc c√¢nd derulezi */
  inset: 0;
  z-index: -1;
  pointer-events: none;

  background:
    radial-gradient(circle at 0% 0%,     rgba(143,211,255,0.7), transparent 55%),
    radial-gradient(circle at 100% 0%,   rgba(255,174,238,0.75), transparent 55%),
    radial-gradient(circle at 0% 100%,   rgba(173,255,189,0.7), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(255,214,165,0.75), transparent 60%);
  background-size: 160% 160%;
  animation: appBgDrift 32s ease-in-out infinite alternate;
}

/* mi»ôcare foarte lentƒÉ, ‚Äúrespira»õie‚Äù de culori */
@keyframes appBgDrift {
  0% {
    background-position:
      0%   0%,
      100% 0%,
      0%   100%,
      100% 100%;
  }
  50% {
    background-position:
      12%  8%,
      88%  2%,
      6%   88%,
      94%  96%;
  }
  100% {
    background-position:
      0%   10%,
      100% 6%,
      4%   100%,
      96%  90%;
  }
}  /* Glow animat foarte subtil pe header */
.rk-header {
  position: relative;
  overflow: visible;
}

.rk-header::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 100%;
  width: 260px;
  height: 70px;
  transform: translateX(-50%);
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(255, 170, 255, 0.35),
    rgba(120, 160, 255, 0.18),
    rgba(255, 255, 255, 0)
  );
  filter: blur(22px);
  animation: rkGlow 6s ease-in-out infinite alternate;
  pointer-events: none;
  z-index: -1;
}

@keyframes rkGlow {
  0%   { opacity: 0.45; transform: translateX(-50%) translateY(6px) scale(1.0);}
  100% { opacity: 0.85; transform: translateX(-50%) translateY(2px) scale(1.08);}
}
  /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
/* üåà Gradient animat lent pe fundal */
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

body.pastel-theme {
  background: linear-gradient(
    120deg,
    #dff3ff,
    #ffe9ff,
    #f4fffc,
    #e8f0ff
  );
  background-size: 380% 380%;
  animation: bgFlow 28s ease-in-out infinite;
}

@keyframes bgFlow {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}



/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
/* ‚ú® Glow animat foarte subtil sub header */
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

.rk-header {
  position: relative;
  overflow: visible;
}

.rk-header::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 100%;
  width: 260px;
  height: 70px;
  transform: translateX(-50%);
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(255, 170, 255, 0.35),
    rgba(120, 160, 255, 0.18),
    rgba(255, 255, 255, 0)
  );
  filter: blur(22px);
  animation: rkGlow 6s ease-in-out infinite alternate;
  pointer-events: none;
  z-index: -1;
}

@keyframes rkGlow {
  0% {
    opacity: 0.45;
    transform: translateX(-50%) translateY(6px) scale(1.0);
  }
  100% {
    opacity: 0.85;
    transform: translateX(-50%) translateY(2px) scale(1.08);
  }
}
 /* TEXT MARE & BOLD ‚Äî preview propozi»õie coreeanƒÉ */
.preview-sentence,
#koreanPreview,
.preview-output {
  font-size: 26px;
  font-weight: 800;
  line-height: 1.9;
  letter-spacing: 0.3px;
}
    body.pastel-theme .bottom-nav:last-of-type {
  display: flex !important;
}

/* Scoate plƒÉcu»õa albƒÉ din spatele tab-urilor */
.bottom-nav .nav-btn::before {
  content: none !important;
}
  /* ============================================================
   PARSER RO ‚Üí BUILDER (V2, mai complet)
   ============================================================ */

/* 1. Normalizare text rom√¢nƒÉ:
   - litere mici
   - diacritice uniformizate
   - scoatem semnele de punctua»õie
*/
function normalizeRo(text) {
  if (!text) return "";
  let t = text.toLowerCase();

  // uniformizƒÉm diacritice / variante
  t = t.replace(/≈ü/g, "»ô").replace(/≈£/g, "»õ");
  t = t.replace(/√É¬¢/g, "√¢").replace(/√É¬Æ/g, "√Æ");

  // scoatem unele semne de punctua»õie
  t = t.replace(/[.,!?;:]/g, " ");

  // spa»õii multiple ‚Üí un singur spa»õiu
  t = t.replace(/\s+/g, " ").trim();
  return t;
}

/* 2. Reguli pentru fiecare slot
   - fiecare regulƒÉ are un regex »ôi un value (cuv√¢ntul coreean)
   - ORDINEA conteazƒÉ: primele reguli sunt mai ‚Äûprioritare‚Äù
*/

const RO_RULES = {
  subject: [
    // eu (formal) ‚Äì Ï†Ä
    { re: /\beu\s*\(formal\)|eu\s*-\s*formal\b/, value: "Ï†Ä" },
    // eu (informal) ‚Äì ÎÇò
    { re: /\beu\s*\(informal\)|eu\s*-\s*informal\b/, value: "ÎÇò" },
    // dacƒÉ apare simplu ‚Äûeu‚Äù ‚Üí default Ï†Ä (po»õi schimba)
    { re: /\beu\b/, value: "Ï†Ä" },
    // tu
    { re: /\btu\b/, value: "ÎÑà" }
  ],

  time: [
    { re: /\bazi\b|\bastƒÉzi\b/, value: "Ïò§Îäò" },
    { re: /\bm√¢ine\b/, value: "ÎÇ¥Ïùº" },
    { re: /\bieri\b/, value: "Ïñ¥Ï†ú" },
    { re: /\bacum\b/, value: "ÏßÄÍ∏à" }
  ],

  place: [
    { re: /\bacas[ƒÉa]\b/, value: "Ïßë" },
    { re: /la\s+»ôcoal[ƒÉa]|la\s+scoala|»ôcoal[ƒÉa]\b|scoala\b/, value: "ÌïôÍµê" },
    { re: /la\s+firm[ƒÉa]|la\s+serviciu|la\s+companie|firm[ƒÉa]\b|serviciu\b|companie\b/, value: "ÌöåÏÇ¨" },
    { re: /la\s+banc[ƒÉa]|banc[ƒÉa]\b/, value: "ÏùÄÌñâ" },
    { re: /cafenea|cafene[al]/, value: "Ïπ¥Ìéò" }
  ],

  mod: [
    { re: /\bbine\b|frumos\b|ok\b/, value: "Ïûò" },
    { re: /√Æn\s+lini»ôte|in\s+liniste|lini»ôte|liniste/, value: "Ï°∞Ïö©Ìûà" },
    { re: /cu\s+s√¢rguint[ƒÉa]|cu\s+sarguinta|harnic|cu\s+mult\s+efort/, value: "Ïó¥Ïã¨Ìûà" },
    { re: /√Æncet|incet/, value: "Ï≤úÏ≤úÌûà" },
    { re: /repede|rapid/, value: "Îπ®Î¶¨" }
  ],

  object: [
    { re: /cafea/, value: "Ïª§Ìîº" },
    { re: /\bap[ƒÉa]\b|ap[ƒÉa]\s+mineral[ƒÉa]?/, value: "Î¨º" },
    { re: /carte|c[ƒÉa]r»õile|c[ƒÉa]rti\b/, value: "Ï±Ö" },
    { re: /m[ƒÉa]ncare|pr[ƒÉa]nzul|cina|mic\s+dejun/, value: "ÏùåÏãù" },
    { re: /ceai\b/, value: "Ï∞®" }
  ],

  // op»õional: numƒÉr pentru obiect (doar 1‚Äì3, ca exemplu)
  numeral: [
    { re: /\bo\s+carte\b|\bunƒÉ\s+carte\b|\b(o|un)\s+caf(ea|ea)\b/, value: "Ìïú" },
    { re: /\bdou[ƒÉa]\s+car»õi|dou[ƒÉa]\s+cafele/, value: "Îëê" },
    { re: /\btrei\s+car»õi|trei\s+cafele/, value: "ÏÑ∏" }
  ],

  // op»õional: alegem classifier √Æn func»õie de obiect
  counter: [
    { re: /carte|c[ƒÉa]rti\b/, value: "Í∂å" },  // pentru cƒÉr»õi
    { re: /cafea|ap[ƒÉa]\b|ceai\b|m[ƒÉa]ncare/, value: "Í∞ú" } // general
  ],

  // verb foarte simplu ‚Äì doar pentru propozi»õia mare
  verb: [
    { re: /merg\b|a merge|sƒÉ merg|sa merg/, value: "Í∞ÄÏöî" },
    { re: /vin\b|a veni|sƒÉ vin|sa vin/, value: "ÏôÄÏöî" },
    { re: /beau\b|a bea|sƒÉ beau|sa beau/, value: "ÎßàÏÖîÏöî" },
    { re: /m[ƒÉa]n[√¢a]nc\b|m[ƒÉa]n√¢nc|mananc|a m[ƒÉa]nca/, value: "Î®πÏñ¥Ïöî" },
    { re: /citesc|a citi|sƒÉ citesc|sa citesc/, value: "ÏùΩÏñ¥Ïöî" },
    { re: /lucrez|a lucra/, value: "ÏùºÌï¥Ïöî" }
  ]
};

/* 3. Helper: ia primul value al regulii care se potrive»ôte */
function matchSlot(rules, text) {
  if (!rules) return null;
  for (const rule of rules) {
    if (rule.re.test(text)) return rule.value;
  }
  return null;
}

/* 4. Func»õia principalƒÉ: text RO ‚Üí sloturi Builder */
function parseRomanianToSlots(text) {
  const t = normalizeRo(text);

  const slots = {
    subject: matchSlot(RO_RULES.subject, t),
    time:    matchSlot(RO_RULES.time, t),
    place:   matchSlot(RO_RULES.place, t),
    mod:     matchSlot(RO_RULES.mod, t),
    object:  matchSlot(RO_RULES.object, t),
    numeral: matchSlot(RO_RULES.numeral, t),
    counter: matchSlot(RO_RULES.counter, t),
    verb:    matchSlot(RO_RULES.verb, t)
  };

  return slots;
}

/* 5. AplicƒÉ sloturile √Æn Propozi»õia 1 (tabelul de sus) */
function applySlotsToBuilderP1(slots) {
  const table = document.getElementById("tableP1");
  if (!table || !slots) return;

  const setCol = (key, value) => {
    if (!value) return;
    const col = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
    if (col) {
      col.textContent = value;
    }
  };

  setCol("subject", slots.subject);
  setCol("time",    slots.time);
  setCol("place",   slots.place);
  setCol("mod",     slots.mod);
  setCol("object",  slots.object);
  setCol("numeral", slots.numeral);
  setCol("counter", slots.counter);
  // verbul √Æl folosim doar la reconstruc»õia propozi»õiei, nu umplem coloanƒÉ (deocamdatƒÉ)
}

/* 6. Reconstruie»ôte propozi»õia coreeanƒÉ mare din sloturi */
function rebuildPreviewFromBuilderP1(slotsFromParser) {
  const table = document.getElementById("tableP1");
  if (!table) return;

  const pick = (key) => {
    const col = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
    return col ? col.textContent.trim() : "";
  };

  const subject = pick("subject") || "Ï†Ä";
  const time    = pick("time");
  const place   = pick("place");
  const mod     = pick("mod");
  const numeral = pick("numeral");
  const counter = pick("counter");
  const object  = pick("object");

  // dacƒÉ avem numeral+counter+object ‚Üí ‚ÄûÏ±Ö Ìïú Í∂å‚Äù etc.
  let objectChunk = "";
  if (object && numeral && counter) {
    objectChunk = object + " " + numeral + " " + counter;
  } else if (object) {
    objectChunk = object;
  }

  // verb: dacƒÉ parserul a gƒÉsit ceva, √Æl folosim, altfel Í∞ÄÏöî
  const verb =
    (slotsFromParser && slotsFromParser.verb) ||
    "Í∞ÄÏöî";

  const pieces = [subject, time, place, mod, objectChunk, verb].filter(Boolean);
  const sentence = pieces.join(" ");

  const out =
    document.getElementById("previewSentence") ||
    document.getElementById("previewKo") ||
    document.querySelector(".preview-sentence");

  if (out) {
    out.textContent = sentence;
  }
}  
   // === LimbƒÉ de intrare (Rom√¢nƒÉ / English) din switch-ul de sus ===
function getInputLang() {
  const el = document.querySelector('input[name="inputLang"]:checked');
  // fallback: dacƒÉ nu gƒÉsim nimic, presupunem Rom√¢nƒÉ
  return el ? el.value : "ro";
}
       <section class="card" id="roCard">
      <h2>Rom√¢nƒÉ / English ‚Üí CoreeanƒÉ (auto-fill)</h2>

      <div style="margin-bottom:6px;font-size:11px;color:var(--text-soft);display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <span>Limba propozi»õiei:</span>
        <select id="langSelect" style="padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:11px;">
          <option value="ro" selected>Rom√¢nƒÉ</option>
          <option value="en">English</option>
        </select>
        <label style="display:flex;align-items:center;gap:6px;margin-left:auto;font-weight:800;">
          <input type="checkbox" id="fillOnlyEmpty" checked />
          CompleteazƒÉ doar c√¢mpurile goale
        </label>
      </div>

      <textarea id="inputText" placeholder="Ex: AstƒÉzi merg la cafenea »ôi citesc o carte »ôi beau o cafea.
Today I go to the cafe and read a book and drink a coffee."></textarea>

      <div class="btn-row">
        <button id="autoFillBtn">CompleteazƒÉ automat builder-ul</button>
        <button id="clearBtn" class="secondary">CurƒÉ»õƒÉ tot</button>
      </div>

      <div class="hint">
        Reguli (default) pentru split √Æntre clauze:
        <br>‚Ä¢ <b>»ôi / and</b> ‚Üí <code class="k">-Í≥†</code>
        <br>‚Ä¢ <b>dar / but</b> ‚Üí <code class="k">-ÏßÄÎßå</code>
        <br>‚Ä¢ <b>pentru cƒÉ / because</b> ‚Üí <code class="k">-ÏïÑ/Ïñ¥ÏÑú</code> (default <code class="k">-Ïñ¥ÏÑú</code>)
        <br>‚Ä¢ <b>dacƒÉ / if</b> ‚Üí <code class="k">-(Ïúº)Î©¥</code>
        <br>‚Ä¢ <b>c√¢nd / when</b> ‚Üí <code class="k">-(Ïúº)„Ñπ Îïå</code>
        <br>‚Ä¢ <b>ca sƒÉ / in order to</b> ‚Üí <code class="k">-(Ïúº)Î†§Í≥†</code>
      </div>

      <details class="grammars" id="grammarsBox">
        <summary>BibliotecƒÉ de gramatici (RO + EN ‚Üí KO) ‚Äì din fi»ôa ta</summary>
        <div class="grammars-grid" id="grammarsGrid"></div>
      </details>
    </section>
<!-- ===== RO/EN ‚Üí KO (auto-fill) + Builder (clauze) + Preview final ===== -->

<section class="card" id="roCard">
  <h2>Rom√¢nƒÉ / English ‚Üí CoreeanƒÉ (auto-fill)</h2>

  <div style="margin-bottom:6px;font-size:11px;color:var(--text-soft);display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
    <span>Limba propozi»õiei:</span>
    <select id="langSelect" style="padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:11px;">
      <option value="ro" selected>Rom√¢nƒÉ</option>
      <option value="en">English</option>
    </select>
    <label style="display:flex;align-items:center;gap:6px;margin-left:auto;font-weight:800;">
      <input type="checkbox" id="fillOnlyEmpty" checked />
      CompleteazƒÉ doar c√¢mpurile goale
    </label>
  </div>

  <textarea id="inputText" placeholder="Ex: AstƒÉzi merg la cafenea »ôi citesc o carte »ôi beau o cafea.
Today I go to the cafe and read a book and drink a coffee."></textarea>

  <div class="btn-row">
    <button id="autoFillBtn">CompleteazƒÉ automat builder-ul</button>
    <button id="clearBtn" class="secondary">CurƒÉ»õƒÉ tot</button>
  </div>

  <div class="hint">
    Reguli (default) pentru split √Æntre clauze:
    <br>‚Ä¢ <b>»ôi / and</b> ‚Üí <code class="k">-Í≥†</code>
    <br>‚Ä¢ <b>dar / but</b> ‚Üí <code class="k">-ÏßÄÎßå</code>
    <br>‚Ä¢ <b>pentru cƒÉ / because</b> ‚Üí <code class="k">-ÏïÑ/Ïñ¥ÏÑú</code> (default <code class="k">-Ïñ¥ÏÑú</code>)
    <br>‚Ä¢ <b>dacƒÉ / if</b> ‚Üí <code class="k">-(Ïúº)Î©¥</code>
    <br>‚Ä¢ <b>c√¢nd / when</b> ‚Üí <code class="k">-(Ïúº)„Ñπ Îïå</code>
    <br>‚Ä¢ <b>ca sƒÉ / in order to</b> ‚Üí <code class="k">-(Ïúº)Î†§Í≥†</code>
  </div>

  <details class="grammars" id="grammarsBox">
    <summary>BibliotecƒÉ de gramatici (RO + EN ‚Üí KO) ‚Äì din fi»ôa ta</summary>
    <div class="grammars-grid" id="grammarsGrid"></div>
  </details>
</section>

<h3 class="section-title">Builder (clauze)</h3>
<div id="clausesHost"></div>

<section class="preview-card">
  <div class="preview-title">
    <span>Propozi»õia finalƒÉ √Æn coreeanƒÉ</span>
    <span class="right">
      <label style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="politeToggle" />
        <span>Polite»õe (doar ultima clauzƒÉ)</span>
      </label>
    </span>
  </div>
  <div id="previewSentence" class="preview-sentence"></div>
  <div id="previewInfo" class="preview-ro"></div>
</section>

<!-- ===== /RO/EN ‚Üí KO + Clauses + Preview final ===== -->
  </div>
</style>
</head>
<body class="pastel-theme">
  <div class="app">
    <header class="rk-header">
  <div class="rk-header-main">
    <h1>Raluca Korean</h1>
    <span class="rk-badge">Study App v2.0</span>
  </div>
  <p id="subtitle">Builder propozi»õii + particule + audio + conjugƒÉri</p>
</header>
    <!-- SCREEN 1: BUILDER -->
    <div class="screen active" id="screen-builder">

      <!-- Panel sus: mod afi»ôare + ce pƒÉr»õi folose»ôte -->
      <div class="mode-panel">
        <div class="mode-row">
          <span class="section-label">Mod afi»ôare</span>
          <div>
            <button class="secondary small-mode-btn" data-mode="simple">Simplu</button>
            <button class="secondary small-mode-btn active" data-mode="topik">TOPIK</button>
          </div>
        </div>

        <div class="mode-row">
          <span class="section-label">Propozi»õia 1 ‚Äì ce pƒÉr»õi folose»ôte?</span>
          <div class="part-toggles" id="togglesP1"></div>
        </div>
  <div class="mode-row">
    <span class="section-label">Propozi»õia 2 ‚Äì ce pƒÉr»õi folose»ôte?</span>
    <div class="part-toggles" id="togglesP2"></div>
  </div>
</div> <!-- √Ænchidem blocul .mode-panel (bara de sus) -->

<div class="table-block">
  
        <div class="table-title">
          <span>Propozi»õia 1</span>
          <span class="page-indicator" id="pageInfo"></span>
        </div>

        <div class="table-horizontal" id="tableP1"></div>
<!-- Bifa care activeazƒÉ / dezactiveazƒÉ Propozi»õia 2 -->
<div class="mode-row builder-enable-p2">
  <label>
    <input type="checkbox" id="enableP2" />
    ActiveazƒÉ Propozi»õia 2 (fraza)
  </label>
</div>
        <div class="table-title hidden" id="titleP2">
          <span>Propozi»õia 2 (continuare / frazƒÉ)</span>
        </div>
        <div class="table-horizontal hidden" id="tableP2"></div>

        <div class="controls">
          <div class="btn-group">
            <button id="prevBtn">‚¨Ö Prev (r√¢nd model)</button>
            <button id="nextBtn">Next ‚û°</button>
          </div>
          <button class="secondary" id="resetBtn">Reset pƒÉr»õi de propozi»õie</button>
        </div>

        <div class="legend">
          ‚û§ Tap scurt pe coloanƒÉ = treci la urmƒÉtorul cuv√¢nt.  
          ‚û§ »öine apƒÉsat pe coloanƒÉ = deschizi lista completƒÉ (cu traduceri + cƒÉutare).  
          ‚û§ ‚≠ê la CONJUGƒÇRI = gramaticƒÉ de legƒÉturƒÉ (cere propozi»õia 2).  
          ‚û§ Sistem de <b>conjugare realƒÉ</b>: verbul se une»ôte cu finalul (ex: Í∞ÄÎã§ + -Í≥† ÏûàÏñ¥Ïöî ‚Üí Í∞ÄÍ≥† ÏûàÏñ¥Ïöî).
        </div>

        <div class="preview-card">
          <div class="preview-title">
            <span>Propozi»õia / fraza (coreeanƒÉ, cu particule & verb conjugat)</span>
          </div>
          <div class="preview-ko" id="previewKo">(alege cuvinte din tabel)</div>

          <div class="preview-title">
            <span>Traducere aproximativƒÉ (rom√¢nƒÉ ‚Äì pe pƒÉr»õi)</span>
            <button id="toggleRoBtn" class="secondary" style="padding:3px 8px;font-size:10px;">
              Ascunde traducerea
            </button>
          </div>
          <div class="preview-ro" id="previewRo"></div>

          <div class="preview-natural" id="naturalHint"></div>

          <div class="preview-buttons">
            <button id="randomBtn">üé≤ Random propozi»õie</button>
            <button id="speakBtn">üîä Audio coreeanƒÉ</button>
            <button id="favBtn" class="secondary">‚≠ê SalveazƒÉ propozi»õia</button>
          </div>
        </div>
      </div><!-- /table-block -->
<h3 class="section-title">Builder (clauze)</h3>
<div id="clausesHost"></div>

<section class="preview-card">
  <div class="preview-title">
    <span>Propozi»õia finalƒÉ √Æn coreeanƒÉ</span>
    <span class="right">
      <label style="display:flex;align-items:center;gap:6px;">
        <input type="checkbox" id="politeToggle" />
        <span>Polite»õe (doar ultima clauzƒÉ)</span>
      </label>
    </span>
  </div>
  <div id="previewSentence" class="preview-sentence"></div>
  <div id="previewInfo" class="preview-ro"></div>
</section>
      <!-- Rom√¢nƒÉ ‚Üí CoreeanƒÉ mutat JOS √Æn Builder -->
      <div class="card">
        <h2>Rom√¢nƒÉ ‚Üí CoreeanƒÉ</h2>
        <textarea id="roInput" rows="3"
                  placeholder="Scrie propozi»õia √Æn rom√¢nƒÉ aici..."></textarea>
        <button id="roTranslateBtn">
          <span class="translate-icon">üá∑üá¥‚û°Ô∏èüá∞üá∑</span>
          Tradu √Æn coreeanƒÉ
        </button>
        <div class="preview-ko" id="roToKoResult"></div>
        <div class="preview-ro" id="roCorrected"></div>
      </div>
    </div>   
    
        <!-- SCREEN 2: EXERCI»öII TOPIK -->
    <div class="screen" id="screen-exercises">
      <div class="card ex-card">
        <div class="ex-header-row">
          <div>
            <div class="ex-pill">TOPIK trainer</div>
            <h2>Exerci»õii TOPIK ‚Äì propozi»õii</h2>
          </div>
          <div class="ex-mini-hint">
            AntreneazƒÉ: verbe ¬∑ particule ¬∑ conjugƒÉri
          </div>
        </div>

        <div class="ex-type-row">
          <div class="ex-type-left">
            <span class="small-label">Tip exerci»õiu</span>
            <span class="ex-type-chip" id="exerciseTypeLabel">
              propozi»õii random din builder
            </span>
          </div>
          <select id="exerciseType">
            <option value="verb">Alege VERBUL corect</option>
            <option value="particle">Alege PARTICULA corectƒÉ (simplu)</option>
            <option value="particlePlus">Particule multiple (ÏùÄ/Îäî, Ïù¥/Í∞Ä, ÏùÑ/Î•º, Ïóê/ÏóêÏÑú)</option>
            <option value="conjug">Alege CONJUGAREA corectƒÉ</option>
            <option value="puzzle">üß© Puzzle ‚Äì ordoneazƒÉ propozi»õia</option>
          </select>
        </div>

        <div class="ex-question-shell">
          <div class="ex-question-tag-row">
            <span class="ex-question-tag">√éntrebare curentƒÉ</span>
            <span class="ex-question-subtag" id="exerciseSubtag"> </span>
          </div>

          <div class="exercise-question empty" id="exerciseQuestion">
            Alege tipul de exerci»õiu »ôi apasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù.
          </div>

          <div class="exercise-options" id="exerciseOptions"></div>

          <div class="btn-group ex-buttons">
            <button id="checkAnswerBtn">VerificƒÉ rƒÉspunsul</button>
            <button class="secondary" id="nextQuestionBtn">√éntrebare nouƒÉ</button>
          </div>

          <div class="exercise-feedback" id="exerciseFeedback"></div>
        </div>
      </div>

      <div class="legend ex-legend">
        ‚û§ Po»õi schimba tipul de exerci»õiu din box-ul de sus.<br />
        ‚û§ La ‚ÄûParticule multiple‚Äù, toate spa»õiile (1)(2)(3)(4) trebuie corecte ca sƒÉ fie ‚úÖ.
      </div>
    </div>

    <!-- SCREEN 3: LEC»öII DE GRAMATICƒÇ -->
    <div class="screen" id="screen-lessons">
      <div class="card">
        <div class="lesson-header">
          <h2>üìò Lec»õia 1 ‚Äî (Ïúº)Î†§Í≥† Ìï¥Ïöî</h2>
          <div class="small-label">
            Inten»õie / plan apropiat ‚Äì ‚Äûam de g√¢nd sƒÉ‚Ä¶, mƒÉ pregƒÉtesc sƒÉ‚Ä¶‚Äù
          </div>
        </div>

        <div style="margin-top:8px;font-size:13px;line-height:1.5;">
          <b>‚óÜ Ce √ÆnseamnƒÉ:</b><br />
          ‚Äì ExprimƒÉ o ac»õiune pe care <b>ai de g√¢nd</b> sƒÉ o faci √Æn cur√¢nd.<br />
          ‚Äì √én rom√¢nƒÉ: ‚Äûam de g√¢nd sƒÉ‚Ä¶‚Äù, ‚ÄûmƒÉ pregƒÉtesc sƒÉ‚Ä¶‚Äù.
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.6;">
          <b>‚óÜ Cum se formeazƒÉ:</b><br />

          <ul style="padding-left:18px;margin:4px 0;">
            <li>Verbe care se terminƒÉ √Æn <b>consoanƒÉ</b> ‚Üí <b>ÏúºÎ†§Í≥† Ìï¥Ïöî</b><br />
              <span class="example">
                ÏùΩÎã§ ‚Üí ÏùΩÏúºÎ†§Í≥† Ìï¥Ïöî (am de g√¢nd sƒÉ citesc)<br />
                Î®πÎã§ ‚Üí Î®πÏúºÎ†§Í≥† Ìï¥Ïöî (am de g√¢nd sƒÉ mƒÉn√¢nc)
              </span>
            </li>
          </ul>

          <ul style="padding-left:18px;margin:4px 0;">
            <li>Verbe care se terminƒÉ √Æn <b>vocalƒÉ</b> ‚Üí <b>Î†§Í≥† Ìï¥Ïöî</b><br />
              <span class="example">
                Í∞ÄÎã§ ‚Üí Í∞ÄÎ†§Í≥† Ìï¥Ïöî (am de g√¢nd sƒÉ merg)<br />
                Î≥¥ÎÇ¥Îã§ ‚Üí Î≥¥ÎÇ¥Î†§Í≥† Ìï¥Ïöî (am de g√¢nd sƒÉ trimit)
              </span>
            </li>
          </ul>
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.6;">
          <b>üîπ Exemple simple:</b><br />
          <b>1)</b> Ï†ÄÎäî Ïò§Îäò Ï±ÖÏùÑ ÏùΩÏúºÎ†§Í≥† Ìï¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí Azi am de g√¢nd sƒÉ citesc o carte.<br /><br />

          <b>2)</b> ÎÇ¥Ïùº ÏπúÍµ¨Î•º ÎßåÎÇòÎ†§Í≥† Ìï¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí M√¢ine am de g√¢nd sƒÉ mƒÉ √Ænt√¢lnesc cu prietenul.<br /><br />

          <b>3)</b> ÏßëÏóêÏÑú Ïâ¨Î†§Í≥† Ìï¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí Am de g√¢nd sƒÉ mƒÉ odihnesc acasƒÉ.<br /><br />

          <b>4)</b> ÌïúÍµ≠Ïñ¥Î•º Îçî Ïó¥Ïã¨Ìûà Í≥µÎ∂ÄÌïòÎ†§Í≥† Ìï¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí Am de g√¢nd sƒÉ studiez coreeana mai serios.
        </div>

        <div style="margin-top:10px;">
          <button id="lesson1TryBtn">‚úçÔ∏è √éncearcƒÉ lec»õia √Æn Builder</button>
        </div>

        <div class="small-label" style="margin-top:6px;">
          ApasƒÉ pe buton »ôi √Æ»õi pun automat o propozi»õie √Æn Builder, ca sƒÉ vezi cum
          func»õioneazƒÉ -(Ïúº)Î†§Í≥† Ìï¥Ïöî pe structura ta.
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>üìò Lec»õia 2 ‚Äî -(Ïúº)„ÑπÍπåÏöî?</h2>
          <div class="small-label">
            Propuneri, invita»õii »ôi √ÆntrebƒÉri despre opinia altcuiva.
          </div>
        </div>

        <div style="margin-top:8px;font-size:13px;line-height:1.5;">
          <b>‚óÜ Ce √ÆnseamnƒÉ:</b><br />
          ‚Äì Se folose»ôte c√¢nd vrei sƒÉ √Æntrebi pƒÉrerea cuiva sau sƒÉ faci o propunere.<br />
          ‚Äì √én rom√¢nƒÉ: ‚ÄûsƒÉ ‚Ä¶?‚Äù, ‚Äûce-ar fi sƒÉ ‚Ä¶?‚Äù, ‚Äûoare sƒÉ ‚Ä¶?‚Äù.
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.5;">
          <b>‚óÜ Cum se formeazƒÉ:</b><br />

          <ul style="padding-left:18px;margin:4px 0;">
            <li>Verbe care se terminƒÉ √Æn <b>consoanƒÉ</b> ‚Üí <b>ÏùÑÍπåÏöî?</b><br />
              <span class="example">
                Î®πÎã§ ‚Üí Î®πÏùÑÍπåÏöî? (sƒÉ m√¢ncƒÉm?)<br />
                ÏùΩÎã§ ‚Üí ÏùΩÏùÑÍπåÏöî? (sƒÉ citim?)
              </span>
            </li>
          </ul>

          <ul style="padding-left:18px;margin:4px 0;">
            <li>Verbe care se terminƒÉ √Æn <b>vocalƒÉ</b> sau <b>„Ñπ</b> ‚Üí <b>„ÑπÍπåÏöî?</b><br />
              <span class="example">
                Í∞ÄÎã§ ‚Üí Í∞àÍπåÏöî? (sƒÉ mergem?)<br />
                ÌïòÎã§ ‚Üí Ìï†ÍπåÏöî? (sƒÉ facem?)
              </span>
            </li>
          </ul>
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.6%;">
          <b>üîπ Exemple simple:</b><br />

          <b>1)</b> ÏòÅÌôî Î≥ºÍπåÏöî?<br />
          &nbsp;&nbsp;‚Üí SƒÉ vedem un film?<br /><br />

          <b>2)</b> ÎÇ¥Ïùº ÎßåÎÇ†ÍπåÏöî?<br />
          &nbsp;&nbsp;‚Üí Ne vedem m√¢ine?<br /><br />

          <b>3)</b> Î≠ê Î®πÏùÑÍπåÏöî?<br />
          &nbsp;&nbsp;‚Üí Ce sƒÉ m√¢ncƒÉm?<br /><br />

          <b>4)</b> ÏßÄÍ∏à Ï∂úÎ∞úÌï†ÍπåÏöî?<br />
          &nbsp;&nbsp;‚Üí SƒÉ plecƒÉm acum?
        </div>

        <div style="margin-top:10px;">
          <button id="lesson2TryBtn">‚úçÔ∏è √éncearcƒÉ lec»õia 2 √Æn Builder</button>
        </div>

        <div class="small-label" style="margin-top:6px;">
          ApasƒÉ pe buton »ôi √Æ»õi pun automat o propozi»õie √Æn Builder cu -(Ïúº)„ÑπÍπåÏöî?,
          ca sƒÉ exersezi propunerile »ôi invita»õiile.
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>üìò Lec»õia 3 ‚Äî Fraze cu ‚ÄûsƒÉ ... »ôi sƒÉ ...‚Äù</h2>
          <div class="small-label">
            DouƒÉ ac»õiuni legate: ‚ÄûMerg la X sƒÉ fac Y (»ôi sƒÉ fac Z)‚Äù.
          </div>
        </div>

        <div style="margin-top:8px;font-size:13px;line-height:1.5;">
          <b>‚óÜ Ideea principalƒÉ:</b><br />
          ‚Äì Prima parte: verb de deplasare (Í∞ÄÎã§ / Ïò§Îã§) + loc.<br />
          ‚Äì A doua parte: una sau mai multe ac»õiuni de scop, legate cu <b>-Í≥†</b>,
            ultima √Æn prezent politicos.
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.6%;">
          <b>üîπ Exemplu:</b><br />
          Ïò§Îäò ÏãúÏû•Ïóê Í∞ÄÏÑú Ï±ÑÏÜåÎ•º ÏÇ¨Í≥† Í≤¨Í≥ºÎ•òÎ•º Î®πÏñ¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí Azi merg la pia»õƒÉ sƒÉ cumpƒÉr legume »ôi sƒÉ mƒÉn√¢nc nuci.
        </div>

        <div style="margin-top:10px;">
          <button id="lesson3TryBtn">‚úçÔ∏è √éncearcƒÉ lec»õia 3 √Æn Builder</button>
        </div>

        <div class="small-label" style="margin-top:6px;">
          ApasƒÉ pe buton »ôi √Æ»õi pun automat √Æn Builder propozi»õia<br />
          ‚ÄûAstƒÉzi merg la cafenea sƒÉ √ÆnvƒÉ»õ coreeanƒÉ.‚Äù ca sƒÉ vezi fraza completƒÉ √Æn coreeanƒÉ.
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>üìò Lec»õia 4 ‚Äî Rutine zilnice</h2>
          <div class="small-label">
            Folosim prezentul politicos pentru obiceiuri: ‚Äû√Æn fiecare diminea»õƒÉ fac X‚Äù.
          </div>
        </div>

        <div style="margin-top:8px;font-size:13px;line-height:1.5;">
          <b>‚óÜ Ideea principalƒÉ:</b><br />
          ‚Äì Adverb de frecven»õƒÉ (Ìï≠ÏÉÅ, ÏûêÏ£º, Îß§Ïùº, ÏïÑÏπ®ÎßàÎã§...) + ac»õiunea la prezent
            politicos (-ÏïÑÏöî/Ïñ¥Ïöî).<br />
          ‚Äì √én rom√¢nƒÉ: ‚ÄûDe obicei..., √én fiecare diminea»õƒÉ..., Mereu...‚Äù.
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.6%;">
          <b>üîπ Exemplu:</b><br />
          ÏïÑÏπ®ÎßàÎã§ Ïª§ÌîºÎ•º ÎßàÏãúÍ≥† ÌïúÍµ≠Ïñ¥Î•º Í≥µÎ∂ÄÌï¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí √én fiecare diminea»õƒÉ beau cafea »ôi studiez coreeanƒÉ.
        </div>

        <div style="margin-top:10px;">
          <button id="lesson4TryBtn">‚úçÔ∏è √éncearcƒÉ lec»õia 4 √Æn Builder</button>
        </div>

        <div class="small-label" style="margin-top:6px;">
          ApasƒÉ pe buton »ôi trimit propozi»õia<br />
          ‚Äû√én fiecare diminea»õƒÉ beau cafea »ôi studiez coreeanƒÉ.‚Äù direct √Æn Builder.
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>üìò Lec»õia 5 ‚Äî Stare & obosealƒÉ (adjective + verbe)</h2>
          <div class="small-label">
            Combina»õii de tip ‚Äûlucrez mult »ôi sunt obositƒÉ‚Äù.
          </div>
        </div>

        <div style="margin-top:8px;font-size:13px;line-height:1.5;">
          <b>‚óÜ Ideea principalƒÉ:</b><br />
          ‚Äì Verbul de ac»õiune + <b>ÎßéÏù¥</b> / <b>Ïó¥Ïã¨Ìûà</b> etc.<br />
          ‚Äì Apoi verb/adjectiv de stare: ÌîºÍ≥§ÌïòÎã§ (a fi obosit), ÌûòÎì§Îã§, Î∞îÏÅòÎã§ etc.
        </div>

        <div style="margin-top:10px;font-size:13px;line-height:1.6%;">
          <b>üîπ Exemplu:</b><br />
          ÏöîÏ¶ò ÏùºÏùÑ ÎßéÏù¥ Ìï¥ÏÑú ÏïÑÏ£º ÌîºÍ≥§Ìï¥Ïöî.<br />
          &nbsp;&nbsp;‚Üí √én ultima vreme lucrez mult »ôi sunt foarte obositƒÉ.
        </div>

        <div style="margin-top:10px;">
          <button id="lesson5TryBtn">‚úçÔ∏è √éncearcƒÉ lec»õia 5 √Æn Builder</button>
        </div>

        <div class="small-label" style="margin-top:6px;">
          ApasƒÉ pe buton »ôi trimit propozi»õia<br />
          ‚ÄûLucrez mult »ôi sunt foarte obositƒÉ.‚Äù √Æn Builder pentru conversie automatƒÉ.
        </div>
      </div>
    </div>

    <!-- SCREEN 4: GLOSAR + FAVORITE -->
    <div class="screen" id="screen-glossary">
      <div class="card">
        <h2>üìö Glosar coreean‚Äìrom√¢n</h2>

        <!-- üìÖ 3 cuvinte/zi -->
        <div class="card" style="margin-top:8px;">
          <h2>üìÖ 3 cuvinte/zi</h2>

          <div class="small-label" id="dailyDateLabel">Azi</div>

          <div id="dailyWordsBox"
               style="display:flex;flex-direction:column;gap:6px;margin-top:6px;"></div>

          <div class="btn-group" style="margin-top:8px;">
            <button class="secondary" id="dailyPrevBtn">‚¨Ö Ieri</button>
            <button class="secondary" id="dailyNextBtn">M√¢ine ‚û°</button>
            <button id="dailyMarkBtn">‚úÖ Am √ÆnvƒÉ»õat azi</button>
          </div>

          <div class="small-label" id="dailyProgress" style="margin-top:6px;"></div>
        </div>

        <div class="small-label">Propozi»õii favorite:</div>
        <div id="favoritesList" class="fav-list"></div>

        <div class="small-label" style="margin-top:6px;">
          CautƒÉ √Æn glosar (coreeanƒÉ sau rom√¢nƒÉ):
        </div>
        <div class="glossary-search">
          <input type="text" id="glossarySearch"
                 placeholder="ex: Í∞ÄÎã§ sau a merge" />
        </div>
        <div class="glossary-list" id="glossaryList"></div>
      </div>
    </div>
    
  <!-- bottom nav -->
  <nav class="bottom-nav">
    <button class="nav-btn active" data-target="builder">
      <span class="icon">üèó</span>
      <span>Builder</span>
    </button>
    <button class="nav-btn" data-target="exercises">
      <span class="icon">üìù</span>
      <span>Exerci»õii</span>
    </button>
    <button class="nav-btn" data-target="lessons">
      <span class="icon">üìó</span>
      <span>Lec»õii</span>
    </button>
    <button class="nav-btn" data-target="glossary">
      <span class="icon">üìö</span>
      <span>Glosar</span>
    </button>
  </nav>
  <!-- overlay panel -->
  <div class="overlay hidden" id="overlay">
    <div class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title" id="panelTitle"></div>
          <div class="panel-sub" id="panelSub"></div>
        </div>
        <button class="panel-close" id="closePanelBtn">‚úï</button>
      </div>

      <!-- CƒÉutare √Æn lista de cuvinte -->
      <div class="panel-input-row">
        <input type="text" id="panelSearchInput" placeholder="CautƒÉ √Æn listƒÉ (primele litere)..." />
      </div>

      <!-- Cuv√¢nt nou + traducere -->
      <div class="panel-input-row">
        <input type="text" id="newWordInput" placeholder="Cuv√¢nt nou (coreeanƒÉ sau numƒÉr)..." />
      </div>
      <div class="panel-input-row">
        <input type="text" id="newWordTransInput" placeholder="Traducere √Æn rom√¢nƒÉ (ex: unu, azi) ‚Äì op»õional" />
        <button id="addWordBtn" class="secondary">+ Add</button>
      </div>

      <div class="panel-list" id="panelList"></div>
    </div>
  </div>

  <script>
    let LAST_RO_SENTENCE = "";
/* === LISTE DE CUVINTE (de bazƒÉ) === */
const subjects = [
  "Ï†Ä","ÎÇò","ÎÑà","Ïö∞Î¶¨","ÎÑàÌù¨","ÏÇ¨Îûå","ÌïôÏÉù","ÏÑ†ÏÉùÎãò","ÏßÅÏõê","Ï†ÑÎ¨∏Í∞Ä","ÏßÄÏõêÏûê","Í¥ÄÎ¶¨Ïûê",
  "Î∂ÄÎ™®Îãò","ÏïÑÏù¥","Ïñ¥Î•∏","ÏãúÎØº","Í≥†Í∞ù","ÏùòÏÇ¨","Í∞ÑÌò∏ÏÇ¨","Ïó∞Íµ¨Ïûê","Í¥ÄÍ≥ÑÏûê","ÎåÄÌëú","ÌöåÏû•",
  "ÏÇ¨Ïö©Ïûê","Ï∞∏Í∞ÄÏûê","Ïö¥Ï†ÑÏûê","Ï£ºÎØº","ÌôòÏûê"
];
const times = [
  "Ïò§Îäò","Ïñ¥Ï†ú","ÎÇ¥Ïùº","ÏßÄÍ∏à","Î∞©Í∏à","Ï°∞Í∏à ÌõÑÏóê","Í≥ß","ÏµúÍ∑ºÏóê","ÏöîÏ¶ò","ÎßàÏπ®ÎÇ¥","Í≤∞Íµ≠",
  "Ïù¥Ï†ÑÏóê","Ïù¥ÌõÑÏóê","ÎãπÏãúÏóê","ÌïúÎèôÏïà","Í≥ÑÏÜç","Í∞ÄÎÅî","Ìï≠ÏÉÅ","ÏûêÏ£º","Ï†êÏ†ê","Ï∞®Ï∏∞","ÏùºÏ∞ç","Îä¶Í≤å"
];
const places = [
  "Ïßë","ÌïôÍµê","ÌöåÏÇ¨","ÏãùÎãπ","Ïπ¥Ìéò","ÎèÑÏÑúÍ¥Ä","Î≥ëÏõê","ÏãúÏû•","Î∞±ÌôîÏ†ê","Í≥µÌï≠","Í∏∞Ï∞®Ïó≠",
  "Î≤ÑÏä§Ï†ïÎ•òÏû•","Ïó∞Íµ¨ÏÜå","Í∏∞Í¥Ä","ÏßÄÏó≠ÏÇ¨Ìöå","ÌôòÍ≤Ω","ÎåÄÍ∏∞ÏóÖ","ÌöåÏùòÏã§","Î≤ïÏõê","Í≤ΩÏ∞∞ÏÑú",
  "Ìï¥Î≥Ä","ÏÇ∞","Í≥µÏõê","ÏùÄÌñâ"
];
const mods = [
  "Ïûò","Ïó¥Ïã¨Ìûà","Ï°∞Ïö©Ìûà","Ï≤úÏ≤úÌûà","Îπ®Î¶¨","Ï†ïÎßê","ÏïÑÏ£º","ÎÑàÎ¨¥","ÎßéÏù¥","Ï°∞Í∏à","Í∞ëÏûêÍ∏∞","ÎØ∏Î¶¨",
  "Î≤åÏç®","ÏïÑÍπå","Î∞©Í∏à","Í∏àÎ∞©","Í≥ß","Ìï≠ÏÉÅ","ÏûêÏ£º","Í∞ÄÎÅî","ÎìúÎ¨ºÍ≤å","ÏÉÅÎãπÌûà","ÍΩ§","ÎèÑÎåÄÏ≤¥","Ï†àÎåÄÎ°ú",
  "Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú","Ï∂©Î∂ÑÌûà","ÌäπÌûà","Ïò§ÌûàÎ†§","Ï†êÏ†ê","Ï∞®Ï∏∞","Í≥ÑÏÜç"
];
const objects = [
  "Ï±Ö","Ïª§Ìîº","Î¨º","ÏùåÏãù","ÏòÅÌôî","Í∞ÄÎ∞©","Ï†ÑÌôî","Ïò∑","ÏûêÎ£å","Îç∞Ïù¥ÌÑ∞","Í≥ÑÌöç","Ï°∞Í±¥","ÏÉÅÌô©","Î¨∏Ï†ú",
  "Ìï¥Í≤∞Ï±Ö","ÏöîÏïΩ","Î≥¥Í≥†ÏÑú","Î¨∏ÏÑú","Ïª¥Ìì®ÌÑ∞","ÎÖ∏Ìä∏Î∂Å","Ìé∏ÏßÄ","ÏÑ†Î¨º","ÏùòÍ≤¨","Ï†ïÎ≥¥","Í¥ÄÍ≥Ñ","Í≤∞Í≥º",
  "ÏõêÏù∏","Î∞©Î≤ï","Ï†úÌíà","ÏÑúÎπÑÏä§","Ï†ïÏ±Ö","Î¨∏Ìôî","Ï±ÑÏÜå","Í≤¨Í≥ºÎ•ò"
];
const numerals = new Array(60).fill("");
const counters = [
  "Í∞ú","Î™Ö","Í∂å","Ïû•","ÎåÄ","Î≥ë","Ïûî","ÎßàÎ¶¨","Î≤à","ÏÇ¥","ÏÜ°Ïù¥","Ï§Ñ","Ï†ê","Í±¥","Ìöå","Í∞ÄÏßÄ","Ï™Ω"
];
const verbs = [
  "Í∞ÄÎã§","Ïò§Îã§","Î®πÎã§","ÎßàÏãúÎã§","Î≥¥Îã§","ÏùΩÎã§","Ïì∞Îã§","Î∞∞Ïö∞Îã§","ÏÇ¨Îã§","Ï£ºÎã§","Î∞õÎã§","ÏùºÌïòÎã§",
  "Í≥µÎ∂ÄÌïòÎã§","ÏöîÎ¶¨ÌïòÎã§","Ï≤≠ÏÜåÌïòÎã§","Ï§ÄÎπÑÌïòÎã§","ÎèÑÏôÄÏ£ºÎã§","ÏÇ¨Ïö©ÌïòÎã§","ÌïÑÏöîÌïòÎã§","Ï¢ãÏïÑÌïòÎã§",
  "Ïã´Ïñ¥ÌïòÎã§","Í∏∞Îã§Î¶¨Îã§","Ïâ¨Îã§","ÎßåÎÇòÎã§","Í±∑Îã§","Îã¨Î¶¨Îã§","ÏïâÎã§","ÏÑúÎã§","Í≤∞Ï†ïÌïòÎã§","Ï†úÏïàÌïòÎã§",
  "Ï†ÑÎã¨ÌïòÎã§","Ïú†ÏßÄÌïòÎã§","Î∞úÏÉùÌïòÎã§","Ï¶ùÍ∞ÄÌïòÎã§","Í∞êÏÜåÌïòÎã§","Ïù∏Ï†ïÌïòÎã§","Î∂ÑÏÑùÌïòÎã§","Í¥ÄÏ∞∞ÌïòÎã§",
  "Ìï¥Í≤∞ÌïòÎã§","Ïó∞Íµ¨ÌïòÎã§","ÌòëÎ†•ÌïòÎã§","ÏöîÏ≤≠ÌïòÎã§","Ï∂©Ï°±ÌïòÎã§","ÎπÑÍµêÌïòÎã§","ÏÑ§Î™ÖÌïòÎã§","ÏòàÏÉÅÌïòÎã§"
];
const conjugations = [
  "-ÏïÑÏöî/Ïñ¥Ïöî","-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî","-Í≥† ÏûàÏñ¥Ïöî","-Í≥† Ïã∂Ïñ¥Ïöî","-(Ïúº)ÏÑ∏Ïöî","-(Ïúº)„Ñπ Í±∞ÏòàÏöî",
  "-Í≥†","-ÏßÄ ÎßàÏÑ∏Ïöî","-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî","-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî","-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî","-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî",
  "-ÎçîÎùºÍ≥†Ïöî","-ÎÑ§Ïöî","-Íµ∞Ïöî","-Í≥† ÎÇòÏÑú","-Í∏∞ Ï†ÑÏóê","-(Ïúº)Î©¥ÏÑú","-(Ïúº)Î©∞",
  "-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî","-(Ïúº)„ÑπÍ≤åÏöî","-(Ïúº)„ÑπÎûòÏöî?","-(Ïúº)„ÑπÍπåÏöî?","-Îäî Í≤å Ïñ¥ÎïåÏöî?",
  "-Îäî Ï§ëÏù¥ÏóêÏöî","-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî","-(Ïúº)Î©¥ Ïïà ÎèºÏöî","-(Ïúº)ÎÇò","-(Ïúº)ÎØÄÎ°ú","-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº",
  "-(Ïúº)„ÑπÏàòÎ°ù","-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ","-(Ïúº)„ÑπÏßÄÎùºÎèÑ","-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê","-ÎèÑÎ°ù ÌïòÎã§",
  "-Í≤å ÎêòÎã§","-ÏïÑ/Ïñ¥ÏßÄÎã§","-Í∏∞ ÎßàÎ†®Ïù¥Îã§","-Í∏∞Ïóê","-Í∏∏Îûò","-Í≥† ÎßêÎã§","-Í≥†Ïûê ÌïòÎã§","-(Ïúº)„Ñπ ÎøêÏù¥Îã§"
];

/* === TRADUCERI (coreeanƒÉ ‚Üí rom√¢nƒÉ) === */
const translations = {
  subject:{ "Ï†Ä":"eu (formal)","ÎÇò":"eu (informal)","ÎÑà":"tu","Ïö∞Î¶¨":"noi","ÎÑàÌù¨":"voi",
    "ÏÇ¨Îûå":"persoanƒÉ","ÌïôÏÉù":"student/ƒÉ","ÏÑ†ÏÉùÎãò":"profesor","ÏßÅÏõê":"angajat",
    "Î∂ÄÎ™®Îãò":"pƒÉrin»õi","ÏïÑÏù¥":"copil","Ïñ¥Î•∏":"adult","Í≥†Í∞ù":"client","ÏùòÏÇ¨":"medic",
    "Í∞ÑÌò∏ÏÇ¨":"asistentƒÉ","Ïó∞Íµ¨Ïûê":"cercetƒÉtor","ÎåÄÌëú":"reprezentant","ÌôòÏûê":"pacient"
  },
  time:{ "Ïò§Îäò":"astƒÉzi","Ïñ¥Ï†ú":"ieri","ÎÇ¥Ïùº":"m√¢ine","ÏßÄÍ∏à":"acum","Î∞©Í∏à":"tocmai acum",
    "Ï°∞Í∏à ÌõÑÏóê":"pu»õin mai t√¢rziu","Í≥ß":"√Æn cur√¢nd","ÏµúÍ∑ºÏóê":"recent","ÏöîÏ¶ò":"√Æn ultima vreme",
    "ÎßàÏπ®ÎÇ¥":"√Æn cele din urmƒÉ","Í≤∞Íµ≠":"p√¢nƒÉ la urmƒÉ","Ïù¥Ï†ÑÏóê":"√Ænainte","Ïù¥ÌõÑÏóê":"dupƒÉ",
    "ÎãπÏãúÏóê":"atunci","ÌïúÎèôÏïà":"o perioadƒÉ","Í≥ÑÏÜç":"continuƒÉ","Í∞ÄÎÅî":"din c√¢nd √Æn c√¢nd",
    "Ìï≠ÏÉÅ":"√Æntotdeauna","ÏûêÏ£º":"des","Ï†êÏ†ê":"din ce √Æn ce","Ï∞®Ï∏∞":"treptat",
    "ÏùºÏ∞ç":"devreme","Îä¶Í≤å":"t√¢rziu"
  },
  place:{ "Ïßë":"acasƒÉ","ÌïôÍµê":"»ôcoalƒÉ","ÌöåÏÇ¨":"firmƒÉ / companie","ÏãùÎãπ":"restaurant","Ïπ¥Ìéò":"cafenea",
    "ÎèÑÏÑúÍ¥Ä":"bibliotecƒÉ","Î≥ëÏõê":"spital","ÏãúÏû•":"pia»õƒÉ","Î∞±ÌôîÏ†ê":"magazin universal",
    "Í≥µÌï≠":"aeroport","Í∏∞Ï∞®Ïó≠":"garƒÉ","Î≤ÑÏä§Ï†ïÎ•òÏû•":"sta»õie de autobuz","Ïó∞Íµ¨ÏÜå":"laborator",
    "Í∏∞Í¥Ä":"institu»õie","ÏßÄÏó≠ÏÇ¨Ìöå":"comunitate","ÌôòÍ≤Ω":"mediu","ÎåÄÍ∏∞ÏóÖ":"corpora»õie mare",
    "ÌöåÏùòÏã§":"salƒÉ de »ôedin»õe","Î≤ïÏõê":"instan»õƒÉ","Í≤ΩÏ∞∞ÏÑú":"sec»õie de poli»õie",
    "Ìï¥Î≥Ä":"plajƒÉ","ÏÇ∞":"munte","Í≥µÏõê":"parc","ÏùÄÌñâ":"bancƒÉ"
  },
  mod:{ "Ïûò":"bine","Ïó¥Ïã¨Ìûà":"cu s√¢rguin»õƒÉ","Ï°∞Ïö©Ìûà":"√Æn lini»ôte","Ï≤úÏ≤úÌûà":"√Æncet",
    "Îπ®Î¶¨":"repede","Ï†ïÎßê":"cu adevƒÉrat","ÏïÑÏ£º":"foarte","ÎÑàÎ¨¥":"prea / foarte",
    "ÎßéÏù¥":"mult","Ï°∞Í∏à":"pu»õin","Í∞ëÏûêÍ∏∞":"brusc","ÎØ∏Î¶¨":"√Æn avans","Î≤åÏç®":"deja",
    "ÏïÑÍπå":"mai devreme","Î∞©Í∏à":"chiar acum","Í∏àÎ∞©":"imediat","Í≥ß":"√Æn cur√¢nd",
    "Ìï≠ÏÉÅ":"mereu","ÏûêÏ£º":"des","Í∞ÄÎÅî":"din c√¢nd √Æn c√¢nd","ÎìúÎ¨ºÍ≤å":"rar",
    "ÏÉÅÎãπÌûà":"destul de","ÍΩ§":"bini»ôor","ÎèÑÎåÄÏ≤¥":"(deloc / √Æn √ÆntrebƒÉri)",
    "Ï†àÎåÄÎ°ú":"niciodatƒÉ (interdic»õie)","Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú":"activ","Ï∂©Î∂ÑÌûà":"suficient",
    "ÌäπÌûà":"√Æn special","Ïò§ÌûàÎ†§":"mai degrabƒÉ","Ï†êÏ†ê":"din ce √Æn ce","Ï∞®Ï∏∞":"treptat",
    "Í≥ÑÏÜç":"√Æn mod continuu"
  },
    object:{ 
    "Ï±Ö":"carte","Ïª§Ìîº":"cafea","Î¨º":"apƒÉ","ÏùåÏãù":"m√¢ncare","ÏòÅÌôî":"film",
    "Í∞ÄÎ∞©":"geantƒÉ","Ï†ÑÌôî":"telefon","Ïò∑":"haine","ÏûêÎ£å":"materiale","Îç∞Ïù¥ÌÑ∞":"date",
    "Í≥ÑÌöç":"plan","Ï°∞Í±¥":"condi»õie","ÏÉÅÌô©":"situa»õie","Î¨∏Ï†ú":"problemƒÉ",
    "Ìï¥Í≤∞Ï±Ö":"solu»õie","ÏöîÏïΩ":"rezumat","Î≥¥Í≥†ÏÑú":"raport","Î¨∏ÏÑú":"document",
    "Ïª¥Ìì®ÌÑ∞":"calculator","ÎÖ∏Ìä∏Î∂Å":"laptop","Ìé∏ÏßÄ":"scrisoare","ÏÑ†Î¨º":"cadou",
    "ÏùòÍ≤¨":"opinie","Ï†ïÎ≥¥":"informa»õie","Í¥ÄÍ≥Ñ":"rela»õie","Í≤∞Í≥º":"rezultat",
    "ÏõêÏù∏":"cauzƒÉ","Î∞©Î≤ï":"metodƒÉ","Ï†úÌíà":"produs","ÏÑúÎπÑÏä§":"serviciu",
    "Ï†ïÏ±Ö":"politicƒÉ","Î¨∏Ìôî":"culturƒÉ",
    "Ï±ÑÏÜå":"legume",
    "Í≤¨Í≥ºÎ•ò":"alune / nuci"
  },
  numeral:{},
  counter:{ "Í∞ú":"bucatƒÉ","Î™Ö":"persoanƒÉ","Í∂å":"volum (carte)","Ïû•":"foaie / paginƒÉ",
    "ÎåÄ":"aparat / vehicul","Î≥ë":"sticlƒÉ","Ïûî":"canƒÉ / pahar",
    "ÎßàÎ¶¨":"animal","Î≤à":"datƒÉ","ÏÇ¥":"ani (v√¢rstƒÉ)","ÏÜ°Ïù¥":"buchet / ciorchine",
    "Ï§Ñ":"r√¢nd / »ôir","Ï†ê":"punct","Í±¥":"caz","Ìöå":"datƒÉ (ocazie)",
    "Í∞ÄÏßÄ":"fel / tip","Ï™Ω":"paginƒÉ / direc»õie"
  },
  verb:{
    "Í∞ÄÎã§":"a merge","Ïò§Îã§":"a veni","Î®πÎã§":"a m√¢nca","ÎßàÏãúÎã§":"a bea","Î≥¥Îã§":"a vedea / a se uita",
    "ÏùΩÎã§":"a citi","Ïì∞Îã§":"a scrie","Î∞∞Ïö∞Îã§":"a √ÆnvƒÉ»õa","ÏÇ¨Îã§":"a cumpƒÉra","Ï£ºÎã§":"a da",
    "Î∞õÎã§":"a primi","ÏùºÌïòÎã§":"a lucra","Í≥µÎ∂ÄÌïòÎã§":"a studia","ÏöîÎ¶¨ÌïòÎã§":"a gƒÉti",
    "Ï≤≠ÏÜåÌïòÎã§":"a face curat","Ï§ÄÎπÑÌïòÎã§":"a pregƒÉti","ÎèÑÏôÄÏ£ºÎã§":"a ajuta",
    "ÏÇ¨Ïö©ÌïòÎã§":"a folosi","ÌïÑÏöîÌïòÎã§":"a fi necesar","Ï¢ãÏïÑÌïòÎã§":"a plƒÉcea",
    "Ïã´Ïñ¥ÌïòÎã§":"a nu plƒÉcea / a ur√Æ","Í∏∞Îã§Î¶¨Îã§":"a a»ôtepta","Ïâ¨Îã§":"a se odihni",
    "ÎßåÎÇòÎã§":"a se √Ænt√¢lni","Í±∑Îã§":"a merge pe jos","Îã¨Î¶¨Îã§":"a alerga",
    "ÏïâÎã§":"a se a»ôeza","ÏÑúÎã§":"a sta √Æn picioare","Í≤∞Ï†ïÌïòÎã§":"a decide",
    "Ï†úÏïàÌïòÎã§":"a propune","Ï†ÑÎã¨ÌïòÎã§":"a transmite","Ïú†ÏßÄÌïòÎã§":"a men»õine",
    "Î∞úÏÉùÌïòÎã§":"a se produce","Ï¶ùÍ∞ÄÌïòÎã§":"a cre»ôte","Í∞êÏÜåÌïòÎã§":"a scƒÉdea",
    "Ïù∏Ï†ïÌïòÎã§":"a recunoa»ôte","Î∂ÑÏÑùÌïòÎã§":"a analiza","Í¥ÄÏ∞∞ÌïòÎã§":"a observa",
    "Ìï¥Í≤∞ÌïòÎã§":"a rezolva","Ïó∞Íµ¨ÌïòÎã§":"a cerceta","ÌòëÎ†•ÌïòÎã§":"a colabora",
    "ÏöîÏ≤≠ÌïòÎã§":"a solicita","Ï∂©Ï°±ÌïòÎã§":"a satisface","ÎπÑÍµêÌïòÎã§":"a compara",
    "ÏÑ§Î™ÖÌïòÎã§":"a explica","ÏòàÏÉÅÌïòÎã§":"a anticipa"
  },
  conjug:{
    "-ÏïÑÏöî/Ïñ¥Ïöî":"prezent politicos",
    "-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî":"trecut politicos",
    "-Í≥† ÏûàÏñ¥Ïöî":"ac»õiune √Æn desfƒÉ»ôurare",
    "-Í≥† Ïã∂Ïñ¥Ïöî":"vreau sƒÉ...",
     "-Í≥†":"»ôi", 
    "-(Ïúº)ÏÑ∏Ïöî":"imperativ / onorific",
    "-(Ïúº)„Ñπ Í±∞ÏòàÏöî":"viitor",
    "-ÏßÄ ÎßàÏÑ∏Ïöî":"nu face»õi..., vƒÉ rog",
    "-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî":"vƒÉ rog sƒÉ...",
    "-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî":"trebuie sƒÉ...",
    "-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî":"pot sƒÉ...",
    "-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî":"nu pot sƒÉ...",
    "-ÎçîÎùºÍ≥†Ïöî":"am observat cƒÉ...",
    "-ÎÑ§Ïöî":"exclamativ (observa»õie surprinsƒÉ)",
    "-Íµ∞Ïöî":"exclamativ (constatare)",
    "-Í≥† ÎÇòÏÑú":"dupƒÉ ce...",
    "-Í∏∞ Ï†ÑÏóê":"√Ænainte sƒÉ...",
    "-(Ïúº)Î©¥ÏÑú":"√Æn timp ce...",
    "-(Ïúº)Î©∞":"»ôi (√Æn timp ce)",
    "-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî":"s-ar putea sƒÉ...",
    "-(Ïúº)„ÑπÍ≤åÏöî":"voi face (pentru tine)",
    "-(Ïúº)„ÑπÎûòÏöî?":"ai chef sƒÉ...? / vreau sƒÉ...",
    "-(Ïúº)„ÑπÍπåÏöî?":"sƒÉ facem...?",
    "-Îäî Í≤å Ïñ¥ÎïåÏöî?":"ce-ar fi sƒÉ...?",
    "-Îäî Ï§ëÏù¥ÏóêÏöî":"sunt √Æn mijlocul ac»õiunii",
    "-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî":"po»õi sƒÉ..., e √Æn regulƒÉ",
    "-(Ïúº)Î©¥ Ïïà ÎèºÏöî":"nu ai voie sƒÉ...",
    "-ÎèÑÎ°ù ÌïòÎã§":"sƒÉ faci √Æn a»ôa fel √Ænc√¢t sƒÉ...",
    "-Í≤å ÎêòÎã§":"ajungi sƒÉ...",
    "-ÏïÑ/Ïñ¥ÏßÄÎã§":"a deveni...",
    "-Í∏∞Ïóê":"pentru cƒÉ..., fiindcƒÉ",
    "-Í∏∏Îûò":"pentru cƒÉ (am vƒÉzut / sim»õit eu)",
    "-Í≥† ÎßêÎã§":"√Æn cele din urmƒÉ ajunge sƒÉ...",
    "-Í≥†Ïûê ÌïòÎã§":"a inten»õiona sƒÉ...",
    "-(Ïúº)„Ñπ ÎøêÏù¥Îã§":"doar..., nimic altceva"
  }
};

/* === SALVARE CUVINTE NOI === */
const STORAGE_KEY="ralucaKoreanCustomWords_v2";
const customData={
  subject:[],time:[],place:[],mod:[],object:[],
  numeral:[],counter:[],verb:[],conjug:[]
};
function loadCustomData(){
  try{
    const raw=localStorage.getItem(STORAGE_KEY);
    if(!raw)return;
    const saved=JSON.parse(raw);
    Object.keys(customData).forEach(k=>{
      if(Array.isArray(saved[k]))customData[k]=saved[k];
    });
    Object.entries(customData).forEach(([key,arr])=>{
      arr.forEach(entry=>{
        if(!entry||!entry.word)return;
        const w=entry.word,ro=entry.ro||"";
        let ref=null;
        if(key==="subject")ref=subjects;
        else if(key==="time")ref=times;
        else if(key==="place")ref=places;
        else if(key==="mod")ref=mods;
        else if(key==="object")ref=objects;
        else if(key==="numeral")ref=numerals;
        else if(key==="counter")ref=counters;
        else if(key==="verb")ref=verbs;
        else if(key==="conjug")ref=conjugations;
        if(ref&&!ref.includes(w))ref.push(w);
        if(!translations[key])translations[key]={};
        if(ro)translations[key][w]=ro;
      });
    });
  }catch(e){}
}
    // ================= RO -> KO (parser simplu din dic»õionarul app-ului) =================


    // reverse map: rom√¢nƒÉ -> coreeanƒÉ (din translations)
function stripDiacritics(s){
  return (s||"")
    .replace(/ƒÉ/g,"a").replace(/√¢/g,"a").replace(/√Æ/g,"i")
    .replace(/»ô/g,"s").replace(/≈ü/g,"s")
    .replace(/»õ/g,"t").replace(/≈£/g,"t");
}

function normRo(s){
  return stripDiacritics(
    (s||"")
      .toLowerCase()
      .replace(/[.,!?;]/g," ")
  )
  .replace(/\s+/g," ")
  .trim();
}
function buildReverseMap(){
  const rev = {
    subject:{}, time:{}, place:{}, mod:{},
    object:{}, counter:{}, verb:{}, conjug:{}
  };

  Object.entries(translations).forEach(([cat, map])=>{
    if(!rev[cat]) return;

    Object.entries(map).forEach(([ko, ro])=>{
      if(!ro) return;

      // ex: "a cumpƒÉra" ‚Üí "a cumpara"
      const norm = normRo(ro);

      // cheia de bazƒÉ (ce aveai »ôi √Ænainte)
      if(!rev[cat][norm]) rev[cat][norm] = ko;

      // üëá √Æn plus: suport pentru forme de tip "cumpƒÉr", "sƒÉ cumpƒÉr"
      if(norm.startsWith("a ")){
        // "a cumpara" ‚Üí "cumpara"
        const base = norm.replace(/^a\s+/, ""); 
        if(base){
          // "cumpara" ‚Üí "cumpar" (tƒÉiem ultima vocalƒÉ a infinitivului)
          const stem = base.replace(/[aei]$/, ""); 
          if(stem){
            // "cumpar" ‚Üí prinde "cumpƒÉr legume"
            if(!rev[cat][stem]) rev[cat][stem] = ko;

            // "sa cumpar" ‚Üí prinde "sƒÉ cumpƒÉr legume"
            const saKey = "sa " + stem;
            if(!rev[cat][saKey]) rev[cat][saKey] = ko;
          }
        }
      }
    });
  });

  return rev;
}
let REV = buildReverseMap();

// detecteazƒÉ conjugarea din rom√¢nƒÉ (foarte practic)
function detectConjFromRo(ro){
  const t = normRo(ro);

  // 0) CONECTORI care cer propozi»õia 2 (linking)
  // --- "»ôi / »ôi apoi / iar" ‚Üí -Í≥† ---
  if (/\bsi apoi\b/.test(t) ||
      /\bsi dupa\b/.test(t) ||
      /\biar\b/.test(t) ||
      /\bsi\b/.test(t)) {
    return "-Í≥†";   // »ôi / apoi / iar
  }   
    // 0) ORICE ‚Äûsi / »ôi‚Äù ‚Üí -Í≥† (leagƒÉ douƒÉ ac»õiuni, cere propozi»õia 2)
  if (/\bsi\b/.test(t)) {
    return "-Í≥†";
  }
  if (/\bdupa ce\b/.test(t)) {
    // ‚ÄûDupƒÉ ce ajung acasƒÉ, beau cafea‚Äù
    return "-Í≥† ÎÇòÏÑú";           // dupƒÉ ce...
  }
 
  if (/\binainte sa\b/.test(t)) {
    // ‚Äû√énainte sƒÉ plec la muncƒÉ...‚Äù
    return "-Í∏∞ Ï†ÑÏóê";           // √Ænainte sƒÉ...
  }
  if (/\bin timp ce\b/.test(t)) {
    // ‚Äû√én timp ce √ÆnvƒÉ»õ, beau cafea‚Äù
    return "-(Ïúº)Î©¥ÏÑú";          // √Æn timp ce...
  }
  if (/\bpentru ca\b/.test(t) ||
      /\bdeoarece\b/.test(t) ||
      /\bfiindca\b/.test(t)) {
    // ‚ÄûPentru cƒÉ plouƒÉ, stau acasƒÉ‚Äù
    return "-Í∏∞Ïóê";             // deoarece / pentru cƒÉ...
  }
  if (/\bdesi\b/.test(t) ||
      /\bchiar daca\b/.test(t)) {
    // ‚ÄûDe»ôi e obositƒÉ, studiazƒÉ‚Äù
    return "-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ";      // de»ôi / chiar dacƒÉ...
  }
  if (/\bpe masura ce\b/.test(t) ||
      /\bcu cat\b/.test(t)) {
    // ‚ÄûPe mƒÉsurƒÉ ce √ÆnvƒÉ»õ mai mult...‚Äù
    return "-(Ïúº)„ÑπÏàòÎ°ù";        // cu c√¢t... cu at√¢t...
  }
  // 1) INTEN»öIE / OBLIGA»öIE / ABILITATE
  if(/\bvreau sa\b/.test(t))        return "-Í≥† Ïã∂Ïñ¥Ïöî";
  if(/\btrebuie sa\b/.test(t))      return "-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî";
  if(/\bnu pot sa\b/.test(t))       return "-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî";
  if(/\bpot sa\b/.test(t))          return "-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî";

  // 2) FUTUR
  if(/\b(maine|m√¢ine)\b/.test(t) ||
     /\bvoi\b/.test(t) ||
     /\bo sa\b/.test(t)){
    return "-(Ïúº)„Ñπ Í±∞ÏòàÏöî";
  }

  // 3) TRECUT
  if(/\b(ieri|deja|tocmai)\b/.test(t) ||
     /\bam\b/.test(t)){
    return "-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî";
  }

  // 4) ‚Äû»ôi‚Äù ‚Üí -Í≥†  ‚≠ê
  // normRo face ‚Äû»ôi‚Äù ‚Üí ‚Äûsi‚Äù, deci cƒÉutƒÉm \bsi\b
  if(/\bsi\b/.test(t)){
    return "-Í≥†";
  }

  // 5) NEGATIV
  if(/\bnu\b/.test(t))        return "-ÏßÄ ÎßàÏÑ∏Ïöî";

  // 6) FALLBACK: prezent politicos
  return "-ÏïÑÏöî/Ïñ¥Ïöî";
}  
   // --- √émparte propozi»õia rom√¢nƒÉ √Æn douƒÉ fraze dupƒÉ ‚Äû»ôi / iar / apoi‚Äù ---
function splitRoIntoClauses(txt){
  if (!txt) return null;

  // cƒÉutƒÉm primul ‚Äû»ôi / si / iar / apoi‚Äù (cu spa»õii √Æn jur)
  const re = /\s+(»ôi|si|iar|apoi)\s+/i;
  const m  = txt.match(re);
  if (!m) return null;

  const first  = txt.slice(0, m.index).trim();
  const second = txt.slice(m.index + m[0].length).trim();

  // dacƒÉ nu avem ambele pƒÉr»õi, nu facem split
  if (!first || !second) return null;

  return { first, second };
} 
// cautƒÉ cel mai bun match RO √Æn reverse map (match pe ‚Äúinclude‚Äù, nu doar exact)
function findKoByRo(cat, text){
  const t = normRo(text);
  const keys = Object.keys(REV[cat]||{});
  // preferƒÉm potriviri mai lungi
  keys.sort((a,b)=>b.length-a.length);
  for(const k of keys){
    if(k && t.includes(k)) return REV[cat][k];
  }
  return null;
}
    // ==== FORME ROM√ÇNE»òTI ‚Üí INFINITIV (pt. detectarea verbului) ====
const RO_FORM_TO_INF = {
  // MERGE / PLECA -> tratƒÉm ca "a merge" (=> Í∞ÄÎã§)
  "plec":"a merge","pleci":"a merge","pleacƒÉ":"a merge","pleaca":"a merge",
  "pleca":"a merge","plecam":"a merge","pleca»õi":"a merge",
  "merg":"a merge","mergi":"a merge","merge":"a merge","mergem":"a merge","merge»õi":"a merge",

  // VENI
  "vin":"a veni","vii":"a veni","vine":"a veni","venim":"a veni","veni»õi":"a veni",

  // M√ÇNCA
  "mƒÉn√¢nc":"a m√¢nca","mananc":"a m√¢nca",
  "mƒÉn√¢nci":"a m√¢nca","mananci":"a m√¢nca",
  "mƒÉn√¢ncƒÉ":"a m√¢nca","mananca":"a m√¢nca",

  // BEA
  "beau":"a bea","bei":"a bea","bea":"a bea","bem":"a bea","be»õi":"a bea",

  // CITI
  "citesc":"a citi","cite»ôti":"a citi","citesti":"a citi",
  "cite»ôte":"a citi","citeste":"a citi",
  "citim":"a citi","citi»õi":"a citi","cititi":"a citi",

  // SCRIE
  "scriu":"a scrie","scrii":"a scrie","scrie":"a scrie",
  "scriem":"a scrie","scrie»õi":"a scrie","scrieti":"a scrie"
};

// foarte simplu: gƒÉse»ôte subiect (eu/tu/noi/voi) + cuvinte pe care le »ôtie glosarul
function parseRoToState(roSentence){
  const msg = [];
  const t = normRo(roSentence);

  // SUBJECT
  let subj = "";
  if(/\beu\b/.test(t))      subj = "Ï†Ä";
  else if(/\btu\b/.test(t)) subj = "ÎÑà";
  else if(/\bnoi\b/.test(t))subj = "Ïö∞Î¶¨";
  else if(/\bvoi\b/.test(t))subj = "ÎÑàÌù¨";

  // TIME
  const time =
    findKoByRo("time", roSentence) ||
    (/\bastazi\b/.test(t) ? "Ïò§Îäò" : "") ||
    (/\bmaine\b/.test(t)  ? "ÎÇ¥Ïùº" : "") ||
    (/\bieri\b/.test(t)   ? "Ïñ¥Ï†ú" : "");

  // PLACE
  let place = findKoByRo("place", roSentence);
  if(!place && /\bbanc(ƒÉ|a)\b/i.test(roSentence)) place = "ÏùÄÌñâ";
  // pia»õƒÉ / piata ‚Üí ÏãúÏû•
  if(!place && /\bpiat[ƒÉa]\b/i.test(roSentence))  place = "ÏãúÏû•";

  // MOD / OBJECT
  const mod    = findKoByRo("mod", roSentence);
  const object = findKoByRo("object", roSentence);

  // VERB (1) din dic»õionar
  let verb = findKoByRo("verb", roSentence);

  // VERB (2) infinitiv "a ___"
  if(!verb){
    const m = t.match(/\ba\s+([a-zƒÉ√¢√Æ»ô»õ]+)/i);
    if(m){
      const inf = ("a " + m[1]).toLowerCase();
      verb = REV.verb[inf] || "";
    }
  }

  // VERB (3) forme conjugate (merg, plec, citesc...)
  if(!verb){
    for(const w of t.split(" ")){
      const inf = RO_FORM_TO_INF[w];
      if(inf && REV.verb[inf]){
        verb = REV.verb[inf];
        break;
      }
    }
  }

  // VERB (4) sinonime manuale (pleca, sosi, ajunge)
  if(!verb){
    if(/\bpleca\b/.test(t) ||
       /\bplec\b/.test(t) ||
       /\bpleci\b/.test(t) ||
       /\bplecam\b/.test(t) ||
       /\bpleca»õi\b/.test(t)) {
      verb = "Í∞ÄÎã§";           // pleca ‚Üí a merge
    } else if(/\bsosi\b/.test(t) ||
              /\bajunge\b/.test(t) ||
              /\bajuns\b/.test(t)) {
      verb = "Ïò§Îã§";           // sosi / ajunge ‚Üí a veni
    }
  }

  const conj = detectConjFromRo(roSentence);

  if(!subj) msg.push("‚Ä¢ Nu am detectat clar subiectul (eu/tu/noi/voi).");
  if(!verb) msg.push("‚Ä¢ Nu am gƒÉsit verb √Æn dic»õionar (√ÆncearcƒÉ »ôi infinitiv: ‚Äûa merge‚Äù, ‚Äûa veni‚Äù).");

  return {
    state: {
      subject: subj,
      time,
      place:  place  || "",
      mod:    mod    || "",
      object: object || "",
      numeral:"",
      counter:"",
      verb:   verb   || "",
      conjug: conj   || "-ÏïÑÏöî/Ïñ¥Ïöî"
    },
    msg
  };
}
function saveCustomData(){
  try{localStorage.setItem(STORAGE_KEY,JSON.stringify(customData));}catch(e){}
}
loadCustomData();

/* === HANGUL helperi pt conjugare === */
const H_BASE=0xAC00;
const JONG=["","„Ñ±","„Ñ≤","„Ñ≥","„Ñ¥","„Ñµ","„Ñ∂","„Ñ∑","„Ñπ","„Ñ∫","„Ñª","„Ñº","„ÑΩ","„Ñæ","„Ñø","„ÖÄ",
            "„ÖÅ","„ÖÇ","„ÖÑ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öä","„Öã","„Öå","„Öç","„Öé"];
const JUNG=["„Öè","„Öê","„Öë","„Öí","„Öì","„Öî","„Öï","„Öñ","„Öó","„Öò","„Öô","„Öö","„Öõ",
            "„Öú","„Öù","„Öû","„Öü","„Ö†","„Ö°","„Ö¢","„Ö£"];

function decomposeLastSyl(word){
  if(!word)return null;
  const ch=word.charCodeAt(word.length-1);
  const code=ch-H_BASE;
  if(code<0||code>11171)return null;
  const jong=code%28;
  const jung=((code-jong)/28)%21;
  const cho=Math.floor((code-jong)/28/21);
  return{cho,jung,jong,prefix:word.slice(0,-1)};
}
function hasBatchim(s){
  const d=decomposeLastSyl(s);
  return d?d.jong!==0:false;
}
function getVerbStem(dict){
  if(!dict)return"";
  return dict.endsWith("Îã§")?dict.slice(0,-1):dict;
}

/* verbe speciale */
const specialVerbMap={
  "Í∞ÄÎã§":{present:"Í∞ÄÏöî",past:"Í∞îÏñ¥Ïöî"},
  "Ïò§Îã§":{present:"ÏôÄÏöî",past:"ÏôîÏñ¥Ïöî"},
  "Î≥¥Îã§":{present:"Î¥êÏöî",past:"Î¥§Ïñ¥Ïöî"},
  "ÌïòÎã§":{present:"Ìï¥Ïöî",past:"ÌñàÏñ¥Ïöî"},
  "Î®πÎã§":{past:"Î®πÏóàÏñ¥Ïöî"},
  "ÏùΩÎã§":{past:"ÏùΩÏóàÏñ¥Ïöî"},
  "ÎßàÏãúÎã§":{past:"ÎßàÏÖ®Ïñ¥Ïöî"},
  "ÏÇ¥Îã§":{past:"ÏÇ¥ÏïòÏñ¥Ïöî"}
};

function presentPolite(dict){
  if(specialVerbMap[dict]?.present)return specialVerbMap[dict].present;
  if(dict==="ÌïòÎã§")return"Ìï¥Ïöî";
  const stem=getVerbStem(dict);
  const d=decomposeLastSyl(stem);
  if(!d)return stem+"Ïöî";
  const v=JUNG[d.jung];
  const aGroup=["„Öè","„Öë","„Öó","„Öõ","„Öò","„Öô","„Öö"].includes(v);
  if(stem.length===1&&aGroup)return stem+"Ïöî";
  return stem+(aGroup?"ÏïÑÏöî":"Ïñ¥Ïöî");
}
function pastPolite(dict){
  if(specialVerbMap[dict]?.past)return specialVerbMap[dict].past;
  if(dict==="ÌïòÎã§")return"ÌñàÏñ¥Ïöî";
  const stem=getVerbStem(dict);
  const d=decomposeLastSyl(stem);
  if(!d)return stem+"ÏóàÏñ¥Ïöî";
  const v=JUNG[d.jung];
  const aGroup=["„Öè","„Öë","„Öó","„Öõ","„Öò","„Öô","„Öö"].includes(v);
  if(aGroup)return stem+"ÏïòÏñ¥Ïöî";
  return stem+"ÏóàÏñ¥Ïöî";
}
function stemPlusAeo(dict){
  if(dict==="ÌïòÎã§")return"Ìï¥";
  const stem=getVerbStem(dict);
  const d=decomposeLastSyl(stem);
  if(!d)return stem;
  const v=JUNG[d.jung];
  const aGroup=["„Öè","„Öë","„Öó","„Öõ","„Öò","„Öô","„Öö"].includes(v);
  if(stem.length===1&&aGroup)return stem;
  return stem+(aGroup?"ÏïÑ":"Ïñ¥");
}

/* FUTUR -(Ïúº)„Ñπ‚Ä¶ cu compunerea corectƒÉ a lui „Ñπ */
function futureL(dict){
  const stem=getVerbStem(dict);
  const d=decomposeLastSyl(stem);
  if(!d)return stem+"·ÜØ"; // fallback rar
  if(d.jong===0){
    // fƒÉrƒÉ batchim ‚Üí punem „Ñπ ca Î∞õÏπ®: Ïûê ‚Üí Ïûò, Í∞Ä ‚Üí Í∞à
    const newCode=H_BASE + d.cho*21*28 + d.jung*28 + 8; // index 8 = „Ñπ
    const ch=String.fromCharCode(newCode);
    return d.prefix+ch;
  }else{
    // cu batchim ‚Üí adƒÉugƒÉm "ÏùÑ" separat: Î®πÎã§ ‚Üí Î®πÏùÑ
    return stem+"ÏùÑ";
  }
}

/* conjugƒÉri care leagƒÉ P2 */
const linkingConjugations=new Set([
  "-Í≥†","-Í≥† ÎÇòÏÑú","-Í∏∞ Ï†ÑÏóê","-(Ïúº)Î©¥ÏÑú","-(Ïúº)Î©∞",
  "-(Ïúº)ÎÇò","-(Ïúº)ÎØÄÎ°ú","-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº",
  "-(Ïúº)„ÑπÏàòÎ°ù","-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ","-(Ïúº)„ÑπÏßÄÎùºÎèÑ",
  "-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê","-ÎèÑÎ°ù ÌïòÎã§","-Í∏∞Ïóê","-Í∏∏Îûò","-Í≥† ÎßêÎã§","-Í≥†Ïûê ÌïòÎã§"
]);
const isLinkingConj=v=>linkingConjugations.has(v);

/* ce conjugƒÉri ‚Äûtrag‚Äù spre trecut / viitor */
const timePastWords=new Set(["Ïñ¥Ï†ú","Ïù¥Ï†ÑÏóê","ÎãπÏãúÏóê","ÌïúÎèôÏïà","ÏµúÍ∑ºÏóê","ÎßàÏπ®ÎÇ¥","Í≤∞Íµ≠","Î∞©Í∏à"]);
const timeFutureWords=new Set(["ÎÇ¥Ïùº","Ï°∞Í∏à ÌõÑÏóê","Í≥ß","Ïù¥ÌõÑÏóê"]);
const conjPastLike=new Set(["-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî","-ÎçîÎùºÍ≥†Ïöî"]);
const conjFutureLike=new Set(["-(Ïúº)„Ñπ Í±∞ÏòàÏöî","-(Ïúº)„ÑπÍ≤åÏöî","-(Ïúº)„ÑπÎûòÏöî?","-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî"]);
function conjugationType(cj){
  if(!cj)return"none";
  if(conjPastLike.has(cj))return"past";
  if(conjFutureLike.has(cj))return"future";
  return"present";
}

/* === VERB + CONJUGARE ‚Üí expresie finalƒÉ coreeanƒÉ === */
function buildVerbPhrase(dictVerb,cj){
  if(!dictVerb&&!cj)return"";
  if(!dictVerb)return cj||"";
  if(!cj)return dictVerb;

  if(cj==="-ÏïÑÏöî/Ïñ¥Ïöî")return presentPolite(dictVerb);
  if(cj==="-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî")return pastPolite(dictVerb);
  if(cj==="-(Ïúº)ÏÑ∏Ïöî")return futureL(dictVerb)+"ÏÑ∏Ïöî";
  if(cj==="-(Ïúº)„Ñπ Í±∞ÏòàÏöî")return futureL(dictVerb)+" Í±∞ÏòàÏöî";
  if(cj==="-(Ïúº)„ÑπÍ≤åÏöî")return futureL(dictVerb)+"Í≤åÏöî";
  if(cj==="-(Ïúº)„ÑπÎûòÏöî?")return futureL(dictVerb)+"ÎûòÏöî?";
  if(cj==="-(Ïúº)„ÑπÍπåÏöî?")return futureL(dictVerb)+"ÍπåÏöî?";
  if(cj==="-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî")return futureL(dictVerb)+" Ïàò ÏûàÏñ¥Ïöî";
  if(cj==="-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî")return futureL(dictVerb)+" Ïàò ÏóÜÏñ¥Ïöî";
  if(cj==="-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî")return futureL(dictVerb)+"ÏßÄÎèÑ Î™∞ÎùºÏöî";

  if(cj==="-Í≥† ÏûàÏñ¥Ïöî")return getVerbStem(dictVerb)+"Í≥† ÏûàÏñ¥Ïöî";
  if(cj==="-Í≥† Ïã∂Ïñ¥Ïöî")return getVerbStem(dictVerb)+"Í≥† Ïã∂Ïñ¥Ïöî";
  if(cj==="-ÏßÄ ÎßàÏÑ∏Ïöî")return getVerbStem(dictVerb)+"ÏßÄ ÎßàÏÑ∏Ïöî";
  if(cj==="-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî")return stemPlusAeo(dictVerb)+" Ï£ºÏÑ∏Ïöî";
  if(cj==="-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî")return stemPlusAeo(dictVerb)+"Ïïº ÎèºÏöî";
  if(cj==="-Îäî Ï§ëÏù¥ÏóêÏöî")return getVerbStem(dictVerb)+"Îäî Ï§ëÏù¥ÏóêÏöî";
  if(cj==="-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî")return stemPlusAeo(dictVerb)+"ÎèÑ ÎèºÏöî";

  if(cj==="-Í≤å ÎêòÎã§")return getVerbStem(dictVerb)+"Í≤å ÎèºÏöî";
  if(cj==="-ÏïÑ/Ïñ¥ÏßÄÎã§")return stemPlusAeo(dictVerb)+"ÏßÄÎã§";

  if(isLinkingConj(cj)){
    if(cj==="-Í≥† ÎÇòÏÑú")return getVerbStem(dictVerb)+"Í≥† ÎÇòÏÑú";
    if(cj==="-Í∏∞ Ï†ÑÏóê")return getVerbStem(dictVerb)+"Í∏∞ Ï†ÑÏóê";
    if(cj.includes("Î©¥ÏÑú"))return getVerbStem(dictVerb)+"Î©¥ÏÑú";
    if(cj.includes("Î©∞"))return getVerbStem(dictVerb)+"Î©∞";
    if(cj==="-ÎèÑÎ°ù ÌïòÎã§")return getVerbStem(dictVerb)+"ÎèÑÎ°ù Ìï¥Ïöî";
    if(cj==="-Í≥† ÎßêÎã§")return getVerbStem(dictVerb)+"Í≥† ÎßêÏïòÏñ¥Ïöî";
    if(cj==="-Í≥†Ïûê ÌïòÎã§")return getVerbStem(dictVerb)+"Í≥†Ïûê Ìï¥Ïöî";
    if(cj==="-Í∏∞Ïóê")return getVerbStem(dictVerb)+"Í∏∞Ïóê";
    if(cj==="-Í∏∏Îûò")return getVerbStem(dictVerb)+"Í∏∏Îûò";
    return getVerbStem(dictVerb)+cj.replace(/^-/, "");
  }

  // fallback ‚Äì verb + final, fƒÉrƒÉ spa»õiu »ôi fƒÉrƒÉ ‚Äû-‚Äù
return getVerbStem(dictVerb)+cj.replace(/^-/, "");
}

/* === RESTUL APP-ULUI (builder, preview etc.) === */

const glossaryEntries=[];
const columns=[
  {key:"subject",title:"SUBJECT",ko:"Ï£ºÏñ¥",data:subjects,hint:"Cine?",allowCustom:true},
  {key:"time",title:"TIME",ko:"ÏãúÍ∞Ñ",data:times,hint:"C√¢nd?",allowCustom:true},
  {key:"place",title:"PLACE",ko:"Ïû•ÏÜå",data:places,hint:"Unde?",allowCustom:true},
  {key:"mod",title:"MOD",ko:"Î∞©Î≤ï",data:mods,hint:"Cum?",allowCustom:true},
  {key:"object",title:"OBJECT",ko:"Î™©Ï†ÅÏñ¥",data:objects,hint:"Ce?",allowCustom:true},
  {key:"numeral",title:"NUMERAL",ko:"",data:numerals,hint:"NumƒÉr",allowCustom:true},
  {key:"counter",title:"COUNTER",ko:"ÏàòÎüâÏÇ¨",data:counters,hint:"Clasificator",allowCustom:true},
  {key:"verb",title:"VERB",ko:"ÎèôÏÇ¨",data:verbs,hint:"Ac»õiune",allowCustom:true},
  {key:"conjug",title:"CONJUGƒÇRI",ko:"",data:conjugations,hint:"FormƒÉ verbalƒÉ",allowCustom:true}
];
const maxLen=Math.max(...columns.map(c=>c.data.length));

let index=0;
const stateP1={},stateP2={},activeP1={},activeP2={};
columns.forEach(col=>{
  stateP1[col.key]=col.data[0]||"";
  stateP2[col.key]=col.data[0]||"";
  activeP1[col.key]=true;
  activeP2[col.key]=true;
});

/* referin»õe DOM (presupunem cƒÉ restul HTML e ca √Æn versiunea ta actualƒÉ) */
const tableP1=document.getElementById("tableP1");
const tableP2=document.getElementById("tableP2");
const titleP2=document.getElementById("titleP2");
const togglesP1=document.getElementById("togglesP1");
const togglesP2=document.getElementById("togglesP2");
const enableP2=document.getElementById("enableP2");
const prevBtn=document.getElementById("prevBtn");
const nextBtn=document.getElementById("nextBtn");
const resetBtn=document.getElementById("resetBtn");
const pageInfoEl=document.getElementById("pageInfo");
const previewKo=document.getElementById("previewKo");
const previewRo=document.getElementById("previewRo");
const naturalHint=document.getElementById("naturalHint");
const toggleRoBtn=document.getElementById("toggleRoBtn");
const randomBtn=document.getElementById("randomBtn");
const speakBtn=document.getElementById("speakBtn");
const favBtn=document.getElementById("favBtn");
const overlay=document.getElementById("overlay");
const panelTitle=document.getElementById("panelTitle");
const panelSub=document.getElementById("panelSub");
const panelList=document.getElementById("panelList");
const closePanelBtn=document.getElementById("closePanelBtn");
const panelSearchInput=document.getElementById("panelSearchInput");
const newWordInput=document.getElementById("newWordInput");
const newWordTransInput=document.getElementById("newWordTransInput");
const addWordBtn=document.getElementById("addWordBtn");
const modeButtons=document.querySelectorAll(".small-mode-btn");
const subtitleEl=document.getElementById("subtitle");
const screens={
  builder:document.getElementById("screen-builder"),
  exercises:document.getElementById("screen-exercises"),
  glossary:document.getElementById("screen-glossary"),
  lessons:document.getElementById("screen-lessons")
};
    const navButtons=document.querySelectorAll(".nav-btn");
    /* navigare ecrane ‚Äì varianta corectƒÉ */
function setScreen(name){
  // ascund toate ecranele
  Object.entries(screens).forEach(([key, el])=>{
    if(!el) return;
    el.classList.toggle("active", key === name);
  });

  // marcheazƒÉ butonul activ √Æn bara de jos
  navButtons.forEach(btn=>{
    btn.classList.toggle("active", btn.dataset.target === name);
  });
}

// click pe butoanele din nav
navButtons.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const target = btn.dataset.target;   // builder / exercises / lessons / glossary
    setScreen(target);
  });
});
    // ====== STEPPER pentru Builder (click pe pa»ôi) ======
const builderSteps = document.querySelectorAll(".builder-step");

// zonele la care facem scroll pentru fiecare pas
const builderStepTargets = [
  document.getElementById("roInput"),        // Pas 1: textarea Rom√¢nƒÉ
  document.getElementById("togglesP1"),      // Pas 2: chip-urile SUBJECT/TIME...
  document.querySelector(".preview-card")    // Pas 3: propozi»õia de jos
];

function activateBuilderStep(index){
  builderSteps.forEach((step,i)=>{
    step.classList.toggle("active", i===index);
  });

  const target = builderStepTargets[index];
  if(target){
    target.scrollIntoView({behavior:"smooth", block:"center"});
    if(index === 0 && roInput){
      roInput.focus();
    }
  }
}

builderSteps.forEach((step,i)=>{
  step.addEventListener("click", ()=>{
    activateBuilderStep(i);
  });
});
/* mod simplu / TOPIK */
let currentMode="topik";
const simpleColumnsSet={subject:true,time:true,object:true,verb:true,conjug:true};
function isColumnVisible(key){
  return currentMode==="topik"||!!simpleColumnsSet[key];
}
modeButtons.forEach(btn=>{
  btn.addEventListener("click",()=>{
    currentMode=btn.dataset.mode;
    modeButtons.forEach(b=>b.classList.toggle("active",b===btn));
    render();
  });
});
   // √émparte o frazƒÉ rom√¢neascƒÉ √Æn maxim 2 propozi»õii, la "»ôi / iar / dupƒÉ ce..."
function splitRoIntoTwoClauses(text) {
  if (!text) return { p1: "", p2: "" };

  // rupem la primul "»ôi / ≈üi / si / iar / dupa ce / dupƒÉ ce"
  const parts = text.split(/≈üi apoi|»ôi apoi|si apoi|≈üi dupa|»ôi dupa|si dupa|≈üi|»ôi|si|iar|dupƒÉ ce|dupa ce/i);

  const p1 = (parts[0] || "").trim();
  const p2 = (parts[1] || "").trim();

  return { p1, p2 };
}
    
 const roTranslateBtn = document.getElementById("roTranslateBtn");
if (roTranslateBtn) {
  roTranslateBtn.addEventListener("click", () => {
    translateBtn.addEventListener("click", translateInputToKo);    const txt = roInput.value || "";
    LAST_RO_SENTENCE = txt;

    // 0) √Æncerc sƒÉ vƒÉd dacƒÉ am douƒÉ fraze legate cu ‚Äû»ôi / iar / apoi‚Äù
    const split = splitRoIntoClauses(txt);

    if (split) {
      // üîπ CAZ: douƒÉ propozi»õii legate cu ‚Äû»ôi / iar / apoi‚Äù

      // P1: prima parte + -Í≥†
      const parsed1 = parseRoToState(split.first);
      Object.assign(stateP1, parsed1.state);
      stateP1.conjug   = "-Í≥†";     // for»õƒÉm -Í≥† la P1
      activeP1.conjug  = true;      // ne asigurƒÉm cƒÉ este ON

      // P2: a doua parte, detectatƒÉ normal
      const parsed2 = parseRoToState(split.second);
      Object.assign(stateP2, parsed2.state);

      // activƒÉm vizual Propozi»õia 2
      if (enableP2) {
        enableP2.checked = true;
      }
      if (tableP2) {
        tableP2.classList.remove("hidden");
      }

      render();

    } else {
      // üîπ CAZ: o singurƒÉ propozi»õie (fƒÉrƒÉ ‚Äû»ôi / iar / apoi‚Äù √Æntre ac»õiuni)

      const parsed = parseRoToState(txt);
      Object.assign(stateP1, parsed.state);

      // dezactivƒÉm Propozi»õia 2 √Æn UI
      if (enableP2) {
        enableP2.checked = false;
      }
      if (tableP2) {
        tableP2.classList.add("hidden");
      }

      render();
    }

    // 3) Ro ‚Üí Ko + rom√¢na corectatƒÉ (rƒÉm√¢ne ca √Ænainte)
    const res = translateRoToKo(txt);
    document.getElementById("roToKoResult").textContent = res.ko;
    document.getElementById("roCorrected").textContent = res.roFixed;
  });
}
    function createToggleChips(){
  columns.forEach(col=>{
    // --- Propozi»õia 1 ---
    const chip1 = document.createElement("label");
    chip1.className = "chip";
    const cb1 = document.createElement("input");
    cb1.type = "checkbox";
    cb1.checked = true;
    cb1.dataset.key = col.key;
    cb1.dataset.clause = "p1";
    chip1.appendChild(cb1);
    chip1.append(col.title);
    togglesP1.appendChild(chip1);

    // --- Propozi»õia 2 ---
    const chip2 = document.createElement("label");
    chip2.className = "chip";
    const cb2 = document.createElement("input");
    cb2.type = "checkbox";
    cb2.checked = true;
    cb2.dataset.key = col.key;
    cb2.dataset.clause = "p2";
    chip2.appendChild(cb2);
    chip2.append(col.title);
    togglesP2.appendChild(chip2);
  });

  const sync = (wrapper, map) => {
    // stare ini»õialƒÉ (toate ON, deci fƒÉrƒÉ .chip-off)
    wrapper.querySelectorAll("input[type='checkbox']").forEach(cb=>{
      cb.parentElement.classList.toggle("chip-off", !cb.checked);
    });

    wrapper.addEventListener("change", e => {
      const cb = e.target;
      if (cb.tagName !== "INPUT") return;

      const key = cb.dataset.key;
      map[key] = cb.checked;

      // vizual: chip-ul devine ‚Äûstins‚Äù c√¢nd este debifat
      cb.parentElement.classList.toggle("chip-off", !cb.checked);

      render();
    });
  };

  sync(togglesP1, activeP1);
  sync(togglesP2, activeP2);
}
createToggleChips();
enableP2.addEventListener("change", ()=>{
  const on = enableP2.checked;

  // titlul rƒÉm√¢ne mereu vizibil, ascundem doar tabelul P2
  if (on) {
    tableP2.classList.remove("hidden");
  } else {
    tableP2.classList.add("hidden");
  }

  // sincronizƒÉm »ôi bifa vizibilƒÉ de l√¢ngƒÉ titlu (dacƒÉ existƒÉ)
  if (titleP2Checkbox) {
    titleP2Checkbox.checked = on;
  }

  updatePreview();
});
    /* helper particule */
const pronouns=new Set(["Ï†Ä","ÎÇò","ÎÑà","Ïö∞Î¶¨","ÎÑàÌù¨"]);
function addSubjectWithParticle(word){
  if(!word)return"";
  const b=hasBatchim(word);
  if(pronouns.has(word))return word+(b?"ÏùÄ":"Îäî");
  return word+(b?"Ïù¥":"Í∞Ä");
}
const timeAdverbsNoParticle=new Set(["Ïò§Îäò","Ïñ¥Ï†ú","ÎÇ¥Ïùº","ÏßÄÍ∏à","Î∞©Í∏à","ÏöîÏ¶ò","Ìï≠ÏÉÅ","ÏûêÏ£º","Í∞ÄÎÅî","Í≥ÑÏÜç","Ï†êÏ†ê","Ï∞®Ï∏∞"]);
function addTimeWithParticle(word){
  if(!word)return"";
  if(timeAdverbsNoParticle.has(word))return word;
  return word+"Ïóê";
}
function addPlaceWithParticle(word, verbKo){
  if(!word) return "";

  // verbe de mi»ôcare ‚Äì merg la / vin la ‚Üí Ïóê
  const motionVerbs = new Set(["Í∞ÄÎã§","Ïò§Îã§","ÎÇòÍ∞ÄÎã§","Îì§Ïñ¥Í∞ÄÎã§","ÎèåÏïÑÍ∞ÄÎã§","ÎèåÏïÑÏò§Îã§"]);

  if(verbKo && motionVerbs.has(verbKo)) {
    return word + "Ïóê";
  }
  // altfel, locul ac»õiunii ‚Üí ÏóêÏÑú
  return word + "ÏóêÏÑú";
}
function addObjectWithParticle(word){
  if(!word)return"";
  return word+(hasBatchim(word)?"ÏùÑ":"Î•º");
}
// ================= PARTICLE PICKERS (pentru exerci»õii particlePlus) =================

function pickSubjectParticle(word){
  if(!word) return "ÏùÄ/Îäî";
  const b = hasBatchim(word);
  // pronume: Ï†Ä/ÎÇò/ÎÑà/Ïö∞Î¶¨/ÎÑàÌù¨ -> ÏùÄ/Îäî
  if(pronouns.has(word)) return b ? "ÏùÄ" : "Îäî";
  // rest -> Ïù¥/Í∞Ä
  return b ? "Ïù¥" : "Í∞Ä";
}

function pickObjectParticle(word){
  if(!word) return "ÏùÑ/Î•º";
  return hasBatchim(word) ? "ÏùÑ" : "Î•º";
}

// TIME: majoritatea adverbelor nu cer particulƒÉ
function pickTimeParticle(word){
  if(!word) return "";
  if(timeAdverbsNoParticle.has(word)) return "";
  return "Ïóê";
}

// PLACE: pentru exerci»õii ‚Äì locul ac»õiunii
function pickPlaceParticle(word){
  if(!word) return "ÏóêÏÑú";
  return "ÏóêÏÑú";
}
/* desenare coloane ‚Äì cu bifƒÉ ON/OFF √Æn fiecare cƒÉsu»õƒÉ */
function renderClauseRow(container, activeMap, state, clauseId){
  container.innerHTML = "";

  columns.forEach(col=>{
    if (!isColumnVisible(col.key)) return;

    const colDiv = document.createElement("div");
    colDiv.className = "col";
    colDiv.dataset.key = col.key;
    colDiv.dataset.clause = clauseId;

    // dacƒÉ partea este dezactivatƒÉ √Æn activeMap ‚Üí coloana apare "stinsƒÉ"
    if (activeMap[col.key] === false) {
      colDiv.classList.add("dimmed");
    }

    // ==== HEADER: titlu + bifƒÉ micƒÉ ====
    const header = document.createElement("div");
    header.className = "col-header";

    const titleSpan = document.createElement("span");
    titleSpan.textContent = col.title + (col.ko ? ` (${col.ko})` : "");
    header.appendChild(titleSpan);

    // bifa care controleazƒÉ activeMap[col.key]
    const toggle = document.createElement("input");
    toggle.type = "checkbox";
    toggle.className = "col-toggle";
    toggle.checked = activeMap[col.key] !== false;  // default ON

    toggle.addEventListener("change", () => {
      // actualizƒÉm starea logicƒÉ (folositƒÉ la construirea propozi»õiei)
      activeMap[col.key] = toggle.checked;
      render();   // redeseneazƒÉ tabel + propozi»õie
    });

    header.appendChild(toggle);
    colDiv.appendChild(header);

    // ==== LABEL (hint: Cine? C√¢nd? Unde? etc.) ====
    const label = document.createElement("div");
    label.className = "col-body-label";
    label.textContent = col.hint || "";
    colDiv.appendChild(label);

    // ==== CUV√ÇNTUL ALES ====
    const main = document.createElement("div");
    main.className = "col-body-main";
    main.textContent = state[col.key] || "";
    colDiv.appendChild(main);

    // ==== EXTRA (‚≠ê cere propozi»õia 2 la conjugƒÉri de legƒÉturƒÉ) ====
    const extra = document.createElement("div");
    extra.className = "col-body-extra";
    if (col.key === "conjug" && state[col.key] && isLinkingConj(state[col.key])) {
      extra.textContent = "‚≠ê cere propozi»õia 2";
    }
    colDiv.appendChild(extra);

    container.appendChild(colDiv);
  });
}
    /* === CONSTRUIRE propozi»õie + traducere pe pƒÉr»õi === */
const labelsRo = {
  subject: "SUBJECT",
  time: "TIME",
  place: "PLACE",
  mod: "MOD",
  object: "OBJECT",
  numeral: "NUMƒÇR",
  counter: "COUNTER",
  verb: "VERB"
};

function buildClauseSentence(state, activeMap, conjOverride) {
  const koParts = [];
  const roSegs  = [];
  const use = (key) => activeMap[key] !== false && isColumnVisible(key);

  // SUBJECT
  const subj = state.subject;
  if (subj && use("subject")) {
    koParts.push(addSubjectWithParticle(subj));
    const ro = (translations.subject && translations.subject[subj]) || subj;
    roSegs.push(`${labelsRo.subject}: ${ro}`);
  }

  // TIME
  const t = state.time;
  if (t && use("time")) {
    koParts.push(addTimeWithParticle(t));
    const ro = (translations.time && translations.time[t]) || t;
    roSegs.push(`${labelsRo.time}: ${ro}`);
  }

  // avem nevoie de verb & conjugare pentru loc
  const v      = state.verb;
  const cjUsed = conjOverride || state.conjug;

  // PLACE
  const p = state.place;
  if (p && use("place")) {
    koParts.push(addPlaceWithParticle(p, v));
    const ro = (translations.place && translations.place[p]) || p;
    roSegs.push(`${labelsRo.place}: ${ro}`);
  }

  // MOD
  const m = state.mod;
  if (m && use("mod")) {
    koParts.push(m);
    const ro = (translations.mod && translations.mod[m]) || m;
    roSegs.push(`${labelsRo.mod}: ${ro}`);
  }

  // OBJECT
  const obj = state.object;
  if (obj && use("object")) {
    koParts.push(addObjectWithParticle(obj));
    const ro = (translations.object && translations.object[obj]) || obj;
    roSegs.push(`${labelsRo.object}: ${ro}`);
  }

  // NUMERAL
  const num = state.numeral;
  if (num && use("numeral")) {
    koParts.push(num);
    const ro = (translations.numeral && translations.numeral[num]) || num;
    roSegs.push(`${labelsRo.numeral}: ${ro}`);
  }

  // COUNTER
  const cnt = state.counter;
  if (cnt && use("counter")) {
    koParts.push(cnt);
    const ro = (translations.counter && translations.counter[cnt]) || cnt;
    roSegs.push(`${labelsRo.counter}: ${ro}`);
  }

  // VERB + CONJUGARE
 // VERB + CONJUGARE
if (v || cjUsed) {
  const vp = buildVerbPhrase(v, cjUsed);
  if (vp) {
    koParts.push(vp);

    const roVerb = (translations.verb && translations.verb[v]) || v || "";
    const cjExp  = (translations.conjug && translations.conjug[cjUsed]) || "";
    let combined = roVerb || "";

    // ‚úÖ dacƒÉ avem explica»õie pentru termina»õie
    if (cjExp) {
      if (cjUsed === "-Í≥†") {
        // doar ‚Äû»ôi‚Äù ‚Äì fƒÉrƒÉ paranteze
        combined += ` ${cjExp}`;
      } else {
        // celelalte rƒÉm√¢n cu explica»õia √Æn paranteze
        combined += ` ${cjExp} `;
      }
    }
    roSegs.push(`${labelsRo.verb}: ${combined}`);
  }
}
  return {
    ko:     koParts.join(" "),
    roText: roSegs.join(" / "),
    time:   t,
    conj:   cjUsed
  };
}

/* ==== CONJUGARE ROM√ÇNEASCƒÇ (simplƒÉ) ====
   (folositƒÉ doar ca sƒÉ facƒÉ propozi»õia rom√¢neascƒÉ sƒÉ sune natural) */
const RO_FORMS = {
  "a merge":   { "1sg":"merg","2sg":"mergi","3sg":"merge","1pl":"mergem","2pl":"merge»õi","3pl":"merg" },
  "a veni":    { "1sg":"vin","2sg":"vii","3sg":"vine","1pl":"venim","2pl":"veni»õi","3pl":"vin" },
  "a m√¢nca":   { "1sg":"mƒÉn√¢nc","2sg":"mƒÉn√¢nci","3sg":"mƒÉn√¢ncƒÉ","1pl":"m√¢ncƒÉm","2pl":"m√¢nca»õi","3pl":"mƒÉn√¢ncƒÉ" },
  "a bea":     { "1sg":"beau","2sg":"bei","3sg":"bea","1pl":"bem","2pl":"be»õi","3pl":"beau" },
  "a citi":    { "1sg":"citesc","2sg":"cite»ôti","3sg":"cite»ôte","1pl":"citim","2pl":"citi»õi","3pl":"citesc" },
  "a scrie":   { "1sg":"scriu","2sg":"scrii","3sg":"scrie","1pl":"scriem","2pl":"scrie»õi","3pl":"scriu" },
  "a merge pe jos": {
    "1sg":"merg pe jos","2sg":"mergi pe jos","3sg":"merge pe jos",
    "1pl":"mergem pe jos","2pl":"merge»õi pe jos","3pl":"merg pe jos"
  }
};

function stripInfinitive(roVerb){
  return (roVerb || "").replace(/^\s*a\s+/i, "").trim();
}

function roConjExactTemplate(cj){
  const map = {
    "-ÏïÑÏöî/Ïñ¥Ïöî":         v => `${v}`,
    "-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî":     v => `${v} (√Æn trecut)`,
    "-Í≥† ÏûàÏñ¥Ïöî":         v => `${v} acum`,
    "-Í≥† Ïã∂Ïñ¥Ïöî":         v => `vreau sƒÉ ${v}`,
    "-(Ïúº)„Ñπ Í±∞ÏòàÏöî":      v => `voi ${v}`,
    "-ÏßÄ ÎßàÏÑ∏Ïöî":         v => `nu ${v}, te rog`,
    "-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî":       v => `trebuie sƒÉ ${v}`,
    "-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî":   v => `pot sƒÉ ${v}`,
    "-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî":   v => `nu pot sƒÉ ${v}`,
    "-Í∏∞ Ï†ÑÏóê":           v => `√Ænainte sƒÉ ${v}`,
    "-Í≥† ÎÇòÏÑú":           v => `dupƒÉ ce ${v}`,
    "-(Ïúº)Î©¥ÏÑú":           v => `√Æn timp ce ${v}`,
    "-(Ïúº)„ÑπÍπåÏöî?":        v => `sƒÉ ${v}?`
  };
  return map[cj] || null;
}

function roPersonFromSubjectKo(subjKo){
  if(subjKo==="Ï†Ä"||subjKo==="ÎÇò") return "1sg";
  if(subjKo==="ÎÑà")               return "2sg";
  if(subjKo==="Ïö∞Î¶¨")             return "1pl";
  if(subjKo==="ÎÑàÌù¨")             return "2pl";
  return "3sg";
}

function roAgreeVerb(roVerbInf, subjKo){
  const inf = (roVerbInf || "").trim().toLowerCase();
  const person = roPersonFromSubjectKo(subjKo);
  const forms = RO_FORMS[inf];
  if(forms && forms[person]) return forms[person];
  return stripInfinitive(roVerbInf);
}

function buildRoVerbPhrase(roVerbInf, cj, subjKo){
  const v = roAgreeVerb(roVerbInf, subjKo);
  if(!v && !cj) return "";
  if(!cj) return v;

  const fn = roConjExactTemplate(cj);
  if(fn) return fn(v || "(verbul)");

  const cjExp = (translations.conjug && translations.conjug[cj]) || cj;
  return (v ? v + " " : "") + `(${cjExp})`;
}

/* Propozi»õie rom√¢neascƒÉ naturalƒÉ ‚Äì Time ‚Üí Subject ‚Üí Place ‚Üí Mod ‚Üí Object ‚Üí Verb */
function buildNaturalRomanian(state, activeMap){
  const use = (key) =>
    activeMap[key] !== false && isColumnVisible(key) && state[key];

  const getRo = (catKey, stateKey) => {
    const dict = translations[catKey] || {};
    const raw  = state[stateKey];
    if (!raw) return "";
    return dict[raw] || raw;
  };

  const timeRo    = use("time")    ? getRo("time", "time")       : "";
  const subjRo    = use("subject") ? getRo("subject", "subject") : "";
  const placeRo   = use("place")   ? getRo("place", "place")     : "";
  const modRo     = use("mod")     ? getRo("mod", "mod")         : "";
  const objectRo  = use("object")  ? getRo("object", "object")   : "";
  const numeralRo = use("numeral") ? (state.numeral || "")       : "";

  let objectPhrase = "";
  if (objectRo) {
    const arr = [];
    if (numeralRo) arr.push(numeralRo);
    arr.push(objectRo);
    objectPhrase = arr.join(" ");
  }

  const verbRaw   = state.verb || "";
  const verbRoInf = (translations.verb && translations.verb[verbRaw]) || verbRaw || "";
  const conjUsed  =
    (activeMap.conjug !== false && isColumnVisible("conjug")) ? (state.conjug || "") : "";
  const verbPhrase =
    (activeMap.verb !== false && isColumnVisible("verb"))
      ? buildRoVerbPhrase(verbRoInf, conjUsed, state.subject)
      : "";

  const parts = [];
  if (timeRo)       parts.push(timeRo);
  if (subjRo)       parts.push(subjRo);
  if (placeRo)      parts.push(placeRo);
  if (modRo)        parts.push(modRo);
  if (objectPhrase) parts.push(objectPhrase);
  if (verbPhrase)   parts.push(verbPhrase);

  if (!parts.length) return "";
  let sentence = parts.join(" ");
  sentence = sentence.replace(/\s+/g," ");
  sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1);
  if (!/[.!?]$/.test(sentence)) sentence += ".";
  return sentence;
}

/* verificare naturalitate simplƒÉ */
function analyzeNaturalnessP1(){
  const t  = stateP1.time;
  const cj = stateP1.conjug;
  if(!t || !cj) return { ok:true, msg:"", suggestion:null };

  const tType =
    timePastWords.has(t)   ? "past"   :
    timeFutureWords.has(t) ? "future" :
    "neutral";

  const cType = conjugationType(cj);

  if(tType==="past" && cType==="future"){
    const suggested = "-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî";
    const sent = buildClauseSentence(stateP1, activeP1, suggested);
    return {
      ok:false,
      msg:`‚Äû${t}‚Äù (trecut) cu final viitor ‚Äû${cj}‚Äù nu se prea folose»ôte. Exemplu mai natural:`,
      suggestion:sent.ko
    };
  }

  if(tType==="future" && cType==="past"){
    const suggested = "-(Ïúº)„Ñπ Í±∞ÏòàÏöî";
    const sent = buildClauseSentence(stateP1, activeP1, suggested);
    return {
      ok:false,
      msg:`‚Äû${t}‚Äù (viitor) cu final de trecut ‚Äû${cj}‚Äù poate suna nenatural. Exemplu mai natural:`,
      suggestion:sent.ko
    };
  }

  return { ok:true, msg:"", suggestion:null };
}

let showRo = true;

function updatePreview() {
  // P1
  const c1 = buildClauseSentence(stateP1, activeP1, null);
  let fullKo = c1.ko || "";

  // P2 ‚Äì doar dacƒÉ avem conjunc»õie de legƒÉturƒÉ
  let c2 = null;
  if (
    enableP2.checked &&
    stateP1.conjug &&
    isLinkingConj(stateP1.conjug)
  ) {
    c2 = buildClauseSentence(stateP2, activeP2, null);
    if (c2.ko) fullKo += " " + c2.ko;
  }

  if (!fullKo.trim()) {
    previewKo.textContent = "(alege cuvinte din tabel)";
    previewRo.textContent = "";
    naturalHint.textContent = "";
    return;
  }

  previewKo.textContent = fullKo;

  const ro1 = buildNaturalRomanian(stateP1, activeP1);
  const ro2 = c2 ? buildNaturalRomanian(stateP2, activeP2) : "";
  const fullRo = ro1 + (ro2 ? " " + ro2 : "");

  previewRo.textContent = showRo ? fullRo : "¬∑¬∑¬∑ traducere ascunsƒÉ ¬∑¬∑¬∑";

  const nat = analyzeNaturalnessP1();
  if (nat.ok) {
    naturalHint.textContent =
      "‚úÖ Propozi»õie naturalƒÉ (dupƒÉ regulile simple din aplica»õie).";
  } else {
    naturalHint.textContent = `‚ö† ${nat.msg} „Äå${nat.suggestion}„Äç`;
  }
}
    function loadRow(i){
  columns.forEach(col=>{
    stateP1[col.key]=col.data[i]||"";
  });
}
prevBtn.addEventListener("click",()=>{
  if(index>0){index--;loadRow(index);render();}
});
nextBtn.addEventListener("click",()=>{
  if(index<maxLen-1){index++;loadRow(index);render();}
});
resetBtn.addEventListener("click",()=>{
  [...togglesP1.querySelectorAll("input")].forEach(cb=>{cb.checked=true;activeP1[cb.dataset.key]=true;});
  [...togglesP2.querySelectorAll("input")].forEach(cb=>{cb.checked=true;activeP2[cb.dataset.key]=true;});
  render();
});
toggleRoBtn.addEventListener("click",()=>{
  showRo=!showRo;
  toggleRoBtn.textContent=showRo?"Ascunde traducerea":"AratƒÉ traducerea";
  updatePreview();
});

/* panel liste + adƒÉugare cuv√¢nt nou ‚Äì exact ca √Ænainte (nu schimb logicƒÉ) */
let panelClause="p1",panelKey="subject";
function renderPanelList(col){
  panelList.innerHTML="";
  const key=col.key;
  const map=translations[key]||{};
  const filter=(panelSearchInput.value||"").trim().toLowerCase();
  const words=col.data.filter(w=>{
    if(!w)return false;
    if(!filter)return true; 
    return w.toLowerCase().startsWith(filter);
  });
  if(!words.length){
    const empty=document.createElement("div");
    empty.className="panel-item";
    empty.textContent="Nu existƒÉ cuvinte pentru filtrul introdus.";
    panelList.appendChild(empty);
    return;
  }
  words.forEach(word=>{
    const item=document.createElement("div");
    item.className="panel-item";
    const main=document.createElement("div");
    main.className="panel-item-main";
    main.textContent=word;
    item.appendChild(main);

    const extra=document.createElement("div");
    extra.className="panel-item-extra";
    const ro=map[word];
    if(ro){
      const tag=document.createElement("div");
      tag.className="panel-item-tag";
      tag.textContent=ro;
      extra.appendChild(tag);
    }
    if(key==="conjug"&&isLinkingConj(word)){
      const star=document.createElement("div");
      star.className="panel-item-tag";
      star.textContent="‚≠ê P2";
      extra.appendChild(star);
    }
    item.appendChild(extra);

    item.addEventListener("click",()=>{
      const target=panelClause==="p1"?stateP1:stateP2;
      target[key]=word;
     if (key === "conjug" && isLinkingConj(word)) {
  enableP2.checked = true;
  enableP2.dispatchEvent(new Event("change"));
}
      overlay.classList.add("hidden");
      render();
    });

    panelList.appendChild(item);
  });
}
function openPanel(clause,key){
  panelClause=clause;panelKey=key;
  const col=columns.find(c=>c.key===key);if(!col)return;
  panelTitle.textContent=(clause==="p1"?"Propozi»õia 1 ‚Äì ":"Propozi»õia 2 ‚Äì ")+col.title;
  panelSub.textContent=col.hint||"";
  panelSearchInput.value="";newWordInput.value="";newWordTransInput.value="";
  renderPanelList(col);
  overlay.classList.remove("hidden");
  panelSearchInput.focus();
}
closePanelBtn.addEventListener("click",()=>overlay.classList.add("hidden"));
overlay.addEventListener("click",e=>{if(e.target===overlay)overlay.classList.add("hidden");});
panelSearchInput.addEventListener("input",()=>{
  const col=columns.find(c=>c.key===panelKey);
  if(col)renderPanelList(col);
});
addWordBtn.addEventListener("click",()=>{
  const txt=newWordInput.value.trim();
  if(!txt)return;
  const roTxt=(newWordTransInput.value||"").trim();
  const col=columns.find(c=>c.key===panelKey);
  if(!col||!col.allowCustom)return;

  if(!col.data.includes(txt))col.data.push(txt);
  if(!translations[panelKey])translations[panelKey]={};
  if(roTxt)translations[panelKey][txt]=roTxt;

  if(!customData[panelKey])customData[panelKey]=[];
  const exists=customData[panelKey].some(e=>e.word===txt);
  if(!exists)customData[panelKey].push({word:txt,ro:roTxt});
  else customData[panelKey].forEach(e=>{if(e.word===txt)e.ro=roTxt;});
  saveCustomData();

  newWordInput.value="";newWordTransInput.value="";
  renderPanelList(col);
  REV = buildReverseMap();
});

/* click scurt = urmƒÉtorul cuv√¢nt; long press = panel */
function cycleColumnValue(clause,key){
  const col=columns.find(c=>c.key===key);if(!col)return;
  const arr=col.data;
  const state=clause==="p1"?stateP1:stateP2;
  const cur=state[key];
  let idx=arr.indexOf(cur);
  if(idx===-1)idx=0;
  let nextIdx=(idx+1)%arr.length;
  state[key]=arr[nextIdx]||"";
  render();
}
let longPressTimer=null,pressTarget=null;
function attachPressHandlers(tableEl){
  tableEl.addEventListener("pointerdown", e => {
    const colDiv = e.target.closest(".col");
    if (!colDiv) return;

    // üëâ dacƒÉ am dat click pe checkbox-ul ON/OFF, nu blocƒÉm nimic
    if (e.target.matches("input.col-toggle")) {
      // lƒÉsƒÉm browserul sƒÉ bifeze »ôi sƒÉ trimitƒÉ evenimentul "change"
      return;
    }

    e.preventDefault();
    pressTarget = colDiv;
    longPressTimer = setTimeout(() => {
      if (pressTarget === colDiv) {
        openPanel(colDiv.dataset.clause || "p1", colDiv.dataset.key);
        pressTarget = null;
      }
    }, 450);
  });

  tableEl.addEventListener("pointerup", e => {
    const colDiv = e.target.closest(".col");

    // üëâ iarƒÉ»ôi: dacƒÉ doar ai apƒÉsat pe checkbox, nu facem ciclat / long-press
    if (e.target.matches("input.col-toggle")) {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
      pressTarget = null;
      return;
    }

    if (longPressTimer) {
      clearTimeout(longPressTimer);
      longPressTimer = null;
    }
    if (pressTarget && colDiv === pressTarget) {
      cycleColumnValue(colDiv.dataset.clause || "p1", colDiv.dataset.key);
    }
    pressTarget = null;
  });

  tableEl.addEventListener("pointerleave", () => {
    if (longPressTimer) {
      clearTimeout(longPressTimer);
      longPressTimer = null;
    }
    pressTarget = null;
  });
}
    attachPressHandlers(tableP1);
attachPressHandlers(tableP2);

/* random, audio, favorite ‚Äì ca √Ænainte */
randomBtn.addEventListener("click",()=>{
  columns.forEach(col=>{
    if(!activeP1[col.key]||!isColumnVisible(col.key))return;
    const arr=col.data.filter(x=>x!==""&&x!=null);
    if(!arr.length)return;
    stateP1[col.key]=arr[Math.floor(Math.random()*arr.length)];
  });
  render();
});
    speakBtn.addEventListener("click", () => {
  if (!("speechSynthesis" in window)) {
    alert("Browserul nu suportƒÉ audio.");
    return;
  }

  const text = previewKo.textContent;
  if (!text || text.includes("alege cuvinte")) return;

  const u = new SpeechSynthesisUtterance(text);
  u.lang = "ko-KR";

  // alegem PRIMA voce coreeanƒÉ disponibilƒÉ pentru Web Speech
  const voices = window.speechSynthesis.getVoices();
  const koVoices = voices.filter(v =>
    v.lang && v.lang.toLowerCase().startsWith("ko")
  );

  if (koVoices.length > 0) {
    u.voice = koVoices[0];   // din pƒÉcate, asta e vocea ‚Äûveche‚Äù
  }

  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
});
const favorites=[];
const favoritesListEl=document.getElementById("favoritesList");
function renderFavorites(){
  if(!favoritesListEl)return;
  favoritesListEl.innerHTML="";
  if(!favorites.length){
    const div=document.createElement("div");
    div.className="small-label";
    div.textContent="Nu ai salvat √ÆncƒÉ nicio propozi»õie.";
    favoritesListEl.appendChild(div);
    return;
  }
  favorites.forEach(f=>{
    const item=document.createElement("div");
    item.className="fav-item";
    const ko=document.createElement("div");
    ko.className="fav-ko";
    ko.textContent=f.ko;
    const ro=document.createElement("div");
    ro.className="fav-ro";
    ro.textContent=f.ro;
    item.appendChild(ko);item.appendChild(ro);
    favoritesListEl.appendChild(item);
  });
}
favBtn.addEventListener("click",()=>{
  const ko=previewKo.textContent.trim();
  let ro=previewRo.textContent.trim();
  if(!ko||ko.includes("alege cuvinte"))return;
  if(ro.startsWith("¬∑¬∑¬∑"))ro="";
  const exists=favorites.some(f=>f.ko===ko&&f.ro===ro);
  if(!exists)favorites.push({ko,ro});
  renderFavorites();
  favBtn.textContent="‚≠ê Salvat!";
  setTimeout(()=>{favBtn.textContent="‚≠ê SalveazƒÉ propozi»õia";},800);
});

/* ================== EXERCI»öII TOPIK ‚Äì modul nou ================== */

// Elemente din HTML pentru exerci»õii
const exerciseTypeEl = document.getElementById("exerciseType");
const exerciseQuestionEl = document.getElementById("exerciseQuestion");
const exerciseOptionsEl = document.getElementById("exerciseOptions");
const exerciseFeedbackEl = document.getElementById("exerciseFeedback");
const checkAnswerBtn = document.getElementById("checkAnswerBtn");
const nextQuestionBtn = document.getElementById("nextQuestionBtn");

let currentExercise = null;

// helper random
function randItem(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

// Construim o propozi»õie coreeanƒÉ simplƒÉ pentru exerci»õii (fƒÉrƒÉ particule complicate)
function buildSimpleKoreanSentence(parts){
  const out = [];
  if(parts.time) out.push(parts.time);
  if(parts.subject) out.push(parts.subject);
  if(parts.place) out.push(parts.place);
  if(parts.mod) out.push(parts.mod);
  if(parts.object) out.push(parts.object);
  if(parts.verb) out.push(parts.verb);
  return out.join(" ");
}

// 1) Exerci»õiu: Alege VERBUL corect
function makeVerbExercise(){
  const subj = randItem(subjects);
  const t = randItem(times);
  const place = randItem(places);
  const obj = randItem(objects);
  const correctVerb = randItem(verbs);

  const sentenceKorean = buildSimpleKoreanSentence({
    time: t,
    subject: subj,
    place: place,
    object: obj,
    verb: "___"
  });

  // op»õiuni (4 verbe, 1 corect)
  const options = new Set();
  options.add(correctVerb);
  while(options.size < 4){
    options.add(randItem(verbs));
  }
  const optionsArr = Array.from(options).sort(() => Math.random()-0.5);

  currentExercise = {
    type: "verb",
    correct: correctVerb,
    options: optionsArr
  };

  exerciseQuestionEl.textContent = `Alege verbul corect pentru propozi»õia:  ${sentenceKorean}`;
  renderExerciseOptions(optionsArr);
  exerciseFeedbackEl.textContent = "";
}

// 2) Exerci»õiu: Alege PARTICULA corectƒÉ ‚Äì simplificat
// De ex: Ïò§Îäò ___ ÏπúÍµ¨Î•º ÎßåÎÇòÏöî.
// rƒÉspuns posibil: Ïóê, ÏóêÏÑú, ÏùÑ/Î•º etc. (facem doar un exerci»õiu de recunoa»ôtere)
const simpleParticles = ["ÏùÄ/Îäî","Ïù¥/Í∞Ä","ÏùÑ/Î•º","Ïóê","ÏóêÏÑú"];

// ‚úÖ Distrageri (op»õiuni gre»ôite) ‚Äì folosite ca ‚Äúcapcane‚Äù
const particleChoices = ["ÏùÄ","Îäî","Ïù¥","Í∞Ä","ÏùÑ","Î•º","Ïóê","ÏóêÏÑú"];
function makeParticleExercise(){
  const subj = randItem(subjects);
  const obj  = randItem(objects);
  const verb = randItem(verbs);

  // particula corectƒÉ pentru OBIECT (ÏùÑ/Î•º)
  const correct = pickObjectParticle(obj); // "ÏùÑ" sau "Î•º"

  // propozi»õie cu UN SINGUR BLANK
  const sentence = `${subj} ${obj} ___ ${presentPolite(verb)}.`;

  // op»õiuni (4), 1 corect + 3 capcane
  const options = new Set([correct]);
  while(options.size < 4){
    options.add(randItem(particleChoices)); // ["ÏùÄ","Îäî","Ïù¥","Í∞Ä","ÏùÑ","Î•º","Ïóê","ÏóêÏÑú"]
  }
  const optionsArr = Array.from(options).sort(()=>Math.random()-0.5);

  currentExercise = { type:"particle", correct, options: optionsArr };

  exerciseQuestionEl.textContent = `Alege particula corectƒÉ:  ${sentence}`;
  renderExerciseOptions(optionsArr);
  exerciseFeedbackEl.textContent = "";
}
function makeParticlePlusExercise(){
  const t = randItem(times);
  const subj = randItem(subjects);
  const place = randItem(places);
  const obj = randItem(objects);
  const verb = randItem(verbs);

  // particule corecte
  const p1 = pickSubjectParticle(subj);   // (1) subiect
  const p2 = pickTimeParticle(t);         // (2) timp (poate fi "")
  const p3 = pickPlaceParticle(place);    // (3) loc
  const p4 = pickObjectParticle(obj);     // (4) obiect

  // Propozi»õie: TIME(2) SUBJECT(1) PLACE(3) OBJECT(4) + verb politicos simplu
  const verbForm = presentPolite(verb);

  // DacƒÉ timpul nu are particulƒÉ, pƒÉstrƒÉm blank-ul dar acceptƒÉm ‚Äú(gol)‚Äù ca rƒÉspuns corect
  const sentence =
    `${t} (2) ${subj} (1) ${place} (3) ${obj} (4) ${verbForm}.`;

  // op»õiuni pentru fiecare blank
  function buildOptions(correct){
    const options = new Set();
    // includem corectul (sau "" dacƒÉ e cazul)
    options.add(correct);

    // dacƒÉ e blank de tip ‚Äúpoate fi gol‚Äù, oferim »ôi op»õiunea "(fƒÉrƒÉ)"
    if(correct === "") options.add("(fƒÉrƒÉ)");

    while(options.size < 4){
      options.add(randItem(particleChoices));
    }
    return Array.from(options).sort(()=>Math.random()-0.5);
  }

  const opts1 = buildOptions(p1);
  const opts2 = buildOptions(p2); // poate con»õine "(fƒÉrƒÉ)"
  const opts3 = buildOptions(p3);
  const opts4 = buildOptions(p4);

  currentExercise = {
    type: "particlePlus",
    correct: { p1, p2, p3, p4 },
    sentence,
    parts: { t, subj, place, obj, verb, verbForm },
    options: { p1: opts1, p2: opts2, p3: opts3, p4: opts4 }
  };

  exerciseQuestionEl.textContent = `CompleteazƒÉ particulele (TOATE trebuie corecte):  ${sentence}`;

  renderParticlePlusOptions(currentExercise.options);
  exerciseFeedbackEl.textContent = "";
}
// 3) Exerci»õiu: Alege CONJUGAREA corectƒÉ
function makeConjugExercise(){
  const verb = randItem(verbs);
  const cj = randItem(conjugations);

  const baseSentence = `${verb} (___)`;
  const options = new Set();
  options.add(cj);
  while(options.size < 4){
    options.add(randItem(conjugations));
  }
  const optionsArr = Array.from(options).sort(() => Math.random()-0.5);

  currentExercise = {
    type: "conjug",
    correct: cj,
    verb,
    options: optionsArr
  };

  exerciseQuestionEl.textContent =
    `Alege forma corectƒÉ pentru verbul:  ${verb}  (forma politicosƒÉ / gramaticalƒÉ potrivitƒÉ)`;
  renderExerciseOptions(optionsArr);
  exerciseFeedbackEl.textContent = "";
}
// ================== 4) Exerci»õiu: üß© Puzzle ‚Äì ordoneazƒÉ propozi»õia ==================

function renderPuzzleUI(shuffledTokens){
  exerciseOptionsEl.innerHTML = "";

  const pool = document.createElement("div");
  pool.id = "puzzlePool";
  pool.style.display = "flex";
  pool.style.flexWrap = "wrap";
  pool.style.gap = "6px";
  pool.style.marginBottom = "8px";

  const answer = document.createElement("div");
  answer.id = "puzzleAnswer";
  answer.style.display = "flex";
  answer.style.flexWrap = "wrap";
  answer.style.gap = "6px";
  answer.style.minHeight = "36px";
  answer.style.padding = "6px";
  answer.style.border = "1px dashed var(--border)";
  answer.style.borderRadius = "12px";

  shuffledTokens.forEach(tok => {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.className = "chip";
    btn.textContent = tok;
    btn.dataset.token = tok;
    btn.style.cursor = "pointer";

    btn.addEventListener("click", () => {
      // dacƒÉ e jos, √Æl mutƒÉm sus; dacƒÉ e sus, √Æl mutƒÉm jos
      if (btn.parentElement === pool) {
        answer.appendChild(btn);
      } else {
        pool.appendChild(btn);
      }
    });

    pool.appendChild(btn);
  });

  const hint = document.createElement("div");
  hint.className = "small-label";
  hint.textContent = "Tap pe un cuv√¢nt ca sƒÉ √Æl mu»õi sus/jos »ôi sƒÉ formezi propozi»õia.";

  exerciseOptionsEl.appendChild(pool);
  exerciseOptionsEl.appendChild(answer);
  exerciseOptionsEl.appendChild(hint);
}

function makePuzzleExercise(){
  // construim propozi»õia din Propozi»õia 1 din Builder
  const clause = buildClauseSentence(stateP1, activeP1, null);
  const ko = (clause.ko || "").trim();

  if (!ko) {
    exerciseQuestionEl.textContent =
      "Mai √Ænt√¢i creeazƒÉ o propozi»õie √Æn Builder (de ex: SUBIECT + VERB), apoi revino aici »ôi apasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù.";
    exerciseOptionsEl.innerHTML = "";
    exerciseFeedbackEl.textContent = "";
    currentExercise = null;
    return;
  }

  const tokens = ko.split(/\s+/).filter(Boolean);
  if (tokens.length < 2) {
    exerciseQuestionEl.textContent =
      "Propozi»õia din Builder este prea scurtƒÉ pentru un puzzle. AdaugƒÉ mƒÉcar 3‚Äì4 cuvinte (SUBIECT / LOC / OBIECT / VERB).";
    exerciseOptionsEl.innerHTML = "";
    exerciseFeedbackEl.textContent = "";
    currentExercise = null;
    return;
  }

  // amestecƒÉm cuvintele
  const shuffled = tokens.slice().sort(() => Math.random() - 0.5);

  // traducere rom√¢neascƒÉ naturalƒÉ (o avem deja din Builder)
  const roNat = buildNaturalRomanian(stateP1, activeP1);

  currentExercise = {
    type: "puzzle",
    correctKo: ko,
    correctTokens: tokens,
    shuffled,
    ro: roNat
  };

  exerciseQuestionEl.textContent =
    "OrdineazƒÉ cuvintele pentru a forma propozi»õia corectƒÉ (coreeanƒÉ):";
  renderPuzzleUI(shuffled);
  exerciseFeedbackEl.textContent =
    "Tip: √Æn propozi»õiile simple, ordinea obi»ônuitƒÉ este TIME ‚Üí SUBJECT ‚Üí PLACE ‚Üí OBJECT ‚Üí VERB.";
}
    // RENDER op»õiuni √Æn UI
function renderExerciseOptions(optionsArr){
  exerciseOptionsEl.innerHTML = "";
  optionsArr.forEach((opt, idx)=>{
    const id = "opt_"+idx+"_"+Date.now();
    const label = document.createElement("label");
    label.style.display = "flex";
    label.style.alignItems = "center";
    label.style.gap = "6px";
    const radio = document.createElement("input");
    radio.type = "radio";
    radio.name = "exerciseOption";
    radio.value = opt;
    radio.id = id;

    const span = document.createElement("span");
    span.textContent = opt;

    label.appendChild(radio);
    label.appendChild(span);
    exerciseOptionsEl.appendChild(label);
  });
}
function renderParticlePlusOptions(opts){
  exerciseOptionsEl.innerHTML = "";

  const makeBlock = (label, name, arr) => {
    const wrap = document.createElement("div");
    wrap.style.padding = "8px";
    wrap.style.border = "1px solid var(--border)";
    wrap.style.borderRadius = "12px";
    wrap.style.background = "#faf8ff";
    wrap.style.marginBottom = "6px";

    const title = document.createElement("div");
    title.style.fontWeight = "700";
    title.style.fontSize = "12px";
    title.style.color = "var(--accent-strong)";
    title.textContent = label;
    wrap.appendChild(title);

    arr.forEach((opt, idx)=>{
      const id = `${name}_${idx}_${Date.now()}`;
      const lab = document.createElement("label");
      lab.style.display = "flex";
      lab.style.alignItems = "center";
      lab.style.gap = "6px";
      lab.style.fontSize = "13px";
      lab.style.marginTop = "4px";

      const radio = document.createElement("input");
      radio.type = "radio";
      radio.name = name;
      radio.value = opt;
      radio.id = id;

      const span = document.createElement("span");
      span.textContent = opt;

      lab.appendChild(radio);
      lab.appendChild(span);
      wrap.appendChild(lab);
    });

    return wrap;
  };

  exerciseOptionsEl.appendChild(makeBlock("(1) Particula subiectului", "pPlus1", opts.p1));
  exerciseOptionsEl.appendChild(makeBlock("(2) Particula timpului", "pPlus2", opts.p2));
  exerciseOptionsEl.appendChild(makeBlock("(3) Particula locului", "pPlus3", opts.p3));
  exerciseOptionsEl.appendChild(makeBlock("(4) Particula obiectului", "pPlus4", opts.p4));
}
// Generator √Æntrebare nouƒÉ

function newExerciseQuestion(){
  const type = exerciseTypeEl ? exerciseTypeEl.value : "verb";

  if (type === "verb") {
    makeVerbExercise();
  } else if (type === "particle") {
    makeParticleExercise();
  } else if (type === "particlePlus") {
    makeParticlePlusExercise();
  } else if (type === "conjug" || type === "conjugation") {
    makeConjugExercise();
  } else if (type === "puzzle") {
    makePuzzleExercise();
  } else {
    makeVerbExercise(); // fallback
  }
}
    // Verificare rƒÉspuns
function checkExerciseAnswer(){
  if (!currentExercise) {
    exerciseFeedbackEl.textContent = "Mai √Ænt√¢i apasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù.";
    return;
  }

  // üß© verificare pentru puzzle
  if (currentExercise.type === "puzzle") {
    const answerBox = exerciseOptionsEl.querySelector("#puzzleAnswer");

    if (!answerBox) {
      exerciseFeedbackEl.textContent = "A apƒÉrut o problemƒÉ cu puzzle-ul. Re√ÆncearcƒÉ cu ‚Äû√éntrebare nouƒÉ‚Äù.";
      return;
    }

    const chosenTokens = Array.from(answerBox.querySelectorAll("button"))
      .map(btn => btn.dataset.token || btn.textContent.trim())
      .filter(Boolean);

    if (!chosenTokens.length) {
      exerciseFeedbackEl.textContent =
        "MutƒÉ cuvintele √Æn zona de rƒÉspuns ca sƒÉ formezi propozi»õia.";
      return;
    }

    const userKo = chosenTokens.join(" ");
    const normalize = (s) => (s || "").replace(/\s+/g, " ").trim();
    const correct = normalize(currentExercise.correctKo);

    if (normalize(userKo) === correct) {
      let msg = "‚úÖ Corect! Propozi»õia este:\n" + currentExercise.correctKo;
      if (currentExercise.ro) {
        msg += "\nTraducere naturalƒÉ: " + currentExercise.ro;
      }
      exerciseFeedbackEl.textContent = msg;
    } else {
      let msg = "‚ùå Nu e √ÆncƒÉ ordinea corectƒÉ.\nPropozi»õia corectƒÉ ar fi:\n" +
        currentExercise.correctKo;
      if (currentExercise.ro) {
        msg += "\nTraducere naturalƒÉ: " + currentExercise.ro;
      }
      exerciseFeedbackEl.textContent = msg;
    }
    return;
  }

  // üîπ restul rƒÉm√¢ne identic (particlePlus + exerci»õiile cu radio-uri)
  if(currentExercise.type === "particlePlus"){
    const getVal = (name) => {
      const chosen = Array.from(exerciseOptionsEl.querySelectorAll(`input[name='${name}']`)).find(x=>x.checked);
      return chosen ? chosen.value : null;
    };

    const a1 = getVal("pPlus1");
    const a2 = getVal("pPlus2");
    const a3 = getVal("pPlus3");
    const a4 = getVal("pPlus4");

    if(!a1 || !a2 || !a3 || !a4){
      exerciseFeedbackEl.textContent = "Te rog alege un rƒÉspuns pentru (1)(2)(3)(4).";
      return;
    }

    const norm = (v) => (v === "(fƒÉrƒÉ)" ? "" : v);

    const ok1 = norm(a1) === currentExercise.correct.p1;
    const ok2 = norm(a2) === currentExercise.correct.p2;
    const ok3 = norm(a3) === currentExercise.correct.p3;
    const ok4 = norm(a4) === currentExercise.correct.p4;

    if(ok1 && ok2 && ok3 && ok4){
      exerciseFeedbackEl.textContent = "‚úÖ Corect! Toate particulele sunt bune.";
    } else {
      const c = currentExercise.correct;
      const show = (x)=> x === "" ? "(fƒÉrƒÉ)" : x;
      exerciseFeedbackEl.textContent =
        `‚ùå Nu e complet corect.\n` +
        `Corect: (1) ${c.p1} / (2) ${show(c.p2)} / (3) ${c.p3} / (4) ${c.p4}`;
    }
    return;
  }

  // ‚¨áÔ∏è de aici √Æn jos la»ôi EXACT ce aveai (verificarea cu radio ‚ÄúexerciseOption‚Äù)
  const chosen = Array.from(
    exerciseOptionsEl.querySelectorAll("input[name='exerciseOption']")
  ).find(x=>x.checked);

  if(!chosen){
    exerciseFeedbackEl.textContent = "Te rog sƒÉ alegi un rƒÉspuns.";
    return;
  }

  const val = chosen.value;
  const correct = currentExercise.correct;

  if(val === correct){
    exerciseFeedbackEl.textContent = "‚úÖ Corect! Bravo!";
  }else{
    exerciseFeedbackEl.textContent = `‚ùå Gre»ôit. RƒÉspunsul corect era: ${correct}`;
  }
}
// LegƒÉm butoanele
if(nextQuestionBtn){
  nextQuestionBtn.addEventListener("click", newExerciseQuestion);
}
if(checkAnswerBtn){
  checkAnswerBtn.addEventListener("click", checkExerciseAnswer);
}// mic label care explicƒÉ tipul de exerci»õiu
const exerciseTypeLabel = document.getElementById("exerciseTypeLabel");
const exerciseSubtag = document.getElementById("exerciseSubtag");

function updateExerciseTypeLabel(){
  if(!exerciseTypeEl || !exerciseTypeLabel) return;
  const v = exerciseTypeEl.value;

  if (v === "verb") {
    exerciseTypeLabel.textContent = "Verbele din builder (alegi forma corectƒÉ)";
  } else if (v === "particle") {
    exerciseTypeLabel.textContent = "Particula corectƒÉ pentru o propozi»õie";
  } else if (v === "particlePlus") {
    exerciseTypeLabel.textContent = "4 pozi»õii de particule (SUBJ/TIME/PLACE/OBJ)";
  } else if (v === "conjug" || v === "conjugation") {
    exerciseTypeLabel.textContent = "Finale de verb (timp, inten»õie, interdic»õie)";
  } else if (v === "puzzle") {
    exerciseTypeLabel.textContent = "Puzzle: ordoneazƒÉ propozi»õia din Builder";
  } else {
    exerciseTypeLabel.textContent = "Exerci»õiu TOPIK";
  }

  if (exerciseSubtag){
    exerciseSubtag.textContent = "‚Äî apasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù pentru acest tip";
  }
}
if(exerciseTypeEl){
  exerciseTypeEl.addEventListener("change", ()=>{
    updateExerciseTypeLabel();
    exerciseQuestionEl.textContent = "ApasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù ca sƒÉ √Æncepi.";
    exerciseOptionsEl.innerHTML = "";
    exerciseFeedbackEl.textContent = "";
  });
  updateExerciseTypeLabel();
}
// La √Ænceput: mesaj neutru
if(exerciseQuestionEl){
  exerciseQuestionEl.textContent = '';
}
    
/* glosar simplu (nu schimb) */
const glossarySearch=document.getElementById("glossarySearch");
const glossaryList=document.getElementById("glossaryList");
function addGlossaryFrom(list,catKey,catLabel){
  const map=translations[catKey]||{};
  list.forEach(w=>{
    if(!w)return;
    const ro=map[w]||"(fƒÉrƒÉ traducere √ÆncƒÉ)";
    glossaryEntries.push({ko:w,ro,category:catLabel});
  });
}
addGlossaryFrom(subjects,"subject","SUBJECT");
addGlossaryFrom(times,"time","TIME");
addGlossaryFrom(places,"place","PLACE");
addGlossaryFrom(mods,"mod","MOD");
addGlossaryFrom(objects,"object","OBJECT");
addGlossaryFrom(counters,"counter","COUNTER");
addGlossaryFrom(verbs,"verb","VERB");
addGlossaryFrom(conjugations,"conjug","CONJUGƒÇRI");

function renderGlossary(filter){
  if(!glossaryList)return;
  filter=(filter||"").toLowerCase();
  glossaryList.innerHTML="";
  const filtered=glossaryEntries.filter(e=>{
    if(!filter)return true;
    return e.ko.toLowerCase().includes(filter)||e.ro.toLowerCase().includes(filter);
  });
  if(!filtered.length){
    const div=document.createElement("div");
    div.className="small-label";
    div.textContent="Nu s-a gƒÉsit nimic pentru cƒÉutarea introdusƒÉ.";
    glossaryList.appendChild(div);
    return;
  }
  filtered.forEach(e=>{
    const item=document.createElement("div");
    item.className="glossary-item";
    const left=document.createElement("div");
    const ko=document.createElement("div");
    ko.className="glossary-ko";ko.textContent=e.ko;
    const ro=document.createElement("div");
    ro.className="glossary-ro";ro.textContent=e.ro;
    left.appendChild(ko);left.appendChild(ro);
    const cat=document.createElement("div");
    cat.className="glossary-cat";cat.textContent=e.category;
    item.appendChild(left);item.appendChild(cat);
    glossaryList.appendChild(item);
  });
}
if(glossarySearch)glossarySearch.addEventListener("input",()=>renderGlossary(glossarySearch.value));

/* ini»õializare */
function render(){
  renderClauseRow(tableP1,activeP1,stateP1,"p1");
  if(enableP2.checked)renderClauseRow(tableP2,activeP2,stateP2,"p2");
  pageInfoEl.textContent=`R√¢nd model: ${index+1} / ${maxLen}`;
  prevBtn.disabled=index===0;
  nextBtn.disabled=index===maxLen-1;
  updatePreview();
}
 function translateRoToKo(roText) {
  // pƒÉstrƒÉm ultima propozi»õie, cum era »ôi √Ænainte
  LAST_RO_SENTENCE = roText || "";
  const original = (roText || "").trim();

  if (!original) {
    return { ko: "", roFixed: "" };
  }

  // 1) ParsƒÉm propozi»õia rom√¢neascƒÉ
  const parsed = parseRoToState(original);

  // 2) Construim propozi»õia coreeanƒÉ din state-ul parserului
  const koResult = buildClauseSentence(
    parsed.state,
    {
      subject: true,
      time: true,
      place: true,
      mod: true,
      object: true,
      numeral: false,
      counter: false,
      verb: true,
      conjug: true,
    },
    null
  ).ko;

  // 3) Construim propozi»õia rom√¢neascƒÉ ‚ÄûcorectatƒÉ‚Äù
  let roFixed = buildNaturalRomanian(
    parsed.state,
    {
      subject: true,
      time: true,
      place: true,
      mod: true,
      object: true,
      numeral: false,
      counter: false,
      verb: true,
      conjug: true,
    },
    null
  );
// ======================================================
//    ENGLISH ‚Üí KOREAN  (pipeline separat, cap-coadƒÉ)
// ======================================================

// Dic»õionare simple pentru cuvinte frecvente.
// Po»õi extinde foarte u»ôor aceste liste.
const EN_SUBJECTS = [
  { re: /\bI\b/i, ko: "Ï†Ä", label: "I (formal)" },
  { re: /\byou\b/i, ko: "ÎãπÏã†", label: "you" },
  { re: /\bhe\b/i, ko: "Í∑∏", label: "he" },
  { re: /\bshe\b/i, ko: "Í∑∏ÎÖÄ", label: "she" },
  { re: /\bwe\b/i, ko: "Ïö∞Î¶¨", label: "we" },
  { re: /\bthey\b/i, ko: "Í∑∏Îì§", label: "they" }
];

const EN_TIMES = [
  { re: /\btoday\b/i, ko: "Ïò§Îäò" },
  { re: /\byesterday\b/i, ko: "Ïñ¥Ï†ú" },
  { re: /\btomorrow\b/i, ko: "ÎÇ¥Ïùº" },
  { re: /\bnow\b/i, ko: "ÏßÄÍ∏à" },
  { re: /\bthis morning\b/i, ko: "Ïò§Îäò ÏïÑÏπ®" },
  { re: /\btonight\b/i, ko: "Ïò§Îäò Î∞§" }
];

const EN_PLACES = [
  { re: /\bhome\b/i, ko: "ÏßëÏóê" },
  { re: /\bschool\b/i, ko: "ÌïôÍµêÏóê" },
  { re: /\bthe school\b/i, ko: "ÌïôÍµêÏóê" },
  { re: /\bto school\b/i, ko: "ÌïôÍµêÏóê" },
  { re: /\bcafe\b/i, ko: "Ïπ¥ÌéòÏóê" },
  { re: /\bwork\b/i, ko: "ÌöåÏÇ¨Ïóê" },
  { re: /\boffice\b/i, ko: "ÏÇ¨Î¨¥Ïã§Ïóê" }
];

const EN_OBJECTS = [
  { re: /\bcoffee\b/i, ko: "Ïª§ÌîºÎ•º" },
  { re: /\btea\b/i, ko: "Ï∞®Î•º" },
  { re: /\bbook\b/i, ko: "Ï±ÖÏùÑ" },
  { re: /\bbooks\b/i, ko: "Ï±ÖÏùÑ" },
  { re: /\bKorean\b/i, ko: "ÌïúÍµ≠Ïñ¥Î•º" },
  { re: /\bKorean language\b/i, ko: "ÌïúÍµ≠Ïñ¥Î•º" },
  { re: /\bhomework\b/i, ko: "ÏàôÏ†úÎ•º" }
];

// Verbe de bazƒÉ ‚Äì aici decizi forma finalƒÉ (prezent politicos)
const EN_VERBS = [
  { re: /\bgo\b/i, ko: "Í∞ÄÏöî" },
  { re: /\bcome\b/i, ko: "ÏôÄÏöî" },
  { re: /\bdrink\b/i, ko: "ÎßàÏÖîÏöî" },
  { re: /\beat\b/i, ko: "Î®πÏñ¥Ïöî" },
  { re: /\bstudy\b/i, ko: "Í≥µÎ∂ÄÌï¥Ïöî" },
  { re: /\bread\b/i, ko: "ÏùΩÏñ¥Ïöî" },
  { re: /\bmeet\b/i, ko: "ÎßåÎÇòÏöî" },
  { re: /\bwork\b/i, ko: "ÏùºÌï¥Ïöî" },
  { re: /\bsleep\b/i, ko: "ÏûêÏöî" }
];

// Un mic helper: gƒÉse»ôte primul match √Æntr-o listƒÉ
function findEnMatch(list, text) {
  for (const item of list) {
    if (item.re.test(text)) {
      return item;
    }
  }
  return null;
}

function capitalizeSentence(str) {
  const s = (str || "").trim();
  if (!s) return "";
  const first = s.charAt(0).toUpperCase();
  const rest = s.slice(1);
  const withDot = /[.!?]$/.test(rest) ? rest : rest + ".";
  return first + withDot;
}

// *** Motorul principal EN ‚Üí KO ***
function translateEnToKo(enText) {
  const original = (enText || "").trim();
  if (!original) {
    return { ko: "", roFixed: "" };
  }

  const text = original.toLowerCase();

  // 1) Subject
  const subj = findEnMatch(EN_SUBJECTS, text);
  const koSubj = subj ? subj.ko : ""; // po»õi pune "Ï†Ä" default dacƒÉ vrei

  // 2) Time
  const time = findEnMatch(EN_TIMES, text);
  const koTime = time ? time.ko : "";

  // 3) Place
  const place = findEnMatch(EN_PLACES, text);
  const koPlace = place ? place.ko : "";

  // 4) Object
  const obj = findEnMatch(EN_OBJECTS, text);
  const koObj = obj ? obj.ko : "";

  // 5) Verb
  const verb = findEnMatch(EN_VERBS, text);
  const koVerb = verb ? verb.ko : "";

  // 6) Conector ‚Äûand‚Äù simplu: dacƒÉ apare "and read", "and drink" etc,
  // facem "Í∞ÄÍ≥† ÏùΩÏñ¥Ïöî", "Í∞ÄÍ≥† ÎßàÏÖîÏöî" etc.
  let koSentence = "";

  // Mai √Ænt√¢i √ÆncercƒÉm sƒÉ vedem dacƒÉ existƒÉ "and <verb>"
  const andMatch = text.match(/\band\s+([a-z]+)/i);
  if (andMatch) {
    const secondVerbWord = andMatch[1];
    const secondVerb = findEnMatch(
      EN_VERBS,
      secondVerbWord
    );

    if (verb && secondVerb) {
      // compunem: SUBJECT TIME PLACE OBJECT1 VERB-Í≥† OBJECT2 VERB2
      // ca schemƒÉ simplƒÉ
      const firstPart = [
        koSubj,
        koTime,
        koPlace,
        koObj
      ].filter(Boolean).join(" ");

      const firstVerb = verb.ko.replace(/Ïöî$/, "Í≥†"); // Í∞ÄÏöî ‚Üí Í∞ÄÍ≥†
      const secondVerbKo = secondVerb.ko;

      koSentence = [firstPart, firstVerb, secondVerbKo]
        .filter(Boolean)
        .join(" ");
    }
  }

  // DacƒÉ nu avem structurƒÉ cu "and", facem propozi»õie simplƒÉ
  if (!koSentence) {
    koSentence = [
      koSubj,
      koTime,
      koPlace,
      koObj,
      koVerb
    ].filter(Boolean).join(" ");
  }

  // EN corectat / reformulat (deocamdatƒÉ doar cu literƒÉ mare + punct)
  const enFixed = capitalizeSentence(original);

  return {
    ko: koSentence || "(could not build Korean sentence)",
    roFixed: enFixed
  };
}
   // === ProgrƒÉmel separat: reparƒÉ ‚Äû»ôi. Cuv√¢nt‚Äù ‚Üí ‚Äû»ôi cuv√¢nt‚Äù ===
function smartJoinRomanian(text) {
  if (!text || typeof text !== "string") return text;

  return text
    // 1) cazurile cu paranteze: ‚Äû(»ôi). Cuv√¢nt‚Äù
    .replace(/\(\s*»ôi\s*\)\.\s+([A-ZƒÇ√Ç√é»ò»ö])/g, function (_, p1) {
      return "»ôi " + p1.toLowerCase();
    })
    .replace(/\(\s*si\s*\)\.\s+([A-ZA-Z])/g, function (_, p1) {
      return "»ôi " + p1.toLowerCase();
    })

    // 2) cazul ‚Äû»ôi). Cuv√¢nt‚Äù
    .replace(/»ôi\)\.\s+([A-ZƒÇ√Ç√é»ò»ö])/g, function (_, p1) {
      return "»ôi " + p1.toLowerCase();
    })
    .replace(/si\)\.\s+([A-ZA-Z])/g, function (_, p1) {
      return "»ôi " + p1.toLowerCase();
    })

    // 3) cazul simplu ‚Äû»ôi. Cuv√¢nt‚Äù
    .replace(/»ôi\.\s+([A-ZƒÇ√Ç√é»ò»ö])/g, function (_, p1) {
      return "»ôi " + p1.toLowerCase();
    })
    .replace(/si\.\s+([A-ZA-Z])/g, function (_, p1) {
      return "»ôi " + p1.toLowerCase();
    });
}
   // 5) Rezultatul final
  return {
    ko: koResult || "(nu am putut construi propozi»õia)",
    roFixed: roFixed || original,
  };
}
    // ================== üìÖ 3 CUVINTE/ZI (integrat √Æn program) ==================
const DAILY_KEY = "raluca_daily_words_v1";
const DAILY_LEARNED_KEY = "raluca_daily_learned_days_v1";

function todayLocalISO(d=new Date()){
  // YYYY-MM-DD √Æn timezone local (stabil pt user)
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${yyyy}-${mm}-${dd}`;
}

function xmur3(str){
  let h=1779033703 ^ str.length;
  for(let i=0;i<str.length;i++){
    h=Math.imul(h ^ str.charCodeAt(i), 3432918353);
    h=(h<<13)|(h>>>19);
  }
  return function(){
    h=Math.imul(h ^ (h>>>16), 2246822507);
    h=Math.imul(h ^ (h>>>13), 3266489909);
    h^=h>>>16;
    return h>>>0;
  }
}
function mulberry32(a){
  return function(){
    let t=a+=0x6D2B79F5;
    t=Math.imul(t ^ (t>>>15), t | 1);
    t^=t + Math.imul(t ^ (t>>>7), t | 61);
    return ((t ^ (t>>>14))>>>0)/4294967296;
  }
}
function shuffleSeeded(arr, seedStr){
  const seed = xmur3(seedStr)();
  const rand = mulberry32(seed);
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(rand()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
// ===== TOP cuvinte uzuale (po»õi extinde oric√¢nd) =====
const DAILY_TOP = [
  // SUBJECT (super frecvent)
  {ko:"Ï†Ä", cat:"subject"}, {ko:"ÎÇò", cat:"subject"}, {ko:"ÎÑà", cat:"subject"}, {ko:"Ïö∞Î¶¨", cat:"subject"},

  // TIME
  {ko:"Ïò§Îäò", cat:"time"}, {ko:"Ïñ¥Ï†ú", cat:"time"}, {ko:"ÎÇ¥Ïùº", cat:"time"}, {ko:"ÏßÄÍ∏à", cat:"time"},
  {ko:"ÏöîÏ¶ò", cat:"time"}, {ko:"Î∞©Í∏à", cat:"time"}, {ko:"Í≥ß", cat:"time"},

  // PLACE
  {ko:"Ïßë", cat:"place"}, {ko:"ÌïôÍµê", cat:"place"}, {ko:"ÌöåÏÇ¨", cat:"place"}, {ko:"Ïπ¥Ìéò", cat:"place"},
  {ko:"ÏãùÎãπ", cat:"place"}, {ko:"Î≥ëÏõê", cat:"place"}, {ko:"ÎèÑÏÑúÍ¥Ä", cat:"place"}, {ko:"ÏùÄÌñâ", cat:"place"},

  // MOD
  {ko:"Ïûò", cat:"mod"}, {ko:"Ï≤úÏ≤úÌûà", cat:"mod"}, {ko:"Îπ®Î¶¨", cat:"mod"}, {ko:"Ï†ïÎßê", cat:"mod"},
  {ko:"ÏïÑÏ£º", cat:"mod"}, {ko:"ÎÑàÎ¨¥", cat:"mod"}, {ko:"ÎßéÏù¥", cat:"mod"}, {ko:"Ï°∞Í∏à", cat:"mod"},

  // OBJECT
  {ko:"Ï±Ö", cat:"object"}, {ko:"Î¨º", cat:"object"}, {ko:"Ïª§Ìîº", cat:"object"}, {ko:"ÏùåÏãù", cat:"object"},
  {ko:"Í∞ÄÎ∞©", cat:"object"}, {ko:"Ï†ÑÌôî", cat:"object"}, {ko:"Îèà", cat:"object"}, // (dacƒÉ vrei, √Æl adƒÉugƒÉm »ôi √Æn listƒÉ + traduceri)
  {ko:"Ï†ïÎ≥¥", cat:"object"}, {ko:"Î¨∏Ï†ú", cat:"object"},

  // VERB (cele mai folosite √Æn vorbire)
  {ko:"Í∞ÄÎã§", cat:"verb"}, {ko:"Ïò§Îã§", cat:"verb"}, {ko:"Î®πÎã§", cat:"verb"}, {ko:"ÎßàÏãúÎã§", cat:"verb"},
  {ko:"Î≥¥Îã§", cat:"verb"}, {ko:"ÏùΩÎã§", cat:"verb"}, {ko:"Ïì∞Îã§", cat:"verb"}, {ko:"ÏÇ¨Îã§", cat:"verb"},
  {ko:"Ï£ºÎã§", cat:"verb"}, {ko:"Î∞õÎã§", cat:"verb"}, {ko:"ÏùºÌïòÎã§", cat:"verb"}, {ko:"Í≥µÎ∂ÄÌïòÎã§", cat:"verb"},
  {ko:"Ï¢ãÏïÑÌïòÎã§", cat:"verb"}, {ko:"Ïã´Ïñ¥ÌïòÎã§", cat:"verb"}, {ko:"Í∏∞Îã§Î¶¨Îã§", cat:"verb"}, {ko:"Ïâ¨Îã§", cat:"verb"},
  {ko:"ÎßåÎÇòÎã§", cat:"verb"}
];
function buildDailyPool(){
  // folosim strict TOP words (cele mai uzuale) + traduceri din dictionarul tƒÉu
  const out = [];

  const pickTranslation = (catKey, ko) => (translations[catKey] && translations[catKey][ko]) ? translations[catKey][ko] : "";

  DAILY_TOP.forEach(x=>{
    const catKey = x.cat;      // subject/time/place/mod/object/verb etc
    const ko = x.ko;

    // dacƒÉ nu existƒÉ √Æn listele tale, √Æl putem ignora sau √Æl adƒÉugƒÉm (eu recomand sƒÉ √Æl adaugi)
    out.push({
      ko,
      ro: pickTranslation(catKey, ko),
      cat: catKey.toUpperCase()
    });
  });

  // eliminƒÉm duplicate
  const seen = new Set();
  return out.filter(w=>{
    const k = w.ko+"|"+w.cat;
    if(seen.has(k)) return false;
    seen.add(k);
    return true;
  });
}
function getDailyState(){
  const raw = localStorage.getItem(DAILY_KEY);
  if(raw){
    try { return JSON.parse(raw); } catch(e){}
  }
  // generƒÉm o ordine fixƒÉ (shuffle) care rƒÉm√¢ne aceea»ôi
  const pool = buildDailyPool();
  const order = shuffleSeeded(pool, "RALUCA-DAILY-SEED-v1");
  const state = { order, createdAt: Date.now() };
  localStorage.setItem(DAILY_KEY, JSON.stringify(state));
  return state;
}

function getLearnedDays(){
  try {
    return JSON.parse(localStorage.getItem(DAILY_LEARNED_KEY) || "[]");
  } catch(e){
    return [];
  }
}
function setLearnedDays(arr){
  localStorage.setItem(DAILY_LEARNED_KEY, JSON.stringify(arr));
}

function dayOffset(baseISO, offset){
  const [y,m,d] = baseISO.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  dt.setDate(dt.getDate() + offset);
  return todayLocalISO(dt);
}

let dailyOffset = 0;

function get3WordsForISO(iso){
  const { order } = getDailyState();
  if(!order || !order.length) return [];
  // index = (numƒÉrul zilei √Æn an) * 3
  const [y,m,d] = iso.split("-").map(Number);
  const dt = new Date(y, m-1, d);
  const start = new Date(y, 0, 1);
  const dayNum = Math.floor((dt - start) / (1000*60*60*24)); // 0..365
  const baseIndex = (dayNum * 3) % order.length;

  return [
    order[baseIndex],
    order[(baseIndex+1) % order.length],
    order[(baseIndex+2) % order.length]
  ];
}

function renderDailyWords(){
  const iso = dayOffset(todayLocalISO(), dailyOffset);

  const dateLabel = document.getElementById("dailyDateLabel");
  const box = document.getElementById("dailyWordsBox");
  const progress = document.getElementById("dailyProgress");
  const markBtn = document.getElementById("dailyMarkBtn");

  if(!dateLabel || !box || !progress || !markBtn) return;

  dateLabel.textContent = dailyOffset===0 ? `Azi (${iso})` : `${dailyOffset<0?"Ieri/Mai devreme":"Mai t√¢rziu"} (${iso})`;

  const words = get3WordsForISO(iso);
  box.innerHTML = "";

    words.forEach(w => {
    const row = document.createElement("div");
    row.style.padding = "8px";
    row.style.border = "1px solid var(--border)";
    row.style.borderRadius = "12px";
    row.style.background = "#faf8ff";

    row.innerHTML = `
      <div style="font-weight:700;font-size:14px;">${w.ko}</div>
      <div class="small-label">${w.ro || ""}</div>
      <div class="glossary-cat">${w.cat}</div>
    `;

    box.appendChild(row);
  });

  const learned = getLearnedDays();
  const isLearned = learned.includes(iso);
  markBtn.textContent = isLearned ? "‚úÖ Marcat ca √ÆnvƒÉ»õat" : "‚úÖ Am √ÆnvƒÉ»õat azi";
  markBtn.disabled = isLearned;

  progress.textContent = `Zile bifate: ${learned.length}`;
}

function setupDailyUI(){
  const prev = document.getElementById("dailyPrevBtn");
  const next = document.getElementById("dailyNextBtn");
  const mark = document.getElementById("dailyMarkBtn");

  if(prev) prev.addEventListener("click", ()=>{ dailyOffset--; renderDailyWords(); });
  if(next) next.addEventListener("click", ()=>{ dailyOffset++; renderDailyWords(); });

  if(mark) mark.addEventListener("click", ()=>{
    const iso = dayOffset(todayLocalISO(), dailyOffset);
    const learned = getLearnedDays();
    if(!learned.includes(iso)){
      learned.push(iso);
      setLearnedDays(learned);
    }
    renderDailyWords();
  });

  renderDailyWords();
}
    /* ========= INITIALIZARE APLICA»öIE ========= */

// Pornim cu primul r√¢nd din model √Æn Builder
loadRow(index);
setScreen("builder");
render();

// Ini»õializƒÉm modul ‚Äû3 cuvinte/zi‚Äù
setupDailyUI();

// Glosar & favorite (dacƒÉ existƒÉ elementele √Æn HTML)
renderGlossary && renderGlossary("");
renderFavorites && renderFavorites();

// ActualizƒÉm eticheta pentru tipul curent de exerci»õiu
updateExerciseTypeLabel();

/* ==== BUTOANE LEC»öII ‚Üí TRIMIT EXEMPLE √éN BUILDER ==== */

// folose»ôte aceea»ôi func»õie de traducere ca la butonul mare "Tradu √Æn coreeanƒÉ"
function runExampleInBuilder(roSentence) {
  if (!roTranslateBtn) return;
  roInput.value = roSentence;
  // declan»ôƒÉm fluxul normal: parser + Builder + rezultat
  roTranslateBtn.click();
  setScreen("builder");
}

// ata»ôeazƒÉ un exemplu la un buton de lec»õie
function addLessonExample(btnId, roSentence) {
  const btn = document.getElementById(btnId);
  if (!btn) return;
  btn.addEventListener("click", () => {
    runExampleInBuilder(roSentence);
  });
}

// ConectƒÉm lec»õiile direct (scriptul este la finalul <body>, deci elementele existƒÉ)
addLessonExample("lesson1TryBtn", "Azi am de g√¢nd sƒÉ citesc o carte.");
addLessonExample("lesson2TryBtn", "SƒÉ vedem un film?");
addLessonExample("lesson3TryBtn", "AstƒÉzi merg la cafenea sƒÉ √ÆnvƒÉ»õ coreeanƒÉ.");
addLessonExample("lesson4TryBtn", "√én fiecare diminea»õƒÉ beau cafea »ôi studiez coreeanƒÉ.");
addLessonExample("lesson5TryBtn", "Lucrez mult »ôi sunt foarte obositƒÉ.");
    
  // ===== MUTƒÇ BLOCUL ‚ÄûROM√ÇNƒÇ ‚Üí COREEANƒÇ‚Äù √éN JOSUL BUILDER-ULUI =====
document.addEventListener("DOMContentLoaded", () => {
  // 1) Butonul "Tradu √Æn coreeanƒÉ"
  const roBtn = document.getElementById("roTranslateBtn");
  // 2) Textul cu propozi»õia coreeanƒÉ (preview)
  const previewKo = document.getElementById("previewKo");

  if (!roBtn || !previewKo) {
    return; // dacƒÉ nu gƒÉse»ôte elementele, nu face nimic
  }

  // cardul/blocul √Æn care stƒÉ butonul de traducere
  const roBlock = roBtn.closest(".card") || roBtn.parentElement;
  // cardul cu propozi»õia coreeanƒÉ
  const previewCard = previewKo.closest(".card") || previewKo.parentElement;

  if (!roBlock || !previewCard || !previewCard.parentElement) {
    return;
  }

  // MutƒÉm blocul Rom√¢nƒÉ ‚Üí CoreeanƒÉ IMEDIAT dupƒÉ cardul de preview
  previewCard.insertAdjacentElement("afterend", roBlock);
});
    // ==== SYNC: Traducerea aproximativƒÉ (Builder) -> bloc "Rom√¢nƒÉ ‚Üí CoreeanƒÉ" ====
(function () {
  const previewRo = document.getElementById("previewRo");  // linia de rom√¢nƒÉ de sub Builder
  const roInput   = document.getElementById("roInput");    // textarea din cardul "Rom√¢nƒÉ ‚Üí CoreeanƒÉ"

  // dacƒÉ nu gƒÉse»ôte elementele, nu face nimic (de siguran»õƒÉ)
  if (!previewRo || !roInput) return;

  function syncApproxToRoInput() {
    const text = (previewRo.textContent || "").trim();
    if (!text) return;          // dacƒÉ e gol, nu completƒÉm nimic
    roInput.value = text;       // punem traducerea aproximativƒÉ √Æn textarea de jos
  }

  // urmƒÉrim orice schimbare √Æn previewRo (de la Builder, Random propozi»õie etc.)
  const observer = new MutationObserver(syncApproxToRoInput);
  observer.observe(previewRo, {
    childList: true,
    characterData: true,
    subtree: true
  });

  // sincronizare ini»õialƒÉ (dacƒÉ existƒÉ deja o propozi»õie √Æn Builder)
  syncApproxToRoInput();
})();
   (() => {
  const enableP2 = document.getElementById("enableP2");
  const titleP2  = document.getElementById("titleP2");
  const tableP2  = document.getElementById("tableP2");

  if (!enableP2 || !titleP2 || !tableP2) return;

  const syncP2 = () => {
    const on = enableP2.checked;
    titleP2.classList.toggle("hidden", !on);
    tableP2.classList.toggle("hidden", !on);
  };

  enableP2.addEventListener("change", syncP2);
  syncP2();
})();
  </script>
</body>
</html> 
