<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raluca Korean â€” Study App v2.0</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="pastel-theme">
  <div class="app">
    <header class="rk-header">
      <div class="rk-header-main">
        <h1>Raluca Korean</h1>
        <span class="rk-badge">Study App v2.0</span>
      </div>
      <p id="subtitle">Builder propoziÈ›ii + particule + audio + conjugÄƒri</p>
    </header>

    <!-- SCREEN 1: BUILDER -->
    <section class="screen active" id="screen-builder">
      <!-- Mode panel -->
      <div class="mode-panel">
        <div class="mode-row">
          <span class="section-label">Mod afiÈ™are</span>
          <div>
            <button class="secondary small-mode-btn" data-mode="simple" type="button">Simplu</button>
            <button class="secondary small-mode-btn active" data-mode="topik" type="button">TOPIK</button>
          </div>
        </div>

        <div class="mode-row">
          <span class="section-label">PropoziÈ›ia 1 â€“ ce pÄƒrÈ›i foloseÈ™te?</span>
          <div class="part-toggles" id="togglesP1"></div>
        </div>

        <div class="mode-row">
          <span class="section-label">PropoziÈ›ia 2 â€“ ce pÄƒrÈ›i foloseÈ™te?</span>
          <div class="part-toggles" id="togglesP2"></div>
        </div>
      </div>

      <div class="table-block">
        <div class="table-title">
          <span>PropoziÈ›ia 1</span>
          <span class="page-indicator" id="pageInfo"></span>
        </div>

        <div class="table-horizontal" id="tableP1"></div>

        <div class="mode-row builder-enable-p2">
          <label>
            <input type="checkbox" id="enableP2" />
            ActiveazÄƒ PropoziÈ›ia 2 (fraza)
          </label>
        </div>

        <div class="table-title hidden" id="titleP2">
          <span>PropoziÈ›ia 2 (continuare / frazÄƒ)</span>
        </div>
        <div class="table-horizontal hidden" id="tableP2"></div>

        <div class="controls">
          <div class="btn-group">
            <button id="prevBtn" type="button">â¬… Prev (rÃ¢nd model)</button>
            <button id="nextBtn" type="button">Next â¡</button>
          </div>
          <button class="secondary" id="resetBtn" type="button">Reset pÄƒrÈ›i de propoziÈ›ie</button>
        </div>

        <!-- ===== Build & Extend (toggle Ã®n Builder) ===== -->
        <div class="mode-row" id="beRow">
          <span class="section-label">Mod Builder</span>
          <div class="be-toggle">
            <button class="secondary small-mode-btn active" id="beFreeBtn" type="button">Free Build</button>
            <button class="secondary small-mode-btn" id="beGuidedBtn" type="button">Build & Extend</button>
          </div>
        </div>

        <div class="mode-row hidden" id="beControls">
          <span class="section-label">Set</span>
          <div class="be-controls">
            <select id="beSetSelect"></select>
            <button class="secondary" id="bePrevStep" type="button">â¬…</button>
            <button class="secondary" id="beNextStep" type="button">â¡</button>
          </div>
        </div>

        <div class="mode-row hidden" id="beStepInfo">
          <span class="section-label">Pas</span>
          <div class="be-step-label" id="beStepLabel"></div>
        </div>
        <!-- ===== /Build & Extend ===== -->

        <div class="legend">
          â¤ Tap scurt pe coloanÄƒ = treci la urmÄƒtorul cuvÃ¢nt.<br />
          â¤ Èšine apÄƒsat pe coloanÄƒ = deschizi lista completÄƒ (cu traduceri + cÄƒutare).<br />
          â¤ â­ la CONJUGÄ‚RI = gramaticÄƒ de legÄƒturÄƒ (cere propoziÈ›ia 2).<br />
          â¤ Sistem de <b>conjugare realÄƒ</b>: verbul se uneÈ™te cu finalul (ex: ê°€ë‹¤ + -ê³  ìˆì–´ìš” â†’ ê°€ê³  ìˆì–´ìš”).
        </div>

        <div class="preview-card">
          <div class="preview-title">
            <span>PropoziÈ›ia / fraza (coreeanÄƒ, cu particule & verb conjugat)</span>
          </div>
          <div class="preview-ko" id="previewKo">(alege cuvinte din tabel)</div>

          <div class="preview-title">
            <span>Traducere aproximativÄƒ (romÃ¢nÄƒ â€“ natural)</span>
            <button id="toggleRoBtn" class="secondary tiny" type="button">Ascunde traducerea</button>
          </div>
          <div class="preview-ro" id="previewRo"></div>

          <div class="preview-natural" id="naturalHint"></div>

          <div class="preview-buttons">
            <button id="randomBtn" type="button">ğŸ² Random propoziÈ›ie</button>
            <button id="speakBtn" type="button">ğŸ”Š Audio coreeanÄƒ</button>
            <button id="favBtn" class="secondary" type="button">â­ SalveazÄƒ propoziÈ›ia</button>
          </div>
        </div>

        <!-- RO/EN input + confirmare KO din input -->
        <div class="card" id="roEnCard">
          <div class="card-title">RomÃ¢nÄƒ / English</div>

          <textarea id="roInput" rows="3" placeholder="Scrie aici (RO/EN) â€“ poÈ›i scrie mai multe propoziÈ›ii."></textarea>

          <div class="row">
            <button id="roTranslateBtn" type="button">CompleteazÄƒ tabelul</button>
            <button id="roClearBtn" class="secondary" type="button">CurÄƒÈ›Äƒ</button>
          </div>

          <div class="small-label">KO generat (confirmare)</div>
          <div id="roToKoResult" class="big-ko"></div>

          <div class="small-label" style="margin-top:8px;">Text corectat</div>
          <div id="roCorrected" class="big-ko"></div>
        </div>
      </div>
    </section>

    <!-- SCREEN 2: EXERCIÈšII TOPIK -->
    <section class="screen" id="screen-exercises">
      <div class="card ex-card">
        <div class="ex-header-row">
          <div>
            <div class="ex-pill">TOPIK trainer</div>
            <h2>ExerciÈ›ii TOPIK â€“ propoziÈ›ii</h2>
          </div>
          <div class="ex-mini-hint">AntreneazÄƒ: verbe Â· particule Â· conjugÄƒri</div>
        </div>

        <div class="ex-type-row">
          <div class="ex-type-left">
            <span class="small-label">Tip exerciÈ›iu</span>
            <span class="ex-type-chip" id="exerciseTypeLabel">â€”</span>
          </div>
          <select id="exerciseType">
            <option value="verb">Alege VERBUL corect</option>
            <option value="particle">Alege PARTICULA corectÄƒ (simplu)</option>
            <option value="particlePlus">Particule multiple (SUBJ/TIME/PLACE/OBJ)</option>
            <option value="conjug">Alege CONJUGAREA corectÄƒ</option>
            <option value="puzzle">ğŸ§© Puzzle â€“ ordoneazÄƒ propoziÈ›ia</option>
          </select>
        </div>

        <div class="ex-question-shell">
          <div class="ex-question-tag-row">
            <span class="ex-question-tag">Ãntrebare curentÄƒ</span>
            <span class="ex-question-subtag" id="exerciseSubtag">â€”</span>
          </div>

          <div class="exercise-question empty" id="exerciseQuestion">
            Alege tipul de exerciÈ›iu È™i apasÄƒ â€Ãntrebare nouÄƒâ€.
          </div>

          <div class="exercise-options" id="exerciseOptions"></div>

          <div class="btn-group ex-buttons">
            <button id="checkAnswerBtn" type="button">VerificÄƒ rÄƒspunsul</button>
            <button class="secondary" id="nextQuestionBtn" type="button">Ãntrebare nouÄƒ</button>
          </div>

          <div class="exercise-feedback" id="exerciseFeedback"></div>
        </div>
      </div>

      <div class="legend ex-legend">
        â¤ PoÈ›i schimba tipul de exerciÈ›iu din box-ul de sus.<br />
        â¤ La â€Particule multipleâ€, toate spaÈ›iile (1)(2)(3)(4) trebuie corecte ca sÄƒ fie âœ….
      </div>
    </section>

    <!-- SCREEN 3: LECÈšII -->
    <section class="screen" id="screen-lessons">
      <div class="card">
        <div class="lesson-header">
          <h2>ğŸ“˜ LecÈ›ia 1 â€” (ìœ¼)ë ¤ê³  í•´ìš”</h2>
          <div class="small-label">IntenÈ›ie / plan apropiat â€“ â€am de gÃ¢nd sÄƒâ€¦â€</div>
        </div>

        <div class="lesson-body">
          <b>â—† Ce Ã®nseamnÄƒ:</b><br />
          â€“ ExprimÄƒ o acÈ›iune pe care ai de gÃ¢nd sÄƒ o faci Ã®n curÃ¢nd.<br />
          â€“ Ãn romÃ¢nÄƒ: â€am de gÃ¢nd sÄƒâ€¦â€, â€mÄƒ pregÄƒtesc sÄƒâ€¦â€.<br /><br />

          <b>â—† Cum se formeazÄƒ:</b>
          <ul>
            <li>ConsoanÄƒ â†’ <b>ìœ¼ë ¤ê³  í•´ìš”</b> (ì½ë‹¤ â†’ ì½ìœ¼ë ¤ê³  í•´ìš”)</li>
            <li>VocalÄƒ â†’ <b>ë ¤ê³  í•´ìš”</b> (ê°€ë‹¤ â†’ ê°€ë ¤ê³  í•´ìš”)</li>
          </ul>

          <button id="lesson1TryBtn" type="button">âœï¸ ÃncearcÄƒ lecÈ›ia Ã®n Builder</button>
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>ğŸ“˜ LecÈ›ia 2 â€” -(ìœ¼)ã„¹ê¹Œìš”?</h2>
          <div class="small-label">Propuneri / invitaÈ›ii / â€sÄƒ â€¦?â€</div>
        </div>
        <div class="lesson-body">
          <button id="lesson2TryBtn" type="button">âœï¸ ÃncearcÄƒ lecÈ›ia 2 Ã®n Builder</button>
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>ğŸ“˜ LecÈ›ia 3 â€” Fraze cu â€sÄƒ ... È™i sÄƒ ...â€</h2>
          <div class="small-label">DouÄƒ acÈ›iuni legate (fraze)</div>
        </div>
        <div class="lesson-body">
          <button id="lesson3TryBtn" type="button">âœï¸ ÃncearcÄƒ lecÈ›ia 3 Ã®n Builder</button>
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>ğŸ“˜ LecÈ›ia 4 â€” Rutine zilnice</h2>
          <div class="small-label">Prezent politicos pentru obiceiuri</div>
        </div>
        <div class="lesson-body">
          <button id="lesson4TryBtn" type="button">âœï¸ ÃncearcÄƒ lecÈ›ia 4 Ã®n Builder</button>
        </div>
      </div>

      <div class="card">
        <div class="lesson-header">
          <h2>ğŸ“˜ LecÈ›ia 5 â€” Stare & obosealÄƒ</h2>
          <div class="small-label">â€Lucrez mult È™i sunt obositÄƒ.â€</div>
        </div>
        <div class="lesson-body">
          <button id="lesson5TryBtn" type="button">âœï¸ ÃncearcÄƒ lecÈ›ia 5 Ã®n Builder</button>
        </div>
      </div>
    </section>

    <!-- SCREEN 4: GLOSAR + FAVORITE + 3 cuvinte/zi -->
    <section class="screen" id="screen-glossary">
      <div class="card">
        <h2>ğŸ“š Glosar coreeanâ€“romÃ¢n</h2>

        <div class="card inner" style="margin-top:10px;">
          <h2>ğŸ“… 3 cuvinte/zi</h2>
          <div class="small-label" id="dailyDateLabel">Azi</div>
          <div id="dailyWordsBox" class="daily-words"></div>

          <div class="btn-group" style="margin-top:8px;">
            <button class="secondary" id="dailyPrevBtn" type="button">â¬… Ieri</button>
            <button class="secondary" id="dailyNextBtn" type="button">MÃ¢ine â¡</button>
            <button id="dailyMarkBtn" type="button">âœ… Am Ã®nvÄƒÈ›at azi</button>
          </div>

          <div class="small-label" id="dailyProgress" style="margin-top:6px;"></div>
        </div>

        <div class="small-label" style="margin-top:12px;">PropoziÈ›ii favorite:</div>
        <div id="favoritesList" class="fav-list"></div>

        <div class="small-label" style="margin-top:12px;">
          CautÄƒ Ã®n glosar (coreeanÄƒ sau romÃ¢nÄƒ):
        </div>
        <div class="glossary-search">
          <input type="text" id="glossarySearch" placeholder="ex: ê°€ë‹¤ sau a merge" />
        </div>

        <div class="glossary-list" id="glossaryList"></div>
      </div>
    </section>

    <!-- bottom nav -->
    <nav class="bottom-nav">
      <button class="nav-btn active" data-target="builder" type="button">
        <span class="icon">ğŸ—</span><span>Builder</span>
      </button>
      <button class="nav-btn" data-target="exercises" type="button">
        <span class="icon">ğŸ“</span><span>ExerciÈ›ii</span>
      </button>
      <button class="nav-btn" data-target="lessons" type="button">
        <span class="icon">ğŸ“—</span><span>LecÈ›ii</span>
      </button>
      <button class="nav-btn" data-target="glossary" type="button">
        <span class="icon">ğŸ“š</span><span>Glosar</span>
      </button>
    </nav>

    <!-- overlay panel -->
    <div class="overlay hidden" id="overlay" aria-hidden="true">
      <div class="panel" role="dialog" aria-modal="true">
        <div class="panel-header">
          <div>
            <div class="panel-title" id="panelTitle"></div>
            <div class="panel-sub" id="panelSub"></div>
          </div>
          <button class="panel-close" id="closePanelBtn" type="button">âœ•</button>
        </div>

        <div class="panel-input-row">
          <input type="text" id="panelSearchInput" placeholder="CautÄƒ Ã®n listÄƒ (primele litere)..." />
        </div>

        <div class="panel-input-row">
          <input type="text" id="newWordInput" placeholder="CuvÃ¢nt nou (coreeanÄƒ sau numÄƒr)..." />
        </div>

        <div class="panel-input-row">
          <input type="text" id="newWordTransInput" placeholder="Traducere Ã®n romÃ¢nÄƒ (opÈ›ional)" />
          <button id="addWordBtn" class="secondary" type="button">+ Add</button>
        </div>

        <div class="panel-list" id="panelList"></div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
:root{
  --bg: #f7f4ff;
  --card: #ffffff;
  --card2: #faf8ff;
  --text: #1c1c1c;
  --muted: #6b6b6b;
  --border: rgba(20,20,20,.12);

  --accent: #7c5cff;
  --accent-strong: #5b3dff;

  --shadow: 0 10px 25px rgba(0,0,0,.08);
  --radius: 18px;
  --radius2: 12px;
  --maxw: 980px;
}

*{ box-sizing: border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Arial, sans-serif;
  color: var(--text);
  background: radial-gradient(1200px 600px at 20% 0%, #efeaff 0%, rgba(239,234,255,0) 60%),
              radial-gradient(900px 500px at 80% 10%, #e9fff6 0%, rgba(233,255,246,0) 60%),
              var(--bg);
}

.app{
  max-width: var(--maxw);
  margin: 0 auto;
  padding: 16px 12px 90px;
}

.rk-header{
  background: linear-gradient(135deg, rgba(124,92,255,.10), rgba(124,92,255,.04));
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px 14px 10px;
  box-shadow: var(--shadow);
}

.rk-header-main{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.rk-header h1{
  font-size: 20px;
  margin: 0;
}

.rk-badge{
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(124,92,255,.12);
  border: 1px solid rgba(124,92,255,.25);
  color: var(--accent-strong);
  font-weight: 700;
}

#subtitle{
  margin: 8px 0 0;
  color: var(--muted);
  font-size: 13px;
}

.screen{ display:none; margin-top: 12px; }
.screen.active{ display:block; }

.card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
}
.card.inner{
  background: var(--card2);
  box-shadow:none;
}

.card-title{
  font-weight: 800;
  color: var(--accent-strong);
  margin-bottom: 10px;
}

.mode-panel{
  background: rgba(255,255,255,.65);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 10px 12px;
  box-shadow: var(--shadow);
}

.mode-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 6px 0;
  flex-wrap: wrap;
}

.section-label{
  font-size: 12px;
  color: var(--muted);
  font-weight: 700;
}

.part-toggles{
  display:flex;
  flex-wrap:wrap;
  gap: 6px;
  justify-content:flex-end;
}

.chip{
  display:flex;
  align-items:center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(124,92,255,.08);
  border: 1px solid rgba(124,92,255,.20);
  font-size: 12px;
  cursor:pointer;
  user-select:none;
}

.chip input{ accent-color: var(--accent); }
.chip-off{
  opacity:.45;
  filter: grayscale(.2);
}

.table-block{
  margin-top: 12px;
}

.table-title{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 8px 4px 8px;
  color: var(--accent-strong);
  font-weight: 800;
}

.page-indicator{
  font-size: 12px;
  color: var(--muted);
  font-weight: 700;
}

.table-horizontal{
  display:flex;
  gap: 10px;
  overflow-x: auto;
  padding: 10px 6px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: rgba(255,255,255,.75);
  box-shadow: var(--shadow);
}

.hidden{ display:none !important; }

.col{
  min-width: 148px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius2);
  padding: 10px;
  box-shadow: 0 8px 18px rgba(0,0,0,.06);
  position: relative;
}

.col.dimmed{
  opacity:.42;
}

.col-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap: 8px;
  font-weight: 800;
  font-size: 11px;
  color: var(--accent-strong);
  margin-bottom: 8px;
}

.col-toggle{
  width: 16px;
  height: 16px;
  accent-color: var(--accent);
}

.col-body-label{
  font-size: 11px;
  color: var(--muted);
  margin-bottom: 6px;
  font-weight: 700;
}

.col-body-main{
  font-size: 18px;
  font-weight: 900;
  letter-spacing: .2px;
  padding: 6px 8px;
  border-radius: 12px;
  background: rgba(124,92,255,.08);
  border: 1px solid rgba(124,92,255,.12);
}

.col-body-extra{
  font-size: 11px;
  margin-top: 8px;
  color: var(--muted);
  min-height: 14px;
}

.controls{
  display:flex;
  gap: 10px;
  justify-content:space-between;
  align-items:center;
  flex-wrap: wrap;
  margin-top: 10px;
}

.btn-group{
  display:flex;
  gap: 8px;
  flex-wrap: wrap;
}

button{
  border: none;
  background: var(--accent);
  color: white;
  font-weight: 800;
  padding: 10px 12px;
  border-radius: 12px;
  cursor:pointer;
  box-shadow: 0 10px 18px rgba(124,92,255,.22);
}

button:disabled{
  opacity:.45;
  cursor:not-allowed;
  box-shadow:none;
}

button.secondary{
  background: rgba(124,92,255,.10);
  color: var(--accent-strong);
  border: 1px solid rgba(124,92,255,.25);
  box-shadow: none;
}

.small-mode-btn{
  padding: 6px 10px;
  font-size: 12px;
  border-radius: 999px;
}
.small-mode-btn.active{
  background: var(--accent);
  color: white;
  border: none;
}

button.tiny{
  padding: 4px 8px;
  font-size: 11px;
  border-radius: 10px;
}

.legend{
  margin-top: 10px;
  padding: 10px 12px;
  background: rgba(255,255,255,.60);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--muted);
  font-size: 12px;
  line-height: 1.45;
}

.preview-card{
  margin-top: 12px;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: rgba(255,255,255,.80);
  box-shadow: var(--shadow);
}

.preview-title{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  color: var(--accent-strong);
  font-weight: 900;
  font-size: 12px;
  margin-bottom: 8px;
}

.preview-ko{
  font-size: 20px;
  font-weight: 900;
  letter-spacing: .2px;
  padding: 10px 12px;
  border-radius: var(--radius2);
  background: rgba(124,92,255,.10);
  border: 1px solid rgba(124,92,255,.18);
}

.preview-ro{
  margin-top: 8px;
  font-size: 13px;
  color: var(--text);
  padding: 10px 12px;
  border-radius: var(--radius2);
  background: rgba(233,255,246,.55);
  border: 1px solid rgba(0,0,0,.08);
  white-space: pre-wrap;
}

.preview-natural{
  margin-top: 8px;
  color: var(--muted);
  font-size: 12px;
  font-weight: 700;
}

.preview-buttons{
  display:flex;
  gap: 8px;
  margin-top: 10px;
  flex-wrap: wrap;
}

textarea{
  width: 100%;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  font-size: 13px;
  outline: none;
  background: rgba(255,255,255,.85);
}

.row{
  display:flex;
  gap: 8px;
  margin-top: 10px;
  flex-wrap: wrap;
}

.small-label{
  color: var(--muted);
  font-size: 12px;
  font-weight: 700;
}

.big-ko{
  font-size: 16px;
  font-weight: 900;
  padding: 10px 12px;
  border-radius: 12px;
  background: rgba(124,92,255,.08);
  border: 1px solid rgba(124,92,255,.16);
  min-height: 42px;
  white-space: pre-wrap;
}

.bottom-nav{
  position: fixed;
  left: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,.88);
  border-top: 1px solid var(--border);
  backdrop-filter: blur(10px);
  display:flex;
  justify-content: space-around;
  padding: 10px 8px;
}

.nav-btn{
  width: 23%;
  display:flex;
  flex-direction: column;
  gap: 3px;
  align-items:center;
  justify-content:center;
  background: transparent;
  box-shadow: none;
  border-radius: 14px;
  padding: 8px 6px;
  border: 1px solid transparent;
  color: var(--muted);
  font-weight: 900;
}
.nav-btn .icon{ font-size: 16px; }
.nav-btn.active{
  border-color: rgba(124,92,255,.25);
  background: rgba(124,92,255,.10);
  color: var(--accent-strong);
}

/* Overlay panel */
.overlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.22);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 14px;
  z-index: 999;
}
.panel{
  width: min(640px, 96vw);
  max-height: 88vh;
  overflow:auto;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 12px;
}
.panel-header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--border);
}
.panel-title{
  font-weight: 1000;
  color: var(--accent-strong);
}
.panel-sub{
  color: var(--muted);
  font-size: 12px;
  font-weight: 700;
  margin-top: 3px;
}
.panel-close{
  background: rgba(0,0,0,.05);
  color: var(--text);
  box-shadow:none;
  border: 1px solid rgba(0,0,0,.10);
  padding: 8px 10px;
  border-radius: 12px;
}

.panel-input-row{
  display:flex;
  gap: 8px;
  margin-top: 10px;
}

.panel-input-row input{
  width: 100%;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  font-size: 13px;
}

.panel-list{
  margin-top: 10px;
  display:flex;
  flex-direction: column;
  gap: 8px;
}

.panel-item{
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px 12px;
  background: var(--card2);
  display:flex;
  justify-content: space-between;
  align-items:center;
  gap: 10px;
  cursor:pointer;
}
.panel-item-main{
  font-weight: 1000;
  font-size: 16px;
}
.panel-item-extra{
  display:flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content:flex-end;
}
.panel-item-tag{
  font-size: 11px;
  font-weight: 900;
  color: var(--accent-strong);
  background: rgba(124,92,255,.10);
  border: 1px solid rgba(124,92,255,.22);
  padding: 4px 8px;
  border-radius: 999px;
}

/* Exercises */
.ex-card h2{ margin: 6px 0 0; }
.ex-header-row{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items:flex-start;
}
.ex-pill{
  display:inline-block;
  font-size: 11px;
  font-weight: 1000;
  color: var(--accent-strong);
  background: rgba(124,92,255,.10);
  border: 1px solid rgba(124,92,255,.22);
  padding: 4px 8px;
  border-radius: 999px;
}
.ex-mini-hint{
  color: var(--muted);
  font-size: 12px;
  font-weight: 700;
  text-align:right;
}
.ex-type-row{
  margin-top: 10px;
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items:center;
  flex-wrap: wrap;
}
.ex-type-left{
  display:flex;
  flex-direction: column;
  gap: 3px;
}
.ex-type-chip{
  font-weight: 1000;
  color: var(--accent-strong);
}
#exerciseType{
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  background: rgba(255,255,255,.9);
  font-weight: 800;
}

.ex-question-shell{
  margin-top: 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 12px;
  background: rgba(255,255,255,.75);
}

.ex-question-tag-row{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items:center;
  margin-bottom: 8px;
}

.ex-question-tag{
  font-size: 11px;
  font-weight: 1000;
  color: var(--accent-strong);
}
.ex-question-subtag{
  font-size: 11px;
  color: var(--muted);
  font-weight: 800;
}

.exercise-question{
  font-weight: 900;
  font-size: 14px;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(124,92,255,.08);
  border: 1px solid rgba(124,92,255,.18);
  margin-bottom: 10px;
  white-space: pre-wrap;
}
.exercise-question.empty{
  opacity:.7;
}

.exercise-options{
  display:flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 10px;
}

.ex-buttons{
  margin-top: 6px;
}

.exercise-feedback{
  margin-top: 10px;
  white-space: pre-wrap;
  font-weight: 800;
  color: var(--text);
}

.ex-legend{ margin-top: 10px; }

/* Glossary */
.glossary-search input{
  width:100%;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  background: rgba(255,255,255,.9);
}

.glossary-list{
  margin-top: 10px;
  display:flex;
  flex-direction: column;
  gap: 8px;
}

.glossary-item{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items:center;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px 12px;
  background: rgba(255,255,255,.8);
}

.glossary-ko{
  font-weight: 1000;
  font-size: 16px;
}
.glossary-ro{
  font-size: 12px;
  color: var(--muted);
  font-weight: 700;
  margin-top: 2px;
}
.glossary-cat{
  font-size: 11px;
  font-weight: 1000;
  color: var(--accent-strong);
  background: rgba(124,92,255,.10);
  border: 1px solid rgba(124,92,255,.22);
  padding: 4px 8px;
  border-radius: 999px;
  white-space: nowrap;
}

.fav-list{
  margin-top: 6px;
  display:flex;
  flex-direction: column;
  gap: 8px;
}
.fav-item{
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 10px 12px;
  background: rgba(255,255,255,.8);
}
.fav-ko{ font-weight: 1000; font-size: 16px; }
.fav-ro{ color: var(--muted); font-weight: 700; font-size: 12px; margin-top: 3px; }

.daily-words{
  display:flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 8px;
}

/* Lessons */
.lesson-header h2{ margin: 0; }
.lesson-body{
  margin-top: 10px;
  font-size: 13px;
  line-height: 1.6;
}
.lesson-body ul{ margin: 8px 0 10px; padding-left: 18px; }

.be-controls{
  display:flex;
  gap: 8px;
  align-items:center;
}
.be-controls select{
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  background: rgba(255,255,255,.9);
  font-weight: 800;
}
.be-step-label{
  font-weight: 1000;
  color: var(--accent-strong);
}

/* Readonly UI hint */
.be-readonly .col{
  outline: 2px dashed rgba(124,92,255,.22);
}
<script src=/* =========================================================
   Raluca Korean â€” Study App v2.0
   app.data.js  (DATA + translations + custom words storage)
   ========================================================= */

window.RK = window.RK || {};
RK.LAST_RO_SENTENCE = "";

/* === LISTE DE CUVINTE (de bazÄƒ) === */
RK.subjects = [
  "ì €","ë‚˜","ë„ˆ","ìš°ë¦¬","ë„ˆí¬","ì‚¬ëŒ","í•™ìƒ","ì„ ìƒë‹˜","ì§ì›","ì „ë¬¸ê°€","ì§€ì›ì","ê´€ë¦¬ì",
  "ë¶€ëª¨ë‹˜","ì•„ì´","ì–´ë¥¸","ì‹œë¯¼","ê³ ê°","ì˜ì‚¬","ê°„í˜¸ì‚¬","ì—°êµ¬ì","ê´€ê³„ì","ëŒ€í‘œ","íšŒì¥",
  "ì‚¬ìš©ì","ì°¸ê°€ì","ìš´ì „ì","ì£¼ë¯¼","í™˜ì"
];

RK.times = [
  "ì˜¤ëŠ˜","ì–´ì œ","ë‚´ì¼","ì§€ê¸ˆ","ë°©ê¸ˆ","ì¡°ê¸ˆ í›„ì—","ê³§","ìµœê·¼ì—","ìš”ì¦˜","ë§ˆì¹¨ë‚´","ê²°êµ­",
  "ì´ì „ì—","ì´í›„ì—","ë‹¹ì‹œì—","í•œë™ì•ˆ","ê³„ì†","ê°€ë”","í•­ìƒ","ìì£¼","ì ì ","ì°¨ì¸°","ì¼ì°","ëŠ¦ê²Œ"
];

RK.places = [
  "ì§‘","í•™êµ","íšŒì‚¬","ì‹ë‹¹","ì¹´í˜","ë„ì„œê´€","ë³‘ì›","ì‹œì¥","ë°±í™”ì ","ê³µí•­","ê¸°ì°¨ì—­",
  "ë²„ìŠ¤ì •ë¥˜ì¥","ì—°êµ¬ì†Œ","ê¸°ê´€","ì§€ì—­ì‚¬íšŒ","í™˜ê²½","ëŒ€ê¸°ì—…","íšŒì˜ì‹¤","ë²•ì›","ê²½ì°°ì„œ",
  "í•´ë³€","ì‚°","ê³µì›","ì€í–‰"
];

RK.mods = [
  "ì˜","ì—´ì‹¬íˆ","ì¡°ìš©íˆ","ì²œì²œíˆ","ë¹¨ë¦¬","ì •ë§","ì•„ì£¼","ë„ˆë¬´","ë§ì´","ì¡°ê¸ˆ","ê°‘ìê¸°","ë¯¸ë¦¬",
  "ë²Œì¨","ì•„ê¹Œ","ë°©ê¸ˆ","ê¸ˆë°©","ê³§","í•­ìƒ","ìì£¼","ê°€ë”","ë“œë¬¼ê²Œ","ìƒë‹¹íˆ","ê½¤","ë„ëŒ€ì²´","ì ˆëŒ€ë¡œ",
  "ì ê·¹ì ìœ¼ë¡œ","ì¶©ë¶„íˆ","íŠ¹íˆ","ì˜¤íˆë ¤","ì ì ","ì°¨ì¸°","ê³„ì†"
];

RK.objects = [
  "ì±…","ì»¤í”¼","ë¬¼","ìŒì‹","ì˜í™”","ê°€ë°©","ì „í™”","ì˜·","ìë£Œ","ë°ì´í„°","ê³„íš","ì¡°ê±´","ìƒí™©","ë¬¸ì œ",
  "í•´ê²°ì±…","ìš”ì•½","ë³´ê³ ì„œ","ë¬¸ì„œ","ì»´í“¨í„°","ë…¸íŠ¸ë¶","í¸ì§€","ì„ ë¬¼","ì˜ê²¬","ì •ë³´","ê´€ê³„","ê²°ê³¼",
  "ì›ì¸","ë°©ë²•","ì œí’ˆ","ì„œë¹„ìŠ¤","ì •ì±…","ë¬¸í™”","ì±„ì†Œ","ê²¬ê³¼ë¥˜"
];

RK.numerals = new Array(60).fill("");

RK.counters = [
  "ê°œ","ëª…","ê¶Œ","ì¥","ëŒ€","ë³‘","ì”","ë§ˆë¦¬","ë²ˆ","ì‚´","ì†¡ì´","ì¤„","ì ","ê±´","íšŒ","ê°€ì§€","ìª½"
];

RK.verbs = [
  "ê°€ë‹¤","ì˜¤ë‹¤","ë¨¹ë‹¤","ë§ˆì‹œë‹¤","ë³´ë‹¤","ì½ë‹¤","ì“°ë‹¤","ë°°ìš°ë‹¤","ì‚¬ë‹¤","ì£¼ë‹¤","ë°›ë‹¤","ì¼í•˜ë‹¤",
  "ê³µë¶€í•˜ë‹¤","ìš”ë¦¬í•˜ë‹¤","ì²­ì†Œí•˜ë‹¤","ì¤€ë¹„í•˜ë‹¤","ë„ì™€ì£¼ë‹¤","ì‚¬ìš©í•˜ë‹¤","í•„ìš”í•˜ë‹¤","ì¢‹ì•„í•˜ë‹¤",
  "ì‹«ì–´í•˜ë‹¤","ê¸°ë‹¤ë¦¬ë‹¤","ì‰¬ë‹¤","ë§Œë‚˜ë‹¤","ê±·ë‹¤","ë‹¬ë¦¬ë‹¤","ì•‰ë‹¤","ì„œë‹¤","ê²°ì •í•˜ë‹¤","ì œì•ˆí•˜ë‹¤",
  "ì „ë‹¬í•˜ë‹¤","ìœ ì§€í•˜ë‹¤","ë°œìƒí•˜ë‹¤","ì¦ê°€í•˜ë‹¤","ê°ì†Œí•˜ë‹¤","ì¸ì •í•˜ë‹¤","ë¶„ì„í•˜ë‹¤","ê´€ì°°í•˜ë‹¤",
  "í•´ê²°í•˜ë‹¤","ì—°êµ¬í•˜ë‹¤","í˜‘ë ¥í•˜ë‹¤","ìš”ì²­í•˜ë‹¤","ì¶©ì¡±í•˜ë‹¤","ë¹„êµí•˜ë‹¤","ì„¤ëª…í•˜ë‹¤","ì˜ˆìƒí•˜ë‹¤"
];

RK.conjugations = [
  "-ì•„ìš”/ì–´ìš”","-ì•˜ì–´ìš”/ì—ˆì–´ìš”","-ê³  ìˆì–´ìš”","-ê³  ì‹¶ì–´ìš”","-(ìœ¼)ì„¸ìš”","-(ìœ¼)ã„¹ ê±°ì˜ˆìš”",
  "-ê³ ","-ì§€ ë§ˆì„¸ìš”","-ì•„/ì–´ ì£¼ì„¸ìš”","-ì•„/ì–´ì•¼ ë¼ìš”","-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”","-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”",
  "-ë”ë¼ê³ ìš”","-ë„¤ìš”","-êµ°ìš”","-ê³  ë‚˜ì„œ","-ê¸° ì „ì—","-(ìœ¼)ë©´ì„œ","-(ìœ¼)ë©°",
  "-(ìœ¼)ã„¹ì§€ë„ ëª°ë¼ìš”","-(ìœ¼)ã„¹ê²Œìš”","-(ìœ¼)ã„¹ë˜ìš”?","-(ìœ¼)ã„¹ê¹Œìš”?","-ëŠ” ê²Œ ì–´ë•Œìš”?",
  "-ëŠ” ì¤‘ì´ì—ìš”","-ì•„/ì–´ë„ ë¼ìš”","-(ìœ¼)ë©´ ì•ˆ ë¼ìš”","-(ìœ¼)ë‚˜","-(ìœ¼)ë¯€ë¡œ","-(ìœ¼)ã„´/ëŠ” ë§Œí¼",
  "-(ìœ¼)ã„¹ìˆ˜ë¡","-(ìœ¼)ã„´/ëŠ”ë°ë„","-(ìœ¼)ã„¹ì§€ë¼ë„","-(ìœ¼)ã„´/ëŠ” ë°˜ë©´ì—","-ë„ë¡ í•˜ë‹¤",
  "-ê²Œ ë˜ë‹¤","-ì•„/ì–´ì§€ë‹¤","-ê¸° ë§ˆë ¨ì´ë‹¤","-ê¸°ì—","-ê¸¸ë˜","-ê³  ë§ë‹¤","-ê³ ì í•˜ë‹¤","-(ìœ¼)ã„¹ ë¿ì´ë‹¤"
];

/* === TRADUCERI (coreeanÄƒ â†’ romÃ¢nÄƒ) === */
RK.translations = {
  subject:{ "ì €":"eu (formal)","ë‚˜":"eu (informal)","ë„ˆ":"tu","ìš°ë¦¬":"noi","ë„ˆí¬":"voi",
    "ì‚¬ëŒ":"persoanÄƒ","í•™ìƒ":"student/Äƒ","ì„ ìƒë‹˜":"profesor","ì§ì›":"angajat",
    "ë¶€ëª¨ë‹˜":"pÄƒrinÈ›i","ì•„ì´":"copil","ì–´ë¥¸":"adult","ê³ ê°":"client","ì˜ì‚¬":"medic",
    "ê°„í˜¸ì‚¬":"asistentÄƒ","ì—°êµ¬ì":"cercetÄƒtor","ëŒ€í‘œ":"reprezentant","í™˜ì":"pacient"
  },
  time:{ "ì˜¤ëŠ˜":"astÄƒzi","ì–´ì œ":"ieri","ë‚´ì¼":"mÃ¢ine","ì§€ê¸ˆ":"acum","ë°©ê¸ˆ":"tocmai acum",
    "ì¡°ê¸ˆ í›„ì—":"puÈ›in mai tÃ¢rziu","ê³§":"Ã®n curÃ¢nd","ìµœê·¼ì—":"recent","ìš”ì¦˜":"Ã®n ultima vreme",
    "ë§ˆì¹¨ë‚´":"Ã®n cele din urmÄƒ","ê²°êµ­":"pÃ¢nÄƒ la urmÄƒ","ì´ì „ì—":"Ã®nainte","ì´í›„ì—":"dupÄƒ",
    "ë‹¹ì‹œì—":"atunci","í•œë™ì•ˆ":"o perioadÄƒ","ê³„ì†":"continuÄƒ","ê°€ë”":"din cÃ¢nd Ã®n cÃ¢nd",
    "í•­ìƒ":"Ã®ntotdeauna","ìì£¼":"des","ì ì ":"din ce Ã®n ce","ì°¨ì¸°":"treptat",
    "ì¼ì°":"devreme","ëŠ¦ê²Œ":"tÃ¢rziu"
  },
  place:{ "ì§‘":"acasÄƒ","í•™êµ":"È™coalÄƒ","íšŒì‚¬":"firmÄƒ / companie","ì‹ë‹¹":"restaurant","ì¹´í˜":"cafenea",
    "ë„ì„œê´€":"bibliotecÄƒ","ë³‘ì›":"spital","ì‹œì¥":"piaÈ›Äƒ","ë°±í™”ì ":"magazin universal",
    "ê³µí•­":"aeroport","ê¸°ì°¨ì—­":"garÄƒ","ë²„ìŠ¤ì •ë¥˜ì¥":"staÈ›ie de autobuz","ì—°êµ¬ì†Œ":"laborator",
    "ê¸°ê´€":"instituÈ›ie","ì§€ì—­ì‚¬íšŒ":"comunitate","í™˜ê²½":"mediu","ëŒ€ê¸°ì—…":"corporaÈ›ie mare",
    "íšŒì˜ì‹¤":"salÄƒ de È™edinÈ›e","ë²•ì›":"instanÈ›Äƒ","ê²½ì°°ì„œ":"secÈ›ie de poliÈ›ie",
    "í•´ë³€":"plajÄƒ","ì‚°":"munte","ê³µì›":"parc","ì€í–‰":"bancÄƒ"
  },
  mod:{ "ì˜":"bine","ì—´ì‹¬íˆ":"cu sÃ¢rguinÈ›Äƒ","ì¡°ìš©íˆ":"Ã®n liniÈ™te","ì²œì²œíˆ":"Ã®ncet",
    "ë¹¨ë¦¬":"repede","ì •ë§":"cu adevÄƒrat","ì•„ì£¼":"foarte","ë„ˆë¬´":"prea / foarte",
    "ë§ì´":"mult","ì¡°ê¸ˆ":"puÈ›in","ê°‘ìê¸°":"brusc","ë¯¸ë¦¬":"Ã®n avans","ë²Œì¨":"deja",
    "ì•„ê¹Œ":"mai devreme","ë°©ê¸ˆ":"chiar acum","ê¸ˆë°©":"imediat","ê³§":"Ã®n curÃ¢nd",
    "í•­ìƒ":"mereu","ìì£¼":"des","ê°€ë”":"din cÃ¢nd Ã®n cÃ¢nd","ë“œë¬¼ê²Œ":"rar",
    "ìƒë‹¹íˆ":"destul de","ê½¤":"biniÈ™or","ë„ëŒ€ì²´":"(deloc / Ã®n Ã®ntrebÄƒri)",
    "ì ˆëŒ€ë¡œ":"niciodatÄƒ (interdicÈ›ie)","ì ê·¹ì ìœ¼ë¡œ":"activ","ì¶©ë¶„íˆ":"suficient",
    "íŠ¹íˆ":"Ã®n special","ì˜¤íˆë ¤":"mai degrabÄƒ","ì ì ":"din ce Ã®n ce","ì°¨ì¸°":"treptat",
    "ê³„ì†":"Ã®n mod continuu"
  },
  object:{ 
    "ì±…":"carte","ì»¤í”¼":"cafea","ë¬¼":"apÄƒ","ìŒì‹":"mÃ¢ncare","ì˜í™”":"film",
    "ê°€ë°©":"geantÄƒ","ì „í™”":"telefon","ì˜·":"haine","ìë£Œ":"materiale","ë°ì´í„°":"date",
    "ê³„íš":"plan","ì¡°ê±´":"condiÈ›ie","ìƒí™©":"situaÈ›ie","ë¬¸ì œ":"problemÄƒ",
    "í•´ê²°ì±…":"soluÈ›ie","ìš”ì•½":"rezumat","ë³´ê³ ì„œ":"raport","ë¬¸ì„œ":"document",
    "ì»´í“¨í„°":"calculator","ë…¸íŠ¸ë¶":"laptop","í¸ì§€":"scrisoare","ì„ ë¬¼":"cadou",
    "ì˜ê²¬":"opinie","ì •ë³´":"informaÈ›ie","ê´€ê³„":"relaÈ›ie","ê²°ê³¼":"rezultat",
    "ì›ì¸":"cauzÄƒ","ë°©ë²•":"metodÄƒ","ì œí’ˆ":"produs","ì„œë¹„ìŠ¤":"serviciu",
    "ì •ì±…":"politicÄƒ","ë¬¸í™”":"culturÄƒ","ì±„ì†Œ":"legume","ê²¬ê³¼ë¥˜":"alune / nuci"
  },
  numeral:{},
  counter:{ "ê°œ":"bucatÄƒ","ëª…":"persoanÄƒ","ê¶Œ":"volum (carte)","ì¥":"foaie / paginÄƒ",
    "ëŒ€":"aparat / vehicul","ë³‘":"sticlÄƒ","ì”":"canÄƒ / pahar",
    "ë§ˆë¦¬":"animal","ë²ˆ":"datÄƒ","ì‚´":"ani (vÃ¢rstÄƒ)","ì†¡ì´":"buchet / ciorchine",
    "ì¤„":"rÃ¢nd / È™ir","ì ":"punct","ê±´":"caz","íšŒ":"datÄƒ (ocazie)",
    "ê°€ì§€":"fel / tip","ìª½":"paginÄƒ / direcÈ›ie"
  },
  verb:{
    "ê°€ë‹¤":"a merge","ì˜¤ë‹¤":"a veni","ë¨¹ë‹¤":"a mÃ¢nca","ë§ˆì‹œë‹¤":"a bea","ë³´ë‹¤":"a vedea / a se uita",
    "ì½ë‹¤":"a citi","ì“°ë‹¤":"a scrie","ë°°ìš°ë‹¤":"a Ã®nvÄƒÈ›a","ì‚¬ë‹¤":"a cumpÄƒra","ì£¼ë‹¤":"a da",
    "ë°›ë‹¤":"a primi","ì¼í•˜ë‹¤":"a lucra","ê³µë¶€í•˜ë‹¤":"a studia","ìš”ë¦¬í•˜ë‹¤":"a gÄƒti",
    "ì²­ì†Œí•˜ë‹¤":"a face curat","ì¤€ë¹„í•˜ë‹¤":"a pregÄƒti","ë„ì™€ì£¼ë‹¤":"a ajuta",
    "ì‚¬ìš©í•˜ë‹¤":"a folosi","í•„ìš”í•˜ë‹¤":"a fi necesar","ì¢‹ì•„í•˜ë‹¤":"a plÄƒcea",
    "ì‹«ì–´í•˜ë‹¤":"a nu plÄƒcea / a urÃ®","ê¸°ë‹¤ë¦¬ë‹¤":"a aÈ™tepta","ì‰¬ë‹¤":"a se odihni",
    "ë§Œë‚˜ë‹¤":"a se Ã®ntÃ¢lni","ê±·ë‹¤":"a merge pe jos","ë‹¬ë¦¬ë‹¤":"a alerga",
    "ì•‰ë‹¤":"a se aÈ™eza","ì„œë‹¤":"a sta Ã®n picioare","ê²°ì •í•˜ë‹¤":"a decide",
    "ì œì•ˆí•˜ë‹¤":"a propune","ì „ë‹¬í•˜ë‹¤":"a transmite","ìœ ì§€í•˜ë‹¤":"a menÈ›ine",
    "ë°œìƒí•˜ë‹¤":"a se produce","ì¦ê°€í•˜ë‹¤":"a creÈ™te","ê°ì†Œí•˜ë‹¤":"a scÄƒdea",
    "ì¸ì •í•˜ë‹¤":"a recunoaÈ™te","ë¶„ì„í•˜ë‹¤":"a analiza","ê´€ì°°í•˜ë‹¤":"a observa",
    "í•´ê²°í•˜ë‹¤":"a rezolva","ì—°êµ¬í•˜ë‹¤":"a cerceta","í˜‘ë ¥í•˜ë‹¤":"a colabora",
    "ìš”ì²­í•˜ë‹¤":"a solicita","ì¶©ì¡±í•˜ë‹¤":"a satisface","ë¹„êµí•˜ë‹¤":"a compara",
    "ì„¤ëª…í•˜ë‹¤":"a explica","ì˜ˆìƒí•˜ë‹¤":"a anticipa"
  },
  conjug:{
    "-ì•„ìš”/ì–´ìš”":"prezent politicos",
    "-ì•˜ì–´ìš”/ì—ˆì–´ìš”":"trecut politicos",
    "-ê³  ìˆì–´ìš”":"acÈ›iune Ã®n desfÄƒÈ™urare",
    "-ê³  ì‹¶ì–´ìš”":"vreau sÄƒ...",
    "-ê³ ":"È™i",
    "-(ìœ¼)ì„¸ìš”":"imperativ / onorific",
    "-(ìœ¼)ã„¹ ê±°ì˜ˆìš”":"viitor",
    "-ì§€ ë§ˆì„¸ìš”":"nu faceÈ›i..., vÄƒ rog",
    "-ì•„/ì–´ ì£¼ì„¸ìš”":"vÄƒ rog sÄƒ...",
    "-ì•„/ì–´ì•¼ ë¼ìš”":"trebuie sÄƒ...",
    "-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”":"pot sÄƒ...",
    "-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”":"nu pot sÄƒ...",
    "-ë”ë¼ê³ ìš”":"am observat cÄƒ...",
    "-ë„¤ìš”":"exclamativ (observaÈ›ie surprinsÄƒ)",
    "-êµ°ìš”":"exclamativ (constatare)",
    "-ê³  ë‚˜ì„œ":"dupÄƒ ce...",
    "-ê¸° ì „ì—":"Ã®nainte sÄƒ...",
    "-(ìœ¼)ë©´ì„œ":"Ã®n timp ce...",
    "-(ìœ¼)ë©°":"È™i (Ã®n timp ce)",
    "-(ìœ¼)ã„¹ì§€ë„ ëª°ë¼ìš”":"s-ar putea sÄƒ...",
    "-(ìœ¼)ã„¹ê²Œìš”":"voi face (pentru tine)",
    "-(ìœ¼)ã„¹ë˜ìš”?":"ai chef sÄƒ...? / vreau sÄƒ...",
    "-(ìœ¼)ã„¹ê¹Œìš”?":"sÄƒ facem...?",
    "-ëŠ” ê²Œ ì–´ë•Œìš”?":"ce-ar fi sÄƒ...?",
    "-ëŠ” ì¤‘ì´ì—ìš”":"sunt Ã®n mijlocul acÈ›iunii",
    "-ì•„/ì–´ë„ ë¼ìš”":"poÈ›i sÄƒ..., e Ã®n regulÄƒ",
    "-(ìœ¼)ë©´ ì•ˆ ë¼ìš”":"nu ai voie sÄƒ...",
    "-ë„ë¡ í•˜ë‹¤":"sÄƒ faci Ã®n aÈ™a fel Ã®ncÃ¢t sÄƒ...",
    "-ê²Œ ë˜ë‹¤":"ajungi sÄƒ...",
    "-ì•„/ì–´ì§€ë‹¤":"a deveni...",
    "-ê¸°ì—":"pentru cÄƒ..., fiindcÄƒ",
    "-ê¸¸ë˜":"pentru cÄƒ (am vÄƒzut / simÈ›it eu)",
    "-ê³  ë§ë‹¤":"Ã®n cele din urmÄƒ ajunge sÄƒ...",
    "-ê³ ì í•˜ë‹¤":"a intenÈ›iona sÄƒ...",
    "-(ìœ¼)ã„¹ ë¿ì´ë‹¤":"doar..., nimic altceva"
  }
};

/* === SALVARE CUVINTE NOI === */
RK.STORAGE_KEY = "ralucaKoreanCustomWords_v2";
RK.customData = {
  subject:[], time:[], place:[], mod:[], object:[],
  numeral:[], counter:[], verb:[], conjug:[]
};

RK.saveCustomData = function saveCustomData(){
  try { localStorage.setItem(RK.STORAGE_KEY, JSON.stringify(RK.customData)); } catch(e){}
};

RK.loadCustomData = function loadCustomData(){
  try{
    const raw = localStorage.getItem(RK.STORAGE_KEY);
    if(!raw) return;
    const saved = JSON.parse(raw);

    Object.keys(RK.customData).forEach(k=>{
      if(Array.isArray(saved[k])) RK.customData[k] = saved[k];
    });

    const addTo = (key, refArr) => {
      RK.customData[key].forEach(entry=>{
        if(!entry || !entry.word) return;
        const w = entry.word;
        const ro = entry.ro || "";

        if(refArr && !refArr.includes(w)) refArr.push(w);

        if(!RK.translations[key]) RK.translations[key] = {};
        if(ro) RK.translations[key][w] = ro;
      });
    };

    addTo("subject", RK.subjects);
    addTo("time", RK.times);
    addTo("place", RK.places);
    addTo("mod", RK.mods);
    addTo("object", RK.objects);
    addTo("numeral", RK.numerals);
    addTo("counter", RK.counters);
    addTo("verb", RK.verbs);
    addTo("conjug", RK.conjugations);

  } catch(e){}
};

RK.loadCustomData();

/* Reverse map RO->KO construit din translations (se reconstruieÈ™te cÃ¢nd adaugi cuvinte) */
RK.stripDiacritics = function stripDiacritics(s){
  return (s||"")
    .replace(/Äƒ/g,"a").replace(/Ã¢/g,"a").replace(/Ã®/g,"i")
    .replace(/È™/g,"s").replace(/ÅŸ/g,"s")
    .replace(/È›/g,"t").replace(/Å£/g,"t");
};

RK.normRo = function normRo(s){
  return RK.stripDiacritics(
    (s||"")
      .toLowerCase()
      .replace(/[.,!?;]/g," ")
  ).replace(/\s+/g," ").trim();
};

RK.buildReverseMap = function buildReverseMap(){
  const rev = { subject:{}, time:{}, place:{}, mod:{}, object:{}, counter:{}, verb:{}, conjug:{} };

  Object.entries(RK.translations).forEach(([cat, map])=>{
    if(!rev[cat]) return;
    Object.entries(map).forEach(([ko, ro])=>{
      if(!ro) return;
      const norm = RK.normRo(ro);
      if(!rev[cat][norm]) rev[cat][norm] = ko;

      // suport pt â€a cumparaâ€ -> â€cumparâ€, â€sa cumparâ€
      if(norm.startsWith("a ")){
        const base = norm.replace(/^a\s+/, "");
        if(base){
          const stem = base.replace(/[aei]$/, "");
          if(stem){
            if(!rev[cat][stem]) rev[cat][stem] = ko;
            const saKey = "sa " + stem;
            if(!rev[cat][saKey]) rev[cat][saKey] = ko;
          }
        }
      }
    });
  });

  return rev;
};

RK.REV = RK.buildReverseMap();


</script>
<script src=/* ===========================
   UI: Overlay panel + tabel
   =========================== */

let panelClause = "p1";
let panelKey = "subject";

function renderPanelList(col){
  if(!panelList) return;
  panelList.innerHTML = "";

  const key = col.key;
  const map = translations[key] || {};
  const filter = (panelSearchInput?.value || "").trim().toLowerCase();

  const words = (col.data || []).filter(w=>{
    if(!w) return false;
    if(!filter) return true;
    return String(w).toLowerCase().startsWith(filter);
  });

  if(!words.length){
    const empty=document.createElement("div");
    empty.className="panel-item";
    empty.textContent="Nu existÄƒ cuvinte pentru filtrul introdus.";
    panelList.appendChild(empty);
    return;
  }

  words.forEach(word=>{
    const item=document.createElement("div");
    item.className="panel-item";

    const main=document.createElement("div");
    main.className="panel-item-main";
    main.textContent=word;
    item.appendChild(main);

    const extra=document.createElement("div");
    extra.className="panel-item-extra";

    const ro = map[word];
    if(ro){
      const tag=document.createElement("div");
      tag.className="panel-item-tag";
      tag.textContent=ro;
      extra.appendChild(tag);
    }

    if(key==="conjug" && typeof isLinkingConj==="function" && isLinkingConj(word)){
      const star=document.createElement("div");
      star.className="panel-item-tag";
      star.textContent="â­ P2";
      extra.appendChild(star);
    }

    item.appendChild(extra);

    item.addEventListener("click",()=>{
      const target = (panelClause==="p1") ? stateP1 : stateP2;
      target[key]=word;

      if(key==="conjug" && typeof isLinkingConj==="function" && isLinkingConj(word)){
        if(enableP2){
          enableP2.checked=true;
          enableP2.dispatchEvent(new Event("change"));
        }
      }

      overlay?.classList.add("hidden");
      render();
    });

    panelList.appendChild(item);
  });
}

function openPanel(clause, key){
  panelClause = clause || "p1";
  panelKey = key || "subject";

  const col = columns.find(c=>c.key===panelKey);
  if(!col) return;

  if(panelTitle) panelTitle.textContent = (panelClause==="p1" ? "PropoziÈ›ia 1 â€“ " : "PropoziÈ›ia 2 â€“ ") + col.title;
  if(panelSub) panelSub.textContent = col.hint || "";

  if(panelSearchInput) panelSearchInput.value="";
  if(newWordInput) newWordInput.value="";
  if(newWordTransInput) newWordTransInput.value="";

  renderPanelList(col);
  overlay?.classList.remove("hidden");
  panelSearchInput?.focus();
}

closePanelBtn?.addEventListener("click",()=>overlay?.classList.add("hidden"));
overlay?.addEventListener("click",e=>{ if(e.target===overlay) overlay.classList.add("hidden"); });

panelSearchInput?.addEventListener("input",()=>{
  const col = columns.find(c=>c.key===panelKey);
  if(col) renderPanelList(col);
});

addWordBtn?.addEventListener("click",()=>{
  const txt = (newWordInput?.value || "").trim();
  if(!txt) return;
  const roTxt = (newWordTransInput?.value || "").trim();

  const col = columns.find(c=>c.key===panelKey);
  if(!col || !col.allowCustom) return;

  if(!col.data.includes(txt)) col.data.push(txt);

  if(!translations[panelKey]) translations[panelKey] = {};
  if(roTxt) translations[panelKey][txt] = roTxt;

  // persist Ã®n customData (dacÄƒ existÄƒ Ã®n 1/3)
  if(typeof customData === "object"){
    if(!customData[panelKey]) customData[panelKey] = [];
    const exists = customData[panelKey].some(e=>e?.word===txt);
    if(!exists) customData[panelKey].push({ word: txt, ro: roTxt });
    else customData[panelKey].forEach(e=>{ if(e.word===txt) e.ro=roTxt; });
  }

  if(typeof saveCustomData==="function") saveCustomData();

  if(newWordInput) newWordInput.value="";
  if(newWordTransInput) newWordTransInput.value="";

  renderPanelList(col);

  // rebuild reverse map (dacÄƒ existÄƒ)
  if(typeof buildReverseMap==="function"){
    REV = buildReverseMap();
  }
});

/* ===========================
   Tap / Long-press pe coloane
   =========================== */

function cycleColumnValue(clause,key){
  const col = columns.find(c=>c.key===key);
  if(!col) return;

  const arr = col.data || [];
  const state = (clause==="p2") ? stateP2 : stateP1;

  const cur = state[key];
  let idx = arr.indexOf(cur);
  if(idx===-1) idx=0;
  const nextIdx = (idx+1) % arr.length;
  state[key] = arr[nextIdx] || "";

  render();
}

let longPressTimer=null, pressTarget=null;

function attachPressHandlers(tableEl){
  if(!tableEl) return;

  tableEl.addEventListener("pointerdown", e => {
    const colDiv = e.target.closest(".col");
    if(!colDiv) return;

    // dacÄƒ ai apÄƒsat pe checkbox-ul din header (col-toggle), nu blocÄƒm
    if(e.target.matches("input.col-toggle")) return;

    e.preventDefault();
    pressTarget = colDiv;

    longPressTimer = setTimeout(()=>{
      if(pressTarget===colDiv){
        openPanel(colDiv.dataset.clause || "p1", colDiv.dataset.key);
        pressTarget=null;
      }
    }, 450);
  });

  tableEl.addEventListener("pointerup", e => {
    const colDiv = e.target.closest(".col");

    if(e.target.matches("input.col-toggle")){
      if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null; }
      pressTarget=null;
      return;
    }

    if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null; }
    if(pressTarget && colDiv===pressTarget){
      cycleColumnValue(colDiv.dataset.clause || "p1", colDiv.dataset.key);
    }
    pressTarget=null;
  });

  tableEl.addEventListener("pointerleave", ()=>{
    if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null; }
    pressTarget=null;
  });
}

/* ===========================
   Chips ON/OFF (sus, pe pÄƒrÈ›i)
   =========================== */

function createToggleChips(){
  if(!togglesP1 || !togglesP2) return;

  togglesP1.innerHTML="";
  togglesP2.innerHTML="";

  columns.forEach(col=>{
    // P1
    const chip1=document.createElement("label");
    chip1.className="chip";
    const cb1=document.createElement("input");
    cb1.type="checkbox";
    cb1.checked=true;
    cb1.dataset.key=col.key;
    cb1.dataset.clause="p1";
    chip1.appendChild(cb1);
    chip1.append(col.title);
    togglesP1.appendChild(chip1);

    // P2
    const chip2=document.createElement("label");
    chip2.className="chip";
    const cb2=document.createElement("input");
    cb2.type="checkbox";
    cb2.checked=true;
    cb2.dataset.key=col.key;
    cb2.dataset.clause="p2";
    chip2.appendChild(cb2);
    chip2.append(col.title);
    togglesP2.appendChild(chip2);
  });

  const sync=(wrapper,map)=>{
    wrapper.querySelectorAll("input[type='checkbox']").forEach(cb=>{
      cb.parentElement.classList.toggle("chip-off", !cb.checked);
    });

    wrapper.addEventListener("change", e=>{
      const cb=e.target;
      if(cb.tagName!=="INPUT") return;
      const key=cb.dataset.key;
      map[key]=cb.checked;
      cb.parentElement.classList.toggle("chip-off", !cb.checked);
      render();
    });
  };

  sync(togglesP1, activeP1);
  sync(togglesP2, activeP2);
}

/* ===========================
   Render coloane (tabel)
   =========================== */

function renderClauseRow(container, activeMap, state, clauseId){
  if(!container) return;
  container.innerHTML = "";

  columns.forEach(col=>{
    if(typeof isColumnVisible==="function" && !isColumnVisible(col.key)) return;

    const colDiv = document.createElement("div");
    colDiv.className = "col";
    colDiv.dataset.key = col.key;
    colDiv.dataset.clause = clauseId;

    if(activeMap[col.key] === false){
      colDiv.classList.add("dimmed");
    }

    const header = document.createElement("div");
    header.className = "col-header";

    const titleSpan=document.createElement("span");
    titleSpan.textContent = col.title + (col.ko ? ` (${col.ko})` : "");
    header.appendChild(titleSpan);

    const toggle=document.createElement("input");
    toggle.type="checkbox";
    toggle.className="col-toggle";
    toggle.checked = activeMap[col.key] !== false;

    toggle.addEventListener("change", ()=>{
      activeMap[col.key] = toggle.checked;
      render();
    });

    header.appendChild(toggle);
    colDiv.appendChild(header);

    const label=document.createElement("div");
    label.className="col-body-label";
    label.textContent = col.hint || "";
    colDiv.appendChild(label);

    const main=document.createElement("div");
    main.className="col-body-main";
    main.textContent = state[col.key] || "";
    colDiv.appendChild(main);

    const extra=document.createElement("div");
    extra.className="col-body-extra";
    if(col.key==="conjug" && state[col.key] && typeof isLinkingConj==="function" && isLinkingConj(state[col.key])){
      extra.textContent="â­ cere propoziÈ›ia 2";
    }
    colDiv.appendChild(extra);

    container.appendChild(colDiv);
  });
}

/* ===========================
   Preview + render principal
   =========================== */

let showRo = true;

function updatePreview(){
  if(!previewKo || !previewRo || !naturalHint) return;

  const c1 = (typeof buildClauseSentence==="function")
    ? buildClauseSentence(stateP1, activeP1, null)
    : { ko:"", roText:"", conj:"" };

  let fullKo = (c1.ko || "").trim();

  let c2 = null;
  const wantP2 = !!(enableP2?.checked);
  const conjIsLink = !!(stateP1?.conjug && typeof isLinkingConj==="function" && isLinkingConj(stateP1.conjug));

  if(wantP2 && conjIsLink){
    c2 = buildClauseSentence(stateP2, activeP2, null);
    if(c2?.ko) fullKo = (fullKo + " " + c2.ko).trim();
  }

  if(!fullKo){
    previewKo.textContent="(alege cuvinte din tabel)";
    previewRo.textContent="";
    naturalHint.textContent="";
    return;
  }

  previewKo.textContent = fullKo;

  const ro1 = (typeof buildNaturalRomanian==="function") ? buildNaturalRomanian(stateP1, activeP1) : "";
  const ro2 = c2 ? ((typeof buildNaturalRomanian==="function") ? buildNaturalRomanian(stateP2, activeP2) : "") : "";
  const fullRo = (ro1 + (ro2 ? " " + ro2 : "")).trim();

  previewRo.textContent = showRo ? fullRo : "Â·Â·Â· traducere ascunsÄƒ Â·Â·Â·";

  if(typeof analyzeNaturalnessP1==="function"){
    const nat = analyzeNaturalnessP1();
    if(nat?.ok){
      naturalHint.textContent="âœ… PropoziÈ›ie naturalÄƒ (dupÄƒ regulile simple din aplicaÈ›ie).";
    }else{
      naturalHint.textContent = `âš  ${nat.msg} ã€Œ${nat.suggestion}ã€`;
    }
  }else{
    naturalHint.textContent="";
  }
}

function loadRow(i){
  columns.forEach(col=>{
    stateP1[col.key] = col.data[i] || "";
  });
}

function render(){
  renderClauseRow(tableP1, activeP1, stateP1, "p1");

  if(enableP2?.checked){
    tableP2?.classList.remove("hidden");
    titleP2?.classList.remove("hidden");
    renderClauseRow(tableP2, activeP2, stateP2, "p2");
  }else{
    tableP2?.classList.add("hidden");
    titleP2?.classList.add("hidden");
  }

  if(pageInfoEl){
    pageInfoEl.textContent = `RÃ¢nd model: ${index+1} / ${maxLen}`;
  }
  if(prevBtn) prevBtn.disabled = index===0;
  if(nextBtn) nextBtn.disabled = index===maxLen-1;

  updatePreview();
}

/* bind controls */
prevBtn?.addEventListener("click",()=>{
  if(index>0){ index--; loadRow(index); render(); }
});
nextBtn?.addEventListener("click",()=>{
  if(index<maxLen-1){ index++; loadRow(index); render(); }
});

resetBtn?.addEventListener("click",()=>{
  togglesP1?.querySelectorAll("input").forEach(cb=>{
    cb.checked=true;
    activeP1[cb.dataset.key]=true;
    cb.parentElement.classList.remove("chip-off");
  });
  togglesP2?.querySelectorAll("input").forEach(cb=>{
    cb.checked=true;
    activeP2[cb.dataset.key]=true;
    cb.parentElement.classList.remove("chip-off");
  });
  render();
});

toggleRoBtn?.addEventListener("click",()=>{
  showRo = !showRo;
  toggleRoBtn.textContent = showRo ? "Ascunde traducerea" : "AratÄƒ traducerea";
  updatePreview();
});

enableP2?.addEventListener("change", ()=>{
  const on = enableP2.checked;
  if(on){
    tableP2?.classList.remove("hidden");
    titleP2?.classList.remove("hidden");
  }else{
    tableP2?.classList.add("hidden");
    titleP2?.classList.add("hidden");
  }
  updatePreview();
});

/* attach press handlers (dupÄƒ ce existÄƒ table) */
attachPressHandlers(tableP1);
attachPressHandlers(tableP2);
/* ===========================
   Mode: Simplu / TOPIK
   =========================== */

let currentMode = "topik";
const simpleColumnsSet = { subject:true, time:true, object:true, verb:true, conjug:true };

function isColumnVisible(key){
  if(currentMode==="topik") return true;
  return !!simpleColumnsSet[key];
}

modeButtons?.forEach(btn=>{
  btn.addEventListener("click",()=>{
    currentMode = btn.dataset.mode || "topik";
    modeButtons.forEach(b=>b.classList.toggle("active", b===btn));
    render();
  });
});

/* ===========================
   Navigare ecrane (bottom nav)
   =========================== */

function setScreen(name){
  Object.entries(screens || {}).forEach(([key, el])=>{
    if(!el) return;
    el.classList.toggle("active", key===name);
    el.style.display = (key===name) ? "block" : "none";
  });

  navButtons?.forEach(btn=>{
    btn.classList.toggle("active", btn.dataset.target===name);
  });
}

navButtons?.forEach(btn=>{
  btn.addEventListener("click", ()=>{
    setScreen(btn.dataset.target);
  });
});

/* ===========================
   RO/EN input â†’ completeazÄƒ builder
   =========================== */

function splitRoIntoClauses(txt){
  if(!txt) return null;
  const re = /\s+(È™i|si|iar|apoi)\s+/i;
  const m  = txt.match(re);
  if(!m) return null;

  const first  = txt.slice(0, m.index).trim();
  const second = txt.slice(m.index + m[0].length).trim();
  if(!first || !second) return null;

  return { first, second };
}

/* detect lang: RO vs EN (simplu) */
function getInputLang(){
  const t = (roInput?.value || "").trim();
  // dacÄƒ are multe cuvinte tipic englezeÈ™ti -> en
  if(/\b(i|you|we|they|he|she|today|tomorrow|yesterday|now|and)\b/i.test(t)) return "en";
  return "ro";
}

function translateInputToKo(){
  const text = (roInput?.value || "").trim();
  const lang = getInputLang();

  let result = { ko:"", roFixed:"" };
  if(!text){
    result = { ko:"", roFixed:"" };
  }else if(lang==="en"){
    result = (typeof translateEnToKo==="function") ? translateEnToKo(text) : { ko:"", roFixed:text };
  }else{
    result = (typeof translateRoToKo==="function") ? translateRoToKo(text) : { ko:"", roFixed:text };
  }

  const roCorrectedEl = document.getElementById("roCorrected");
  if(roCorrectedEl) roCorrectedEl.textContent = result.roFixed || "";
  return result;
}

roTranslateBtn?.addEventListener("click", ()=>{
  const txt = roInput?.value || "";
  LAST_RO_SENTENCE = txt;

  const split = splitRoIntoClauses(txt);

  if(split){
    // P1 (forÈ›Äƒm -ê³ )
    const parsed1 = parseRoToState(split.first);
    Object.assign(stateP1, parsed1.state);
    stateP1.conjug = "-ê³ ";
    activeP1.conjug = true;

    // P2
    const parsed2 = parseRoToState(split.second);
    Object.assign(stateP2, parsed2.state);

    // activeazÄƒ P2
    if(enableP2){
      enableP2.checked = true;
      enableP2.dispatchEvent(new Event("change"));
    }

    render();
  }else{
    const parsed = parseRoToState(txt);
    Object.assign(stateP1, parsed.state);

    if(enableP2){
      enableP2.checked = false;
      enableP2.dispatchEvent(new Event("change"));
    }

    render();
  }

  // KO rezultat (confirmare)
  const res = translateInputToKo();
  const koEl = document.getElementById("roToKoResult");
  if(koEl) koEl.textContent = res.ko || "";
});

/* buton curÄƒÈ›Äƒ */
document.getElementById("roClearBtn")?.addEventListener("click", ()=>{
  if(roInput) roInput.value="";
  document.getElementById("roToKoResult").textContent="";
  document.getElementById("roCorrected").textContent="";
});

/* ===========================
   Random / Audio / Favorite
   =========================== */

randomBtn?.addEventListener("click", ()=>{
  columns.forEach(col=>{
    if(activeP1[col.key]===false) return;
    if(!isColumnVisible(col.key)) return;

    const arr = (col.data || []).filter(x=>x!=="" && x!=null);
    if(!arr.length) return;
    stateP1[col.key] = arr[Math.floor(Math.random()*arr.length)];
  });
  render();
});

speakBtn?.addEventListener("click", ()=>{
  if(!("speechSynthesis" in window)){
    alert("Browserul nu suportÄƒ audio.");
    return;
  }
  const text = (previewKo?.textContent || "").trim();
  if(!text || text.includes("alege cuvinte")) return;

  const u = new SpeechSynthesisUtterance(text);
  u.lang = "ko-KR";

  const voices = window.speechSynthesis.getVoices();
  const koVoices = voices.filter(v => (v.lang || "").toLowerCase().startsWith("ko"));
  if(koVoices.length) u.voice = koVoices[0];

  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
});

/* favorites */
const favorites = [];
function renderFavorites(){
  if(!favoritesListEl) return;
  favoritesListEl.innerHTML = "";

  if(!favorites.length){
    const div=document.createElement("div");
    div.className="small-label";
    div.textContent="Nu ai salvat Ã®ncÄƒ nicio propoziÈ›ie.";
    favoritesListEl.appendChild(div);
    return;
  }

  favorites.forEach(f=>{
    const item=document.createElement("div");
    item.className="fav-item";

    const ko=document.createElement("div");
    ko.className="fav-ko";
    ko.textContent=f.ko;

    const ro=document.createElement("div");
    ro.className="fav-ro";
    ro.textContent=f.ro;

    item.appendChild(ko);
    item.appendChild(ro);
    favoritesListEl.appendChild(item);
  });
}

favBtn?.addEventListener("click", ()=>{
  const ko = (previewKo?.textContent || "").trim();
  let ro = (previewRo?.textContent || "").trim();

  if(!ko || ko.includes("alege cuvinte")) return;
  if(ro.startsWith("Â·Â·Â·")) ro="";

  const exists = favorites.some(f=>f.ko===ko && f.ro===ro);
  if(!exists) favorites.push({ ko, ro });

  renderFavorites();

  if(favBtn){
    favBtn.textContent="â­ Salvat!";
    setTimeout(()=>{ favBtn.textContent="â­ SalveazÄƒ propoziÈ›ia"; }, 800);
  }
});

/* chips init */
createToggleChips();
  </script>
<script src= /* ===========================
   EXERCIÈšII TOPIK
   =========================== */

let currentExercise = null;

function randItem(arr){
  return arr[Math.floor(Math.random()*arr.length)];
}

/* propoziÈ›ie simplÄƒ pt exerciÈ›ii */
function buildSimpleKoreanSentence(parts){
  const out = [];
  if(parts.time) out.push(parts.time);
  if(parts.subject) out.push(parts.subject);
  if(parts.place) out.push(parts.place);
  if(parts.mod) out.push(parts.mod);
  if(parts.object) out.push(parts.object);
  if(parts.verb) out.push(parts.verb);
  return out.join(" ");
}

/* Particle choices */
const particleChoices = ["ì€","ëŠ”","ì´","ê°€","ì„","ë¥¼","ì—","ì—ì„œ"];

/* ========== (1) Verb exercise ========== */
function makeVerbExercise(){
  const subj = randItem(subjects);
  const t = randItem(times);
  const place = randItem(places);
  const obj = randItem(objects);
  const correctVerb = randItem(verbs);

  const sentenceKorean = buildSimpleKoreanSentence({
    time: t, subject: subj, place, object: obj, verb: "___"
  });

  const options = new Set([correctVerb]);
  while(options.size < 4) options.add(randItem(verbs));
  const optionsArr = Array.from(options).sort(()=>Math.random()-0.5);

  currentExercise = { type:"verb", correct: correctVerb, options: optionsArr };

  if(exerciseQuestionEl) exerciseQuestionEl.textContent = `Alege verbul corect:  ${sentenceKorean}`;
  renderExerciseOptions(optionsArr);
  if(exerciseFeedbackEl) exerciseFeedbackEl.textContent = "";
}

/* ========== (2) Particle (simplu) ========== */
function makeParticleExercise(){
  const subj = randItem(subjects);
  const obj  = randItem(objects);
  const verb = randItem(verbs);

  const correct = (typeof pickObjectParticle==="function") ? pickObjectParticle(obj) : "ì„";

  const verbForm = (typeof presentPolite==="function") ? presentPolite(verb) : verb;
  const sentence = `${subj} ${obj} ___ ${verbForm}.`;

  const options = new Set([correct]);
  while(options.size < 4) options.add(randItem(particleChoices));
  const optionsArr = Array.from(options).sort(()=>Math.random()-0.5);

  currentExercise = { type:"particle", correct, options: optionsArr };

  if(exerciseQuestionEl) exerciseQuestionEl.textContent = `Alege particula corectÄƒ:  ${sentence}`;
  renderExerciseOptions(optionsArr);
  if(exerciseFeedbackEl) exerciseFeedbackEl.textContent = "";
}

/* ========== (3) Particle PLUS (4 blanks) ========== */
function makeParticlePlusExercise(){
  const t = randItem(times);
  const subj = randItem(subjects);
  const place = randItem(places);
  const obj = randItem(objects);
  const verb = randItem(verbs);

  const p1 = (typeof pickSubjectParticle==="function") ? pickSubjectParticle(subj) : "ì€";
  const p2 = (typeof pickTimeParticle==="function") ? pickTimeParticle(t) : "";
  const p3 = (typeof pickPlaceParticle==="function") ? pickPlaceParticle(place) : "ì—ì„œ";
  const p4 = (typeof pickObjectParticle==="function") ? pickObjectParticle(obj) : "ì„";

  const verbForm = (typeof presentPolite==="function") ? presentPolite(verb) : verb;

  const sentence = `${t} (2) ${subj} (1) ${place} (3) ${obj} (4) ${verbForm}.`;

  function buildOptions(correct){
    const options = new Set();
    options.add(correct);
    if(correct==="") options.add("(fÄƒrÄƒ)");
    while(options.size < 4) options.add(randItem(particleChoices));
    return Array.from(options).sort(()=>Math.random()-0.5);
  }

  const opts = {
    p1: buildOptions(p1),
    p2: buildOptions(p2),
    p3: buildOptions(p3),
    p4: buildOptions(p4)
  };

  currentExercise = {
    type:"particlePlus",
    correct:{ p1,p2,p3,p4 },
    sentence,
    options: opts
  };

  if(exerciseQuestionEl) exerciseQuestionEl.textContent = `CompleteazÄƒ particulele (TOATE corecte):  ${sentence}`;
  renderParticlePlusOptions(opts);
  if(exerciseFeedbackEl) exerciseFeedbackEl.textContent = "";
}

/* ========== (4) Conjug exercise ========== */
function makeConjugExercise(){
  const verb = randItem(verbs);
  const cj = randItem(conjugations);

  const options = new Set([cj]);
  while(options.size < 4) options.add(randItem(conjugations));
  const optionsArr = Array.from(options).sort(()=>Math.random()-0.5);

  currentExercise = { type:"conjug", correct:cj, verb, options: optionsArr };

  if(exerciseQuestionEl){
    exerciseQuestionEl.textContent = `Alege conjugarea corectÄƒ:  ${verb}  (forma politicosÄƒ / gramaticalÄƒ potrivitÄƒ)`;
  }
  renderExerciseOptions(optionsArr);
  if(exerciseFeedbackEl) exerciseFeedbackEl.textContent = "";
}

/* ========== (5) Puzzle exercise ========== */
function renderPuzzleUI(shuffledTokens){
  if(!exerciseOptionsEl) return;
  exerciseOptionsEl.innerHTML = "";

  const pool = document.createElement("div");
  pool.id="puzzlePool";
  pool.style.display="flex";
  pool.style.flexWrap="wrap";
  pool.style.gap="6px";
  pool.style.marginBottom="8px";

  const answer=document.createElement("div");
  answer.id="puzzleAnswer";
  answer.style.display="flex";
  answer.style.flexWrap="wrap";
  answer.style.gap="6px";
  answer.style.minHeight="36px";
  answer.style.padding="6px";
  answer.style.border="1px dashed var(--border)";
  answer.style.borderRadius="12px";

  shuffledTokens.forEach(tok=>{
    const btn=document.createElement("button");
    btn.type="button";
    btn.className="chip";
    btn.textContent=tok;
    btn.dataset.token=tok;
    btn.style.cursor="pointer";

    btn.addEventListener("click", ()=>{
      if(btn.parentElement===pool) answer.appendChild(btn);
      else pool.appendChild(btn);
    });

    pool.appendChild(btn);
  });

  const hint=document.createElement("div");
  hint.className="small-label";
  hint.textContent="Tap pe cuvinte ca sÄƒ le muÈ›i sus/jos È™i sÄƒ formezi propoziÈ›ia.";

  exerciseOptionsEl.appendChild(pool);
  exerciseOptionsEl.appendChild(answer);
  exerciseOptionsEl.appendChild(hint);
}

function makePuzzleExercise(){
  const clause = buildClauseSentence(stateP1, activeP1, null);
  const ko = (clause.ko || "").trim();

  if(!ko){
    if(exerciseQuestionEl) exerciseQuestionEl.textContent =
      "CreeazÄƒ o propoziÈ›ie Ã®n Builder (SUBIECT + VERB), apoi apasÄƒ â€Ãntrebare nouÄƒâ€.";
    if(exerciseOptionsEl) exerciseOptionsEl.innerHTML="";
    if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="";
    currentExercise=null;
    return;
  }

  const tokens = ko.split(/\s+/).filter(Boolean);
  if(tokens.length < 2){
    if(exerciseQuestionEl) exerciseQuestionEl.textContent =
      "PropoziÈ›ia e prea scurtÄƒ pentru puzzle. AdaugÄƒ 3â€“4 cuvinte Ã®n Builder.";
    if(exerciseOptionsEl) exerciseOptionsEl.innerHTML="";
    if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="";
    currentExercise=null;
    return;
  }

  const shuffled = tokens.slice().sort(()=>Math.random()-0.5);
  const roNat = (typeof buildNaturalRomanian==="function") ? buildNaturalRomanian(stateP1, activeP1) : "";

  currentExercise = { type:"puzzle", correctKo: ko, correctTokens: tokens, shuffled, ro: roNat };

  if(exerciseQuestionEl) exerciseQuestionEl.textContent = "OrdineazÄƒ cuvintele pentru propoziÈ›ia coreeanÄƒ:";
  renderPuzzleUI(shuffled);
  if(exerciseFeedbackEl) exerciseFeedbackEl.textContent =
    "Tip: TIME â†’ SUBJECT â†’ PLACE â†’ OBJECT â†’ VERB.";
}

/* render options (radio) */
function renderExerciseOptions(optionsArr){
  if(!exerciseOptionsEl) return;
  exerciseOptionsEl.innerHTML = "";
  optionsArr.forEach((opt, idx)=>{
    const id = `opt_${idx}_${Date.now()}`;
    const label=document.createElement("label");
    label.style.display="flex";
    label.style.alignItems="center";
    label.style.gap="6px";

    const radio=document.createElement("input");
    radio.type="radio";
    radio.name="exerciseOption";
    radio.value=opt;
    radio.id=id;

    const span=document.createElement("span");
    span.textContent=opt;

    label.appendChild(radio);
    label.appendChild(span);
    exerciseOptionsEl.appendChild(label);
  });
}

function renderParticlePlusOptions(opts){
  if(!exerciseOptionsEl) return;
  exerciseOptionsEl.innerHTML="";

  const makeBlock=(label,name,arr)=>{
    const wrap=document.createElement("div");
    wrap.style.padding="8px";
    wrap.style.border="1px solid var(--border)";
    wrap.style.borderRadius="12px";
    wrap.style.background="#faf8ff";
    wrap.style.marginBottom="6px";

    const title=document.createElement("div");
    title.style.fontWeight="700";
    title.style.fontSize="12px";
    title.style.color="var(--accent-strong)";
    title.textContent=label;
    wrap.appendChild(title);

    arr.forEach((opt,idx)=>{
      const id=`${name}_${idx}_${Date.now()}`;
      const lab=document.createElement("label");
      lab.style.display="flex";
      lab.style.alignItems="center";
      lab.style.gap="6px";
      lab.style.fontSize="13px";
      lab.style.marginTop="4px";

      const radio=document.createElement("input");
      radio.type="radio";
      radio.name=name;
      radio.value=opt;
      radio.id=id;

      const span=document.createElement("span");
      span.textContent=opt;

      lab.appendChild(radio);
      lab.appendChild(span);
      wrap.appendChild(lab);
    });

    return wrap;
  };

  exerciseOptionsEl.appendChild(makeBlock("(1) Particula subiectului","pPlus1",opts.p1));
  exerciseOptionsEl.appendChild(makeBlock("(2) Particula timpului","pPlus2",opts.p2));
  exerciseOptionsEl.appendChild(makeBlock("(3) Particula locului","pPlus3",opts.p3));
  exerciseOptionsEl.appendChild(makeBlock("(4) Particula obiectului","pPlus4",opts.p4));
}

function newExerciseQuestion(){
  const type = exerciseTypeEl?.value || "verb";
  if(type==="verb") makeVerbExercise();
  else if(type==="particle") makeParticleExercise();
  else if(type==="particlePlus") makeParticlePlusExercise();
  else if(type==="conjug" || type==="conjugation") makeConjugExercise();
  else if(type==="puzzle") makePuzzleExercise();
  else makeVerbExercise();
}

function checkExerciseAnswer(){
  if(!currentExercise){
    if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="Mai Ã®ntÃ¢i apasÄƒ â€Ãntrebare nouÄƒâ€.";
    return;
  }

  if(currentExercise.type==="puzzle"){
    const answerBox = exerciseOptionsEl?.querySelector("#puzzleAnswer");
    if(!answerBox){
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="ProblemÄƒ puzzle. ReÃ®ncearcÄƒ.";
      return;
    }
    const chosenTokens = Array.from(answerBox.querySelectorAll("button"))
      .map(btn=>btn.dataset.token || btn.textContent.trim())
      .filter(Boolean);

    if(!chosenTokens.length){
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="MutÄƒ cuvintele sus ca sÄƒ formezi propoziÈ›ia.";
      return;
    }

    const userKo = chosenTokens.join(" ");
    const normalize = s => (s||"").replace(/\s+/g," ").trim();

    if(normalize(userKo) === normalize(currentExercise.correctKo)){
      let msg = "âœ… Corect!\n" + currentExercise.correctKo;
      if(currentExercise.ro) msg += "\nTraducere: " + currentExercise.ro;
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent = msg;
    }else{
      let msg = "âŒ Nu e Ã®ncÄƒ ordinea corectÄƒ.\nCorect:\n" + currentExercise.correctKo;
      if(currentExercise.ro) msg += "\nTraducere: " + currentExercise.ro;
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent = msg;
    }
    return;
  }

  if(currentExercise.type==="particlePlus"){
    const getVal = (name)=>{
      const chosen = Array.from(exerciseOptionsEl.querySelectorAll(`input[name='${name}']`)).find(x=>x.checked);
      return chosen ? chosen.value : null;
    };

    const a1=getVal("pPlus1");
    const a2=getVal("pPlus2");
    const a3=getVal("pPlus3");
    const a4=getVal("pPlus4");

    if(!a1||!a2||!a3||!a4){
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="Alege un rÄƒspuns pentru (1)(2)(3)(4).";
      return;
    }

    const norm = v => (v==="(fÄƒrÄƒ)" ? "" : v);

    const ok1 = norm(a1)===currentExercise.correct.p1;
    const ok2 = norm(a2)===currentExercise.correct.p2;
    const ok3 = norm(a3)===currentExercise.correct.p3;
    const ok4 = norm(a4)===currentExercise.correct.p4;

    if(ok1&&ok2&&ok3&&ok4){
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="âœ… Corect! Toate particulele sunt bune.";
    }else{
      const c=currentExercise.correct;
      const show = x => (x==="" ? "(fÄƒrÄƒ)" : x);
      if(exerciseFeedbackEl) exerciseFeedbackEl.textContent =
        `âŒ Nu e complet corect.\nCorect: (1) ${c.p1} / (2) ${show(c.p2)} / (3) ${c.p3} / (4) ${c.p4}`;
    }
    return;
  }

  const chosen = Array.from(exerciseOptionsEl.querySelectorAll("input[name='exerciseOption']")).find(x=>x.checked);
  if(!chosen){
    if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="Alege un rÄƒspuns.";
    return;
  }

  if(chosen.value === currentExercise.correct){
    if(exerciseFeedbackEl) exerciseFeedbackEl.textContent="âœ… Corect! Bravo!";
  }else{
    if(exerciseFeedbackEl) exerciseFeedbackEl.textContent=`âŒ GreÈ™it. Corect era: ${currentExercise.correct}`;
  }
}

nextQuestionBtn?.addEventListener("click", newExerciseQuestion);
checkAnswerBtn?.addEventListener("click", checkExerciseAnswer);

/* label tip exerciÈ›iu */
function updateExerciseTypeLabel(){
  if(!exerciseTypeEl || !exerciseTypeLabel) return;
  const v = exerciseTypeEl.value;

  if(v==="verb") exerciseTypeLabel.textContent="Verbe (alegi verbul corect)";
  else if(v==="particle") exerciseTypeLabel.textContent="ParticulÄƒ (1 blank)";
  else if(v==="particlePlus") exerciseTypeLabel.textContent="Particule (4 blanks)";
  else if(v==="conjug" || v==="conjugation") exerciseType
  </script>
