<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean ‚Äì Builder Multi-Clause Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg1:#dff3ff;
      --bg2:#ffe9ff;
      --bg3:#f4fffc;
      --bg4:#e8f0ff;

      --accent:#7b5dff;
      --card-bg:#ffffffcc;
      --text-main:#2f343b;
      --text-soft:#7a8088;
      --border:#e1d7c7;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text-main);
      background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
      background-size:380% 380%;
      animation:bgFlow 28s ease-in-out infinite;
    }
    @keyframes bgFlow{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .app{
      max-width:1040px;
      margin:0 auto;
      padding:18px 14px 80px;
    }

    .rk-header{
      position:relative;
      padding:12px 16px 16px;
      border-radius:26px;
      background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
      color:#fff;
      box-shadow:0 18px 45px rgba(77,93,255,0.4);
    }
    .rk-header-main{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .rk-header-main h1{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    .rk-badge{
      font-size:11px;
      font-weight:600;
      padding:4px 9px;
      border-radius:999px;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.4);
    }
    #subtitle{
      margin:8px 0 0;
      font-size:12px;
      opacity:0.95;
    }

    .card{
      margin-top:16px;
      padding:16px 18px 18px;
      border-radius:22px;
      background:var(--card-bg);
      backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 18px 40px rgba(0,0,0,0.12);
    }
    .card h2{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      letter-spacing:0.03em;
    }

    textarea{
      width:100%;
      border-radius:16px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:14px;
      resize:vertical;
      min-height:70px;
      color:var(--text-main);
      background:#fff;
    }
    textarea:focus{
      outline:none;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.9),
        0 0 0 3px rgba(149,120,255,0.5);
      border-color:rgba(149,120,255,0.7);
    }

    .btn-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    button{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:12px;
      font-weight:800;
      cursor:pointer;
      color:#fff;
      background:linear-gradient(135deg,#6b8cff,#9b6bff);
      box-shadow:
        0 10px 24px rgba(108,110,210,0.4),
        0 0 0 1px rgba(255,255,255,0.7) inset;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    button.secondary{
      background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(0,0,0,0.18);
      filter:brightness(1.03);
    }
    button:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
      filter:brightness(0.97);
    }

    .section-title{
      margin-top:18px;
      margin-bottom:6px;
      font-size:13px;
      font-weight:800;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#4b607d;
    }

    .table-block{
      margin-top:10px;
      padding:10px 10px 12px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 14px 30px rgba(0,0,0,0.1);
    }
    .table-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      font-weight:800;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .table-horizontal{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding-bottom:4px;
    }

    .col{
      min-width:110px;
      max-width:150px;
      flex:0 0 auto;
      border-radius:16px;
      padding:7px 7px 9px;
      background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
      border:1px solid #e2d7c8;
      box-shadow:0 10px 22px rgba(95,78,58,0.16);
    }
    .col-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:4px;
      font-size:10px;
      font-weight:900;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#7b5dff;
      border-bottom:1px solid rgba(208,196,255,0.8);
      padding-bottom:2px;
      margin-bottom:3px;
    }
    .col-header::before{
      content:"";
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:16px;
      height:16px;
      border-radius:6px;
      background:#fff;
      font-size:11px;
      box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    .col[data-key="subject"] .col-header::before{content:"üë§";}
    .col[data-key="time"]    .col-header::before{content:"‚è∞";}
    .col[data-key="place"]   .col-header::before{content:"üìç";}
    .col[data-key="mod"]     .col-header::before{content:"‚ú®";}
    .col[data-key="object"]  .col-header::before{content:"üéØ";}
    .col[data-key="numeral"] .col-header::before{content:"#Ô∏è‚É£";}
    .col[data-key="counter"] .col-header::before{content:"üî¢";}
    .col[data-key="verb"]    .col-header::before{content:"üöÄ";}
    .col[data-key="conj"]    .col-header::before{content:"üîó";}

    .col-body-label{
      font-size:10px;
      color:#938777;
      margin-bottom:1px;
    }
    .col-body-main{
      font-size:15px;
      font-weight:900;
      min-height:1.4em;
    }
    .col-body-main[contenteditable="true"]{
      outline:none;
      cursor:text;
    }
    .col-body-main:focus{
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.8),
        0 0 0 2px rgba(149,120,255,0.7);
      border-radius:6px;
    }

    .col-body-extra.example{
      margin-top:2px;
      font-size:10px;
      color:#b09b83;
    }

    .preview-card{
      margin-top:14px;
      padding:12px 14px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 16px 32px rgba(0,0,0,0.12);
    }
    .preview-title{
      font-size:12px;
      font-weight:900;
      color:#4b607d;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .preview-sentence{
      font-size:22px;
      font-weight:900;
      line-height:1.6;
      margin-bottom:4px;
      word-break:keep-all;
    }
    .preview-ro{
      font-size:12px;
      color:var(--text-soft);
    }

    .hint{
      margin-top:6px;
      font-size:11px;
      color:var(--text-soft);
      line-height:1.4;
    }
    code.k{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: rgba(255,255,255,0.7);
      border: 1px solid rgba(0,0,0,0.06);
      padding: 1px 6px;
      border-radius: 999px;
    }

    @media (max-width:600px){
      .rk-header-main h1{font-size:17px;}
      .col{min-width:95px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="rk-header">
      <div class="rk-header-main">
        <h1>RALUCA KOREAN</h1>
        <span class="rk-badge">Builder ‚Äì Multi Clause</span>
      </div>
      <p id="subtitle">
        Split pe conectori multipli + P2/P3/P4‚Ä¶ + endings lipite de verb (infinitiv √Æn tabel).
      </p>
    </header>

    <!-- Input -->
    <section class="card" id="roCard">
      <h2>Rom√¢nƒÉ / English ‚Üí CoreeanƒÉ (auto-fill)</h2>
      <div style="margin-bottom:6px;font-size:11px;color:var(--text-soft);display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <span>Limba propozi»õiei:</span>
        <select id="langSelect" style="padding:2px 8px;border-radius:999px;border:1px solid var(--border);font-size:11px;">
          <option value="ro" selected>Rom√¢nƒÉ</option>
          <option value="en">English</option>
        </select>
      </div>

      <textarea id="inputText" placeholder="Ex: AstƒÉzi merg la cafenea »ôi citesc o carte »ôi beau o cafea.
Today I go to the cafe and read a book and drink a coffee."></textarea>

      <div class="btn-row">
        <button id="autoFillBtn">CompleteazƒÉ automat builder-ul</button>
        <button id="clearBtn" class="secondary">CurƒÉ»õƒÉ tot</button>
      </div>

      <div class="hint">
        Reguli de bazƒÉ:
        <br>‚Ä¢ <b>»ôi / and</b> ‚Üí <code class="k">-Í≥†</code> (lipit de verbul dinainte).
        <br>‚Ä¢ <b>dar / but</b> ‚Üí <code class="k">-ÏßÄÎßå</code>
        <br>‚Ä¢ <b>pentru cƒÉ / because</b> ‚Üí <code class="k">-Ïñ¥ÏÑú</code> (po»õi schimba manual la <code class="k">-ÏïÑÏÑú</code>)
        <br>‚Ä¢ <b>dacƒÉ / if</b> ‚Üí <code class="k">-(Ïúº)Î©¥</code>
        <br>‚Ä¢ <b>c√¢nd / atunci c√¢nd / when</b> ‚Üí <code class="k">-(Ïúº)„Ñπ Îïå</code>
        <br>‚Ä¢ <b>ca sƒÉ / in order to / to</b> ‚Üí <code class="k">-(Ïúº)Î†§Í≥†</code>
      </div>
    </section>

    <h3 class="section-title">Builder (clauze)</h3>
    <div id="clausesHost"></div>

    <!-- Preview -->
    <section class="preview-card">
     <div class="preview-title">
  <span>Propozi»õia finalƒÉ √Æn coreeanƒÉ</span>

  <label style="display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-soft);font-weight:800;">
    <input type="checkbox" id="politeLast" />
    Polite»õe (doar ultima clauzƒÉ)
  </label>
</div>
<script>
(function(){

/* ======================
   A. Normalizare
====================== */
function normalizeText(t){
  return (t||"")
    .toLowerCase()
    .replace(/[.,!?;:]/g," ")
    .replace(/\s+/g," ")
    .trim();
}

/* ======================
   B. CONECTORI ‚Äì UNIC
====================== */
const CONNECTORS = [
  { keys:["atunci c√¢nd","c√¢nd","when"], end:"-(Ïúº)„Ñπ Îïå" },
  { keys:["pentru cƒÉ","pentru ca","because"], end:"-Ïñ¥ÏÑú" },
  { keys:["ca sƒÉ","ca sa","in order to","to"], end:"-(Ïúº)Î†§Í≥†" },
  { keys:["dacƒÉ","daca","if"], end:"-(Ïúº)Î©¥" },
  { keys:["dar","but"], end:"-ÏßÄÎßå" },
  { keys:["»ôi","si","and"], end:"-Í≥†" }
];

/* ======================
   C. SPLIT MULTI ‚Äì UNIC
====================== */
function splitSentence(raw){
  const text = normalizeText(raw);
  if(!text) return { clauses:[], ends:[] };

  let clauses=[text];
  let ends=[];

  CONNECTORS.forEach(c=>{
    const nextClauses=[];
    clauses.forEach(cl=>{
      let found=false;
      c.keys.forEach(k=>{
        const r=new RegExp(`\\s${k}\\s`);
        if(r.test(cl)){
          const p=cl.split(r);
          nextClauses.push(p[0], p[1]);
          ends.push(c.end);
          found=true;
        }
      });
      if(!found) nextClauses.push(cl);
    });
    clauses=nextClauses;
  });

  return {
    clauses: clauses.filter(Boolean),
    ends
  };
}

/* ======================
   D. RO / EN RULES
====================== */
const RO_RULES={
  subject:[{re:/\beu\b/,v:"Ï†Ä"}],
  time:[{re:/astƒÉzi|azi/,v:"Ïò§Îäò"}],
  place:[{re:/cafenea/,v:"Ïπ¥Ìéò"}],
  object:[{re:/cafea/,v:"Ïª§Ìîº"}],
  numeral:[{re:/o\s+/,v:"Ìïú"}],
  counter:[{re:/cafea/,v:"Ïûî"}],
  verb:[
    {re:/merg/,v:"Í∞ÄÎã§"},
    {re:/citesc/,v:"ÏùΩÎã§"},
    {re:/beau/,v:"ÎßàÏãúÎã§"}
  ]
};

const EN_RULES={
  subject:[{re:/\bi\b/,v:"Ï†Ä"}],
  time:[{re:/today/,v:"Ïò§Îäò"}],
  place:[{re:/cafe/,v:"Ïπ¥Ìéò"}],
  object:[{re:/coffee/,v:"Ïª§Ìîº"}],
  numeral:[{re:/a\s+/,v:"Ìïú"}],
  counter:[{re:/coffee/,v:"Ïûî"}],
  verb:[
    {re:/go/,v:"Í∞ÄÎã§"},
    {re:/read/,v:"ÏùΩÎã§"},
    {re:/drink/,v:"ÎßàÏãúÎã§"}
  ]
};

function parseClause(t,lang){
  const R = lang==="en"?EN_RULES:RO_RULES;
  const o={};
  Object.keys(R).forEach(k=>{
    const m=R[k].find(r=>r.re.test(t));
    if(m) o[k]=m.v;
  });
  return o;
}

/* ======================
   E. ENDING ‚Üí VERB
====================== */
function attachEnding(verb,end){
  if(!verb || !end) return verb;
  if(!verb.endsWith("Îã§")) return verb;
  const stem=verb.slice(0,-1);
  if(end==="-(Ïúº)Î©¥") return stem+"Î©¥";
  if(end==="-(Ïúº)Î†§Í≥†") return stem+"Î†§Í≥†";
  if(end==="-(Ïúº)„Ñπ Îïå") return stem+"„Ñπ Îïå";
  return stem+end.replace("-","");
}

/* ======================
   F. UI HELPERS
====================== */
function setCell(id,key,val){
  const el=document.querySelector(`#${id} .col[data-key="${key}"] .col-body-main`);
  if(el) el.textContent=val||"";
}

function getCell(id,key){
  const el=document.querySelector(`#${id} .col[data-key="${key}"] .col-body-main`);
  return el?el.textContent.trim():"";
}

/* ======================
   G. AUTOFILL ‚Äì UNIC
====================== */
function autoFill(){
  const txt=document.getElementById("inputText").value;
  const lang=document.getElementById("langSelect").value;

  const res=splitSentence(txt);
  const n=res.clauses.length;

  const host=document.getElementById("clausesHost");
  host.innerHTML="";

  for(let i=0;i<n;i++){
    host.insertAdjacentHTML("beforeend", clauseHTML(i));
    const slots=parseClause(res.clauses[i],lang);
    Object.keys(slots).forEach(k=>{
      setCell(`tableP${i+1}`,k,slots[k]);
    });
    if(res.ends[i]) setCell(`tableP${i+1}`,"conj",res.ends[i]);
  }

  rebuild();
}

/* ======================
   H. BUILD PREVIEW
====================== */
function rebuild(){
  const blocks=document.querySelectorAll("[id^='tableP']");
  const out=[];
  blocks.forEach((b,i)=>{
    const v=getCell(b.id,"verb");
    const e=getCell(b.id,"conj");
    const s=[
      getCell(b.id,"subject"),
      getCell(b.id,"time"),
      getCell(b.id,"place"),
      getCell(b.id,"object"),
      attachEnding(v,e)
    ].filter(Boolean).join(" ");
    out.push(s);
  });
  document.getElementById("previewSentence").textContent=out.join(" ");
}

/* ======================
   I. TEMPLATE CLAUSE
====================== */
function clauseHTML(i){
  return `
  <section class="table-block">
    <div id="tableP${i+1}" class="table-horizontal">
      ${["subject","time","place","object","verb","conj"]
        .map(k=>`<div class="col" data-key="${k}">
          <div class="col-header">${k}</div>
          <div class="col-body-main" contenteditable></div>
        </div>`).join("")}
    </div>
  </section>`;
}

/* ======================
   INIT
====================== */
document.getElementById("autoFillBtn").onclick=autoFill;
document.addEventListener("input",rebuild);

})();
</script>
</body>
</html>
