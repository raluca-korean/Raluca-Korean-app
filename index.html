<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean â€“ Builder P2 Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ===== Pastel simplu â€“ doar pentru test ===== */
    :root{
      --bg1:#dff3ff;
      --bg2:#ffe9ff;
      --bg3:#f4fffc;
      --bg4:#e8f0ff;

      --accent:#7b5dff;
      --accent-soft:#f6b5ff;
      --card-bg:#ffffffcc;
      --text-main:#2f343b;
      --text-soft:#7a8088;
      --border:#e1d7c7;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text-main);
      background:linear-gradient(120deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
      background-size:380% 380%;
      animation:bgFlow 28s ease-in-out infinite;
    }
    @keyframes bgFlow{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    .app{
      max-width:1040px;
      margin:0 auto;
      padding:18px 14px 80px;
    }

    .rk-header{
      position:relative;
      padding:12px 16px 16px;
      border-radius:26px;
      background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
      color:#fff;
      box-shadow:0 18px 45px rgba(77,93,255,0.4);
    }
    .rk-header-main{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .rk-header-main h1{
      margin:0;
      font-size:20px;
      font-weight:900;
      letter-spacing:0.06em;
      text-transform:uppercase;
    }
    .rk-badge{
      font-size:11px;
      font-weight:600;
      padding:4px 9px;
      border-radius:999px;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.4);
    }
    #subtitle{
      margin:8px 0 0;
      font-size:12px;
    }

    .card{
      margin-top:16px;
      padding:16px 18px 18px;
      border-radius:22px;
      background:var(--card-bg);
      backdrop-filter:blur(16px);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 18px 40px rgba(0,0,0,0.12);
    }
    .card h2{
      margin:0 0 8px;
      font-size:16px;
      font-weight:800;
      letter-spacing:0.03em;
    }

    textarea{
      width:100%;
      border-radius:16px;
      border:1px solid var(--border);
      padding:10px 12px;
      font-size:14px;
      resize:vertical;
      min-height:70px;
      color:var(--text-main);
      background:#fff;
    }
    textarea:focus{
      outline:none;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.9),
        0 0 0 3px rgba(149,120,255,0.5);
      border-color:rgba(149,120,255,0.7);
    }

    .btn-row{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    button{
      border:none;
      border-radius:999px;
      padding:8px 16px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      color:#fff;
      background:linear-gradient(135deg,#6b8cff,#9b6bff);
      box-shadow:
        0 10px 24px rgba(108,110,210,0.4),
        0 0 0 1px rgba(255,255,255,0.7) inset;
      transition:transform .12s ease, box-shadow .12s ease, filter .12s ease;
    }
    button.secondary{
      background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 26px rgba(0,0,0,0.18);
      filter:brightness(1.03);
    }
    button:active{
      transform:translateY(1px) scale(0.98);
      box-shadow:0 6px 16px rgba(0,0,0,0.25);
      filter:brightness(0.97);
    }

    .section-title{
      margin-top:18px;
      margin-bottom:6px;
      font-size:13px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#4b607d;
    }

    .table-block{
      margin-top:6px;
      padding:10px 10px 12px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 14px 30px rgba(0,0,0,0.1);
    }
    .table-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:12px;
      font-weight:700;
      color:var(--text-soft);
      margin-bottom:6px;
    }
    .table-horizontal{
      display:flex;
      gap:8px;
      overflow-x:auto;
      padding-bottom:4px;
    }

    .col{
      min-width:110px;
      max-width:140px;
      flex:0 0 auto;
      border-radius:16px;
      padding:7px 7px 9px;
      background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
      border:1px solid #e2d7c8;
      box-shadow:0 10px 22px rgba(95,78,58,0.16);
    }
    .col-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:4px;
      font-size:10px;
      font-weight:700;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color:#7b5dff;
      border-bottom:1px solid rgba(208,196,255,0.8);
      padding-bottom:2px;
      margin-bottom:3px;
    }
    .col-header::before{
      content:"";
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:16px;
      height:16px;
      border-radius:6px;
      background:#fff;
      font-size:11px;
      box-shadow:0 1px 3px rgba(0,0,0,0.06);
    }
    .col[data-key="subject"] .col-header::before{content:"ğŸ‘¤";}
    .col[data-key="time"]    .col-header::before{content:"â°";}
    .col[data-key="place"]   .col-header::before{content:"ğŸ“";}
    .col[data-key="mod"]     .col-header::before{content:"âœ¨";}
    .col[data-key="object"]  .col-header::before{content:"ğŸ¯";}
    .col[data-key="numeral"] .col-header::before{content:"#ï¸âƒ£";}
    .col[data-key="counter"] .col-header::before{content:"ğŸ”¢";}
    .col[data-key="verb"]    .col-header::before{content:"ğŸš€";}
    .col[data-key="conj"]    .col-header::before{content:"ğŸ”—";}

    .col-body-label{
      font-size:10px;
      color:#938777;
      margin-bottom:1px;
    }
    .col-body-main{
      font-size:15px;
      font-weight:700;
      min-height:1.4em;
    }
    .col-body-main[contenteditable="true"]{
      outline:none;
      cursor:text;
    }
    .col-body-main:focus{
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.8),
        0 0 0 2px rgba(149,120,255,0.7);
      border-radius:6px;
    }

    .col-body-extra.example{
      margin-top:2px;
      font-size:10px;
      color:#b09b83;
    }

    .builder-enable-p2{
      margin-top:6px;
      padding-top:6px;
      border-top:1px dashed var(--border);
      font-size:11px;
      display:flex;
      justify-content:flex-end;
      color:var(--text-soft);
    }
    .builder-enable-p2 label{
      display:flex;
      align-items:center;
      gap:4px;
    }

    .hidden{display:none !important;}

    .preview-card{
      margin-top:14px;
      padding:12px 14px;
      border-radius:20px;
      background:var(--card-bg);
      border:1px solid rgba(255,255,255,0.7);
      box-shadow:0 16px 32px rgba(0,0,0,0.12);
    }
    .preview-title{
      font-size:12px;
      font-weight:700;
      color:#4b607d;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    .preview-sentence{
      font-size:22px;
      font-weight:800;
      line-height:1.6;
      margin-bottom:4px;
    }
    .preview-ro{
      font-size:12px;
      color:var(--text-soft);
    }

    @media (max-width:600px){
      .rk-header-main h1{font-size:17px;}
      .col{min-width:95px;}
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="rk-header">
      <div class="rk-header-main">
        <h1>RALUCA KOREAN</h1>
        <span class="rk-badge">Builder P2 â€“ test</span>
      </div>
      <p id="subtitle">
        Versiune micÄƒ de test pentru PropoziÈ›ia 2, fraze lungi È™i RomÃ¢nÄƒ â†’ CoreeanÄƒ.
      </p>
    </header>

    <!-- RomÃ¢nÄƒ â†’ CoreeanÄƒ (builder automat) -->
    <section class="card" id="roCard">
            <h2>RomÃ¢nÄƒ â†’ CoreeanÄƒ (Builder automat)</h2>
      <p style="font-size:12px;color:var(--text-soft);margin-top:0;margin-bottom:4px;">
        Scrie o propoziÈ›ie simplÄƒ Ã®n romÃ¢nÄƒ sau englezÄƒ (ex:
        <em>AstÄƒzi merg la cafenea È™i beau o cafea. / Today I go to the cafe and drink a coffee.</em>),
        apoi apasÄƒ pe buton.
      </p>
      <div style="margin-bottom:6px;font-size:11px;color:var(--text-soft);display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <span>Limba propoziÈ›iei de mai sus:</span>
        <select id="langSelect" style="padding:2px 6px;border-radius:999px;border:1px solid var(--border);font-size:11px;">
          <option value="ro" selected>RomÃ¢nÄƒ</option>
          <option value="en">English</option>
        </select>
      </div>
      <textarea id="roInput" placeholder="Scrie aici propoziÈ›ia taâ€¦"></textarea>

      <div class="btn-row">
        <button id="autoFillBtn">CompleteazÄƒ automat builder-ul</button>
        <button id="clearBtn" class="secondary">CurÄƒÈ›Äƒ tot</button>
      </div>
    </section>

    <!-- PROPOZIÈšIA 1 -->
    <h3 class="section-title">PropoziÈ›ia 1 â€“ pÄƒrÈ›i de vorbire</h3>
    <section class="table-block">
      <div class="table-title">
        <span>PropoziÈ›ia 1 (clauza principalÄƒ)</span>
        <span style="font-size:11px;color:var(--text-soft);">Se poate edita manual</span>
      </div>

      <div id="tableP1" class="table-horizontal">
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/eaâ€¦</div>
          <div class="col-body-main" contenteditable="true">ì €</div>
        </div>

        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, mÃ¢ineâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasÄƒ, la È™coalÄƒâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, Ã®ncetâ€¦)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carteâ€¦)</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douÄƒ, treiâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">ê°œ, ê¶Œâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
        </div>

        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">ê°€ìš”, ë§ˆì…”ìš”â€¦</div>
          <div class="col-body-main" contenteditable="true">ê°€ìš”</div>
        </div>

        <!-- CONJ / ENDING (P1) -->
        <div class="col" data-key="conj">
          <div class="col-header">CONJ / ENDING</div>
          <div class="col-body-label">conector, terminaÈ›ieâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ê·¸ë¦¬ê³ , ê·¸ë˜ì„œ, ~ê³ , ~ì•„ì„œâ€¦</div>
        </div>
      </div>
    </section>

    <!-- PROPOZIÈšIA 2 â€“ CONTINUARE -->
    <section class="table-block" id="p2Block">
      <div class="table-title">
        <span>PROPOZIÈšIA 2 â€“ CONTINUARE</span>
        <div class="builder-enable-p2">
          <label>
            <input type="checkbox" id="enableP2" checked />
            <span>ActiveazÄƒ PropoziÈ›ia 2 (continuare / frazÄƒ)</span>
          </label>
        </div>
      </div>

      <div id="titleP2">
        <span>PropoziÈ›ia 2 (clauza secundarÄƒ)</span>
      </div>

      <div id="tableP2" class="table-horizontal">
        <!-- SUBJECT -->
        <div class="col" data-key="subject">
          <div class="col-header">SUBJECT</div>
          <div class="col-body-label">eu, tu, el/eaâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ì €, ë‚˜â€¦</div>
        </div>

        <!-- TIME -->
        <div class="col" data-key="time">
          <div class="col-header">TIME</div>
          <div class="col-body-label">azi, mÃ¢ineâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ì§€ê¸ˆ, ì˜¤ëŠ˜â€¦</div>
        </div>

        <!-- PLACE -->
        <div class="col" data-key="place">
          <div class="col-header">PLACE</div>
          <div class="col-body-label">acasÄƒ, la È™coalÄƒâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ì§‘ì—, í•™êµì—â€¦</div>
        </div>

        <!-- MOD -->
        <div class="col" data-key="mod">
          <div class="col-header">MOD</div>
          <div class="col-body-label">cum? (bine, Ã®ncetâ€¦)</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ì²œì²œíˆ, ë¹¨ë¦¬â€¦</div>
        </div>

        <!-- OBJECT -->
        <div class="col" data-key="object">
          <div class="col-header">OBJECT</div>
          <div class="col-body-label">ce? (cafea, carteâ€¦)</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ì±…, ì»¤í”¼â€¦</div>
        </div>

        <!-- NUMERAL -->
        <div class="col" data-key="numeral">
          <div class="col-header">NUMERAL</div>
          <div class="col-body-label">una, douÄƒ, treiâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: í•œ, ë‘, ì„¸â€¦</div>
        </div>

        <!-- COUNTER -->
        <div class="col" data-key="counter">
          <div class="col-header">COUNTER</div>
          <div class="col-body-label">ê°œ, ê¶Œâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ê¶Œ, ê°œâ€¦</div>
        </div>

        <!-- VERB -->
        <div class="col" data-key="verb">
          <div class="col-header">VERB</div>
          <div class="col-body-label">ê°€ìš”, ì™€ìš”â€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ì½ì–´ìš”, ë¨¹ì–´ìš”â€¦</div>
        </div>

        <!-- CONJ / ENDING (P2 â€“ dacÄƒ vrei sÄƒ continui mai departe) -->
        <div class="col" data-key="conj">
          <div class="col-header">CONJ / ENDING</div>
          <div class="col-body-label">conector, terminaÈ›ieâ€¦</div>
          <div class="col-body-main" contenteditable="true"></div>
          <div class="col-body-extra example">ex: ê·¸ë¦¬ê³ , ê·¸ë˜ì„œ, ~ê³ â€¦</div>
        </div>
      </div>
    </section>

    <!-- PREVIEW FINAL â€“ FRAZÄ‚ LUNGÄ‚ -->
    <section class="preview-card">
      <div class="preview-title">
        <span>PropoziÈ›ia finalÄƒ Ã®n coreeanÄƒ (P1 + conector + P2)</span>
      </div>
      <div id="previewSentence" class="preview-sentence">ì € ê°€ìš”</div>
      <div id="previewRo" class="preview-ro">
        (Aici vei vedea propoziÈ›ia finalÄƒ Ã®n coreeanÄƒ, generatÄƒ din sloturi.)
      </div>
    </section>
  </div>
  <script>
(function () {
  // ================================
  // 0. Helper: normalize text (RO + EN)
  // ================================
  function normalizeText(text) {
    if (!text) return "";
    let t = text.toLowerCase();
    // diacritice romÃ¢nÄƒ â€“ nu deranjeazÄƒ engleza
    t = t.replace(/ÅŸ/g, "È™").replace(/Å£/g, "È›");
    // scoatem punctuaÈ›ia
    t = t.replace(/[.,!?;:]/g, " ");
    t = t.replace(/\s+/g, " ").trim();
    return t;
  }

  // ===========================================
  // 1. Split propoziÈ›ia Ã®n P1 + CONJ + P2
  //    funcÈ›ioneazÄƒ pentru "È™i / si / iar / apoi / and"
  // ===========================================
  function splitSentence(raw) {
    const t = (raw || "").replace(/\s+/g, " ").trim();
    if (!t) return { p1: "", conj: "", p2: "" };

    // prinde: [ceva] (È™i|si|iar|apoi|and) [ceva]
    const re = /^(.*?)(\s+(È™i|si|iar|apoi|and)\s+)(.+)$/i;
    const m = t.match(re);

    if (m) {
      return {
        p1: m[1].trim(),
        conj: (m[3] || "").toLowerCase(), // "È™i", "and" etc.
        p2: m[4].trim(),
      };
    }

    // fÄƒrÄƒ conector -> doar P1
    return { p1: t, conj: "", p2: "" };
  }

  // ===========================================
  // 2. Reguli simple RO â†’ sloturi
  // ===========================================
  const RO_RULES = {
    subject: [
      { re: /\beu\s*\(formal\)|eu\s*-\s*formal\b/, value: "ì €" },
      { re: /\beu\s*\(informal\)|eu\s*-\s*informal\b/, value: "ë‚˜" },
      { re: /\beu\b/, value: "ì €" },
      { re: /\btu\b/, value: "ë„ˆ" },
    ],
    time: [
      { re: /\bazi\b|\bastÄƒzi\b/, value: "ì˜¤ëŠ˜" },
      { re: /\bmÃ¢ine\b/, value: "ë‚´ì¼" },
      { re: /\bieri\b/, value: "ì–´ì œ" },
      { re: /\bacum\b/, value: "ì§€ê¸ˆ" },
    ],
    place: [
      { re: /\bacas[Äƒa]\b/, value: "ì§‘" },
      { re: /pia[tÈ›]Äƒ|market\b/, value: "ì‹œì¥" },
      { re: /la\s+È™coal[Äƒa]|la\s+scoala|È™coal[Äƒa]\b|scoala\b/, value: "í•™êµ" },
      {
        re: /la\s+firm[Äƒa]|la\s+serviciu|la\s+companie|firm[Äƒa]\b|serviciu\b|companie\b/,
        value: "íšŒì‚¬",
      },
      { re: /cafenea|cafene[al]/, value: "ì¹´í˜" },
      { re: /magazin|supermarket/, value: "ê°€ê²Œ" },
    ],
    mod: [
      { re: /\bbine\b|frumos\b|ok\b/, value: "ì˜" },
      { re: /Ã®n\s+liniÈ™te|in\s+liniste|liniÈ™te|liniste/, value: "ì¡°ìš©íˆ" },
      { re: /cu\s+sÃ¢rguint[Äƒa]|cu\s+sarguinta|harnic|cu\s+mult\s+efort/, value: "ì—´ì‹¬íˆ" },
      { re: /Ã®ncet|incet/, value: "ì²œì²œíˆ" },
      { re: /repede|rapid/, value: "ë¹¨ë¦¬" },
    ],
    object: [
      { re: /cafea/, value: "ì»¤í”¼" },
      { re: /\bap[Äƒa]\b|ap[Äƒa]\s+mineral[Äƒa]?/, value: "ë¬¼" },
      { re: /carte|c[Äƒa]rÈ›ile|c[Äƒa]rti\b/, value: "ì±…" },
      { re: /m[Äƒa]ncare|pr[Äƒa]nzul|cina|mic\s+dejun/, value: "ìŒì‹" },
      { re: /ceai\b/, value: "ì°¨" },
    ],
    numeral: [
      { re: /\bo\s+carte\b|\bo\s+cafea\b/, value: "í•œ" },
      { re: /\bdou[Äƒa]\s+carÈ›i|\bdou[Äƒa]\s+cafele/, value: "ë‘" },
      { re: /\btrei\s+carÈ›i|\btrei\s+cafele/, value: "ì„¸" },
    ],
    counter: [
      { re: /carte|c[Äƒa]rti\b/, value: "ê¶Œ" },
      { re: /cafea|ap[Äƒa]\b|ceai\b|m[Äƒa]ncare/, value: "ê°œ" },
    ],
    verb: [
      { re: /merg\b|a merge|sÄƒ merg|sa merg/, value: "ê°€ë‹¤" },
      { re: /vin\b|a veni|sÄƒ vin|sa vin/, value: "ì˜¤ë‹¤" },
      { re: /beau\b|a bea|sÄƒ beau|sa beau/, value: "ë§ˆì‹œë‹¤" },
      { re: /m[Ã¢Äƒ]n[Ã¢a]nc\b|m[Ã¢Äƒ]nÃ¢nc|mananc|a m[Ã¢Äƒ]nca/, value: "ë¨¹ë‹¤" },
      { re: /citesc|a citi|sÄƒ citesc|sa citesc/, value: "ì½ë‹¤" },
      { re: /lucrez|a lucra/, value: "ì¼í•˜ë‹¤" },
    ],
  };

  // ===========================================
  // 3. Reguli simple EN â†’ sloturi
  // ===========================================
  const EN_RULES = {
    subject: [
      { re: /\bi\s+(go|am|will|want|read|eat|drink|work)\b/, value: "ì €" },
      { re: /\byou\b/, value: "ë„ˆ" },
    ],
    time: [
      { re: /\btoday\b/, value: "ì˜¤ëŠ˜" },
      { re: /\btomorrow\b/, value: "ë‚´ì¼" },
      { re: /\byesterday\b/, value: "ì–´ì œ" },
      { re: /\bnow\b/, value: "ì§€ê¸ˆ" },
    ],
    place: [
      { re: /\bhome\b|house\b/, value: "ì§‘" },
      { re: /\bmarket\b|mart\b|grocery\b/, value: "ì‹œì¥" },
      { re: /\bschool\b/, value: "í•™êµ" },
      { re: /\bwork\b|company\b|office\b/, value: "íšŒì‚¬" },
      { re: /\bcafe\b|coffee shop\b/, value: "ì¹´í˜" },
      { re: /\bshop\b|store\b/, value: "ê°€ê²Œ" },
    ],
    mod: [
      { re: /\bwell\b|nicely\b|okay\b/, value: "ì˜" },
      { re: /\bquietly\b|silently\b/, value: "ì¡°ìš©íˆ" },
      { re: /\bhard\b|diligently\b/, value: "ì—´ì‹¬íˆ" },
      { re: /\bslowly\b/, value: "ì²œì²œíˆ" },
      { re: /\bfast\b|quickly\b/, value: "ë¹¨ë¦¬" },
    ],
    object: [
      { re: /\bcoffee\b/, value: "ì»¤í”¼" },
      { re: /\bwater\b/, value: "ë¬¼" },
      { re: /\bbook\b|books\b/, value: "ì±…" },
      { re: /\bfood\b|meal\b|lunch\b|dinner\b|breakfast\b/, value: "ìŒì‹" },
      { re: /\btea\b/, value: "ì°¨" },
    ],
    numeral: [
      { re: /\ba\s+book\b|\bone\s+book\b|\ba\s+coffee\b|\bone\s+coffee\b/, value: "í•œ" },
      { re: /\btwo\s+books\b|\btwo\s+coffees\b/, value: "ë‘" },
      { re: /\bthree\s+books\b|\bthree\s+coffees\b/, value: "ì„¸" },
    ],
    counter: [
      { re: /\bbook\b|books\b/, value: "ê¶Œ" },
      { re: /\bcoffee\b|coffees\b|water\b|tea\b|food\b|meal\b/, value: "ê°œ" },
    ],
    verb: [
      { re: /\bgo\b|\bgoing\b/, value: "ê°€ë‹¤" },
      { re: /\bcome\b|\bcoming\b/, value: "ì˜¤ë‹¤" },
      { re: /\bdrink\b|\bdrinking\b/, value: "ë§ˆì‹œë‹¤" },
      { re: /\beat\b|\beating\b/, value: "ë¨¹ë‹¤" },
      { re: /\bread\b|\breading\b/, value: "ì½ë‹¤" },
      { re: /\bwork\b|\bworking\b/, value: "ì¼í•˜ë‹¤" },
    ],
  };

  // ===========================================
  // 4. Helper pentru reguli
  // ===========================================
  function matchSlot(rules, textNorm) {
    if (!rules) return "";
    for (const rule of rules) {
      if (rule.re.test(textNorm)) return rule.value;
    }
    return "";
  }

  function parseRomanianToSlots(text) {
    const t = normalizeText(text);
    if (!t) return {};
    return {
      subject: matchSlot(RO_RULES.subject, t),
      time: matchSlot(RO_RULES.time, t),
      place: matchSlot(RO_RULES.place, t),
      mod: matchSlot(RO_RULES.mod, t),
      object: matchSlot(RO_RULES.object, t),
      numeral: matchSlot(RO_RULES.numeral, t),
      counter: matchSlot(RO_RULES.counter, t),
      verb: matchSlot(RO_RULES.verb, t),
    };
  }

  function parseEnglishToSlots(text) {
    const t = normalizeText(text);
    if (!t) return {};
    return {
      subject: matchSlot(EN_RULES.subject, t),
      time: matchSlot(EN_RULES.time, t),
      place: matchSlot(EN_RULES.place, t),
      mod: matchSlot(EN_RULES.mod, t),
      object: matchSlot(EN_RULES.object, t),
      numeral: matchSlot(EN_RULES.numeral, t),
      counter: matchSlot(EN_RULES.counter, t),
      verb: matchSlot(EN_RULES.verb, t),
    };
  }

  function parseInputToSlots(text, lang) {
    if (lang === "en") return parseEnglishToSlots(text);
    return parseRomanianToSlots(text);
  }

  // ===========================================
  // 5. LucrÄƒm cu tabelele
  // ===========================================
  function applySlotsToTable(tableId, slots) {
    if (!slots) return;
    const table = document.getElementById(tableId);
    if (!table) return;

    ["subject", "time", "place", "mod", "object", "numeral", "counter", "verb"].forEach(
      (key) => {
        const value = slots[key];
        if (!value) return;
        const cell = table.querySelector('.col[data-key="' + key + '"] .col-body-main');
        if (cell) cell.textContent = value;
      }
    );
  }

  function readFromTable(tableId, key) {
    const cell = document.querySelector(
      "#" + tableId + ' .col[data-key="' + key + '"] .col-body-main'
    );
    return cell ? cell.textContent.trim() : "";
  }

  // construieÈ™te o clauzÄƒ KO dintr-un tabel
  function buildClause(tableId, includeEnding) {
    const s = {
      subject: readFromTable(tableId, "subject"),
      time: readFromTable(tableId, "time"),
      place: readFromTable(tableId, "place"),
      mod: readFromTable(tableId, "mod"),
      object: readFromTable(tableId, "object"),
      numeral: readFromTable(tableId, "numeral"),
      counter: readFromTable(tableId, "counter"),
      verb: readFromTable(tableId, "verb"),
    };

    let obj = "";
    if (s.object && s.numeral && s.counter) {
      obj = s.object + " " + s.numeral + " " + s.counter;
    } else if (s.object) {
      obj = s.object;
    }

    let verbText = s.verb;
    let connectorWord = "";

    if (includeEnding) {
      const ending = readFromTable(tableId, "conjug"); // CONJ / ENDING
      if (ending) {
        const e = ending.trim();

        // dacÄƒ aratÄƒ ca terminaÈ›ie de verb (~ê³ , -ê³ , ê³ , ~ì•„ì„œ, ~ì–´ì„œ etc.)
        if (/^[-~]?(ê³ |ì•„ì„œ|ì–´ì„œ)$/.test(e)) {
          const core = e.replace(/^[-~]/, ""); // "ê³ " etc

          if (verbText) {
            // scoatem ë‹¤ sau ìš” dacÄƒ existÄƒ
            if (/ë‹¤$/.test(verbText)) {
              verbText = verbText.replace(/ë‹¤$/, "") + core;
            } else if (/ìš”$/.test(verbText)) {
              verbText = verbText.replace(/ìš”$/, "") + core;
            } else {
              verbText = verbText + core;
            }
          } else {
            connectorWord = core;
          }
        } else {
          // altceva (de ex. "ê·¸ë¦¬ê³ ", "ê·¸ë˜ì„œ") â€“ rÄƒmÃ¢ne ca È™i cuvÃ¢nt Ã®ntre P1 È™i P2
          connectorWord = e;
        }
      }
    }

    const pieces = [s.subject, s.time, s.place, s.mod, obj, verbText].filter(Boolean);
    const clause = pieces.join(" ");

    return {
      clause,
      connectorWord,
      hasAny: pieces.length > 0 || !!connectorWord,
    };
  }
function isStandaloneConnector(x) {
  const t = (x || "").trim();
  return ["ê·¸ë¦¬ê³ ","ê·¸ë˜ì„œ","í•˜ì§€ë§Œ","ë˜","ë˜ëŠ”","ê·¸ë˜ë„","ê·¸ëŸ¬ë©´"].includes(t);
}

function normalizeEnding(x) {
  let t = (x || "").trim();
  // scoate simboluri comune: "-ê³ ", "~ê³ "
  t = t.replace(/^[-~]/, "").trim();
  return t;
}

function verbStemFromInfinitive(v) {
  const t = (v || "").trim();
  if (!t) return "";
  // dacÄƒ e infinitiv coreean, de obicei se terminÄƒ Ã®n "ë‹¤"
  if (t.endsWith("ë‹¤")) return t.slice(0, -1);
  // dacÄƒ e deja conjugat (ex: ê°€ìš”), Ã®l lÄƒsÄƒm ca atare
  return t;
}

function attachEndingToVerb(verb, ending) {
  const e = normalizeEnding(ending);
  if (!e) return verb;

  // conectori separaÈ›i NU se lipesc de verb
  if (isStandaloneConnector(e)) return verb;

  // lipim doar dacÄƒ verbul e infinitiv (se terminÄƒ Ã®n ë‹¤)
  const v = (verb || "").trim();
  if (!v) return "";

  if (v.endsWith("ë‹¤")) {
    // stem fÄƒrÄƒ "ë‹¤"
    const stem = v.slice(0, -1);

    // mic hack util pentru í•˜ë‹¤ + ì–´ì„œ/ì•„ì„œ => í•´ì„œ (ca sÄƒ nu iasÄƒ í•˜ì–´ì„œ)
    if (v === "í•˜ë‹¤" && (e === "ì–´ì„œ" || e === "ì•„ì„œ")) return "í•´ì„œ";
    if (v === "í•˜ë‹¤" && e === "ê³ ") return "í•˜ê³ ";

    return stem + e; // ex: ê°€ + ê³  = ê°€ê³  ; ì½ + ê³  = ì½ê³  ; ê°€ + ì–´ì„œ = ê°€ì–´ì„œ (user alege corect ì–´ì„œ/ì•„ì„œ)
  }

  // dacÄƒ verbul NU e infinitiv, nu Ã®ncercÄƒm sÄƒ lipim (altfel stricÄƒm)
  return v;
}

function buildClause(tableId) {
  const s = {
    subject: readFromTable(tableId, "subject") || "",
    time: readFromTable(tableId, "time") || "",
    place: readFromTable(tableId, "place") || "",
    mod: readFromTable(tableId, "mod") || "",
    object: readFromTable(tableId, "object") || "",
    numeral: readFromTable(tableId, "numeral") || "",
    counter: readFromTable(tableId, "counter") || "",
    verb: readFromTable(tableId, "verb") || "",
   conj: readFromTable(tableId, "conjug") || ""
  };

  let obj = "";
  if (s.object && s.numeral && s.counter) obj = s.object + " " + s.numeral + " " + s.counter;
  else if (s.object) obj = s.object;

  // dacÄƒ Ã®n aceeaÈ™i propoziÈ›ie vrei È™i "ending" lipit de verb (ex: -ì•„ìš”/-ì–´ìš”), Ã®l pui tot Ã®n conj
  const verbOut = attachEndingToVerb(s.verb, s.conj);

  const pieces = [s.subject, s.time, s.place, s.mod, obj, verbOut].filter(Boolean);
  return pieces.join(" ").trim();
}

function rebuildPreview() {
  const enableP2 = document.getElementById("enableP2");
  const useP2 = !!(enableP2 && enableP2.checked);

  // P1 clause
  const p1 = buildClause("tableP1") || "ì € ê°€ìš”";

  // verificÄƒm dacÄƒ P2 are ceva
  const hasAnyP2 =
    readFromTable("tableP2", "subject") ||
    readFromTable("tableP2", "time") ||
    readFromTable("tableP2", "place") ||
    readFromTable("tableP2", "mod") ||
    readFromTable("tableP2", "object") ||
    readFromTable("tableP2", "numeral") ||
    readFromTable("tableP2", "counter") ||
    readFromTable("tableP2", "verb") ||
    readFromTable("tableP2", "conj");

  let finalSentence = p1;

  if (useP2 && hasAnyP2) {
    const p2 = buildClause("tableP2");

    // conectorul ÃNTRE propoziÈ›ii: Ã®l luÄƒm din P1.conj DOAR dacÄƒ e conector separat (ê·¸ë¦¬ê³ /ê·¸ë˜ì„œ etc)
  const p1Conj = normalizeEnding(readFromTable("tableP1", "conjug"));
    const mid = isStandaloneConnector(p1Conj) ? p1Conj : "";

    // DacÄƒ user vrea conector separat, Ã®l punem aici.
    // DacÄƒ user foloseÈ™te -ê³  / -ì•„ì„œ/-ì–´ì„œ, ele sunt deja lipite de verb Ã®n P1 (deci mid rÄƒmÃ¢ne gol).
    finalSentence = (p1 + (mid ? " " + mid : "") + (p2 ? " " + p2 : "")).trim();
  }

  const out = document.getElementById("previewSentence");
  if (out) out.textContent = finalSentence;
}

  // ===========================================
  // 7. Auto-fill din textarea (RO sau EN)
  // ===========================================
  function autoFillFromInput() {
    const input = document.getElementById("roInput");
    const langSelect = document.getElementById("langSelect"); // <select> cu RomÃ¢nÄƒ / English
    if (!input) return;

    const text = input.value || "";
    const lang = langSelect ? langSelect.value : "ro"; // "ro" sau "en"

    const parts = splitSentence(text); // {p1, conj, p2}

    // P1
    const slots1 = parseInputToSlots(parts.p1, lang);
    applySlotsToTable("tableP1", slots1);

    // P2
    const slots2 = parts.p2 ? parseInputToSlots(parts.p2, lang) : null;
    if (slots2) {
      applySlotsToTable("tableP2", slots2);
    } else {
      // dacÄƒ nu avem P2, curÄƒÈ›Äƒm P2
      const table2 = document.getElementById("tableP2");
      if (table2) {
        table2.querySelectorAll(".col-body-main").forEach((el) => {
          el.textContent = "";
        });
      }
    }

    // Conectorul: cÃ¢nd detectÄƒm "È™i/and" punem automat "-ê³ "
    const conjCell = document.querySelector(
      '#tableP1 .col[data-key="conjug"] .col-body-main'
    );
    if (conjCell) {
      if (parts.conj) {
        conjCell.textContent = "-ê³ "; // default: legÄƒm verbele cu -ê³ 
      } else {
        conjCell.textContent = "";
      }
    }

    // bifa P2 ON doar dacÄƒ avem efectiv P2
    const enableP2 = document.getElementById("enableP2");
    const p2Block = document.getElementById("p2Block");
    if (enableP2) {
      enableP2.checked = !!parts.p2;
      if (p2Block) {
        p2Block.style.display = enableP2.checked ? "" : "none";
      }
    }

    rebuildPreview();
  }

  // ===========================================
  // 8. Clear all
  // ===========================================
  function clearAll() {
    const input = document.getElementById("roInput");
    if (input) input.value = "";

    ["tableP1", "tableP2"].forEach((id) => {
      const table = document.getElementById(id);
      if (!table) return;
      table.querySelectorAll(".col-body-main").forEach((el) => {
        el.textContent = "";
      });
    });

    const conjCell = document.querySelector(
      '#tableP1 .col[data-key="conjug"] .col-body-main'
    );
    if (conjCell) conjCell.textContent = "";

    const out = document.getElementById("previewSentence");
    if (out) out.textContent = "ì € ê°€ìš”";
  }

  // ===========================================
  // 9. Init: butoane + bifa P2
  // ===========================================
  window.addEventListener("DOMContentLoaded", function () {
    const autoFillBtn = document.getElementById("autoFillBtn");
    const clearBtn = document.getElementById("clearBtn");
    const enableP2 = document.getElementById("enableP2");
    const p2Block = document.getElementById("p2Block");

    if (autoFillBtn) autoFillBtn.addEventListener("click", autoFillFromInput);
    if (clearBtn) clearBtn.addEventListener("click", clearAll);

    if (enableP2 && p2Block) {
      const sync = () => {
        p2Block.style.display = enableP2.checked ? "" : "none";
        rebuildPreview();
      };
      enableP2.addEventListener("change", sync);
      sync();
    }

    rebuildPreview();
  });
})();
</script>
</body>
</html>
