<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean ‚Äì Study App v1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f3ff;
      --card-bg: #ffffff;
      --accent: #c9b5ff;
      --accent-strong: #9b7cff;
      --text-main: #333333;
      --text-soft: #666666;
      --border: #e0d7ff;
      --dimmed-bg: #f2eefc;
      --overlay-bg: rgba(0, 0, 0, 0.2);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#fdfbff,#f4f0ff);
      color:var(--text-main);display:flex;flex-direction:column;min-height:100vh;
    }
    .app{
      max-width:1000px;margin:0 auto;padding:10px 10px 60px;
      display:flex;flex-direction:column;gap:10px;min-height:100vh;
    }
    header{text-align:center;padding:4px 8px 4px;}
    header h1{font-size:18px;margin:2px 0;font-weight:700;color:var(--accent-strong);}
    header p{margin:0;font-size:11px;color:var(--text-soft);}

    .screen{display:none;flex-direction:column;gap:10px;flex:1;min-height:0;}
    .screen.active{display:flex;}

    .mode-panel{
      background:var(--card-bg);border-radius:12px;border:1px solid var(--border);
      padding:6px 8px;font-size:11px;display:flex;flex-direction:column;gap:4px;
      box-shadow:0 4px 12px rgba(120,96,190,0.08);
    }
    .mode-row{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;
    }
    .mode-row label{font-size:11px;display:flex;align-items:center;gap:4px;}
    .part-toggles{display:flex;flex-wrap:wrap;gap:6px;}
    .chip{
      display:inline-flex;align-items:center;gap:3px;
      padding:3px 8px;border-radius:999px;background:#ede7ff;color:var(--accent-strong);
      font-size:10px;cursor:pointer;
    }
    .chip input{margin:0;}
    .section-label{font-size:11px;font-weight:600;color:var(--accent-strong);margin-top:2px;}

    .table-block{
      background:var(--card-bg);border-radius:14px;padding:8px;
      box-shadow:0 6px 16px rgba(120,96,190,0.12);border:1px solid var(--border);
      display:flex;flex-direction:column;gap:6px;flex:1;min-height:0;
    }
    .table-title{
      font-size:11px;font-weight:600;color:var(--text-soft);
      display:flex;justify-content:space-between;align-items:center;
    }
    .table-horizontal{
      display:flex;flex-direction:row;overflow-x:auto;padding-bottom:4px;gap:6px;
    }
    .col{
      min-width:110px;max-width:140px;flex:0 0 auto;background:#faf8ff;border-radius:10px;
      border:1px solid var(--border);display:flex;flex-direction:column;
      padding:6px 6px 8px;transition:0.2s;cursor:pointer;
    }
    .col-header{
      font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;
      color:var(--accent-strong);margin-bottom:4px;border-bottom:1px solid var(--border);
      padding-bottom:3px;
    }
    .col-body-label{font-size:10px;color:var(--text-soft);margin-bottom:2px;}
    .col-body-main{font-size:15px;font-weight:600;margin-bottom:2px;}
    .col-body-extra{font-size:11px;color:var(--text-soft);}
    .dimmed{
      opacity:0.35;background-image:repeating-linear-gradient(
        -45deg,var(--dimmed-bg),var(--dimmed-bg) 4px,#fdfbff 4px,#fdfbff 8px
      );
    }

    .controls{
      display:flex;justify-content:space-between;align-items:center;gap:8px;
      padding-top:4px;border-top:1px dashed var(--border);
    }
    .btn-group{display:flex;gap:6px;}
    button{
      border-radius:999px;border:none;padding:6px 10px;font-size:12px;font-weight:600;
      cursor:pointer;background:var(--accent);color:#fff;display:inline-flex;
      align-items:center;gap:4px;box-shadow:0 2px 6px rgba(90,70,160,0.25);
    }
    button.secondary{background:#ede7ff;color:var(--accent-strong);box-shadow:none;}
    button:disabled{opacity:0.4;box-shadow:none;cursor:default;}
    .page-indicator{font-size:11px;color:var(--text-soft);}
    .legend{font-size:10px;color:var(--text-soft);text-align:center;padding:2px 4px 0;}
    .hidden{display:none !important;}

    .preview-card{
      margin-top:6px;padding:8px;border-radius:12px;
      background:#f9f7ff;border:1px solid var(--border);
      display:flex;flex-direction:column;gap:4px;
    }
    .preview-title{
      font-size:11px;font-weight:600;color:var(--accent-strong);
      display:flex;justify-content:space-between;align-items:center;
    }
    .preview-ko{
      font-size:14px;font-weight:600;margin-top:2px;
    }
    .preview-ro{
      font-size:12px;color:var(--text-soft);
    }
    .preview-buttons{
      display:flex;gap:6px;margin-top:4px;flex-wrap:wrap;
    }

    .overlay{
      position:fixed;inset:0;background:var(--overlay-bg);
      display:flex;justify-content:center;align-items:flex-end;z-index:1000;
    }
    .panel{
      width:100%;max-width:900px;background:var(--card-bg);
      border-radius:18px 18px 0 0;box-shadow:0 -6px 18px rgba(0,0,0,0.15);
      padding:10px 12px 14px;animation:slideUp 0.18s ease-out;
    }
    @keyframes slideUp{
      from{transform:translateY(40px);opacity:0;}
      to{transform:translateY(0);opacity:1;}
    }
    .panel-header{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;
    }
    .panel-title{font-size:13px;font-weight:600;color:var(--accent-strong);}
    .panel-sub{font-size:11px;color:var(--text-soft);}
    .panel-close{
      background:transparent;color:var(--text-soft);box-shadow:none;
      padding:4px 6px;font-size:14px;
    }
    .panel-input-row{display:flex;gap:6px;margin-bottom:6px;}
    .panel-input-row input{
      flex:1;border-radius:999px;border:1px solid var(--border);
      padding:6px 10px;font-size:12px;
    }
    .panel-list{
      max-height:260px;overflow-y:auto;border-radius:10px;
      border:1px solid var(--border);background:#faf8ff;padding:4px;
    }
    .panel-item{
      padding:4px 8px;border-radius:8px;display:flex;justify-content:space-between;
      align-items:center;font-size:13px;cursor:pointer;
    }
    .panel-item:hover{background:#ede7ff;}
    .panel-item-main{font-weight:600;}
    .panel-item-extra{
      display:flex;flex-direction:column;align-items:flex-end;gap:2px;
    }
    .panel-item-tag{font-size:10px;color:var(--accent-strong);}

    /* bottom nav */
    .bottom-nav{
      position:fixed;bottom:0;left:0;right:0;
      background:#ffffffee;border-top:1px solid var(--border);
      display:flex;justify-content:space-around;align-items:center;
      padding:6px 0;backdrop-filter:blur(8px);z-index:500;
    }
    .nav-btn{
      flex:1;text-align:center;border:none;background:transparent;
      font-size:11px;color:var(--text-soft);padding:4px 0;cursor:pointer;
      display:flex;flex-direction:column;align-items:center;gap:2px;
    }
    .nav-btn span.icon{font-size:18px;}
    .nav-btn.active{color:var(--accent-strong);font-weight:600;}
    .nav-btn.active span.icon{transform:translateY(-1px);}
    @media (max-width:600px){
      header h1{font-size:16px;}
      .col{min-width:95px;}
    }

    /* Exercises */
    .card{
      background:var(--card-bg);border-radius:14px;padding:10px;
      box-shadow:0 4px 12px rgba(120,96,190,0.12);border:1px solid var(--border);
      display:flex;flex-direction:column;gap:6px;
    }
    .card h2{
      margin:0;font-size:14px;color:var(--accent-strong);
    }
    .small-label{font-size:11px;color:var(--text-soft);}
    select{
      border-radius:999px;border:1px solid var(--border);
      padding:4px 10px;font-size:12px;background:#fff;
    }
    .exercise-question{
      font-size:14px;font-weight:600;margin-top:4px;
    }
    .exercise-options{display:flex;flex-direction:column;gap:4px;margin-top:2px;}
    .exercise-options label{
      font-size:13px;display:flex;align-items:center;gap:6px;
    }
    .exercise-feedback{
      font-size:12px;margin-top:4px;
    }

    /* Glossary */
    .glossary-search{
      display:flex;gap:6px;align-items:center;margin-top:4px;
    }
    .glossary-search input{
      flex:1;border-radius:999px;border:1px solid var(--border);
      padding:6px 10px;font-size:12px;
    }
    .glossary-list{
      margin-top:6px;max-height:360px;overflow-y:auto;padding-right:2px;
    }
    .glossary-item{
      padding:6px 8px;border-radius:10px;border:1px solid var(--border);
      background:#faf8ff;margin-bottom:4px;font-size:12px;
      display:flex;justify-content:space-between;gap:8px;
    }
    .glossary-ko{font-weight:600;}
    .glossary-ro{color:var(--text-soft);}
    .glossary-cat{font-size:10px;color:var(--accent-strong);}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Raluca Korean ‚Äì Study App</h1>
      <p id="subtitle">Builder propozi»õii + particule + audio</p>
    </header>

    <!-- SCREEN 1: BUILDER -->
    <div class="screen active" id="screen-builder">
      <div class="mode-panel">
        <div class="mode-row">
          <span class="section-label">Propozi»õia 1 ‚Äì ce pƒÉr»õi folose»ôte?</span>
          <div class="part-toggles" id="togglesP1"></div>
        </div>
        <div class="mode-row">
          <label>
            <input type="checkbox" id="enableP2" />
            ActiveazƒÉ Propozi»õia 2 (fraza)
          </label>
          <div class="part-toggles" id="togglesP2"></div>
        </div>
      </div>

      <div class="table-block">
        <div class="table-title">
          <span>Propozi»õia 1</span>
          <span class="page-indicator" id="pageInfo"></span>
        </div>
        <div class="table-horizontal" id="tableP1"></div>

        <div class="table-title hidden" id="titleP2">
          <span>Propozi»õia 2 (continuare / frazƒÉ)</span>
        </div>
        <div class="table-horizontal hidden" id="tableP2"></div>

        <div class="controls">
          <div class="btn-group">
            <button id="prevBtn">‚¨Ö Prev (r√¢nd model)</button>
            <button id="nextBtn">Next ‚û°</button>
          </div>
          <button class="secondary" id="resetBtn">Reset pƒÉr»õi de propozi»õie</button>
        </div>
        <div class="legend">
          ‚û§ Tap pe o coloanƒÉ pentru a schimba cuv√¢ntul (panel cu coreeanƒÉ + traducere).  
          ‚û§ ‚≠ê la CONJUGƒÇRI = gramaticƒÉ de legƒÉturƒÉ (cere propozi»õia 2).
        </div>

        <div class="preview-card">
          <div class="preview-title">
            <span>Propozi»õia / fraza (coreeanƒÉ, cu particule)</span>
          </div>
          <div class="preview-ko" id="previewKo">(alege cuvinte din tabel)</div>

          <div class="preview-title">
            <span>Traducere aproximativƒÉ (rom√¢nƒÉ ‚Äì cuvinte)</span>
            <button id="toggleRoBtn" class="secondary" style="padding:3px 8px;font-size:10px;">
              Ascunde traducerea
            </button>
          </div>
          <div class="preview-ro" id="previewRo"></div>

          <div class="preview-buttons">
            <button id="randomBtn">üé≤ Random propozi»õie</button>
            <button id="speakBtn">üîä Audio coreeanƒÉ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SCREEN 2: EXERCI»öII TOPIK -->
    <div class="screen" id="screen-exercises">
      <div class="card">
        <h2>üìù Exerci»õii TOPIK ‚Äì propozi»õii</h2>
        <div class="small-label">Alege tipul de exerci»õiu:</div>
        <select id="exerciseType">
          <option value="verb">Alege VERBUL corect</option>
          <option value="particle">Alege PARTICULA corectƒÉ</option>
          <option value="conjug">Alege CONJUGAREA corectƒÉ</option>
        </select>

        <div class="exercise-question" id="exerciseQuestion">
          ApasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù ca sƒÉ √Æncepi.
        </div>
        <div class="exercise-options" id="exerciseOptions"></div>

        <div class="btn-group">
          <button id="checkAnswerBtn">VerificƒÉ rƒÉspunsul</button>
          <button class="secondary" id="nextQuestionBtn">√éntrebare nouƒÉ</button>
        </div>
        <div class="exercise-feedback" id="exerciseFeedback"></div>
      </div>
      <div class="legend">
        ‚û§ Mai √Ænt√¢i alege tipul de exerci»õiu, apoi ‚Äû√éntrebare nouƒÉ‚Äù.  
        ‚û§ DupƒÉ ce bifezi un rƒÉspuns, apasƒÉ ‚ÄûVerificƒÉ rƒÉspunsul‚Äù.
      </div>
    </div>

    <!-- SCREEN 3: GLOSAR -->
    <div class="screen" id="screen-glossary">
      <div class="card">
        <h2>üìö Glosar coreean‚Äìrom√¢n</h2>
        <div class="small-label">CautƒÉ dupƒÉ coreeanƒÉ sau rom√¢nƒÉ:</div>
        <div class="glossary-search">
          <input type="text" id="glossarySearch" placeholder="ex: Í∞ÄÎã§ sau a merge" />
        </div>
        <div class="glossary-list" id="glossaryList"></div>
      </div>
    </div>
  </div>

  <!-- bottom nav -->
  <nav class="bottom-nav">
    <button class="nav-btn active" data-target="builder">
      <span class="icon">üèó</span>
      <span>Builder</span>
    </button>
    <button class="nav-btn" data-target="exercises">
      <span class="icon">üìù</span>
      <span>Exerci»õii</span>
    </button>
    <button class="nav-btn" data-target="glossary">
      <span class="icon">üìö</span>
      <span>Glosar</span>
    </button>
  </nav>

  <!-- overlay panel -->
  <div class="overlay hidden" id="overlay">
    <div class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title" id="panelTitle"></div>
          <div class="panel-sub" id="panelSub"></div>
        </div>
        <button class="panel-close" id="closePanelBtn">‚úï</button>
      </div>

      <div class="panel-input-row">
        <input type="text" id="newWordInput" placeholder="AdaugƒÉ cuv√¢nt nou‚Ä¶" />
        <button id="addWordBtn" class="secondary">+ Add</button>
      </div>

      <div class="panel-list" id="panelList"></div>
    </div>
  </div>

  <script>
    /* === LISTE DE CUVINTE (CA √éNAINTE) === */
    const subjects = [
      "Ï†Ä","ÎÇò","ÎÑà","Ïö∞Î¶¨","ÎÑàÌù¨","ÏÇ¨Îûå","ÌïôÏÉù","ÏÑ†ÏÉùÎãò","ÏßÅÏõê","Ï†ÑÎ¨∏Í∞Ä","ÏßÄÏõêÏûê","Í¥ÄÎ¶¨Ïûê",
      "Î∂ÄÎ™®Îãò","ÏïÑÏù¥","Ïñ¥Î•∏","ÏãúÎØº","Í≥†Í∞ù","ÏùòÏÇ¨","Í∞ÑÌò∏ÏÇ¨","Ïó∞Íµ¨Ïûê","Í¥ÄÍ≥ÑÏûê","ÎåÄÌëú","ÌöåÏû•",
      "ÏÇ¨Ïö©Ïûê","Ï∞∏Í∞ÄÏûê","Ïö¥Ï†ÑÏûê","Ï£ºÎØº","ÌôòÏûê"
    ];
    const times = [
      "Ïò§Îäò","Ïñ¥Ï†ú","ÎÇ¥Ïùº","ÏßÄÍ∏à","Î∞©Í∏à","Ï°∞Í∏à ÌõÑÏóê","Í≥ß","ÏµúÍ∑ºÏóê","ÏöîÏ¶ò","ÎßàÏπ®ÎÇ¥","Í≤∞Íµ≠",
      "Ïù¥Ï†ÑÏóê","Ïù¥ÌõÑÏóê","ÎãπÏãúÏóê","ÌïúÎèôÏïà","Í≥ÑÏÜç","Í∞ÄÎÅî","Ìï≠ÏÉÅ","ÏûêÏ£º","Ï†êÏ†ê","Ï∞®Ï∏∞","ÏùºÏ∞ç","Îä¶Í≤å"
    ];
    const places = [
      "Ïßë","ÌïôÍµê","ÌöåÏÇ¨","ÏãùÎãπ","Ïπ¥Ìéò","ÎèÑÏÑúÍ¥Ä","Î≥ëÏõê","ÏãúÏû•","Î∞±ÌôîÏ†ê","Í≥µÌï≠","Í∏∞Ï∞®Ïó≠",
      "Î≤ÑÏä§Ï†ïÎ•òÏû•","Ïó∞Íµ¨ÏÜå","Í∏∞Í¥Ä","ÏßÄÏó≠ÏÇ¨Ìöå","ÌôòÍ≤Ω","ÎåÄÍ∏∞ÏóÖ","ÌöåÏùòÏã§","Î≤ïÏõê","Í≤ΩÏ∞∞ÏÑú",
      "Ìï¥Î≥Ä","ÏÇ∞","Í≥µÏõê","ÏùÄÌñâ"
    ];
    const mods = [
      "Ïûò","Ïó¥Ïã¨Ìûà","Ï°∞Ïö©Ìûà","Ï≤úÏ≤úÌûà","Îπ®Î¶¨","Ï†ïÎßê","ÏïÑÏ£º","ÎÑàÎ¨¥","ÎßéÏù¥","Ï°∞Í∏à","Í∞ëÏûêÍ∏∞","ÎØ∏Î¶¨",
      "Î≤åÏç®","ÏïÑÍπå","Î∞©Í∏à","Í∏àÎ∞©","Í≥ß","Ìï≠ÏÉÅ","ÏûêÏ£º","Í∞ÄÎÅî","ÎìúÎ¨ºÍ≤å","ÏÉÅÎãπÌûà","ÍΩ§","ÎèÑÎåÄÏ≤¥","Ï†àÎåÄÎ°ú",
      "Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú","Ï∂©Î∂ÑÌûà","ÌäπÌûà","Ïò§ÌûàÎ†§","Ï†êÏ†ê","Ï∞®Ï∏∞","Í≥ÑÏÜç"
    ];
    const objects = [
      "Ï±Ö","Ïª§Ìîº","Î¨º","ÏùåÏãù","ÏòÅÌôî","Í∞ÄÎ∞©","Ï†ÑÌôî","Ïò∑","ÏûêÎ£å","Îç∞Ïù¥ÌÑ∞","Í≥ÑÌöç","Ï°∞Í±¥","ÏÉÅÌô©","Î¨∏Ï†ú",
      "Ìï¥Í≤∞Ï±Ö","ÏöîÏïΩ","Î≥¥Í≥†ÏÑú","Î¨∏ÏÑú","Ïª¥Ìì®ÌÑ∞","ÎÖ∏Ìä∏Î∂Å","Ìé∏ÏßÄ","ÏÑ†Î¨º","ÏùòÍ≤¨","Ï†ïÎ≥¥","Í¥ÄÍ≥Ñ","Í≤∞Í≥º",
      "ÏõêÏù∏","Î∞©Î≤ï","Ï†úÌíà","ÏÑúÎπÑÏä§","Ï†ïÏ±Ö","Î¨∏Ìôî"
    ];
    const numerals = new Array(60).fill("");
    const counters = [
      "Í∞ú","Î™Ö","Í∂å","Ïû•","ÎåÄ","Î≥ë","Ïûî","ÎßàÎ¶¨","Î≤à","ÏÇ¥","Ìèâ","ÏÜ°Ïù¥","Ï§Ñ","Ï†ê","Í±¥","Ìöå","Í∞ÄÏßÄ","Ï™Ω"
    ];
    const verbs = [
      "Í∞ÄÎã§","Ïò§Îã§","Î®πÎã§","ÎßàÏãúÎã§","Î≥¥Îã§","ÏùΩÎã§","Ïì∞Îã§","Î∞∞Ïö∞Îã§","ÏÇ¨Îã§","Ï£ºÎã§","Î∞õÎã§","ÏùºÌïòÎã§",
      "Í≥µÎ∂ÄÌïòÎã§","ÏöîÎ¶¨ÌïòÎã§","Ï≤≠ÏÜåÌïòÎã§","Ï§ÄÎπÑÌïòÎã§","ÎèÑÏôÄÏ£ºÎã§","ÏÇ¨Ïö©ÌïòÎã§","ÌïÑÏöîÌïòÎã§","Ï¢ãÏïÑÌïòÎã§",
      "Ïã´Ïñ¥ÌïòÎã§","Í∏∞Îã§Î¶¨Îã§","Ïâ¨Îã§","ÎßåÎÇòÎã§","Í±∑Îã§","Îã¨Î¶¨Îã§","ÏïâÎã§","ÏÑúÎã§","Í≤∞Ï†ïÌïòÎã§","Ï†úÏïàÌïòÎã§",
      "Ï†ÑÎã¨ÌïòÎã§","Ïú†ÏßÄÌïòÎã§","Î∞úÏÉùÌïòÎã§","Ï¶ùÍ∞ÄÌïòÎã§","Í∞êÏÜåÌïòÎã§","Ïù∏Ï†ïÌïòÎã§","Î∂ÑÏÑùÌïòÎã§","Í¥ÄÏ∞∞ÌïòÎã§",
      "Ìï¥Í≤∞ÌïòÎã§","Ïó∞Íµ¨ÌïòÎã§","ÌòëÎ†•ÌïòÎã§","ÏöîÏ≤≠ÌïòÎã§","Ï∂©Ï°±ÌïòÎã§","ÎπÑÍµêÌïòÎã§","ÏÑ§Î™ÖÌïòÎã§","ÏòàÏÉÅÌïòÎã§"
    ];
    const conjugations = [
      "-ÏïÑÏöî/Ïñ¥Ïöî","-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî","-Í≥† ÏûàÏñ¥Ïöî","-Í≥† Ïã∂Ïñ¥Ïöî","-(Ïúº)ÏÑ∏Ïöî","-(Ïúº)„Ñπ Í±∞ÏòàÏöî",
      "-ÏßÄ ÎßàÏÑ∏Ïöî","-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî","-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî","-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî","-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî",
      "-ÎçîÎùºÍ≥†Ïöî","-ÎÑ§Ïöî","-Íµ∞Ïöî","-Í≥† ÎÇòÏÑú","-Í∏∞ Ï†ÑÏóê","-(Ïúº)Î©¥ÏÑú","-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî",
      "-(Ïúº)„ÑπÍ≤åÏöî","-(Ïúº)„ÑπÎûòÏöî?","-(Ïúº)„ÑπÍπåÏöî?","-Îäî Í≤å Ïñ¥ÎïåÏöî?","-Îäî Ï§ëÏù¥ÏóêÏöî",
      "-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî","-(Ïúº)Î©¥ Ïïà ÎèºÏöî","-(Ïúº)Î©∞","-(Ïúº)ÎÇò","-(Ïúº)ÎØÄÎ°ú","-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº",
      "-(Ïúº)„ÑπÏàòÎ°ù","-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ","-(Ïúº)„ÑπÏßÄÎùºÎèÑ","-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê","-ÎèÑÎ°ù ÌïòÎã§",
      "-Í≤å ÎêòÎã§","-ÏïÑ/Ïñ¥ÏßÄÎã§","-Í∏∞ ÎßàÎ†®Ïù¥Îã§","-Í∏∞Ïóê","-Í∏∏Îûò","-Í≥† ÎßêÎã§","-Í≥†Ïûê ÌïòÎã§","-(Ïúº)„Ñπ ÎøêÏù¥Îã§"
    ];

    const translations = {
      subject: {
        "Ï†Ä":"eu (formal)","ÎÇò":"eu (informal)","ÎÑà":"tu","Ïö∞Î¶¨":"noi","ÎÑàÌù¨":"voi",
        "ÏÇ¨Îûå":"persoanƒÉ","ÌïôÏÉù":"student/ƒÉ","ÏÑ†ÏÉùÎãò":"profesor","ÏßÅÏõê":"angajat",
        "Î∂ÄÎ™®Îãò":"pƒÉrin»õi","ÏïÑÏù¥":"copil","Ïñ¥Î•∏":"adult","Í≥†Í∞ù":"client","ÏùòÏÇ¨":"medic",
        "Í∞ÑÌò∏ÏÇ¨":"asistentƒÉ","Ïó∞Íµ¨Ïûê":"cercetƒÉtor","ÎåÄÌëú":"reprezentant","ÌôòÏûê":"pacient"
      },
      time: {
        "Ïò§Îäò":"astƒÉzi","Ïñ¥Ï†ú":"ieri","ÎÇ¥Ïùº":"m√¢ine","ÏßÄÍ∏à":"acum","Î∞©Í∏à":"tocmai acum",
        "Ï°∞Í∏à ÌõÑÏóê":"pu»õin mai t√¢rziu","Í≥ß":"√Æn cur√¢nd","ÏµúÍ∑ºÏóê":"recent","ÏöîÏ¶ò":"√Æn ultima vreme",
        "ÎßàÏπ®ÎÇ¥":"√Æn cele din urmƒÉ","Í≤∞Íµ≠":"p√¢nƒÉ la urmƒÉ","Ïù¥Ï†ÑÏóê":"√Ænainte","Ïù¥ÌõÑÏóê":"dupƒÉ",
        "ÎãπÏãúÏóê":"atunci","ÌïúÎèôÏïà":"o perioadƒÉ","Í≥ÑÏÜç":"continuƒÉ","Í∞ÄÎÅî":"din c√¢nd √Æn c√¢nd",
        "Ìï≠ÏÉÅ":"√Æntotdeauna","ÏûêÏ£º":"des","Ï†êÏ†ê":"din ce √Æn ce","Ï∞®Ï∏∞":"treptat",
        "ÏùºÏ∞ç":"devreme","Îä¶Í≤å":"t√¢rziu"
      },
      place: {
        "Ïßë":"acasƒÉ","ÌïôÍµê":"»ôcoalƒÉ","ÌöåÏÇ¨":"firmƒÉ / companie","ÏãùÎãπ":"restaurant","Ïπ¥Ìéò":"cafenea",
        "ÎèÑÏÑúÍ¥Ä":"bibliotecƒÉ","Î≥ëÏõê":"spital","ÏãúÏû•":"pia»õƒÉ","Î∞±ÌôîÏ†ê":"magazin universal",
        "Í≥µÌï≠":"aeroport","Í∏∞Ï∞®Ïó≠":"garƒÉ","Î≤ÑÏä§Ï†ïÎ•òÏû•":"sta»õie de autobuz","Ïó∞Íµ¨ÏÜå":"laborator",
        "Í∏∞Í¥Ä":"institu»õie","ÏßÄÏó≠ÏÇ¨Ìöå":"comunitate","ÌôòÍ≤Ω":"mediu","ÎåÄÍ∏∞ÏóÖ":"corpora»õie mare",
        "ÌöåÏùòÏã§":"salƒÉ de »ôedin»õe","Î≤ïÏõê":"instan»õƒÉ","Í≤ΩÏ∞∞ÏÑú":"sec»õie de poli»õie",
        "Ìï¥Î≥Ä":"plajƒÉ","ÏÇ∞":"munte","Í≥µÏõê":"parc","ÏùÄÌñâ":"bancƒÉ"
      },
      mod: {
        "Ïûò":"bine","Ïó¥Ïã¨Ìûà":"cu s√¢rguin»õƒÉ","Ï°∞Ïö©Ìûà":"√Æn lini»ôte","Ï≤úÏ≤úÌûà":"√Æncet",
        "Îπ®Î¶¨":"repede","Ï†ïÎßê":"cu adevƒÉrat","ÏïÑÏ£º":"foarte","ÎÑàÎ¨¥":"prea / foarte",
        "ÎßéÏù¥":"mult","Ï°∞Í∏à":"pu»õin","Í∞ëÏûêÍ∏∞":"brusc","ÎØ∏Î¶¨":"√Æn avans","Î≤åÏç®":"deja",
        "ÏïÑÍπå":"mai devreme","Î∞©Í∏à":"chiar acum","Í∏àÎ∞©":"imediat","Í≥ß":"√Æn cur√¢nd",
        "Ìï≠ÏÉÅ":"mereu","ÏûêÏ£º":"des","Í∞ÄÎÅî":"din c√¢nd √Æn c√¢nd","ÎìúÎ¨ºÍ≤å":"rar",
        "ÏÉÅÎãπÌûà":"destul de","ÍΩ§":"bini»ôor","ÎèÑÎåÄÏ≤¥":"(deloc / √Æn √ÆntrebƒÉri)",
        "Ï†àÎåÄÎ°ú":"niciodatƒÉ (interdic»õie)","Ï†ÅÍ∑πÏ†ÅÏúºÎ°ú":"activ","Ï∂©Î∂ÑÌûà":"suficient",
        "ÌäπÌûà":"√Æn special","Ïò§ÌûàÎ†§":"mai degrabƒÉ","Ï†êÏ†ê":"din ce √Æn ce","Ï∞®Ï∏∞":"treptat",
        "Í≥ÑÏÜç":"√Æn mod continuu"
      },
      object: {
        "Ï±Ö":"carte","Ïª§Ìîº":"cafea","Î¨º":"apƒÉ","ÏùåÏãù":"m√¢ncare","ÏòÅÌôî":"film",
        "Í∞ÄÎ∞©":"geantƒÉ","Ï†ÑÌôî":"telefon","Ïò∑":"haine","ÏûêÎ£å":"materiale","Îç∞Ïù¥ÌÑ∞":"date",
        "Í≥ÑÌöç":"plan","Ï°∞Í±¥":"condi»õie","ÏÉÅÌô©":"situa»õie","Î¨∏Ï†ú":"problemƒÉ",
        "Ìï¥Í≤∞Ï±Ö":"solu»õie","ÏöîÏïΩ":"rezumat","Î≥¥Í≥†ÏÑú":"raport","Î¨∏ÏÑú":"document",
        "Ïª¥Ìì®ÌÑ∞":"calculator","ÎÖ∏Ìä∏Î∂Å":"laptop","Ìé∏ÏßÄ":"scrisoare","ÏÑ†Î¨º":"cadou",
        "ÏùòÍ≤¨":"opinie","Ï†ïÎ≥¥":"informa»õie","Í¥ÄÍ≥Ñ":"rela»õie","Í≤∞Í≥º":"rezultat",
        "ÏõêÏù∏":"cauzƒÉ","Î∞©Î≤ï":"metodƒÉ","Ï†úÌíà":"produs","ÏÑúÎπÑÏä§":"serviciu",
        "Ï†ïÏ±Ö":"politicƒÉ","Î¨∏Ìôî":"culturƒÉ"
      },
      numeral: {},
      counter: {
        "Í∞ú":"bucatƒÉ","Î™Ö":"persoanƒÉ","Í∂å":"volum (carte)","Ïû•":"foaie / paginƒÉ",
        "ÎåÄ":"aparat / vehicul","Î≥ë":"sticlƒÉ","Ïûî":"canƒÉ / pahar",
        "ÎßàÎ¶¨":"animal","Î≤à":"datƒÉ","ÏÇ¥":"ani (v√¢rstƒÉ)","ÏÜ°Ïù¥":"buchet / ciorchine",
        "Ï§Ñ":"r√¢nd / »ôir","Ï†ê":"punct","Í±¥":"caz","Ìöå":"datƒÉ (ocazie)",
        "Í∞ÄÏßÄ":"fel / tip","Ï™Ω":"paginƒÉ / direc»õie"
      },
      verb: {
        "Í∞ÄÎã§":"a merge","Ïò§Îã§":"a veni","Î®πÎã§":"a m√¢nca","ÎßàÏãúÎã§":"a bea","Î≥¥Îã§":"a vedea / a se uita",
        "ÏùΩÎã§":"a citi","Ïì∞Îã§":"a scrie","Î∞∞Ïö∞Îã§":"a √ÆnvƒÉ»õa","ÏÇ¨Îã§":"a cumpƒÉra","Ï£ºÎã§":"a da",
        "Î∞õÎã§":"a primi","ÏùºÌïòÎã§":"a lucra","Í≥µÎ∂ÄÌïòÎã§":"a studia","ÏöîÎ¶¨ÌïòÎã§":"a gƒÉti",
        "Ï≤≠ÏÜåÌïòÎã§":"a face curat","Ï§ÄÎπÑÌïòÎã§":"a pregƒÉti","ÎèÑÏôÄÏ£ºÎã§":"a ajuta",
        "ÏÇ¨Ïö©ÌïòÎã§":"a folosi","ÌïÑÏöîÌïòÎã§":"a fi necesar","Ï¢ãÏïÑÌïòÎã§":"a plƒÉcea",
        "Ïã´Ïñ¥ÌïòÎã§":"a nu plƒÉcea / a ur√Æ","Í∏∞Îã§Î¶¨Îã§":"a a»ôtepta","Ïâ¨Îã§":"a se odihni",
        "ÎßåÎÇòÎã§":"a se √Ænt√¢lni","Í±∑Îã§":"a merge pe jos","Îã¨Î¶¨Îã§":"a alerga",
        "ÏïâÎã§":"a se a»ôeza","ÏÑúÎã§":"a sta √Æn picioare","Í≤∞Ï†ïÌïòÎã§":"a decide",
        "Ï†úÏïàÌïòÎã§":"a propune","Ï†ÑÎã¨ÌïòÎã§":"a transmite","Ïú†ÏßÄÌïòÎã§":"a men»õine",
        "Î∞úÏÉùÌïòÎã§":"a se produce","Ï¶ùÍ∞ÄÌïòÎã§":"a cre»ôte","Í∞êÏÜåÌïòÎã§":"a scƒÉdea",
        "Ïù∏Ï†ïÌïòÎã§":"a recunoa»ôte","Î∂ÑÏÑùÌïòÎã§":"a analiza","Í¥ÄÏ∞∞ÌïòÎã§":"a observa",
        "Ìï¥Í≤∞ÌïòÎã§":"a rezolva","Ïó∞Íµ¨ÌïòÎã§":"a cerceta","ÌòëÎ†•ÌïòÎã§":"a colabora",
        "ÏöîÏ≤≠ÌïòÎã§":"a solicita","Ï∂©Ï°±ÌïòÎã§":"a satisface","ÎπÑÍµêÌïòÎã§":"a compara",
        "ÏÑ§Î™ÖÌïòÎã§":"a explica","ÏòàÏÉÅÌïòÎã§":"a anticipa"
      },
      conjug: {
        "-ÏïÑÏöî/Ïñ¥Ïöî":"prezent politicos",
        "-ÏïòÏñ¥Ïöî/ÏóàÏñ¥Ïöî":"trecut politicos",
        "-Í≥† ÏûàÏñ¥Ïöî":"(sunt) √Æn curs de a face",
        "-Í≥† Ïã∂Ïñ¥Ïöî":"vreau sƒÉ...",
        "-(Ïúº)ÏÑ∏Ïöî":"imperativ / onorific",
        "-(Ïúº)„Ñπ Í±∞ÏòàÏöî":"viitor",
        "-ÏßÄ ÎßàÏÑ∏Ïöî":"nu face»õi..., vƒÉ rog",
        "-ÏïÑ/Ïñ¥ Ï£ºÏÑ∏Ïöî":"vƒÉ rog sƒÉ...",
        "-ÏïÑ/Ïñ¥Ïïº ÎèºÏöî":"trebuie sƒÉ...",
        "-(Ïúº)„Ñπ Ïàò ÏûàÏñ¥Ïöî":"pot sƒÉ...",
        "-(Ïúº)„Ñπ Ïàò ÏóÜÏñ¥Ïöî":"nu pot sƒÉ...",
        "-ÎçîÎùºÍ≥†Ïöî":"chiar am observat cƒÉ...",
        "-ÎÑ§Ïöî":"exclamativ (observa»õie)",
        "-Íµ∞Ïöî":"exclamativ (constatare)",
        "-Í≥† ÎÇòÏÑú":"dupƒÉ ce...",
        "-Í∏∞ Ï†ÑÏóê":"√Ænainte sƒÉ...",
        "-(Ïúº)Î©¥ÏÑú":"√Æn timp ce...",
        "-(Ïúº)„ÑπÏßÄÎèÑ Î™∞ÎùºÏöî":"s-ar putea sƒÉ...",
        "-(Ïúº)„ÑπÍ≤åÏöî":"voi face pentru tine",
        "-(Ïúº)„ÑπÎûòÏöî?":"ai chef sƒÉ...?/vreau sƒÉ...",
        "-(Ïúº)„ÑπÍπåÏöî?":"sƒÉ facem...?",
        "-Îäî Í≤å Ïñ¥ÎïåÏöî?":"ce-ar fi sƒÉ...?",
        "-Îäî Ï§ëÏù¥ÏóêÏöî":"sunt √Æn mijlocul ac»õiunii",
        "-ÏïÑ/Ïñ¥ÎèÑ ÎèºÏöî":"po»õi sƒÉ..., e √Æn regulƒÉ",
        "-(Ïúº)Î©¥ Ïïà ÎèºÏöî":"nu ai voie sƒÉ...",
        "-(Ïúº)Î©∞":"»ôi (√Æn timp ce)",
        "-(Ïúº)ÎÇò":"dar / √ÆnsƒÉ",
        "-(Ïúº)ÎØÄÎ°ú":"deoarece / fiindcƒÉ",
        "-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº":"pe c√¢t..., at√¢t...",
        "-(Ïúº)„ÑπÏàòÎ°ù":"cu c√¢t..., cu at√¢t...",
        "-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ":"de»ôi...",
        "-(Ïúº)„ÑπÏßÄÎùºÎèÑ":"chiar dacƒÉ...",
        "-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê":"pe de altƒÉ parte",
        "-ÎèÑÎ°ù ÌïòÎã§":"sƒÉ faci √Æn a»ôa fel √Ænc√¢t sƒÉ...",
        "-Í≤å ÎêòÎã§":"ajungi sƒÉ..., devine cƒÉ...",
        "-ÏïÑ/Ïñ¥ÏßÄÎã§":"a deveni...",
        "-Í∏∞ ÎßàÎ†®Ïù¥Îã§":"este firesc sƒÉ...",
        "-Í∏∞Ïóê":"pentru cƒÉ..., fiindcƒÉ",
        "-Í∏∏Îûò":"pentru cƒÉ (am vƒÉzut / sim»õit eu)",
        "-Í≥† ÎßêÎã§":"√Æn cele din urmƒÉ ajunge sƒÉ...",
        "-Í≥†Ïûê ÌïòÎã§":"a inten»õiona sƒÉ...",
        "-(Ïúº)„Ñπ ÎøêÏù¥Îã§":"doar..., nimic altceva"
      }
    };

    const linkingConjugations = new Set([
      "-Í≥† ÎÇòÏÑú","-Í∏∞ Ï†ÑÏóê","-(Ïúº)Î©¥ÏÑú","-(Ïúº)Î©∞","-(Ïúº)ÎÇò","-(Ïúº)ÎØÄÎ°ú",
      "-(Ïúº)„Ñ¥/Îäî ÎßåÌÅº","-(Ïúº)„ÑπÏàòÎ°ù","-(Ïúº)„Ñ¥/ÎäîÎç∞ÎèÑ","-(Ïúº)„ÑπÏßÄÎùºÎèÑ",
      "-(Ïúº)„Ñ¥/Îäî Î∞òÎ©¥Ïóê","-ÎèÑÎ°ù ÌïòÎã§","-Í∏∞Ïóê","-Í∏∏Îûò","-Í≥† ÎßêÎã§","-Í≥†Ïûê ÌïòÎã§"
    ]);
    const isLinkingConj = v => linkingConjugations.has(v);

    const columns = [
      { key:"subject", title:"SUBJECT", ko:"Ï£ºÏñ¥",   data:subjects,    hint:"Cine?",        allowCustom:true },
      { key:"time",    title:"TIME",    ko:"ÏãúÍ∞Ñ",   data:times,       hint:"C√¢nd?",        allowCustom:true },
      { key:"place",   title:"PLACE",   ko:"Ïû•ÏÜå",   data:places,      hint:"Unde?",        allowCustom:true },
      { key:"mod",     title:"MOD",     ko:"Î∞©Î≤ï",   data:mods,        hint:"Cum?",         allowCustom:true },
      { key:"object",  title:"OBJECT",  ko:"Î™©Ï†ÅÏñ¥", data:objects,     hint:"Ce?",          allowCustom:true },
      { key:"numeral", title:"NUMERAL", ko:"",      data:numerals,    hint:"NumƒÉr",        allowCustom:true },
      { key:"counter", title:"COUNTER", ko:"ÏàòÎüâÏÇ¨", data:counters,    hint:"Clasificator", allowCustom:true },
      { key:"verb",    title:"VERB",    ko:"ÎèôÏÇ¨",   data:verbs,       hint:"Ac»õiune",      allowCustom:true },
      { key:"conjug",  title:"CONJUGƒÇRI", ko:"",    data:conjugations,hint:"FormƒÉ (P1/P2)",allowCustom:true }
    ];
    const maxLen = Math.max(...columns.map(c => c.data.length));

    let index=0;
    const stateP1={}, stateP2={}, activeP1={}, activeP2={};
    columns.forEach(col=>{
      stateP1[col.key]=col.data[0]||"";
      stateP2[col.key]=col.data[0]||"";
      activeP1[col.key]=true;
      activeP2[col.key]=true;
    });

    const tableP1=document.getElementById("tableP1");
    const tableP2=document.getElementById("tableP2");
    const titleP2=document.getElementById("titleP2");
    const pageInfoEl=document.getElementById("pageInfo");
    const prevBtn=document.getElementById("prevBtn");
    const nextBtn=document.getElementById("nextBtn");
    const resetBtn=document.getElementById("resetBtn");
    const enableP2=document.getElementById("enableP2");
    const togglesP1=document.getElementById("togglesP1");
    const togglesP2=document.getElementById("togglesP2");

    const overlay=document.getElementById("overlay");
    const panelTitle=document.getElementById("panelTitle");
    const panelSub=document.getElementById("panelSub");
    const panelList=document.getElementById("panelList");
    const closePanelBtn=document.getElementById("closePanelBtn");
    const newWordInput=document.getElementById("newWordInput");
    const addWordBtn=document.getElementById("addWordBtn");

    const previewKo=document.getElementById("previewKo");
    const previewRo=document.getElementById("previewRo");
    const toggleRoBtn=document.getElementById("toggleRoBtn");
    const randomBtn=document.getElementById("randomBtn");
    const speakBtn=document.getElementById("speakBtn");

    const subtitleEl=document.getElementById("subtitle");

    /* bottom nav & screens */
    const screens = {
      builder: document.getElementById("screen-builder"),
      exercises: document.getElementById("screen-exercises"),
      glossary: document.getElementById("screen-glossary")
    };
    const navButtons = document.querySelectorAll(".nav-btn");

    function setScreen(name){
      Object.entries(screens).forEach(([k,el])=>{
        el.classList.toggle("active", k===name);
      });
      navButtons.forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.target===name);
      });
      if(name==="builder"){
        subtitleEl.textContent="Builder propozi»õii + particule + audio";
      }else if(name==="exercises"){
        subtitleEl.textContent="Exerci»õii TOPIK ‚Äì verb, particulƒÉ, conjugare";
      }else{
        subtitleEl.textContent="Glosar coreean‚Äìrom√¢n (cuvinte din aplica»õie)";
        renderGlossary(""); // la intrare, randƒÉm lista
      }
    }
    navButtons.forEach(btn=>{
      btn.addEventListener("click",()=>setScreen(btn.dataset.target));
    });

    /* func»õii particule */
    const hasBatchim = (syl) => {
      if(!syl) return false;
      const code = syl.charCodeAt(syl.length-1) - 0xAC00;
      if(code < 0 || code > 11171) return false;
      const jong = code % 28;
      return jong !== 0;
    };
    const pronouns = new Set(["Ï†Ä","ÎÇò","ÎÑà","Ïö∞Î¶¨","ÎÑàÌù¨"]);
    function addSubjectWithParticle(word){
      if(!word) return "";
      const batchim = hasBatchim(word);
      if(pronouns.has(word)){
        return word + (batchim ? "ÏùÄ" : "Îäî");
      } else {
        return word + (batchim ? "Ïù¥" : "Í∞Ä");
      }
    }
    function addObjectWithParticle(word){
      if(!word) return "";
      const batchim = hasBatchim(word);
      return word + (batchim ? "ÏùÑ" : "Î•º");
    }
    const timeAdverbsNoParticle = new Set([
      "Ïò§Îäò","Ïñ¥Ï†ú","ÎÇ¥Ïùº","ÏßÄÍ∏à","Î∞©Í∏à","ÏöîÏ¶ò","Ìï≠ÏÉÅ","ÏûêÏ£º","Í∞ÄÎÅî","Í≥ÑÏÜç","Ï†êÏ†ê","Ï∞®Ï∏∞"
    ]);
    function addTimeWithParticle(word){
      if(!word) return "";
      if(timeAdverbsNoParticle.has(word)) return word;
      return word + "Ïóê";
    }
    function addPlaceWithParticle(word){
      if(!word) return "";
      return word + "ÏóêÏÑú";
    }

    function createToggleChips(){
      columns.forEach(col=>{
        const chip1=document.createElement("label");
        chip1.className="chip";
        const cb1=document.createElement("input");
        cb1.type="checkbox";cb1.checked=true;cb1.dataset.key=col.key;cb1.dataset.clause="p1";
        chip1.appendChild(cb1);chip1.append(col.title);togglesP1.appendChild(chip1);

        const chip2=document.createElement("label");
        chip2.className="chip";
        const cb2=document.createElement("input");
        cb2.type="checkbox";cb2.checked=true;cb2.dataset.key=col.key;cb2.dataset.clause="p2";
        chip2.appendChild(cb2);chip2.append(col.title);togglesP2.appendChild(chip2);
      });

      togglesP1.addEventListener("change",e=>{
        const cb=e.target;if(cb.tagName.toLowerCase()!=="input")return;
        activeP1[cb.dataset.key]=cb.checked;render();
      });
      togglesP2.addEventListener("change",e=>{
        const cb=e.target;if(cb.tagName.toLowerCase()!=="input")return;
        activeP2[cb.dataset.key]=cb.checked;render();
      });

      enableP2.addEventListener("change",()=>{
        const on=enableP2.checked;
        if(on){titleP2.classList.remove("hidden");tableP2.classList.remove("hidden");}
        else{titleP2.classList.add("hidden");tableP2.classList.add("hidden");}
        updatePreview();
      });

      resetBtn.addEventListener("click",()=>{
        [...togglesP1.querySelectorAll("input")].forEach(cb=>{
          cb.checked=true;activeP1[cb.dataset.key]=true;
        });
        [...togglesP2.querySelectorAll("input")].forEach(cb=>{
          cb.checked=true;activeP2[cb.dataset.key]=true;
        });
        render();
      });
    }

    function renderClauseRow(container,activeMap,state,clauseId){
      container.innerHTML="";
      columns.forEach(col=>{
        const colDiv=document.createElement("div");
        colDiv.className="col";
        if(!activeMap[col.key])colDiv.classList.add("dimmed");
        colDiv.dataset.key=col.key;colDiv.dataset.clause=clauseId;

        const header=document.createElement("div");
        header.className="col-header";
        header.textContent=col.title+(col.ko?` (${col.ko})`:"");
        colDiv.appendChild(header);

        const label=document.createElement("div");
        label.className="col-body-label";
        label.textContent=col.hint||"";
        colDiv.appendChild(label);

        const main=document.createElement("div");
        main.className="col-body-main";
        main.textContent=state[col.key]||"";
        colDiv.appendChild(main);

        const extra=document.createElement("div");
        extra.className="col-body-extra";
        if(col.key==="conjug" && state[col.key] && isLinkingConj(state[col.key])){
          extra.textContent="‚≠ê cere propozi»õia 2";
        }else extra.textContent="";
        colDiv.appendChild(extra);

        container.appendChild(colDiv);
      });
    }

    function buildClauseSentence(state){
      const koParts=[], roParts=[];
      const subj = state.subject;
      if(subj){
        koParts.push(addSubjectWithParticle(subj));
        roParts.push((translations.subject && translations.subject[subj]) || subj);
      }
      const t = state.time;
      if(t){
        koParts.push(addTimeWithParticle(t));
        roParts.push((translations.time && translations.time[t]) || t);
      }
      const p = state.place;
      if(p){
        koParts.push(addPlaceWithParticle(p));
        roParts.push((translations.place && translations.place[p]) || p);
      }
      const m = state.mod;
      if(m){
        koParts.push(m);
        roParts.push((translations.mod && translations.mod[m]) || m);
      }
      const obj = state.object;
      if(obj){
        koParts.push(addObjectWithParticle(obj));
        roParts.push((translations.object && translations.object[obj]) || obj);
      }
      const num = state.numeral;
      if(num){
        koParts.push(num);
        roParts.push(num);
      }
      const cnt = state.counter;
      if(cnt){
        koParts.push(cnt);
        roParts.push((translations.counter && translations.counter[cnt]) || cnt);
      }
      const v = state.verb;
      if(v){
        koParts.push(v);
        roParts.push((translations.verb && translations.verb[v]) || v);
      }
      const cj = state.conjug;
      if(cj){
        koParts.push(cj);
        roParts.push((translations.conjug && translations.conjug[cj]) || cj);
      }
      return { ko: koParts.join(" "), ro: roParts };
    }

    function updatePreview(){
      const c1=buildClauseSentence(stateP1);
      let koText=c1.ko;
      let roWords=[...c1.ro];

      const conj1=stateP1["conjug"];
      if(enableP2.checked && conj1 && isLinkingConj(conj1)){
        const c2=buildClauseSentence(stateP2);
        if(c2.ko){
          koText = koText + " / " + c2.ko;
          roWords = roWords.concat(["//"], c2.ro);
        }
      }

      if(!koText){
        previewKo.textContent="(alege cuvinte din tabel)";
        previewRo.textContent="";
        return;
      }
      previewKo.textContent=koText;
      if(showRo){
        previewRo.textContent = roWords.length ? roWords.join(" ") : "(fƒÉrƒÉ traducere disponibilƒÉ)";
      }else{
        previewRo.textContent = "¬∑¬∑¬∑ traducere ascunsƒÉ ¬∑¬∑¬∑";
      }
    }

    function render(){
      renderClauseRow(tableP1,activeP1,stateP1,"p1");
      if(enableP2.checked) renderClauseRow(tableP2,activeP2,stateP2,"p2");
      pageInfoEl.textContent=`R√¢nd model: ${index+1} / ${maxLen}`;
      prevBtn.disabled=index===0;
      nextBtn.disabled=index===maxLen-1;
      updatePreview();
    }

    function openPanel(clause,key){
      panelClause=clause;panelKey=key;
      const col=columns.find(c=>c.key===key);if(!col)return;
      panelTitle.textContent=(clause==="p1"?"Propozi»õia 1 ‚Äì ":"Propozi»õia 2 ‚Äì ")+col.title;
      panelSub.textContent=col.hint||"";
      newWordInput.value="";panelList.innerHTML="";

      const map=translations[key]||{};
      col.data.forEach(word=>{
        if(!word)return;
        const item=document.createElement("div");
        item.className="panel-item";

        const main=document.createElement("div");
        main.className="panel-item-main";
        main.textContent=word;
        item.appendChild(main);

        const extraBox=document.createElement("div");
        extraBox.className="panel-item-extra";

        const ro=map[word];
        if(ro){
          const roDiv=document.createElement("div");
          roDiv.className="panel-item-tag";
          roDiv.textContent=ro;
          extraBox.appendChild(roDiv);
        }
        if(key==="conjug" && isLinkingConj(word)){
          const star=document.createElement("div");
          star.className="panel-item-tag";
          star.textContent="‚≠ê P2";
          extraBox.appendChild(star);
        }
        item.appendChild(extraBox);

        item.addEventListener("click",()=>{
          const target = clause==="p1" ? stateP1 : stateP2;
          target[key]=word;
          if(key==="conjug" && isLinkingConj(word)){
            enableP2.checked=true;
            titleP2.classList.remove("hidden");
            tableP2.classList.remove("hidden");
          }
          overlay.classList.add("hidden");
          render();
        });

        panelList.appendChild(item);
      });

      overlay.classList.remove("hidden");
      newWordInput.focus();
    }

    const overlayEl=document.getElementById("overlay");
    closePanelBtn.addEventListener("click",()=>overlayEl.classList.add("hidden"));
    overlayEl.addEventListener("click",e=>{if(e.target===overlayEl)overlayEl.classList.add("hidden");});
    addWordBtn.addEventListener("click",()=>{
      const txt=newWordInput.value.trim();if(!txt)return;
      const col=columns.find(c=>c.key===panelKey);
      if(!col||!col.allowCustom)return;
      col.data.push(txt);newWordInput.value="";
      openPanel(panelClause,panelKey);
    });
    tableP1.addEventListener("click",e=>{
      const colDiv=e.target.closest(".col");if(!colDiv)return;
      openPanel(colDiv.dataset.clause||"p1",colDiv.dataset.key);
    });
    tableP2.addEventListener("click",e=>{
      const colDiv=e.target.closest(".col");if(!colDiv)return;
      openPanel(colDiv.dataset.clause||"p2",colDiv.dataset.key);
    });

    function loadRow(i){
      columns.forEach(col=>{
        const v=col.data[i]||"";
        stateP1[col.key]=v;
      });
    }
    prevBtn.addEventListener("click",()=>{if(index>0){index--;loadRow(index);render();}});
    nextBtn.addEventListener("click",()=>{if(index<maxLen-1){index++;loadRow(index);render();}});

    let showRo=true;
    toggleRoBtn.addEventListener("click",()=>{
      showRo=!showRo;
      toggleRoBtn.textContent = showRo ? "Ascunde traducerea" : "AratƒÉ traducerea";
      updatePreview();
    });

    randomBtn.addEventListener("click",()=>{
      columns.forEach(col=>{
        if(!activeP1[col.key]) return;
        const arr=col.data.filter(x=>x!=="" && x!=null);
        if(!arr.length) return;
        const rand = arr[Math.floor(Math.random()*arr.length)];
        stateP1[col.key]=rand;
      });
      render();
    });

    speakBtn.addEventListener("click",()=>{
      if(!("speechSynthesis" in window)){alert("Browserul nu suportƒÉ audio.");return;}
      const text=previewKo.textContent;
      if(!text || text.includes("alege cuvinte")) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang="ko-KR";
      const voices = window.speechSynthesis.getVoices();
      const koVoice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith("ko"));
      if(koVoice) utter.voice = koVoice;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    });

    createToggleChips();
    loadRow(index);
    render();

    /* ===== EXERCI»öII TOPIK ===== */
    const exerciseTypeSelect=document.getElementById("exerciseType");
    const exerciseQuestionEl=document.getElementById("exerciseQuestion");
    const exerciseOptionsEl=document.getElementById("exerciseOptions");
    const exerciseFeedbackEl=document.getElementById("exerciseFeedback");
    const checkAnswerBtn=document.getElementById("checkAnswerBtn");
    const nextQuestionBtn=document.getElementById("nextQuestionBtn");

    const exerciseSets = {
      verb: [
        {
          sentence: "Ï†ÄÎäî ÏïÑÏπ®Ïóê Ïª§ÌîºÎ•º ___ .",
          options: ["ÎßàÏÖîÏöî","Î®πÏñ¥Ïöî","Í∞ÄÏöî"],
          correct: 0,
          explanation: "Ïª§ÌîºÎäî Î≥¥ÌÜµ ÎßàÏÖîÏöî (a bea cafea), nu Î®πÏñ¥Ïöî."
        },
        {
          sentence: "ÏïÑÏù¥Îì§Ïù¥ Í≥µÏõêÏóêÏÑú Í≥µÏùÑ ___ .",
          options: ["ÏùΩÏñ¥Ïöî","Ï∞®Ïöî","Ïç®Ïöî"],
          correct: 1,
          explanation: "Í≥µÏùÑ Ï∞®Îã§ = a »ôuta/mingea (a lovi cu piciorul)."
        },
        {
          sentence: "Ï†ÄÎäî ÏßëÏóêÏÑú ÌïúÍµ≠Ïñ¥Î•º ___ .",
          options: ["Í≥µÎ∂ÄÌï¥Ïöî","ÎßàÏÖîÏöî","ÎÅìÏó¨Ïöî"],
          correct: 0,
          explanation: "ÌïúÍµ≠Ïñ¥Î•º Í≥µÎ∂ÄÌï¥Ïöî = √ÆnvƒÉ»õ coreeanƒÉ."
        }
      ],
      particle: [
        {
          sentence: "Ï†Ä___ ÎÇ¥Ïùº ÏπúÍµ¨Î•º ÎßåÎÇ† Í±∞ÏòàÏöî.",
          options: ["Îäî","Î•º","Ïóê"],
          correct: 0,
          explanation: "Ï†ÄÎäî = subiect marcat cu ÏùÄ/Îäî."
        },
        {
          sentence: "Ï†ÄÎäî ÌïôÍµê___ Í≥µÎ∂ÄÌï¥Ïöî.",
          options: ["Ïóê","ÏóêÏÑú","ÏùÑ"],
          correct: 1,
          explanation: "Ac»õiunea 'a studia' se √Ænt√¢mplƒÉ la »ôcoalƒÉ ‚Üí ÌïôÍµêÏóêÏÑú."
        },
        {
          sentence: "Ï†ÄÎäî Ï±Ö___ ÏùΩÏñ¥Ïöî.",
          options: ["ÏùÑ","Ïóê","Í∞Ä"],
          correct: 0,
          explanation: "Ï±ÖÏùÑ ÏùΩÏñ¥Ïöî ‚Üí obiect + ÏùÑ/Î•º."
        }
      ],
      conjug: [
        {
          sentence: "ÎÇ¥Ïùº ÎπÑÍ∞Ä Ïò¨ ___ .",
          options: ["Í±∞ÏòàÏöî","Í≥† ÏûàÏñ¥Ïöî","ÏßÄ ÎßàÏÑ∏Ïöî"],
          correct: 0,
          explanation: "Ïò¨ Í±∞ÏòàÏöî = va ploua (viitor)."
        },
        {
          sentence: "ÏßÄÍ∏à Î∞•ÏùÑ Î®πÍ≥† ___ .",
          options: ["Ïã∂Ïñ¥Ïöî","ÏûàÏñ¥Ïöî","Í∞à Í±∞ÏòàÏöî"],
          correct: 1,
          explanation: "Î®πÍ≥† ÏûàÏñ¥Ïöî = mƒÉn√¢nc acum (ac»õiune √Æn curs)."
        },
        {
          sentence: "ÎÑàÎ¨¥ ÌîºÍ≥§Ìï¥ÏÑú Ïò§Îäò ÏùºÏ∞ç ÏûêÏïº ___ .",
          options: ["ÎèºÏöî","Ïã∂Ïñ¥Ïöî","Ïàò ÏûàÏñ¥Ïöî"],
          correct: 0,
          explanation: "ÏûêÏïº ÎèºÏöî = trebuie sƒÉ dorm devreme."
        }
      ]
    };

    let currentQuestion = null;
    let selectedOptionIndex = null;

    function loadRandomExercise(){
      const type = exerciseTypeSelect.value;
      const set = exerciseSets[type];
      if(!set || !set.length)return;
      currentQuestion = set[Math.floor(Math.random()*set.length)];
      selectedOptionIndex = null;
      exerciseQuestionEl.textContent = currentQuestion.sentence;
      exerciseOptionsEl.innerHTML="";
      currentQuestion.options.forEach((opt,idx)=>{
        const id="opt-"+idx;
        const label=document.createElement("label");
        const radio=document.createElement("input");
        radio.type="radio";radio.name="exerciseOption";radio.value=idx;radio.id=id;
        radio.addEventListener("change",()=>{selectedOptionIndex=idx;});
        const span=document.createElement("span");
        span.textContent=opt;
        label.appendChild(radio);label.appendChild(span);
        exerciseOptionsEl.appendChild(label);
      });
      exerciseFeedbackEl.textContent="";
    }

    checkAnswerBtn.addEventListener("click",()=>{
      if(!currentQuestion){exerciseFeedbackEl.textContent="Mai √Ænt√¢i apasƒÉ ‚Äû√éntrebare nouƒÉ‚Äù.";return;}
      if(selectedOptionIndex===null){exerciseFeedbackEl.textContent="Te rog alege un rƒÉspuns.";return;}
      if(selectedOptionIndex===currentQuestion.correct){
        exerciseFeedbackEl.textContent="‚úî Corect! " + currentQuestion.explanation;
        exerciseFeedbackEl.style.color="#2e7d32";
      }else{
        const correctText=currentQuestion.options[currentQuestion.correct];
        exerciseFeedbackEl.textContent=`‚úò Nu e corect. RƒÉspuns corect: "${correctText}". ${currentQuestion.explanation}`;
        exerciseFeedbackEl.style.color="#c62828";
      }
    });
    nextQuestionBtn.addEventListener("click",loadRandomExercise);
    exerciseTypeSelect.addEventListener("change",loadRandomExercise);

    /* ===== GLOSAR ===== */
    const glossarySearch=document.getElementById("glossarySearch");
    const glossaryList=document.getElementById("glossaryList");
    const glossaryEntries=[];

    function addGlossaryFrom(list, catKey, categoryLabel){
      const map = translations[catKey] || {};
      list.forEach(w=>{
        if(!w) return;
        const ro = map[w] || "(fƒÉrƒÉ traducere √ÆncƒÉ)";
        glossaryEntries.push({ko:w, ro, category:categoryLabel});
      });
    }

    addGlossaryFrom(subjects,"subject","SUBJECT");
    addGlossaryFrom(times,"time","TIME");
    addGlossaryFrom(places,"place","PLACE");
    addGlossaryFrom(mods,"mod","MOD");
    addGlossaryFrom(objects,"object","OBJECT");
    addGlossaryFrom(counters,"counter","COUNTER");
    addGlossaryFrom(verbs,"verb","VERB");
    addGlossaryFrom(conjugations,"conjug","CONJUGƒÇRI");

    function renderGlossary(filter){
      filter = (filter||"").toLowerCase();
      glossaryList.innerHTML="";
      const filtered = glossaryEntries.filter(e=>{
        if(!filter) return true;
        return e.ko.toLowerCase().includes(filter) || e.ro.toLowerCase().includes(filter);
      });
      if(!filtered.length){
        const div=document.createElement("div");
        div.className="small-label";
        div.textContent="Nu s-a gƒÉsit nimic pentru cƒÉutarea introdusƒÉ.";
        glossaryList.appendChild(div);
        return;
      }
      filtered.forEach(e=>{
        const item=document.createElement("div");
        item.className="glossary-item";
        const left=document.createElement("div");
        const ko=document.createElement("div");
        ko.className="glossary-ko";
        ko.textContent=e.ko;
        const ro=document.createElement("div");
        ro.className="glossary-ro";
        ro.textContent=e.ro;
        left.appendChild(ko);left.appendChild(ro);
        const cat=document.createElement("div");
        cat.className="glossary-cat";
        cat.textContent=e.category;
        item.appendChild(left);item.appendChild(cat);
        glossaryList.appendChild(item);
      });
    }

    glossarySearch.addEventListener("input",()=>renderGlossary(glossarySearch.value));

    // porne»ôte pe ecranul builder
    setScreen("builder");
  </script>
</body>
</html>
