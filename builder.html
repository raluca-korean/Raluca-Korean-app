<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Raluca Korean – Sentence Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:#f4f6fb;
  color:#2f343b;
}

.app{
  max-width:1100px;
  margin:0 auto;
  padding:20px 16px 80px;
}

h1{
  margin:0 0 10px;
  font-size:22px;
  font-weight:900;
}

.section-title{
  margin:24px 0 8px;
  font-size:13px;
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#556;
}

/* ===== CLAUSE BLOCK ===== */

.clause-block{
  background:#ffffff;
  border-radius:18px;
  padding:12px;
  margin-bottom:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.clause-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  font-weight:900;
  color:#666;
  margin-bottom:6px;
}

.table{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding-bottom:4px;
}

/* ===== COLUMN ===== */

.col{
  flex:0 0 auto;
  min-width:120px;
  max-width:150px;
  background:#faf8f4;
  border-radius:14px;
  padding:8px;
  border:1px solid #e3dccf;
}

.col-header{
  font-size:10px;
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#7b5dff;
  border-bottom:1px solid #ddd;
  padding-bottom:3px;
  margin-bottom:4px;
}

.col-hint{
  font-size:10px;
  color:#999;
  margin-bottom:2px;
}

.cell{
  font-size:15px;
  font-weight:900;
  min-height:1.4em;
}

.cell[contenteditable]{
  outline:none;
  cursor:text;
}

.cell:focus{
  box-shadow:0 0 0 2px rgba(123,93,255,.35);
  border-radius:6px;
}

/* ===== PREVIEW ===== */

.preview{
  margin-top:20px;
  background:#fff;
  border-radius:18px;
  padding:14px;
  box-shadow:0 14px 30px rgba(0,0,0,.1);
}

.preview-title{
  font-size:12px;
  font-weight:900;
  color:#555;
  margin-bottom:6px;
}

.preview-ko{
  font-size:22px;
  font-weight:900;
  line-height:1.5;
}

</style>
</head>

<body>
<div class="app">

<h1>Raluca Korean – Builder</h1>

<div class="section-title">Builder (multi-clause)</div>

<!-- ===================== -->
<!-- CLAUSE 1 -->
<!-- ===================== -->
<section class="clause-block" data-clause="0">

  <div class="clause-header">
    <span>Propoziția 1</span>
    <span>VERB infinitiv + CONJ</span>
  </div>

  <div class="table">

    <div class="col" data-key="subject">
      <div class="col-header">Subject</div>
      <div class="col-hint">eu / tu / noi</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="time">
      <div class="col-header">Time</div>
      <div class="col-hint">azi / mâine</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="place">
      <div class="col-header">Place</div>
      <div class="col-hint">loc (bază)</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="mod">
      <div class="col-header">Mod</div>
      <div class="col-hint">bine / încet</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="object">
      <div class="col-header">Object</div>
      <div class="col-hint">ce?</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="numeral">
      <div class="col-header">Numeral</div>
      <div class="col-hint">un / doi</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="counter">
      <div class="col-header">Counter</div>
      <div class="col-hint">권 / 개</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="verb">
      <div class="col-header">Verb</div>
      <div class="col-hint">infinitiv (…다)</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="conj">
      <div class="col-header">Conj</div>
      <div class="col-hint">-고 / -지만</div>
      <div class="cell" contenteditable></div>
    </div>

  </div>
</section>

<!-- ===================== -->
<!-- CLAUSE 2 -->
<!-- ===================== -->
<section class="clause-block" data-clause="1">

  <div class="clause-header">
    <span>Propoziția 2</span>
    <span>continuare</span>
  </div>

  <div class="table">

    <div class="col" data-key="subject">
      <div class="col-header">Subject</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="time">
      <div class="col-header">Time</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="place">
      <div class="col-header">Place</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="mod">
      <div class="col-header">Mod</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="object">
      <div class="col-header">Object</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="numeral">
      <div class="col-header">Numeral</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="counter">
      <div class="col-header">Counter</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="verb">
      <div class="col-header">Verb</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="conj">
      <div class="col-header">Conj</div>
      <div class="cell" contenteditable></div>
    </div>

  </div>
</section>

<!-- ===== PREVIEW ===== -->

<div class="preview">
  <div class="preview-title">Propoziția finală</div>
  <label style="display:flex;align-items:center;gap:6px;">
  <input type="checkbox" id="topicToggle" checked />
  <span>은/는 (topic)</span>
</label>
  <div class="preview-ko" id="previewSentence">저 가요</div>
</div>

</div>
</body>
<script>
/* =========================
   UTILITARE
========================= */
function hasBatchim(word){
  if(!word) return false;
  const ch = word[word.length-1];
  const code = ch.charCodeAt(0);
  if(code < 0xac00 || code > 0xd7a3) return false;
  return (code - 0xac00) % 28 !== 0;
}

function topicParticle(word){
  return hasBatchim(word) ? "은" : "는";
}
function subjectParticle(word){
  return hasBatchim(word) ? "이" : "가";
}
function objectParticle(word){
  return hasBatchim(word) ? "을" : "를";
}

/* =========================
   VERB ENDINGS
========================= */
function politeVerb(verb){
  if(!verb.endsWith("다")) return verb;
  if(verb === "하다") return "해요";

  const stem = verb.slice(0,-1);
  const last = stem[stem.length-1];
  const code = last.charCodeAt(0);
  const jung = Math.floor((code - 0xac00) % (21*28) / 28);
  const aGroup = [0,2,8,9]; // ㅏ ㅑ ㅗ ㅛ
  return stem + (aGroup.includes(jung) ? "아요" : "어요");
}

function attachEnding(verb, ending){
  if(!ending) return verb;
  if(!verb.endsWith("다")) return verb;

  const stem = verb.slice(0,-1);
  const batchim = hasBatchim(stem);

  if(ending === "-고") return stem + "고";
  if(ending === "-지만") return stem + "지만";
  if(ending === "-아서" || ending === "-어서") return stem + ending.replace("-","");
  if(ending === "-(으)면") return stem + (batchim ? "으면" : "면");
  if(ending === "-(으)ㄹ 때") return stem + (batchim ? "을 때" : "ㄹ 때");
  if(ending === "-(으)려고") return stem + (batchim ? "으려고" : "려고");

  return stem + ending.replace("-","");
}

/* =========================
   BUILD ONE CLAUSE
========================= */
function buildClause(block, isLast){
  const get = k =>
    block.querySelector(`.col[data-key="${k}"] .cell`)?.textContent.trim() || "";
const rawSubject = readCell(tableId,"subject");
const useTopic = document.getElementById("topicToggle")?.checked;
const subject = rawSubject
  ? subjectParticle(rawSubject, useTopic)
  : "";
  let subject = get("subject");
  let time    = get("time");
  let place   = get("place");
  let mod     = get("mod");
  let object  = get("object");
  let obj = "";
if (object && numeral && counter) {
  obj = `${objectParticle(object)} ${numeral} ${counter}`;
} else if (object) {
  obj = objectParticle(object);
}
  let numeral = get("numeral");
  let counter = get("counter");
  let verb    = get("verb");
  let conj    = get("conj");

  let out = [];

  if(subject) out.push(subject + topicParticle(subject));
  if(time) out.push(time);

  if(place){
    if(verb === "가다" || verb === "오다") out.push(place + "에");
    else out.push(place + "에서");
  }

  if(mod) out.push(mod);

  if(object){
    if(numeral && counter)
      out.push(`${object}${objectParticle(object)} ${numeral} ${counter}`);
    else
      out.push(object + objectParticle(object));
  }

  if(isLast){
    out.push(politeVerb(verb));
  }else{
    out.push(attachEnding(verb, conj));
  }

  return out.join(" ").trim();
}

/* =========================
   BUILD FULL SENTENCE
========================= */
function rebuildPreview(){
  const clauses = document.querySelectorAll(".clause-block");
  let sentence = [];

  clauses.forEach((c,i)=>{
    const built = buildClause(c, i === clauses.length-1);
    if(built) sentence.push(built);
  });

  document.getElementById("previewSentence").textContent =
    sentence.join(" ").replace(/\s+/g," ");
}
/* =========================
   DICTIONARE MINIMALE
========================= */
const RO = {
  subject: [
    ["eu","저"],["tu","너"],["noi","우리"]
  ],
  time: [
    ["azi","오늘"],["astăzi","오늘"],["mâine","내일"],["ieri","어제"]
  ],
  place: [
    ["cafenea","카페"],["cafea","카페"],["acasă","집"],["acasa","집"]
  ],
  object: [
    ["carte","책"],["cafea","커피"],["apă","물"],["apa","물"]
  ],
  verb: [
    ["merg","가다"],["citesc","읽다"],["beau","마시다"],
    ["mănânc","먹다"],["mananc","먹다"]
  ]
};

const EN = {
  subject: [
    ["i","저"],["you","너"],["we","우리"]
  ],
  time: [
    ["today","오늘"],["tomorrow","내일"],["yesterday","어제"]
  ],
  place: [
    ["cafe","카페"],["home","집"]
  ],
  object: [
    ["book","책"],["coffee","커피"],["water","물"]
  ],
  verb: [
    ["go","가다"],["read","읽다"],["drink","마시다"],["eat","먹다"]
  ]
};

const CONNECTORS = [
  {keys:["și","and"], ending:"-고"},
  {keys:["dar","but"], ending:"-지만"},
  {keys:["pentru că","because"], ending:"-어서"},
  {keys:["dacă","if"], ending:"-(으)면"},
  {keys:["când","when"], ending:"-(으)ㄹ 때"}
];

/* =========================
   UTIL
========================= */
function normalize(t){
  return t.toLowerCase()
    .replace(/[.,!?]/g," ")
    .replace(/\s+/g," ")
    .trim();
}

function find(dict, text){
  for(const [k,v] of dict){
    if(text.includes(k)) return v;
  }
  return "";
}

/* =========================
   SPLIT CLAUZE
========================= */
function splitClauses(text){
  let norm = normalize(text);
  let clauses = [norm];
  let endings = [];

  CONNECTORS.forEach(c=>{
    c.keys.forEach(k=>{
      if(norm.includes(" "+k+" ")){
        clauses = norm.split(" "+k+" ");
        endings = clauses.map((_,i)=> i<clauses.length-1 ? c.ending : "");
      }
    });
  });

  return {clauses, endings};
}

/* =========================
   AUTO FILL
========================= */
function autoFill(){
  const text = document.getElementById("inputText").value;
  if(!text) return;

  const lang = document.getElementById("langSelect").value;
  const dict = lang==="en" ? EN : RO;

  const {clauses, endings} = splitClauses(text);

  ensureClauseCount(clauses.length);

  clauses.forEach((c,i)=>{
    const block = document.querySelectorAll(".clause-block")[i];
    const t = normalize(c);

    const set = (k,v)=>{
      const cell = block.querySelector(`.col[data-key="${k}"] .cell`);
      if(cell && !cell.textContent.trim()) cell.textContent = v;
    };

    set("subject", find(dict.subject,t));
    set("time", find(dict.time,t));
    set("place", find(dict.place,t));
    set("object", find(dict.object,t));
    set("verb", find(dict.verb,t));
    set("conj", endings[i]);
  });

  rebuildPreview();
}
function hasBatchimChar(ch){
  if(!ch) return false;
  const code = ch.charCodeAt(0);
  if(code < 0xAC00 || code > 0xD7A3) return false;
  return ((code - 0xAC00) % 28) !== 0;
}
function objectParticle(word){
  if(!word) return "";
  const last = word[word.length - 1];
  const batchim = hasBatchimChar(last);
  return word + (batchim ? "을" : "를");
}
  function subjectParticle(word, useTopic){
  if(!word) return "";
  const last = word[word.length-1];
  const batchim = hasBatchimChar(last);

  if(useTopic){
    return word + (batchim ? "은" : "는");
  } else {
    return word + (batchim ? "이" : "가");
  }
}
  /* =========================
   BUTTON
========================= */
document.getElementById("autoFillBtn")
  .addEventListener("click", autoFill);
/* =========================
   LIVE UPDATE
========================= */
document.addEventListener("input", e=>{
  if(e.target.classList.contains("cell")){
    rebuildPreview();
  }
});

/* INIT */
rebuildPreview();
</script>
</body>
</html>
