<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Raluca Korean – Builder FINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  *{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(120deg,#e8f0ff,#ffe9ff,#e9fff5);
  color:#2f343b;
}
.app{
  max-width:1100px;
  margin:0 auto;
  padding:16px 16px 80px;
}
.header{
  padding:16px;
  border-radius:24px;
  background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
  color:#fff;
  box-shadow:0 18px 40px rgba(0,0,0,.25);
}
.header h1{margin:0;font-size:22px}
.header p{margin:6px 0 0;font-size:13px;opacity:.95}

.card{
  margin-top:16px;
  padding:16px;
  border-radius:22px;
  background:#ffffffcc;
  box-shadow:0 16px 32px rgba(0,0,0,.12);
}

textarea{
  width:100%;
  min-height:80px;
  padding:12px;
  border-radius:16px;
  border:1px solid #ddd;
  font-size:14px;
}

.actions{
  margin-top:10px;
  display:flex;
  gap:10px;
}
button{
  border:none;
  border-radius:999px;
  padding:8px 18px;
  font-weight:800;
  color:#fff;
  cursor:pointer;
  background:linear-gradient(135deg,#6b8cff,#9b6bff);
}
button.secondary{
  background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
}

.table-block{
  margin-top:14px;
  padding:12px;
  border-radius:20px;
  background:#ffffffcc;
  box-shadow:0 14px 28px rgba(0,0,0,.12);
}

.table-title{
  font-weight:900;
  font-size:13px;
  margin-bottom:6px;
}

.table{
  display:flex;
  gap:8px;
  overflow-x:auto;
}

.col{
  min-width:120px;
  padding:8px;
  border-radius:16px;
  background:#fdfbf7;
  border:1px solid #e2d7c8;
}
.col-header{
  font-size:10px;
  font-weight:900;
  color:#7b5dff;
  margin-bottom:4px;
}
.col-body{
  min-height:1.6em;
  font-size:15px;
  font-weight:900;
}
.col-body[contenteditable]{
  outline:none;
}

.preview{
  margin-top:18px;
}
.sentence{
  font-size:24px;
  font-weight:900;
  margin-top:10px;
}
.polite{
  font-size:12px;
  font-weight:800;
}
  
</head>
</style>  
<body>
  <div class="app">

    <header class="header">
      <h1>Raluca Korean – Builder FINAL</h1>
      <p>Construcție propoziții coreene – multi-clause, particles corecte</p>
    </header>

    <!-- INPUT -->
    <section class="card">
      <textarea id="inputText"
        placeholder="Ex: Astăzi merg la cafenea și citesc o carte și beau o cafea."></textarea>
      <div class="actions">
        <button id="autoFill">Auto-fill</button>
        <button id="resetAll" class="secondary">Reset</button>
      </div>
    </section>

    <!-- CLAUSES -->
    <div id="clausesHost"></div>

    <!-- PREVIEW -->
    <section class="card preview">
      <label class="polite">
        <input type="checkbox" id="politeToggle">
        Politețe (doar ultima clauză)
      </label>
      <div id="previewSentence" class="sentence">저 가요</div>
    </section>

  </div>
 <script> 
  /* =========================================================
   RALUCA KOREAN – BUILDER LOGIC (FINAL)
   ========================================================= */

/* ===================== UTILITARE ===================== */

function hasFinalConsonant(word) {
  if (!word) return false;
  const code = word.charCodeAt(word.length - 1);
  if (code < 0xac00 || code > 0xd7a3) return false;
  return ((code - 0xac00) % 28) !== 0;
}

function particle(word, pair) {
  if (!word) return "";
  const [a, b] = pair.split("/");
  return hasFinalConsonant(word) ? a : b;
}

/* ===================== PARTICULE ===================== */

function subjectParticle(word) {
  return particle(word, "은/는");
}

function focusSubjectParticle(word) {
  return particle(word, "이/가");
}

function objectParticle(word) {
  return particle(word, "을/를");
}

function placeParticle(place, verb) {
  const movementVerbs = ["가다", "오다", "다니다"];
  return movementVerbs.includes(verb) ? "에" : "에서";
}

/* ===================== DATE DE BAZĂ ===================== */

const DATA = {
  subject: [
    { ko: "저", ro: "eu (formal)" },
    { ko: "친구", ro: "prieten" },
    { ko: "학생", ro: "student" }
  ],

  time: [
    { ko: "오늘", ro: "astăzi" },
    { ko: "내일", ro: "mâine" }
  ],

  place: [
    { ko: "집", ro: "acasă" },
    { ko: "카페", ro: "cafenea" }
  ],

  mod: [
    { ko: "잘", ro: "bine" },
    { ko: "천천히", ro: "încet" }
  ],

  object: [
    { ko: "책", ro: "carte" },
    { ko: "커피", ro: "cafea" }
  ],

  numeral: [
    { ko: "한", ro: "un/o" },
    { ko: "두", ro: "doi/două" }
  ],

  counter: [
    { ko: "권", ro: "volum (cărți)" },
    { ko: "잔", ro: "ceașcă" }
  ],

  verb: [
    { inf: "가다", stem: "가", polite: "가요", ro: "a merge" },
    { inf: "읽다", stem: "읽", polite: "읽어요", ro: "a citi" },
    { inf: "마시다", stem: "마시", polite: "마셔요", ro: "a bea" }
  ],

  conj: [
    { ko: "그리고", ro: "și" },
    { ko: "그래서", ro: "deci" }
  ]
};

/* ===================== STARE BUILDER ===================== */

const state = {
  subject: null,
  time: null,
  place: null,
  mod: null,
  object: null,
  numeral: null,
  counter: null,
  verb: null,
  conj: null
};

/* ===================== SELECTARE ===================== */

function selectPart(key, value) {
  state[key] = value;
  render();
}

/* ===================== BUILD SENTENCE ===================== */

function buildSentence() {
  if (!state.verb) return "";

  const v = state.verb;
  let parts = [];

  if (state.subject) {
    parts.push(state.subject.ko + subjectParticle(state.subject.ko));
  }

  if (state.time) {
    parts.push(state.time.ko);
  }

  if (state.place) {
    parts.push(
      state.place.ko +
      placeParticle(state.place.ko, v.inf)
    );
  }

  if (state.mod) {
    parts.push(state.mod.ko);
  }

  if (state.object) {
    let obj = state.object.ko;

    if (state.numeral && state.counter) {
      obj =
        state.numeral.ko +
        " " +
        state.counter.ko +
        " " +
        obj;
    }

    obj += objectParticle(state.object.ko);
    parts.push(obj);
  }

  parts.push(v.polite);

  return parts.join(" ");
}

/* ===================== HIGHLIGHT CLAUSE ===================== */

function highlightByRole(sentence) {
  return sentence
    .replace(state.subject?.ko ?? "", `<span class="hl subject">${state.subject?.ko ?? ""}</span>`)
    .replace(state.time?.ko ?? "", `<span class="hl time">${state.time?.ko ?? ""}</span>`)
    .replace(state.place?.ko ?? "", `<span class="hl place">${state.place?.ko ?? ""}</span>`)
    .replace(state.object?.ko ?? "", `<span class="hl object">${state.object?.ko ?? ""}</span>`)
    .replace(state.verb?.polite ?? "", `<span class="hl verb">${state.verb?.polite ?? ""}</span>`);
}

/* ===================== RANDOM ===================== */

function randomSentence() {
  Object.keys(state).forEach(key => {
    const arr = DATA[key];
    if (!arr) return;
    state[key] = arr[Math.floor(Math.random() * arr.length)];
  });
  render();
}

/* ===================== AUDIO ===================== */

function speakKorean(text) {
  const ut = new SpeechSynthesisUtterance(text);
  ut.lang = "ko-KR";
  speechSynthesis.speak(ut);
}

/* ===================== SAVE ===================== */

function saveSentence(sentence) {
  const favs = JSON.parse(localStorage.getItem("rk_favs") || "[]");
  favs.push(sentence);
  localStorage.setItem("rk_favs", JSON.stringify(favs));
}

/* ===================== RENDER ===================== */

function render() {
  const sentence = buildSentence();
  const preview = document.getElementById("previewKo");
  if (!preview) return;

  preview.innerHTML = highlightByRole(sentence);
}

/* ===================== EXPORT ===================== */

window.RKBuilder = {
  DATA,
  state,
  selectPart,
  randomSentence,
  speakKorean,
  saveSentence,
  buildSentence
};
</script>
</body>
</html>
