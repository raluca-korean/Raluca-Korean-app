<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Raluca Korean – Sentence Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  background:#f4f6fb;
  color:#2f343b;
}

.app{
  max-width:1100px;
  margin:0 auto;
  padding:20px 16px 80px;
}

h1{
  margin:0 0 10px;
  font-size:22px;
  font-weight:900;
}

.section-title{
  margin:24px 0 8px;
  font-size:13px;
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#556;
}

/* ===== CLAUSE BLOCK ===== */

.clause-block{
  background:#ffffff;
  border-radius:18px;
  padding:12px;
  margin-bottom:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.clause-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  font-weight:900;
  color:#666;
  margin-bottom:6px;
}

.table{
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding-bottom:4px;
}

/* ===== COLUMN ===== */

.col{
  flex:0 0 auto;
  min-width:120px;
  max-width:150px;
  background:#faf8f4;
  border-radius:14px;
  padding:8px;
  border:1px solid #e3dccf;
}

.col-header{
  font-size:10px;
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:#7b5dff;
  border-bottom:1px solid #ddd;
  padding-bottom:3px;
  margin-bottom:4px;
}

.col-hint{
  font-size:10px;
  color:#999;
  margin-bottom:2px;
}

.cell{
  font-size:15px;
  font-weight:900;
  min-height:1.4em;
}

.cell[contenteditable]{
  outline:none;
  cursor:text;
}

.cell:focus{
  box-shadow:0 0 0 2px rgba(123,93,255,.35);
  border-radius:6px;
}

/* ===== PREVIEW ===== */

.preview{
  margin-top:20px;
  background:#fff;
  border-radius:18px;
  padding:14px;
  box-shadow:0 14px 30px rgba(0,0,0,.1);
}

.preview-title{
  font-size:12px;
  font-weight:900;
  color:#555;
  margin-bottom:6px;
}

.preview-ko{
  font-size:22px;
  font-weight:900;
  line-height:1.5;
}

</style>
</head>

<body>
<div class="app">

<h1>Raluca Korean – Builder</h1>

<div class="section-title">Builder (multi-clause)</div>

<!-- ===================== -->
<!-- CLAUSE 1 -->
<!-- ===================== -->
<section class="clause-block" data-clause="0">

  <div class="clause-header">
    <span>Propoziția 1</span>
    <span>VERB infinitiv + CONJ</span>
  </div>

  <div class="table">

    <div class="col" data-key="subject">
      <div class="col-header">Subject</div>
      <div class="col-hint">eu / tu / noi</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="time">
      <div class="col-header">Time</div>
      <div class="col-hint">azi / mâine</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="place">
      <div class="col-header">Place</div>
      <div class="col-hint">loc (bază)</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="mod">
      <div class="col-header">Mod</div>
      <div class="col-hint">bine / încet</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="object">
      <div class="col-header">Object</div>
      <div class="col-hint">ce?</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="numeral">
      <div class="col-header">Numeral</div>
      <div class="col-hint">un / doi</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="counter">
      <div class="col-header">Counter</div>
      <div class="col-hint">권 / 개</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="verb">
      <div class="col-header">Verb</div>
      <div class="col-hint">infinitiv (…다)</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="conj">
      <div class="col-header">Conj</div>
      <div class="col-hint">-고 / -지만</div>
      <div class="cell" contenteditable></div>
    </div>

  </div>
</section>

<!-- ===================== -->
<!-- CLAUSE 2 -->
<!-- ===================== -->
<section class="clause-block" data-clause="1">

  <div class="clause-header">
    <span>Propoziția 2</span>
    <span>continuare</span>
  </div>

  <div class="table">

    <div class="col" data-key="subject">
      <div class="col-header">Subject</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="time">
      <div class="col-header">Time</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="place">
      <div class="col-header">Place</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="mod">
      <div class="col-header">Mod</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="object">
      <div class="col-header">Object</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="numeral">
      <div class="col-header">Numeral</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="counter">
      <div class="col-header">Counter</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="verb">
      <div class="col-header">Verb</div>
      <div class="cell" contenteditable></div>
    </div>

    <div class="col" data-key="conj">
      <div class="col-header">Conj</div>
      <div class="cell" contenteditable></div>
    </div>

  </div>
</section>

<!-- ===== PREVIEW ===== -->

<div class="preview">
  <div class="preview-title">Propoziția finală</div>
  <label style="display:flex;align-items:center;gap:6px;">
  <input type="checkbox" id="topicToggle" checked />
  <span>은/는 (topic)</span>
</label>
  <div class="preview-ko" id="previewSentence">저 가요</div>
</div>

</div>
</body>
  <script>
(function () {
  "use strict";

  /* =========================
     UTILS
  ========================= */
  function normalizeText(text){
    if(!text) return "";
    let t = text.toLowerCase();
    t = t.replace(/ş/g,"ș").replace(/ţ/g,"ț");
    t = t.replace(/[.,!?;:]/g," ");
    return t.replace(/\s+/g," ").trim();
  }

  function escapeRegExp(s){
    return String(s).replace(/[.*+?^${}()|[\]\\]/g,"\\$&");
  }

  function lastHangulChar(str){
    const s = (str||"").trim();
    return s ? s[s.length-1] : "";
  }

  function hasBatchim(ch){
    if(!ch) return false;
    const code = ch.charCodeAt(0);
    if(code < 0xAC00 || code > 0xD7A3) return false;
    return ((code - 0xAC00) % 28) !== 0;
  }

  /* =========================
     PARTICLES
  ========================= */
  function subjectParticle(n){
    const last = lastHangulChar(n);
    return hasBatchim(last) ? n+"이" : n+"가";
  }

  function topicParticle(n){
    const last = lastHangulChar(n);
    return hasBatchim(last) ? n+"은" : n+"는";
  }

  function objectParticle(n){
    const last = lastHangulChar(n);
    return hasBatchim(last) ? n+"을" : n+"를";
  }

  function choosePlaceParticle(place, verb){
    if(!place) return "";
    return (verb==="가다" || verb==="오다") ? place+"에" : place+"에서";
  }

  /* =========================
     CONNECTORS
  ========================= */
  const CONNECTORS = [
    {keys:["și","si","and"], ending:"-고"},
    {keys:["dar","but"], ending:"-지만"},
    {keys:["pentru că","pentru ca","because"], ending:"-어서"},
    {keys:["dacă","daca","if"], ending:"-(으)면"},
    {keys:["când","when"], ending:"-(으)ㄹ 때"},
    {keys:["ca să","in order to"], ending:"-(으)려고"}
  ];

  function buildConnectorRegex(){
    const all = CONNECTORS.flatMap(c=>c.keys);
    all.sort((a,b)=>b.length-a.length);
    return new RegExp("\\s("+all.map(escapeRegExp).join("|")+")\\s","ig");
  }

  function mapConnector(tok){
    const t = tok.toLowerCase();
    for(const c of CONNECTORS){
      if(c.keys.includes(t)) return c.ending;
    }
    return "-고";
  }

  function splitIntoChain(text){
    const t = normalizeText(text);
    if(!t) return {clauses:[], links:[]};

    const re = buildConnectorRegex();
    let m,last=0;
    const parts=[];
    while((m=re.exec(t))){
      const before=t.slice(last,m.index).trim();
      if(before) parts.push({type:"clause",text:before});
      parts.push({type:"conn",text:m[1]});
      last=m.index+m[0].length;
    }
    const tail=t.slice(last).trim();
    if(tail) parts.push({type:"clause",text:tail});

    const clauses=[], links=[];
    parts.forEach(p=>{
      if(p.type==="clause") clauses.push(p.text);
      else links.push(mapConnector(p.text));
    });
    while(links.length>=clauses.length) links.pop();

    return {clauses,links};
  }

  /* =========================
     RULES (RO + EN)
  ========================= */
  const RO = {
    subject:[[/\beu\b/i,"저"],[/\btu\b/i,"너"],[/\bnoi\b/i,"우리"]],
    time:[[/astăzi|azi/i,"오늘"],[/mâine/i,"내일"],[/ieri/i,"어제"]],
    place:[[/cafenea|cafe/i,"카페"],[/acasă|acasa/i,"집"]],
    object:[[/carte/i,"책"],[/cafea/i,"커피"]],
    numeral:[[/o\b/i,"한"],[/două|doua/i,"두"]],
    counter:[[/carte/i,"권"],[/cafea/i,"개"]],
    verb:[[/merg/i,"가다"],[/beau/i,"마시다"],[/citesc/i,"읽다"]]
  };

  function parseSlots(text){
    const t = normalizeText(text);
    const out={};
    for(const k in RO){
      for(const r of RO[k]){
        if(r[0].test(t)){ out[k]=r[1]; break; }
      }
    }
    return out;
  }

  /* =========================
     UI HELPERS
  ========================= */
  const host=document.getElementById("clausesHost");

  function clauseHTML(i){
    return `
      <section class="table-block" data-i="${i}">
        <div class="table-title">Propoziția ${i+1}</div>
        <div id="t${i}" class="table-horizontal">
          ${["subject","time","place","mod","object","numeral","counter","verb","conj"]
            .map(k=>`
            <div class="col" data-k="${k}">
              <div class="col-header">${k}</div>
              <div class="col-body-main" contenteditable></div>
            </div>`).join("")}
        </div>
      </section>`;
  }

  function ensureClauses(n){
    while(host.children.length<n) host.insertAdjacentHTML("beforeend",clauseHTML(host.children.length));
    while(host.children.length>n) host.lastElementChild.remove();
  }

  function cell(i,k){
    return document.querySelector(`#t${i} .col[data-k="${k}"] .col-body-main`);
  }

  /* =========================
     ENDINGS
  ========================= */
  function attachEnding(verb,ending){
    if(!verb||!verb.endsWith("다")||!ending) return verb;
    const stem=verb.slice(0,-1);
    const last=lastHangulChar(stem);
    const b=hasBatchim(last);

    if(ending==="-(으)면") return stem+(b?"으면":"면");
    if(ending==="-(으)ㄹ 때") return stem+(b?"을 때":"ㄹ 때");
    if(ending==="-(으)려고") return stem+(b?"으려고":"려고");
    if(ending==="-어서") return stem+"어서";
    if(ending==="-고") return stem+"고";
    if(ending==="-지만") return stem+"지만";

    return stem+ending;
  }

  function polite(verb){
    if(!verb.endsWith("다")) return verb;
    const stem=verb.slice(0,-1);
    return stem+"요";
  }

  /* =========================
     PREVIEW
  ========================= */
  function buildClause(i,last){
    const s = cell(i,"subject")?.textContent.trim();
    const t = cell(i,"time")?.textContent.trim();
    const p = cell(i,"place")?.textContent.trim();
    const o = cell(i,"object")?.textContent.trim();
    const n = cell(i,"numeral")?.textContent.trim();
    const c = cell(i,"counter")?.textContent.trim();
    const v = cell(i,"verb")?.textContent.trim();
    const e = cell(i,"conj")?.textContent.trim();

    const topic = document.getElementById("topicToggle")?.checked;
    const politeOn = document.getElementById("politeToggle")?.checked;

    const subj = s ? (topic?topicParticle(s):subjectParticle(s)) : "";
    const obj  = o ? objectParticle(n&&c?`${o} ${n} ${c}`:o) : "";
    const place = choosePlaceParticle(p,v);
    let verbOut = attachEnding(v,e);
    if(politeOn && last && !e) verbOut = polite(v);

    return [subj,t,place,obj,verbOut].filter(Boolean).join(" ");
  }

  function rebuild(){
    const out=[];
    const blocks=host.children.length;
    for(let i=0;i<blocks;i++){
      const txt=buildClause(i,i===blocks-1);
      if(txt) out.push(txt);
    }
    document.getElementById("previewSentence").textContent =
      out.join(" ") || "저 가요";
  }

  /* =========================
     AUTO FILL
  ========================= */
  function autoFill(){
    const raw=document.getElementById("inputText").value;
    const chain=splitIntoChain(raw);
    ensureClauses(chain.clauses.length||1);

    chain.clauses.forEach((c,i)=>{
      const s=parseSlots(c);
      for(const k in s) cell(i,k).textContent=s[k];
    });

    chain.links.forEach((l,i)=>cell(i,"conj").textContent=l);
    rebuild();
  }

  /* =========================
     INIT
  ========================= */
  function init(){
    ensureClauses(1);
    cell(0,"subject").textContent="저";
    cell(0,"verb").textContent="가다";

    document.getElementById("autoFillBtn").onclick=autoFill;
    document.getElementById("clearBtn").onclick=()=>location.reload();
    document.addEventListener("input",rebuild);
    rebuild();
  }

  window.addEventListener("DOMContentLoaded",init);
})();
</script>;
</body>
</html>
