<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Raluca Korean – Builder FINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  *{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(120deg,#e8f0ff,#ffe9ff,#e9fff5);
  color:#2f343b;
}
.app{
  max-width:1100px;
  margin:0 auto;
  padding:16px 16px 80px;
}
.header{
  padding:16px;
  border-radius:24px;
  background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
  color:#fff;
  box-shadow:0 18px 40px rgba(0,0,0,.25);
}
.header h1{margin:0;font-size:22px}
.header p{margin:6px 0 0;font-size:13px;opacity:.95}

.card{
  margin-top:16px;
  padding:16px;
  border-radius:22px;
  background:#ffffffcc;
  box-shadow:0 16px 32px rgba(0,0,0,.12);
}

textarea{
  width:100%;
  min-height:80px;
  padding:12px;
  border-radius:16px;
  border:1px solid #ddd;
  font-size:14px;
}

.actions{
  margin-top:10px;
  display:flex;
  gap:10px;
}
button{
  border:none;
  border-radius:999px;
  padding:8px 18px;
  font-weight:800;
  color:#fff;
  cursor:pointer;
  background:linear-gradient(135deg,#6b8cff,#9b6bff);
}
button.secondary{
  background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
}

.table-block{
  margin-top:14px;
  padding:12px;
  border-radius:20px;
  background:#ffffffcc;
  box-shadow:0 14px 28px rgba(0,0,0,.12);
}

.table-title{
  font-weight:900;
  font-size:13px;
  margin-bottom:6px;
}

.table{
  display:flex;
  gap:8px;
  overflow-x:auto;
}

.col{
  min-width:120px;
  padding:8px;
  border-radius:16px;
  background:#fdfbf7;
  border:1px solid #e2d7c8;
}
.col-header{
  font-size:10px;
  font-weight:900;
  color:#7b5dff;
  margin-bottom:4px;
}
.col-body{
  min-height:1.6em;
  font-size:15px;
  font-weight:900;
}
.col-body[contenteditable]{
  outline:none;
}

.preview{
  margin-top:18px;
}
.sentence{
  font-size:24px;
  font-weight:900;
  margin-top:10px;
}
.polite{
  font-size:12px;
  font-weight:800;
}
  
</head>
</style>  
<body>
  <div class="app">

    <header class="header">
      <h1>Raluca Korean – Builder FINAL</h1>
      <p>Construcție propoziții coreene – multi-clause, particles corecte</p>
    </header>

    <!-- INPUT -->
    <section class="card">
      <textarea id="inputText"
        placeholder="Ex: Astăzi merg la cafenea și citesc o carte și beau o cafea."></textarea>
      <div class="actions">
        <button id="autoFill">Auto-fill</button>
        <button id="resetAll" class="secondary">Reset</button>
      </div>
    </section>

    <!-- CLAUSES -->
    <div id="clausesHost"></div>

    <!-- PREVIEW -->
    <section class="card preview">
      <label class="polite">
        <input type="checkbox" id="politeToggle">
        Politețe (doar ultima clauză)
      </label>
      <div id="previewSentence" class="sentence">저 가요</div>
    </section>

  </div>

<script>
  "use strict";

/* =========================
   CLAUSE STRUCTURE
========================= */
const host = document.getElementById("clausesHost");

const COLUMNS = [
  ["subject","SUBJECT"],
  ["time","TIME"],
  ["place","PLACE"],
  ["mod","MOD"],
  ["object","OBJECT"],
  ["numeral","NUMERAL"],
  ["counter","COUNTER"],
  ["verb","VERB (…다)"],
  ["conj","CONJ / ENDING"]
];

function clauseHTML(index){
  let cols = "";
  COLUMNS.forEach(c=>{
    cols+=`
      <div class="col" data-key="${c[0]}">
        <div class="col-header">${c[1]}</div>
        <div class="col-body" contenteditable="true"></div>
      </div>`;
  });
  return `
    <section class="table-block" data-index="${index}">
      <div class="table-title">Propoziția ${index+1}</div>
      <div class="table">${cols}</div>
    </section>`;
}

function ensureClauses(n){
  const cur = host.children.length;
  if(cur<n){
    for(let i=cur;i<n;i++){
      host.insertAdjacentHTML("beforeend",clauseHTML(i));
    }
  }else if(cur>n){
    for(let i=cur-1;i>=n;i--) host.children[i].remove();
  }
}

/* =========================
   HELPERS
========================= */
function cell(i,key){
  return host.children[i]
    .querySelector(`.col[data-key="${key}"] .col-body`);
}

function hasBatchim(word){
  if(!word) return false;
  const c = word.charCodeAt(word.length-1);
  if(c<0xAC00||c>0xD7A3) return false;
  return ((c-0xAC00)%28)!==0;
}

/* =========================
   PARTICLES
========================= */
function topicParticle(noun){
  return hasBatchim(noun) ? noun+"은" : noun+"는";
}
function objectParticle(noun){
  return hasBatchim(noun) ? noun+"을" : noun+"를";
}
function placeParticle(place,verb){
  if(verb==="가다"||verb==="오다") return place+"에";
  return place+"에서";
}

/* =========================
   VERB ENDINGS
========================= */
function attachEnding(verb,ending){
  if(!verb||!verb.endsWith("다")) return verb;
  if(!ending) return verb;

  const stem = verb.slice(0,-1);
  if(ending==="고") return stem+"고";
  if(ending==="지만") return stem+"지만";
  if(ending==="아서"||ending==="어서") return stem+ending;
  if(ending==="(으)면")
    return stem+(hasBatchim(stem)?"으면":"면");
  return stem+ending;
}

function politeVerb(verb){
  if(!verb.endsWith("다")) return verb;
  const stem=verb.slice(0,-1);
  return stem+"요";
}

/* =========================
   BUILD SENTENCE
========================= */
function build(){
  const polite=document.getElementById("politeToggle").checked;
  const parts=[];
  const count=host.children.length;

  for(let i=0;i<count;i++){
    const s=cell(i,"subject").textContent.trim();
    const t=cell(i,"time").textContent.trim();
    const p=cell(i,"place").textContent.trim();
    const m=cell(i,"mod").textContent.trim();
    const o=cell(i,"object").textContent.trim();
    const n=cell(i,"numeral").textContent.trim();
    const c=cell(i,"counter").textContent.trim();
    const v=cell(i,"verb").textContent.trim();
    const conj=cell(i,"conj").textContent.trim();

    let obj="";
    if(o&&n&&c) obj=`${o} ${n}${c}`;
    else if(o) obj=o;

    let place="";
    if(p) place=placeParticle(p,v);

    let verbOut=attachEnding(v,conj);
    if(polite&&i===count-1) verbOut=politeVerb(v);

    const clause=[
      s&&topicParticle(s),
      t,
      place,
      m,
      obj&&objectParticle(obj),
      verbOut
    ].filter(Boolean).join(" ");

    parts.push(clause);
  }

  document.getElementById("previewSentence").textContent=
    parts.join(" ").replace(/\s+/g," ").trim()||"저 가요";
}

/* =========================
   EVENTS
========================= */
document.addEventListener("input",e=>{
  if(e.target.classList.contains("col-body")) build();
});
document.getElementById("politeToggle").addEventListener("change",build);

document.getElementById("resetAll").onclick=()=>{
  ensureClauses(1);
  COLUMNS.forEach(c=>cell(0,c[0]).textContent="");
  cell(0,"subject").textContent="저";
  cell(0,"verb").textContent="가다";
  build();
};

/* INIT */
ensureClauses(1);
cell(0,"subject").textContent="저";
cell(0,"verb").textContent="가다";
build();
  
</script>
</body>
</html>
