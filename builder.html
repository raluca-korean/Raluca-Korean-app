<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Raluca Korean – Sentence Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: system-ui, -apple-system, Segoe UI, Roboto;
  background:#f4f6fb;
  padding:20px;
}
h1{margin-bottom:10px}
textarea{width:100%;height:80px}
button{margin:6px 4px;padding:6px 12px;font-weight:600}

.table-block{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
.table{
  display:flex;
  gap:6px;
  overflow-x:auto;
}
.col{
  min-width:120px;
  border:1px solid #ddd;
  border-radius:10px;
  padding:6px;
}
.col h4{
  margin:0;
  font-size:11px;
  text-align:center;
  color:#555;
}
.col div{
  margin-top:4px;
  min-height:28px;
  border:1px dashed #ccc;
  border-radius:6px;
  padding:4px;
}
.col div[contenteditable]{outline:none}

#preview{
  background:#fff;
  padding:14px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}
#previewSentence{
  font-size:22px;
  font-weight:900;
  margin-top:6px;
}
</style>
</head>

<body>

<h1>Raluca Korean – Builder</h1>

<textarea id="inputText"
placeholder="Ex: Astăzi merg la cafenea și citesc o carte și beau o cafea."></textarea>
<br>
<button id="addClause">+ Clauză</button>
<button id="resetAll">Reset</button>

<label style="margin-left:12px">
  <input type="checkbox" id="politeToggle"> Polite (ultima clauză)
</label>

<h2>Builder</h2>
<div id="clausesHost"></div>

<div id="preview">
  <div>Propoziția finală:</div>
  <div id="previewSentence">저 가요</div>
</div>

<script>
"use strict";

/* ==========================
   CONFIG
========================== */
const COLUMNS = [
  ["subject","SUBIECT"],
  ["time","TIMP"],
  ["place","LOC"],
  ["mod","MOD"],
  ["object","OBIECT"],
  ["numeral","NUMERAL"],
  ["counter","COUNTER"],
  ["verb","VERB (…다)"],
  ["conj","CONJ / ENDING"]
];

const host = document.getElementById("clausesHost");

/* ==========================
   UTILS
========================== */
function hasBatchim(ch){
  const code = ch.charCodeAt(ch.length-1);
  if(code<0xac00||code>0xd7a3) return false;
  return (code-0xac00)%28!==0;
}

function attachEnding(verb, ending){
  if(!verb||!verb.endsWith("다")) return verb;
  if(!ending) return verb;

  const stem = verb.slice(0,-1);
  const last = stem[stem.length-1];
  const b = hasBatchim(last);

  if(ending==="-고"||ending==="고") return stem+"고";
  if(ending==="-지만"||ending==="지만") return stem+"지만";
  if(ending==="-아서"||ending==="아서") return stem+"아서";
  if(ending==="-어서"||ending==="어서") return stem+"어서";
  if(ending==="-(으)면") return stem+(b?"으면":"면");

  return stem+ending.replace(/^-/,"");
}

function politeForm(verb){
  if(!verb||!verb.endsWith("다")) return verb;
  const stem = verb.slice(0,-1);
  const last = stem[stem.length-1];
  const code = last.charCodeAt(0);
  const jung = Math.floor(((code-0xac00)%(21*28))/28);
  const aGroup=[0,2,8,9];
  return stem+(aGroup.includes(jung)?"아요":"어요");
}

function placeParticle(place, verb){
  if(!place) return "";
  if(verb==="가다"||verb==="오다") return place+"에";
  return place+"에서";
}

/* ==========================
   UI
========================== */
function createClause(){
  const block=document.createElement("div");
  block.className="table-block";

  const table=document.createElement("div");
  table.className="table";

  COLUMNS.forEach(c=>{
    const col=document.createElement("div");
    col.className="col";
    col.dataset.key=c[0];
    col.innerHTML=`<h4>${c[1]}</h4><div contenteditable="true"></div>`;
    table.appendChild(col);
  });

  block.appendChild(table);
  host.appendChild(block);
}

function resetAll(){
  host.innerHTML="";
  createClause();
  buildPreview();
}

/* ==========================
   BUILD SENTENCE
========================== */
function read(clause,key){
  return clause.querySelector(`[data-key="${key}"] div`).textContent.trim();
}

function buildPreview(){
  const clauses=[...host.children];
  const polite=document.getElementById("politeToggle").checked;
  let out=[];

  clauses.forEach((cl,i)=>{
    const subject=read(cl,"subject");
    const time=read(cl,"time");
    const placeBase=read(cl,"place");
    const mod=read(cl,"mod");
    const object=read(cl,"object");
    const numeral=read(cl,"numeral");
    const counter=read(cl,"counter");
    const verb=read(cl,"verb");
    const conj=read(cl,"conj");

    const place=placeParticle(placeBase,verb);
    let obj=object;
    if(object&&numeral&&counter) obj=`${object} ${numeral}${counter}`;

    let vOut=verb;
    if(conj) vOut=attachEnding(verb,conj);
    if(!conj&&polite&&i===clauses.length-1)
      vOut=politeForm(verb);

    const chunk=[subject,time,place,mod,obj,vOut].filter(Boolean).join(" ");
    out.push(chunk);
  });

  document.getElementById("previewSentence").textContent=
    out.join(" ").replace(/\s+/g," ").trim()||"저 가요";
}

/* ==========================
   EVENTS
========================== */
document.addEventListener("input",e=>{
  if(e.target.closest(".col")) buildPreview();
});

document.getElementById("addClause").onclick=()=>{
  createClause();
  buildPreview();
};

document.getElementById("resetAll").onclick=resetAll;
document.getElementById("politeToggle").onchange=buildPreview;

/* ==========================
   INIT
========================== */
resetAll();
</script>

</body>
</html>
