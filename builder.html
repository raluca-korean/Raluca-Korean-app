Bb9
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Raluca Korean â€“ Study App v2.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f7f3ff;
      --card-bg: #ffffff;
      --accent: #c9b5ff;
      --accent-strong: #9b7cff;
      --text-main: #333333;
      --text-soft: #666666;
      --border: #e0d7ff;
      --dimmed-bg: #f2eefc;
      --overlay-bg: rgba(0, 0, 0, 0.2);
    }
    header{text-align:center;padding:4px 8px 4px;}
    header h1{font-size:18px;margin:2px 0;font-weight:700;color:var(--accent-strong);}
    header p{margin:0;font-size:11px;color:var(--text-soft);}

    .screen{display:none;flex-direction:column;gap:10px;flex:1;min-height:0;}
    .screen.active{display:flex;}

    .mode-panel{
      background:var(--card-bg);border-radius:12px;border:1px solid var(--border);
      padding:6px 8px;font-size:11px;display:flex;flex-direction:column;gap:4px;
      box-shadow:0 4px 12px rgba(120,96,190,0.08);
    }
    .mode-row{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;
    }
    .mode-row label{font-size:11px;display:flex;align-items:center;gap:4px;}
    .part-toggles{display:flex;flex-wrap:wrap;gap:6px;}
    .chip{
      display:inline-flex;align-items:center;gap:3px;
      padding:3px 8px;border-radius:999px;background:#ede7ff;color:var(--accent-strong);
      font-size:10px;cursor:pointer;
    }
    .chip input{margin:0;}
    .section-label{font-size:11px;font-weight:600;color:var(--accent-strong);margin-top:2px;}

    .small-mode-btn{
      padding:3px 8px;
      font-size:10px;
    }
    .small-mode-btn.active{
      background:var(--accent-strong);
      color:#fff;
    }

    .table-block{
      background:var(--card-bg);border-radius:14px;padding:8px;
      box-shadow:0 6px 16px rgba(120,96,190,0.12);border:1px solid var(--border);
      display:flex;flex-direction:column;gap:6px;flex:1;min-height:0;
    }
    .table-title{
      font-size:11px;font-weight:600;color:var(--text-soft);
      display:flex;justify-content:space-between;align-items:center;
    }
    .table-horizontal{
      display:flex;flex-direction:row;overflow-x:auto;padding-bottom:4px;gap:6px;
    }
    .col{
      min-width:110px;max-width:140px;flex:0 0 auto;background:#faf8ff;border-radius:10px;
      border:1px solid var(--border);display:flex;flex-direction:column;
      padding:6px 6px 8px;transition:0.2s;cursor:pointer;
      touch-action:manipulation;
    }
    .col-header{
      font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;
      color:var(--accent-strong);margin-bottom:4px;border-bottom:1px solid var(--border);
      padding-bottom:3px;
    }
    /* Header de coloanÄƒ cu titlu + bifÄƒ ON/OFF */
.col-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:4px;
}

.col-header input.col-toggle{
  width:14px;
  height:14px;
  accent-color: var(--accent-strong);
  flex-shrink:0;
}
    .col-body-label{font-size:10px;color:var(--text-soft);margin-bottom:2px;}
    .col-body-main{font-size:15px;font-weight:600;margin-bottom:2px;}
    .col-body-extra{font-size:11px;color:var(--text-soft);}
    .dimmed{
      opacity:0.35;background-image:repeating-linear-gradient(
        -45deg,var(--dimmed-bg),var(--dimmed-bg) 4px,#fdfbff 4px,#fdfbff 8px
      );
    }

    .controls{
      display:flex;justify-content:space-between;align-items:center;gap:8px;
      padding-top:4px;border-top:1px dashed var(--border);
    }
    .btn-group{display:flex;gap:6px;}
    button{
      border-radius:999px;border:none;padding:6px 10px;font-size:12px;font-weight:600;
      cursor:pointer;background:var(--accent);color:#fff;display:inline-flex;
      align-items:center;gap:4px;box-shadow:0 2px 6px rgba(90,70,160,0.25);
    }
    button.secondary{background:#ede7ff;color:var(--accent-strong);box-shadow:none;}
    button:disabled{opacity:0.4;box-shadow:none;cursor:default;}
    .page-indicator{font-size:11px;color:var(--text-soft);}
    .legend{font-size:10px;color:var(--text-soft);text-align:center;padding:2px 4px 0;}
    .hidden{display:none !important;}

    .preview-card{
      margin-top:6px;padding:8px;border-radius:12px;
      background:#f9f7ff;border:1px solid var(--border);
      display:flex;flex-direction:column;gap:4px;
    }
    .preview-title{
      font-size:11px;font-weight:600;color:var(--accent-strong);
      display:flex;justify-content:space-between;align-items:center;
    }
    .preview-ko{
      font-size:14px;font-weight:600;margin-top:2px;
    }
    .preview-ro{
      font-size:12px;color:var(--text-soft);
    }
    .preview-natural{
      font-size:11px;
      color:#8e6cff;
      margin-top:2px;
    }
    .preview-buttons{
      display:flex;gap:6px;margin-top:4px;flex-wrap:wrap;
    }
  
  
    .overlay{
      position:fixed;inset:0;background:var(--overlay-bg);
      display:flex;justify-content:center;align-items:flex-end;z-index:1000;
    }
    .panel{
      width:100%;max-width:900px;background:var(--card-bg);
      border-radius:18px 18px 0 0;box-shadow:0 -6px 18px rgba(0,0,0,0.15);
      padding:10px 12px 14px;animation:slideUp 0.18s ease-out;
    }
    @keyframes slideUp{
      from{transform:translateY(40px);opacity:0;}
      to{transform:translateY(0);opacity:1;}
    }
    .panel-header{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;
    }
    .panel-title{font-size:13px;font-weight:600;color:var(--accent-strong);}
    .panel-sub{font-size:11px;color:var(--text-soft);}
    .panel-close{
      background:transparent;color:var(--text-soft);box-shadow:none;
      padding:4px 6px;font-size:14px;
    }
    .panel-input-row{display:flex;gap:6px;margin-bottom:6px;}
    .panel-input-row input{
      flex:1;border-radius:999px;border:1px solid var(--border);
      padding:6px 10px;font-size:12px;
    }
    .panel-list{
      max-height:260px;overflow-y:auto;border-radius:10px;
      border:1px solid var(--border);background:#faf8ff;padding:4px;
    }
    .panel-item{
      padding:4px 8px;border-radius:8px;display:flex;justify-content:space-between;
      align-items:center;font-size:13px;cursor:pointer;
    }
    .panel-item:hover{background:#ede7ff;}
    .panel-item-main{font-weight:600;}
    .panel-item-extra{
      display:flex;flex-direction:column;align-items:flex-end;gap:2px;
    }
    .panel-item-tag{font-size:10px;color:var(--accent-strong);}

   

    .card{
      background:var(--card-bg);border-radius:14px;padding:10px;
      box-shadow:0 4px 12px rgba(120,96,190,0.12);border:1px solid var(--border);
      display:flex;flex-direction:column;gap:6px;
    }
    .card h2{
      margin:0;font-size:14px;color:var(--accent-strong);
    }
    .small-label{font-size:11px;color:var(--text-soft);}
    select{
      border-radius:999px;border:1px solid var(--border);
      padding:4px 10px;font-size:12px;background:#fff;
    }
   
   


    /* CARD GENERAL â€“ RomÃ¢nÄƒ â†’ CoreeanÄƒ, ExerciÈ›ii, Glosar */
.card{
  background: linear-gradient(145deg, #ffffff, #f5f0ff);
  border-radius: 18px;
  padding: 12px 14px;
  box-shadow: 0 10px 24px rgba(120,96,190,0.18);
  border: 1px solid rgba(201,181,255,0.6);
}

/* Titlurile cardurilor */
.card h2{
  margin: 0 0 6px;
  font-size: 15px;
  font-weight: 700;
  color: #7b5fff;
  letter-spacing: 0.03em;
}

/* Textarea romÃ¢nÄƒ */
textarea#roInput{
  border-radius: 14px;
  border: 1px solid #d7c9ff;
  background: #fbf9ff;
  padding: 10px 12px;
  font-size: 13px;
  line-height: 1.45;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.7);
}

/* Buton â€Tradu Ã®n coreeanÄƒâ€ */
#roTranslateBtn{
  margin-top: 6px;
  border-radius: 999px;
  padding: 7px 14px;
  font-size: 12px;
  font-weight: 600;
  background: linear-gradient(120deg, #b391ff, #8a6bff);
  color: #fff;
  border: none;
  box-shadow: 0 6px 14px rgba(125,99,210,0.35);
}
#roTranslateBtn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:6px;
}

.translate-icon{
  font-size:14px;
  transform:translateY(0.5px);
}
    /* Rezultat KO + romÃ¢na corectatÄƒ */
#roToKoResult{
  margin-top: 8px;
  font-size: 15px;
  font-weight: 700;
  color: #3a295d;
}

#roCorrected{
  margin-top: 2px;
  font-size: 12px;
  color: #7b7496;
}

/* Coloanele SUBJ/TIME/PLACE etc. */
.col{
  min-width: 110px;
  max-width: 140px;
  flex: 0 0 auto;
  background: radial-gradient(circle at top left,#fdfbff,#f1ecff);
  border-radius: 14px;
  border: 1px solid #ddd2ff;
  padding: 7px 7px 9px;
  box-shadow: 0 6px 16px rgba(118,95,205,0.16);
  transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s;
}

/* Efect la tap / hover (desktop) */
.col:active,
.col:hover{
  transform: translateY(-1px);
  box-shadow: 0 9px 20px rgba(118,95,205,0.24);
  border-color: #b09bff;
}

/* Headerul coloanei */
.col-header{
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: #9a80ff;
  margin-bottom: 3px;
  border-bottom: 1px solid rgba(208,196,255,0.8);
  padding-bottom: 2px;
}

/* CuvÃ¢ntul ales Ã®n coloanÄƒ */
.col-body-main{
  font-size: 15px;
  font-weight: 700;
  color: #372449;
}

/* Hintul gri mic din coloanÄƒ */
.col-body-label{
  font-size: 10px;
  color: #8a849d;
}

/* PropoziÈ›ia KO mare de jos */
#previewKo{
  font-size: 16px;
  font-weight: 700;
  color: #2f2948;
}

/* Traducere romÃ¢nÄƒ */
#previewRo{
  font-size: 12px;
  color: #746f91;
}

/* Badge â€naturalâ€ / atenÈ›ionare */
#naturalHint{
  font-size: 11px;
  margin-top: 3px;
}

    /* =========================================================
   THEME v4 â€“ â€app desenatÄƒâ€ pentru Raluca
   â€“ forme de fundal + iconiÈ›e pe coloane + carduri ilustrate
   (se pune ULTIMUL Ã®n <style>)
========================================================= */

/* fundal cu â€buleâ€ moi */
body{
  background-color:#f4efe4;
  background-image:
    radial-gradient(circle at 10% 0%, rgba(255,255,255,0.9) 0, rgba(255,255,255,0) 45%),
    radial-gradient(circle at 90% 0%, rgba(191,208,222,0.55) 0, rgba(191,208,222,0) 55%),
    radial-gradient(circle at 0% 80%, rgba(198,189,171,0.55) 0, rgba(198,189,171,0) 45%),
    radial-gradient(circle at 80% 100%, rgba(180,205,187,0.55) 0, rgba(180,205,187,0) 50%);
}

/* header cu â€bandÄƒâ€ de app */
header{
  position:relative;
  padding:10px 10px 14px;
}
header::before{
  content:"";
  position:absolute;
  inset:0 8px auto;
  height:60px;
  border-radius:22px;
  background:linear-gradient(120deg,#fdfbf7,#e4eaf3);
  box-shadow:0 14px 30px rgba(120,111,90,0.18);
  z-index:-1;
}
header h1{
  font-size:17px;
  letter-spacing:0.12em;
  text-transform:uppercase;
}
header p{
  font-size:11px;
}

/* mic â€badgeâ€ versiune */
header p::after{
  content:"v2.0";
  display:inline-flex;
  align-items:center;
  justify-content:center;
  margin-left:6px;
  padding:2px 8px;
  border-radius:999px;
  font-size:9px;
  font-weight:600;
  background:rgba(75,104,127,0.09);
  color:#4b687f;
}

/* carduri cu ornament Ã®n colÈ› */
.card,
.table-block,
.preview-card{
  position:relative;
  overflow:hidden;
}
.card::before,
.table-block::before,
.preview-card::before{
  content:"";
  position:absolute;
  right:-32px;
  top:-32px;
  width:90px;
  height:90px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,rgba(255,255,255,0.9),rgba(178,193,209,0.15));
  pointer-events:none;
}
.card::after,
.table-block::after,
.preview-card::after{
  content:"";
  position:absolute;
  left:-26px;
  bottom:-26px;
  width:70px;
  height:70px;
  border-radius:50%;
  background:radial-gradient(circle at 70% 70%,rgba(255,255,255,0.95),rgba(198,188,166,0.15));
  pointer-events:none;
}

/* conÈ›inutul cardurilor sÄƒ rÄƒmÃ¢nÄƒ deasupra ornamentelor */
.card > *,
.table-block > *,
.preview-card > *{
  position:relative;
  z-index:1;
}

/* titluri card cu barÄƒ subÈ›ire dedesubt */
.card h2{
  position:relative;
  padding-bottom:4px;
}
.card h2::after{
  content:"";
  position:absolute;
  left:0;
  bottom:0;
  width:42px;
  height:2px;
  border-radius:999px;
  background:linear-gradient(90deg,rgba(75,104,127,0.65),rgba(255,255,255,0));
}

/* chips â€“ mai â€tableteâ€ */
.chip{
  position:relative;
  padding:4px 10px 4px 8px;
}
.chip::before{
  content:"";
  width:6px;
  height:6px;
  border-radius:50%;
  background:#c3b08f;
}

/* ========= ICONIÈšE PE COLOANE (SUBJECT/TIME/PLACE etc.) ========= */

.col-header{
  display:flex;
  align-items:center;
  gap:4px;
}

/* icon placeholder */
.col-header::before{
  content:"";
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:16px;
  height:16px;
  border-radius:6px;
  background:rgba(255,255,255,0.8);
  font-size:11px;
  box-shadow:0 1px 3px rgba(0,0,0,0.06);
}

/* SUBJ ğŸ‘¤ */
.col[data-key="subject"] .col-header::before{
  content:"ğŸ‘¤";
}
/* TIME â° */
.col[data-key="time"] .col-header::before{
  content:"â°";
}
/* PLACE ğŸ“ */
.col[data-key="place"] .col-header::before{
  content:"ğŸ“";
}
/* MOD âœ¨ */
.col[data-key="mod"] .col-header::before{
  content:"âœ¨";
}
/* OBJECT ğŸ¯ */
.col[data-key="object"] .col-header::before{
  content:"ğŸ¯";
}
/* NUMERAL #ï¸âƒ£ */
.col[data-key="numeral"] .col-header::before{
  content:"#ï¸âƒ£";
}
/* COUNTER ğŸ”¢ */
.col[data-key="counter"] .col-header::before{
  content:"ğŸ”¢";
}
/* VERB ğŸš€ */
.col[data-key="verb"] .col-header::before{
  content:"ğŸš€";
}
/* CONJUGÄ‚RI ğŸ”— */
.col[data-key="conjug"] .col-header::before{
  content:"ğŸ”—";
}

/* cÃ¢nd coloana e â€stinsÄƒâ€ (dimmed) â€“ iconiÈ›a devine gri */
.col.dimmed .col-header::before{
  filter:grayscale(0.9);
  opacity:0.6;
}

/* ========= ACCENTE DIFERITE PE FIECARE ECRAN ========= */

/* ğŸ— Builder â€“ bandÄƒ sus de secÈ›iune */
#screen-builder .mode-panel{
  border-top:3px solid rgba(186,166,126,0.85);
}
#screen-builder .preview-title span:first-child::before{
  content:"ğŸ— ";
}

/* ========= PREVIEW propoziÈ›ie ========= */

.preview-card{
  margin-top:10px;
}
.preview-title span:first-child{
  display:flex;
  align-items:center;
  gap:6px;
}
.preview-title span:first-child::before{
  content:"ğŸ”Š";
  width:18px;
  height:18px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  background:rgba(75,104,127,0.08);
}

/* hint naturalitate â€“ â€badgeâ€ */
.preview-natural{
  padding:4px 8px;
  border-radius:999px;
  display:inline-block;
  background:rgba(185,207,192,0.35);
}

/* overlay panel â€“ divider subtil sus */
.panel-header{
  border-bottom:1px solid rgba(222,214,200,0.9);
  padding-bottom:6px;
}
    /* === THEME A â€“ Korean Minimal Chic & Cozy === */

:root{
  --bg: #f6f1e8;
  --card-bg: #fdfbf7;
  --accent: #6f86a8;          /* albastru-cernealÄƒ */
  --accent-strong: #4b607d;   /* albastru Ã®nchis */
  --accent-soft: #f1d3a0;     /* auriu cald */
  --text-main: #2f343b;
  --text-soft: #7a8088;
  --border: #e3dacb;
  --dimmed-bg: #f0e6d7;
  --overlay-bg: rgba(40,32,24,0.25);
}

/* fundal general â€“ crem cald, tip â€cafea cu lapteâ€ */
body{
  margin:0;
  padding:0;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:
    radial-gradient(circle at top,#fbf4e8 0,#f0ebe3 40%,#e9e2d7 100%);
  color:var(--text-main);
}

/* containerul aplicaÈ›iei â€“ uÈ™or â€cardâ€ pe mijloc */
.app{
  max-width:1040px;
  margin:0 auto;
  padding:18px 14px calc(70px + env(safe-area-inset-bottom));
}
/* header â€“ mai â€brandâ€ È™i mai premium */
header{
  padding:6px 10px 10px;
  text-align:left;
}
header h1{
  font-size:18px;
  font-weight:700;
  letter-spacing:0.03em;
  text-transform:uppercase;
  color:var(--accent-strong);
  display:flex;
  align-items:center;
  gap:6px;
}
header h1::before{
  content:"âœï¸";
  font-size:16px;
}
header p{
  margin:2px 0 0;
  font-size:12px;
  color:var(--text-soft);
}

/* carduri mari â€“ efect de planner premium */
.card,
.table-block,
.preview-card{
  background:linear-gradient(145deg,#fdfbf7,#f4eee3);
  border-radius:18px;
  border:1px solid rgba(227,218,203,0.9);
  box-shadow:0 14px 30px rgba(80,64,48,0.12);
}

/* card standard (RomÃ¢nÄƒ â†’ CoreeanÄƒ, ExerciÈ›ii, Glosar) */
.card{
  padding:12px 14px;
}
.card h2{
  font-size:15px;
  color:var(--accent-strong);
  letter-spacing:0.04em;
}

/* bara de introducere propoziÈ›ie */
textarea#roInput{
  background:#fbf8f1;
  border:1px solid #e1d5c5;
  box-shadow:0 0 0 1px rgba(255,255,255,0.7);
}

/* buton mare â€Tradu Ã®n coreeanÄƒâ€ */
#roTranslateBtn{
  background:linear-gradient(115deg,#4b607d,#6f86a8);
  box-shadow:0 8px 18px rgba(75,96,125,0.35);
}

/* bara albastrÄƒ lungÄƒ (Tradu / Next etc.) */
button{
  border-radius:999px;
  border:none;
  padding:7px 14px;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(120deg,#4b607d,#6f86a8);
  color:#fff;
  box-shadow:0 8px 18px rgba(75,96,125,0.32);
}
button.secondary{
  background:#f3ebdd;
  color:var(--accent-strong);
  box-shadow:none;
}
button:disabled{
  opacity:0.45;
  box-shadow:none;
}

/* toggle-urile SUBJECT / TIME / ... â€“ chip-uri mai elegante */
.chip{
  background:#f4ece0;
  color:var(--accent-strong);
  border-radius:999px;
  padding:4px 10px;
  box-shadow:0 4px 8px rgba(180,162,136,0.25);
}
.chip input{
  accent-color:var(--accent-strong);
}

/* coloanele din tabel (SUBJECT / TIME / PLACE etc.) */
.col{
  background:radial-gradient(circle at top left,#fdfbf7,#f2ebde);
  border-radius:16px;
  border:1px solid #e2d7c8;
  box-shadow:0 10px 22px rgba(95,78,58,0.16);
  transform:translateY(0);
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease,
    border-color 0.15s ease,
    background 0.15s ease;
}
.col-header{
  color:var(--accent-strong);
}
.col-body-main{
  color:#2f343b;
}
.col-body-label{
  color:#938777;
}
.col:hover{
  transform:translateY(-1px);
  box-shadow:0 14px 28px rgba(95,78,58,0.24);
  border-color:#d0c1aa;
}

/* cÃ¢nd coloana e dezactivatÄƒ */
.col.dimmed{
  opacity:0.4;
  background-image:none;
  background:#f1e7d8;
}

/* cardul de preview propoziÈ›ie de jos */
.preview-card{
  margin-top:10px;
  padding:10px 12px;
}
.preview-title span{
  color:var(--accent-strong);
}
.preview-ko{
  font-size:16px;
  font-weight:700;
  color:#292f35;
}
.preview-ro{
  font-size:12px;
  color:var(--text-soft);
}
.preview-natural{
  color:#a97a2e; /* un auriu cald pentru mesajele de naturalitate */
}

/* legendÄƒ explicativÄƒ */
.legend{
  font-size:10px;
  color:#8b8476;
}

/* panelul de overlay (lista de cuvinte) â€“ ca un sertar de lemn deschis */
.panel{
  background:linear-gradient(145deg,#fdfbf7,#f2ebde);
  border-radius:20px 20px 0 0;
  border:1px solid #e1d7c7;
}
.panel-item{
  border-radius:12px;
}
.panel-item:hover{
  background:#f3ebdd;
}
    /* === Stepper 3 paÈ™i (Builder) === */

.builder-steps{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin:4px 0 10px;
  font-size:11px;
  color:var(--text-soft);
}

.builder-step{
  display:flex;
  align-items:center;
  gap:6px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(255,255,255,0.7);
  border:1px solid var(--border);
  box-shadow:0 2px 6px rgba(80,64,48,0.10);
}

.builder-step-number{
  width:16px;
  height:16px;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
  font-weight:700;
  background:var(--accent-strong);
  color:#fff;
}

.builder-step-text{
  white-space:nowrap;
}

/* pasul curent (1) evidenÈ›iat puÈ›in mai mult */
.builder-step.active{
  background:#fff7e4;
  border-color:var(--accent-soft);
}
    /* === HEADER BRAND + TABS DE CAIET === */

/* header general */
.rk-header{
  padding:8px 10px 12px;
  display:flex;
  flex-direction:column;
  gap:4px;
}

.rk-header-main{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.rk-header-main h1{
  margin:0;
  font-size:20px;
  font-weight:700;
  letter-spacing:0.06em;
  text-transform:uppercase;
  color:var(--accent-strong);
}

/* badge mic lÃ¢ngÄƒ titlu â€“ aratÄƒ ca o etichetÄƒ de agendÄƒ */
.rk-badge{
  font-size:11px;
  font-weight:600;
  padding:4px 9px;
  border-radius:999px;
  background:linear-gradient(120deg,#f1d3a0,#f6e3b9);
  color:#514029;
  border:1px solid rgba(210,175,112,0.7);
  box-shadow:0 4px 10px rgba(185,145,84,0.25);
}

/* subtitlu */
.rk-header #subtitle{
  margin:0;
  font-size:12px;
  color:var(--text-soft);
}


/* AdaugÄƒ Ã®n <style> */
.legend{
  display:none;
}
    /* tot Ã®n <style> */
#naturalHint{
  display:none;
}
    /* Chip-uri oprite (SUBJECT/TIME/PLACE etc. nefolosite Ã®n propoziÈ›ie) */
#screen-builder .chip-off{
  opacity: 0.45;
  background: #eee2d1;
  box-shadow: none;
  filter: grayscale(0.1);
}
    /* ===== STEPPER pentru Builder (3 paÈ™i vizuali) ===== */

.builder-steps{
  display:flex;
  gap:6px;
  margin-bottom:8px;
  padding:6px 6px 2px;
  border-radius:14px;
  background:rgba(255,252,246,0.9);
  border:1px solid rgba(223,210,190,0.9);
  box-shadow:0 6px 14px rgba(96,78,56,0.12);
}

.builder-step{
  flex:1;
  display:flex;
  align-items:center;
  gap:6px;
  padding:4px 6px;
  border-radius:999px;
  font-size:11px;
  color:var(--text-soft);
  opacity:0.9;
}

.builder-step-number{
  width:18px;
  height:18px;
  border-radius:50%;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:11px;
  font-weight:700;
  background:#f3ebdd;
  color:#70563a;
}

.builder-step-text{
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

/* primul pas â€“ accent uÈ™or (pare â€activâ€) */
.builder-step.active{
  background:linear-gradient(120deg,#f6efe3,#f1e2cc);
  color:var(--accent-strong);
  font-weight:600;
}

.builder-step.active .builder-step-number{
  background:var(--accent-strong);
  color:#fff;
}
   
    .example{
  display:inline-block;
  font-size:12px;
  margin-top:2px;
  color:var(--text-soft);
}
    /* Ascunde rezultatul coreean + romÃ¢na corectatÄƒ din blocul RomÃ¢nÄƒ â†’ CoreeanÄƒ */
#roToKoResult,
#roCorrected {
  display: none;
}

    /* Ascund bara veche "Mod afiÈ™are / PropoziÈ›ia 1â€“2" */
#screen-builder > .mode-panel{
  display:none;
}
  /* ===== Fine tuning pentru Builder â€“ PropoziÈ›ia 2 ===== */

/* rÃ¢ndul cu bifa P2, lipit de tabel, Ã®n dreapta */
.builder-enable-p2{
  margin-top: 4px;
  padding-top: 4px;
  display: flex;
  justify-content: flex-end;
  border-top: 1px dashed var(--border);
  font-size: 11px;
  color: var(--text-soft);
}

.builder-enable-p2 label{
  display: flex;
  align-items: center;
  gap: 4px;
}

/* titlul "PropoziÈ›ia 2 (continuare / frazÄƒ)" â€“ aratÄƒ ca sub-titlu elegant */
#titleP2{
  margin-top: 6px;
  padding-top: 4px;
  border-top: 1px dashed var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 11px;
  color: var(--text-soft);
}

#titleP2 span::before{
  content: "â†³ ";
  color: var(--accent-strong);
  font-weight: 600;
}  
 
  /* ===== TEMA PASTEL GLOBALÄ‚ (v2.0) â€“ Raluca Korean ===== */

/* fundal general aplicaÈ›ie */
body.pastel-theme {
  background: radial-gradient(circle at top left, #ffe4ff 0%, #d7f0ff 40%, #f0e5ff 75%, #f3d4ff 100%);
  font-weight: 500;
}

/* header sus */
body.pastel-theme .rk-header {
  background: linear-gradient(120deg, #6fb8ff, #a774ff, #ff7fd1);
  color: #fff;
  box-shadow: 0 18px 45px rgba(77, 93, 255, 0.4);
  border-radius: 26px;
}

body.pastel-theme .rk-header-main h1 {
  font-weight: 900;
  letter-spacing: 0.06em;
  text-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

body.pastel-theme .rk-badge {
  background: rgba(255, 255, 255, 0.18);
  border-radius: 999px;
  padding-inline: 14px;
  font-weight: 600;
}

/* card-urile mari (builder, exerciÈ›ii, lecÈ›ii, glosar) */
body.pastel-theme .card,
body.pastel-theme .table-block,
body.pastel-theme .preview-card {
  background: radial-gradient(circle at top left, #ffffff 5%, #f7f0ff 45%, #ffe9ff 85%);
  border-radius: 26px;
  box-shadow:
    0 18px 40px rgba(70, 85, 155, 0.22),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
  border: none;
}

/* zona RomÃ¢nÄƒ â†’ CoreeanÄƒ */
body.pastel-theme #roInput,
body.pastel-theme textarea {
  border-radius: 18px;
  border: none;
  box-shadow:
    0 10px 25px rgba(120, 140, 200, 0.18),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
  background: linear-gradient(145deg, #ffffff, #f7f4ff);
}

/* titluri mai groase peste tot */
body.pastel-theme h1,
body.pastel-theme h2,
body.pastel-theme h3 {
  font-weight: 800;
}

/* butoane â€3D pillâ€ generale */
body.pastel-theme button,
body.pastel-theme .bottom-nav .nav-btn {
  border-radius: 999px;
  border: none;
  font-weight: 600;
  padding-inline: 18px;
  padding-block: 8px;
  box-shadow:
    0 10px 25px rgba(80, 90, 160, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  background: linear-gradient(135deg, #4b8bff, #a55dff);
  color: #ffffff;
  transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, filter 0.1s ease-out;
}

/* butoane secundare (gri/galben/roz) â€“ folosim clasa existentÄƒ .secondary */
body.pastel-theme button.secondary {
  background: linear-gradient(135deg, #ffaf6b, #ff72b4);
}

/* hover/active 3D */
body.pastel-theme button:hover,
body.pastel-theme .bottom-nav .nav-btn:hover {
  transform: translateY(-1px);
  filter: brightness(1.05);
  box-shadow:
    0 14px 32px rgba(60, 80, 160, 0.42),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
}

body.pastel-theme button:active,
body.pastel-theme .bottom-nav .nav-btn:active {
  transform: translateY(1px);
  box-shadow:
    0 6px 16px rgba(50, 70, 130, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
}

/* bara de jos â€“ nav */
body.pastel-theme .bottom-nav {
  background: linear-gradient(120deg, #f3e6ff, #ffe8fb);
  box-shadow: 0 -10px 25px rgba(110, 120, 190, 0.25);
  border-radius: 24px 24px 0 0;
}

body.pastel-theme .bottom-nav .nav-btn {
  background: transparent;
  box-shadow: none;
  color: #5860b0;
}

/* buton activ din nav */
body.pastel-theme .bottom-nav .nav-btn.active {
  background: linear-gradient(135deg, #5f8cff, #be6dff);
  color: #fff;
  box-shadow:
    0 8px 20px rgba(90, 90, 190, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
}

/* mici iconiÈ›e rotunde (dacÄƒ foloseÈ™ti .icon / emoji Ã®n span) */
body.pastel-theme .icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: radial-gradient(circle at 30% 0%, #fff, rgba(255, 255, 255, 0));
  box-shadow: 0 6px 15px rgba(70, 70, 140, 0.35);
}  
    /* ===== Carduri 3D pastel pentru Builder (SUBJECT / TIME / PLACE / MOD / OBJECT / NUMERAL / COUNTER / VERB...) ===== */

body.pastel-theme #tableP1 > div {
  position: relative;
  border-radius: 22px;
  padding: 10px 12px;
  margin-bottom: 6px;
  background: radial-gradient(circle at top left, #ffffff 0%, #f3f3ff 55%, #ffe7ff 100%);
  box-shadow:
    0 12px 28px rgba(80, 90, 160, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.9) inset;
  overflow: hidden;
}

/* efect de highlight pe marginea de sus a fiecÄƒrui card */
body.pastel-theme #tableP1 > div::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(120deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0));
  opacity: 0.8;
  pointer-events: none;
}

/* textul din headerul cardului (SUBJECT, TIME, etc.) â€“ Ã®l Ã®ngroÈ™Äƒm */
body.pastel-theme #tableP1 > div > *:first-child {
  font-weight: 800;
  letter-spacing: 0.02em;
}

/* micÄƒ margine Ã®ntre header È™i restul conÈ›inutului din card */
body.pastel-theme #tableP1 > div > *:nth-child(2) {
  margin-top: 4px;
}

/* nuanÈ›e diferite pe fiecare card, ca Ã®n mockup (pe bazÄƒ de poziÈ›ie) */
body.pastel-theme #tableP1 > div:nth-child(1) {
  background: radial-gradient(circle at top left, #e0f0ff 0%, #b9d5ff 45%, #e3e6ff 100%);
}

body.pastel-theme #tableP1 > div:nth-child(2) {
  background: radial-gradient(circle at top left, #ffe1ea 0%, #ffc0d7 45%, #ffeaf5 100%);
}

body.pastel-theme #tableP1 > div:nth-child(3) {
  background: radial-gradient(circle at top left, #fff3d6 0%, #ffd68a 45%, #fff0d7 100%);
}

body.pastel-theme #tableP1 > div:nth-child(4) {
  background: radial-gradient(circle at top left, #d9ffe6 0%, #b4f4cf 45%, #e3fff0 100%);
}

body.pastel-theme #tableP1 > div:nth-child(5) {
  background: radial-gradient(circle at top left, #dde6ff 0%, #b5c5ff 45%, #e3e5ff 100%);
}

body.pastel-theme #tableP1 > div:nth-child(6),
body.pastel-theme #tableP1 > div:nth-child(7),
body.pastel-theme #tableP1 > div:nth-child(8) {
  background: radial-gradient(circle at top left, #f4e1ff 0%, #e3c1ff 45%, #f8e7ff 100%);
}
    /* Culori pastel Propozitia 2 (randul de jos) */
body.pastel-theme #tableP2 > div:nth-child(1) {
  background: radial-gradient(circle at top left, #ffe8ef 0%, #ffc7d9 45%, #ffeef5 100%);
}

body.pastel-theme #tableP2 > div:nth-child(2) {
  background: radial-gradient(circle at top left, #fff1da 0%, #ffe0a8 45%, #fff3dd 100%);
}

body.pastel-theme #tableP2 > div:nth-child(3) {
  background: radial-gradient(circle at top left, #e9ffe4 0%, #bfffd3 45%, #efffea 100%);
}

body.pastel-theme #tableP2 > div:nth-child(4) {
  background: radial-gradient(circle at top left, #e8f2ff 0%, #c8dcff 45%, #eef4ff 100%);
}

body.pastel-theme #tableP2 > div:nth-child(5) {
  background: radial-gradient(circle at top left, #f3e7ff 0%, #dcc4ff 45%, #f6ecff 100%);
}

body.pastel-theme #tableP2 > div:nth-child(6) {
  background: radial-gradient(circle at top left, #fff0f0 0%, #ffd6d6 45%, #fff4f4 100%);
}

body.pastel-theme #tableP2 > div:nth-child(7) {
  background: radial-gradient(circle at top left, #f0fff6 0%, #ccffe6 45%, #f2fff8 100%);
}

body.pastel-theme #tableP2 > div:nth-child(8) {
  background: radial-gradient(circle at top left, #f0f5ff 0%, #d6e3ff 45%, #f3f7ff 100%);
}
    /* ===== Butoane pastel 3D ===== */

body.pastel-theme .preview-buttons button,
body.pastel-theme #prevBtn,
body.pastel-theme #nextBtn,
body.pastel-theme #resetBtn,
body.pastel-theme #toggleRoBtn {
  border: none;
  border-radius: 18px;
  padding: 8px 14px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: #ffffff;
  box-shadow:
    0 10px 22px rgba(80, 80, 140, 0.28),
    0 0 0 1px rgba(255,255,255,.7) inset;
  transition: transform .15s ease, box-shadow .15s ease;
}

/* efect apÄƒsare */
body.pastel-theme .preview-buttons button:active,
body.pastel-theme #prevBtn:active,
body.pastel-theme #nextBtn:active,
body.pastel-theme #resetBtn:active,
body.pastel-theme #toggleRoBtn:active {
  transform: translateY(2px);
  box-shadow:
    0 4px 10px rgba(60, 60, 120, 0.25),
    0 0 0 1px rgba(255,255,255,.6) inset;
}
    /* Random propoziÈ›ie */
body.pastel-theme #randomBtn {
  background: linear-gradient(135deg, #7a6cff, #6cc9ff);
}

/* Audio coreeanÄƒ */
body.pastel-theme #speakBtn {
  background: linear-gradient(135deg, #6cc9ff, #5be6c6);
}

/* SalveazÄƒ propoziÈ›ia */
body.pastel-theme #favBtn {
  background: linear-gradient(135deg, #ff9a6c, #ff5f8c);
}

/* Reset pÄƒrÈ›i propoziÈ›ie */
body.pastel-theme #resetBtn {
  background: linear-gradient(135deg, #ff6b6b, #ff9a6c);
}

/* Prev / Next */
body.pastel-theme #prevBtn {
  background: linear-gradient(135deg, #8aa4ff, #b1c2ff);
}
body.pastel-theme #nextBtn {
  background: linear-gradient(135deg, #9f77ff, #c188ff);
}

/* Ascunde traducerea */
body.pastel-theme #toggleRoBtn {
  background: linear-gradient(135deg, #ffa3a3, #ffc2a9);
}
    /* ===== Card RomÃ¢nÄƒ â†’ CoreeanÄƒ â€“ glassmorphic ===== */

body.pastel-theme #roInput,
body.pastel-theme #roToKoResult,
body.pastel-theme #roCorrected {
  background: rgba(255,255,255,0.6);
  backdrop-filter: blur(14px);
  border-radius: 18px;
  box-shadow:
    0 12px 28px rgba(140, 130, 200, 0.25),
    0 0 0 1px rgba(255,255,255,.6) inset;
  font-weight: 600;
}
   /* Ascund DOAR textul titlului traducerii, pÄƒstrez butonul */
body.pastel-theme .preview-card #previewRoTitle span {
  display: none !important;
} 
   /* ===== Card RomÃ¢nÄƒ â†’ CoreeanÄƒ â€“ glassmorphism pastel ===== */

#roCard {
  margin-top: 16px;
  padding: 16px 20px 20px;
  border-radius: 22px;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.75),
    rgba(255, 255, 255, 0.45)
  );
  box-shadow:
    0 18px 45px rgba(131, 112, 210, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  backdrop-filter: blur(18px);
}

#roCard h2 {
  font-size: 16px;
  font-weight: 800;
  letter-spacing: 0.03em;
  margin-bottom: 10px;
}

/* textarea de romÃ¢nÄƒ */
#roCard textarea#roInput {
  width: 100%;
  border-radius: 18px;
  border: none;
  padding: 10px 14px;
  font-size: 14px;
  font-weight: 600;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: 0 8px 20px rgba(135, 130, 200, 0.25);
}

/* butonul 'Tradu Ã®n coreeanÄƒ' â€“ capsulÄƒ pastel 3D */
#roCard #roTranslateBtn {
  margin-top: 10px;
  border-radius: 999px;
  border: none;
  padding: 8px 16px;
  font-weight: 700;
  color: #ffffff;
  cursor: pointer;
  background: linear-gradient(135deg, #6b8cff, #9b6bff);
  box-shadow:
    0 10px 24px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

#roCard #roTranslateBtn:active {
  transform: translateY(2px);
  box-shadow:
    0 5px 12px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}

/* rezultatul Ã®n coreeanÄƒ + varianta corectatÄƒ */
#roCard #roToKoResult,
#roCard #roCorrected {
  margin-top: 10px;
  padding: 8px 12px;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  box-shadow: 0 6px 16px rgba(140, 135, 210, 0.25);
} 
 
   /* ===== Card RomÃ¢nÄƒ â†’ CoreeanÄƒ â€“ glassmorphism pastel ===== */
#screen-builder .card {
  margin-top: 16px;
  padding: 16px 20px 20px;
  border-radius: 22px;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.8),
    rgba(255, 255, 255, 0.5)
  );
  box-shadow:
    0 18px 45px rgba(131, 112, 210, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  backdrop-filter: blur(18px);
}

/* titlul RomÃ¢nÄƒ â†’ CoreeanÄƒ */
#screen-builder .card h2 {
  font-size: 16px;
  font-weight: 800;
  letter-spacing: 0.03em;
  margin-bottom: 10px;
}
/* TEXT MARE & BOLD â€” bloc RomÃ¢nÄƒ â†’ CoreeanÄƒ */
.translation-output,
#roToKrOutput,
.translation-box {
  font-size: 26px;
  font-weight: 800;
  line-height: 1.9;
  letter-spacing: 0.3px;
}
    /* textarea Ã®n care scrii romÃ¢na */
#screen-builder .card textarea#roInput {
  width: 100%;
  border-radius: 18px;
  border: none;
  padding: 10px 14px;
  font-size: 14px;
  font-weight: 600;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 8px 20px rgba(135, 130, 200, 0.25);
}

/* butonul 'Tradu Ã®n coreeanÄƒ' â€“ capsulÄƒ 3D */
#screen-builder .card #roTranslateBtn {
  margin-top: 10px;
  border-radius: 999px;
  border: none;
  padding: 8px 16px;
  font-weight: 700;
  color: #ffffff;
  cursor: pointer;
  background: linear-gradient(135deg, #6b8cff, #9b6bff);
  box-shadow:
    0 10px 24px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

#screen-builder .card #roTranslateBtn:active {
  transform: translateY(2px);
  box-shadow:
    0 5px 12px rgba(108, 110, 210, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}

/* rezultatul Ã®n coreeanÄƒ + varianta corectatÄƒ */
#screen-builder .card #roToKoResult,
#screen-builder .card #roCorrected {
  margin-top: 10px;
  padding: 8px 12px;
  border-radius: 14px;
  background: rgba(255, 255, 255, 0.95);
  font-weight: 600;
  box-shadow: 0 6px 16px rgba(140, 135, 210, 0.25);
} 
    /* Carduri pÄƒrÈ›i propoziÈ›ie â€“ stil capsule 3D */
.table-block .table-title span,
.mode-row span.section-label {
  font-weight: 800;
  letter-spacing: 0.02em;
}

/* Butoane select â€“ bordurÄƒ interioarÄƒ + glow fin */
.part-option {
  font-weight: 700;
  box-shadow:
    0 10px 22px rgba(120, 120, 200, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.8) inset;
  border-radius: 16px;
  backdrop-filter: blur(6px);
}
    /* Butoane principale glossy gradient */
.preview-buttons button,
.btn-group button {
  border-radius: 16px;
  font-weight: 800;
  letter-spacing: 0.02em;
  border: none;
  color: white;
  padding: 8px 14px;

  background: linear-gradient(135deg,
    rgba(140, 170, 255, 1),
    rgba(200, 130, 255, 1)
  );

  box-shadow:
    0 14px 28px rgba(140, 120, 230, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.7) inset;

  transition: transform .15s ease, box-shadow .15s ease;
}

.preview-buttons button:active,
.btn-group button:active {
  transform: translateY(2px);
  box-shadow:
    0 6px 16px rgba(140, 120, 230, 0.45),
    0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}

/* Dar pÄƒstrez butonul "Ascunde traducerea" vizibil */
.preview-card .preview-title button {
  visibility: visible;
}
    /* ==== 1. FONTURI MAI GROASE PENTRU TITLURI + BUTOANE ==== */

/* Titlul mare + subtitlul de sus */
h1 {
  font-weight: 800;
  letter-spacing: 0.04em;
}

#subtitle {
  font-weight: 500;
}

/* Titlurile de secÈ›iune (ex: RomÃ¢nÄƒ â†’ CoreeanÄƒ, ExerciÈ›ii TOPIK etc.) */
h2,
.table-title span,
.preview-title span {
  font-weight: 700;
}

/* Text pe butoane (inclusiv butoane de jos: Builder / ExerciÈ›ii / LecÈ›ii / Glosar) */
button,
.nav-btn span {
  font-weight: 600;
  letter-spacing: 0.02em;
}
    /* ==== 2. BUTOANE 3D + ANIMAÈšIE ==== */

/* bazÄƒ pentru TOATE butoanele */
button,
.nav-btn {
  transition:
    transform 0.12s ease-out,
    box-shadow 0.12s ease-out,
    filter 0.12s ease-out;
  transform-origin: center;
}

/* efect â€plutireâ€ la hover (pe desktop / cÃ¢nd atingi uÈ™or) */
button:hover,
.nav-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.18);
  filter: brightness(1.03);
}

/* mic â€apÄƒsatâ€ la click */
button:active,
.nav-btn:active {
  transform: translateY(1px) scale(0.98);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.24);
  filter: brightness(0.98);
}

/* un pic de glow Ã®n plus pentru butoanele importante (random / audio / salveazÄƒ etc.) */
button.primary,
button#randomBtn,
button#speakBtn,
button#favBtn {
  box-shadow: 0 12px 28px rgba(255, 160, 220, 0.45);
}

/* tab-ul activ din bara de jos (Builder, ExerciÈ›ii, LecÈ›ii, Glosar) mai â€ridicatâ€ */
.bottom-nav .nav-btn.active {
  transform: translateY(-2px);
  box-shadow: 0 14px 32px rgba(73, 46, 180, 0.45);
}/* ==== 3. CARDURI GLOSSY PENTRU EXERCIÈšII / LECÈšII / GLOSAR ==== */
#screen-builder .preview-card #previewRoTitle span {
  display: none !important;
}
    :root{
  --glass-bg: linear-gradient(145deg,#ffffff80,#ffffff20);
  --glass-border: 1px solid rgba(255,255,255,0.45);
  --glass-shadow: 0 20px 40px rgba(0,0,0,0.08);

  --grad-top: linear-gradient(120deg,#9fd6ff,#c6a7ff,#ff9acb);
  --grad-bottom: linear-gradient(120deg,#b7e2ff,#e6c8ff,#ffd1e3);
}
   
    body{
  background: var(--grad-bottom);
}
    button,
.btn {
  border-radius: 14px;
  border: none;
  padding: 10px 16px;
  font-weight: 700;
  backdrop-filter: blur(6px);
  box-shadow: 0 8px 18px rgba(0,0,0,.12);
  transform: translateY(0);
  transition: .18s ease;
}

button:hover {
  transform: translateY(-2px);
}

.btn-blue  { background: linear-gradient(120deg,#82b5ff,#5fa8ff); color:#fff; }
.btn-green { background: linear-gradient(120deg,#8df2c8,#5ed6a8); color:#044; }
.btn-pink  { background: linear-gradient(120deg,#ff9acb,#ff7fae); color:#fff; }
.btn-orange{ background: linear-gradient(120deg,#ffb585,#ff8a46); color:#552200; }
   #screen-builder .card,
#screen-builder .preview-card {
  border-radius: 24px;
}
   
   /* IconiÈ›e + micro 3D pe butoanele principale din Builder */
#screen-builder #randomBtn::before,
#screen-builder #speakBtn::before,
#screen-builder #favBtn::before {
  display: inline-block;
  margin-right: 6px;
  transform: translateY(1px);
  transition: transform 0.15s ease, filter 0.15s ease;
}

/* Icon concrete */
#screen-builder #randomBtn::before  { content: "ğŸ²"; }
#screen-builder #speakBtn::before   { content: "ğŸ”Š"; }
#screen-builder #favBtn::before     { content: "â­"; }

/* Micro 3D cÃ¢nd treci cu mouse-ul / atingi */
#screen-builder #randomBtn:hover::before,
#screen-builder #speakBtn:hover::before,
#screen-builder #favBtn:hover::before {
  transform: translateY(-1px) scale(1.08);
  filter: drop-shadow(0 2px 3px rgba(0,0,0,0.25));
}
 
 /* Neon focus pentru cÃ¢mpuri de text / select */
input:focus,
textarea:focus,
select:focus {
  outline: none;
  border-color: rgba(255,255,255,0.9);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.9),
    0 0 0 3px rgba(149, 120, 255, 0.7),
    0 0 16px rgba(149, 120, 255, 0.7);
  background-color: rgba(255,255,255,0.8);
}.bottom-nav {
  backdrop-filter: blur(18px);
}




   /* Header â€“ gradient care se miÈ™cÄƒ + glow subtil */
.rk-header {
  position: relative;
  z-index: 2;
  background-size: 220% 220%;          /* permite animarea gradientului existent */
  animation: headerGradient 18s ease-in-out infinite;
}

/* Aura coloratÄƒ moale Ã®n jurul header-ului */
.rk-header::after {
  content: "";
  position: absolute;
  inset: -18px -26px;                  /* cÃ¢t de mare e â€œauraâ€ Ã®n jur */
  border-radius: 32px;
  background: radial-gradient(circle at 0% 0%,  rgba(143,211,255,0.9), transparent 60%),
              radial-gradient(circle at 100% 0%, rgba(255,174,238,0.9), transparent 60%),
              radial-gradient(circle at 50% 100%, rgba(173,255,189,0.9), transparent 65%);
  filter: blur(32px);
  opacity: 0.24;
  pointer-events: none;
  z-index: -1;
  animation: headerGlow 8s ease-in-out infinite;
}

/* anima miÈ™carea gradientului din header (foloseÈ™te gradientul pe care Ã®l ai deja) */
@keyframes headerGradient {
  0%   { background-position: 0% 40%; }
  50%  { background-position: 100% 60%; }
  100% { background-position: 0% 40%; }
}

/* anima â€œrespiraÈ›iaâ€ aurei */
@keyframes headerGlow {
  0%, 100% {
    opacity: 0.18;
    transform: translateY(0);
  }
  50% {
    opacity: 0.32;
    transform: translateY(3px);
  }
}
    /* Containerul principal â€“ Ã®l facem â€œsuportâ€ pentru fundalul animat */
.app {
  position: relative;
  z-index: 0;
  overflow-x: hidden;
}

/* Stratul de fundal animat, foarte subtil (sub toatÄƒ aplicaÈ›ia) */
.app::before {
  content: "";
  position: fixed;      /* rÄƒmÃ¢ne pe loc cÃ¢nd derulezi */
  inset: 0;
  z-index: -1;
  pointer-events: none;

  background:
    radial-gradient(circle at 0% 0%,     rgba(143,211,255,0.7), transparent 55%),
    radial-gradient(circle at 100% 0%,   rgba(255,174,238,0.75), transparent 55%),
    radial-gradient(circle at 0% 100%,   rgba(173,255,189,0.7), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(255,214,165,0.75), transparent 60%);
  background-size: 160% 160%;
  animation: appBgDrift 32s ease-in-out infinite alternate;
}

/* miÈ™care foarte lentÄƒ, â€œrespiraÈ›ieâ€ de culori */
@keyframes appBgDrift {
  0% {
    background-position:
      0%   0%,
      100% 0%,
      0%   100%,
      100% 100%;
  }
  50% {
    background-position:
      12%  8%,
      88%  2%,
      6%   88%,
      94%  96%;
  }
  100% {
    background-position:
      0%   10%,
      100% 6%,
      4%   100%,
      96%  90%;
  }
}  /* Glow animat foarte subtil pe header */
.rk-header {
  position: relative;
  overflow: visible;
}

.rk-header::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 100%;
  width: 260px;
  height: 70px;
  transform: translateX(-50%);
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(255, 170, 255, 0.35),
    rgba(120, 160, 255, 0.18),
    rgba(255, 255, 255, 0)
  );
  filter: blur(22px);
  animation: rkGlow 6s ease-in-out infinite alternate;
  pointer-events: none;
  z-index: -1;
}

@keyframes rkGlow {
  0%   { opacity: 0.45; transform: translateX(-50%) translateY(6px) scale(1.0);}
  100% { opacity: 0.85; transform: translateX(-50%) translateY(2px) scale(1.08);}
}
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸŒˆ Gradient animat lent pe fundal */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

body.pastel-theme {
  background: linear-gradient(
    120deg,
    #dff3ff,
    #ffe9ff,
    #f4fffc,
    #e8f0ff
  );
  background-size: 380% 380%;
  animation: bgFlow 28s ease-in-out infinite;
}

@keyframes bgFlow {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* âœ¨ Glow animat foarte subtil sub header */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.rk-header {
  position: relative;
  overflow: visible;
}

.rk-header::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 100%;
  width: 260px;
  height: 70px;
  transform: translateX(-50%);
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(255, 170, 255, 0.35),
    rgba(120, 160, 255, 0.18),
    rgba(255, 255, 255, 0)
  );
  filter: blur(22px);
  animation: rkGlow 6s ease-in-out infinite alternate;
  pointer-events: none;
  z-index: -1;
}

@keyframes rkGlow {
  0% {
    opacity: 0.45;
    transform: translateX(-50%) translateY(6px) scale(1.0);
  }
  100% {
    opacity: 0.85;
    transform: translateX(-50%) translateY(2px) scale(1.08);
  }
}
 /* TEXT MARE & BOLD â€” preview propoziÈ›ie coreeanÄƒ */
.preview-sentence,
#koreanPreview,
.preview-output {
  font-size: 26px;
  font-weight: 800;
  line-height: 1.9;
  letter-spacing: 0.3px;
}
    body.pastel-theme .bottom-nav:last-of-type {
  display: flex !important;
}

/* Scoate plÄƒcuÈ›a albÄƒ din spatele tab-urilor */
.bottom-nav .nav-btn::before {
  content: none !important;
}
 /* ===== EXTRA CLAUSES VISUAL ===== */
.clause-extra {
  margin-top: 22px;
  padding-top: 14px;
  border-top: 2px dashed rgba(120,120,120,0.25);
}

.clause-extra .table-title span {
  font-weight: 600;
  opacity: 0.85;
}
    .preview-ko{
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 6px;
}

.preview-ro{
  font-size: 15px;
  opacity: 0.8;
}

.preview-hint{
  font-size: 13px;
  opacity: 0.5;
}
    .preview-ko{
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 6px;

  white-space: normal;
  word-break: keep-all;
  line-height: 1.35;
    }
    #previewKo{
  white-space: normal;
}   
    #screen-builder #roCard{
  display: none;
}
    #roCard #previewRo {
  margin-top: 6px;
  font-size: 13px;
  opacity: 0.85;
}
  </style>
</head>
<body class="pastel-theme">
  <div class="app">
    <header class="rk-header">
  <div class="rk-header-main">
    <h1>Raluca Korean</h1>
    <span class="rk-badge">Study App v2.0</span>
  </div>
  <p id="subtitle">Builder propoziÈ›ii + particule + audio + conjugÄƒri</p>
</header>
    <!-- SCREEN 1: BUILDER -->
    <div class="screen active" id="screen-builder">

      <!-- Panel sus: mod afiÈ™are + ce pÄƒrÈ›i foloseÈ™te -->
      <div class="mode-panel">
        <div class="mode-row">
          <span class="section-label">Mod afiÈ™are</span>
          <div>
            <button class="secondary small-mode-btn" data-mode="simple">Simplu</button>
            <button class="secondary small-mode-btn active" data-mode="topik">TOPIK</button>
          </div>
        </div>

        <div class="mode-row">
          <span class="section-label">PropoziÈ›ia 1 â€“ ce pÄƒrÈ›i foloseÈ™te?</span>
          <div class="part-toggles" id="togglesP1"></div>
        </div>
  <div class="mode-row">
    <span class="section-label">PropoziÈ›ia 2 â€“ ce pÄƒrÈ›i foloseÈ™te?</span>
    <div class="part-toggles" id="togglesP2"></div>
  </div>
</div> <!-- Ã®nchidem blocul .mode-panel (bara de sus) -->

<div class="table-block">
  <!-- ===== PROPOZIÈšIA 1 ===== -->
<div class="table-title">
  <span>PropoziÈ›ia 1</span>
</div>
<div class="table-horizontal" id="tableP1"></div>
<!-- ===== PROPOZIÈšIA 2 ===== -->
<div class="table-title hidden" id="titleP2">
  <span>PropoziÈ›ia 2 (continuare / frazÄƒ)</span>
</div>
<div class="table-horizontal hidden" id="tableP2"></div>


<!-- ===== PROPOZIÈšIA 3+ ===== -->
<div id="extra-clauses"></div>


<!-- ===== PREVIEW ===== -->
<div class="preview-card">
  <div class="preview-title">
    <span>PropoziÈ›ia / fraza (coreeanÄƒ, cu particule & verb conjugat)</span>
  </div>

  <div class="preview-ko" id="previewKo">(alege cuvinte din tabel)</div>

  <div class="preview-title">
    <span>Traducere aproximativÄƒ (romÃ¢nÄƒ â€“ pe pÄƒrÈ›i)</span>
   
      Ascund traducerea
    </button>
  </div>

 <div class="preview-ko" id="roToKoResult"></div>
<div class="preview-ro" id="previewRo"></div>   <!-- ğŸ‘ˆ aici -->
<div class="preview-ro" id="roCorrected"></div>
  <div class="preview-hint" id="naturalHint"></div>

  <div class="preview-buttons">
    <button id="randomBtn">ğŸ² Random propoziÈ›ie</button>
    <button id="speakBtn">ğŸ”Š Audio coreeanÄƒ</button>
    <button id="favBtn" class="secondary">â­ SalveazÄƒ propoziÈ›ia</button>
  </div>
</div>

        <div class="controls">
          <div class="btn-group">
            <button id="prevBtn">â¬… Prev (rÃ¢nd model)</button>
            <button id="nextBtn">Next â¡</button>
          </div>
        </div>
<div class="builder-enable-p2">
  <label>
    
    PropoziÈ›ia 2
  </label>
</div>

  <div id="tableP2" class="table-block hidden">
  <!-- coloanele P2 -->
</div>
  <div class="legend">
          â¤ Tap scurt pe coloanÄƒ = treci la urmÄƒtorul cuvÃ¢nt.  
          â¤ Èšine apÄƒsat pe coloanÄƒ = deschizi lista completÄƒ (cu traduceri + cÄƒutare).  
          â¤ â­ la CONJUGÄ‚RI = gramaticÄƒ de legÄƒturÄƒ (cere propoziÈ›ia 2).  
          â¤ Sistem de <b>conjugare realÄƒ</b>: verbul se uneÈ™te cu finalul (ex: ê°€ë‹¤ + -ê³  ìˆì–´ìš” â†’ ê°€ê³  ìˆì–´ìš”).
        </div>

          
      </div><!-- /table-block -->

      <!-- RomÃ¢nÄƒ â†’ CoreeanÄƒ mutat JOS Ã®n Builder -->
      <div class="card">
        <h2>RomÃ¢nÄƒ â†’ CoreeanÄƒ</h2>
        <textarea id="roInput" rows="3"
                  placeholder="Scrie propoziÈ›ia Ã®n romÃ¢nÄƒ aici..."></textarea>
        <button id="roTranslateBtn">
          <span class="translate-icon">ğŸ‡·ğŸ‡´â¡ï¸ğŸ‡°ğŸ‡·</span>
          Tradu Ã®n coreeanÄƒ
        </button>
        <div class="preview-ko" id="roToKoResult"></div>
        <div class="preview-ro" id="roCorrected"></div>
      </div>
    </div>    
  
  <!-- overlay panel -->
  <div class="overlay hidden" id="overlay">
    <div class="panel">
      <div class="panel-header">
        <div>
          <div class="panel-title" id="panelTitle"></div>
          <div class="panel-sub" id="panelSub"></div>
        </div>
        <button class="panel-close" id="closePanelBtn">âœ•</button>
      </div>

      <!-- CÄƒutare Ã®n lista de cuvinte -->
      <div class="panel-input-row">
        <input type="text" id="panelSearchInput" placeholder="CautÄƒ Ã®n listÄƒ (primele litere)..." />
      </div>

      <!-- CuvÃ¢nt nou + traducere -->
      <div class="panel-input-row">
        <input type="text" id="newWordInput" placeholder="CuvÃ¢nt nou (coreeanÄƒ sau numÄƒr)..." />
      </div>
      <div class="panel-input-row">
        <input type="text" id="newWordTransInput" placeholder="Traducere Ã®n romÃ¢nÄƒ (ex: unu, azi) â€“ opÈ›ional" />
        <button id="addWordBtn" class="secondary">+ Add</button>
      </div>

      <div class="panel-list" id="panelList"></div>
    </div>
  </div>
  <script>
    /* ============================================================
   builder.js (REWRITE 100%, cap-coadÄƒ, robust, fÄƒrÄƒ duplicÄƒri)
   - RespectÄƒ HTML-ul tÄƒu (id-uri existente) + NU crapÄƒ dacÄƒ lipsesc unele
   - Builder cu 1..N propoziÈ›ii (NU hard-limit 2)
   - PÄƒstreazÄƒ: panel, long-press, chips, toggles, preview KO/RO, audio, favorites,
                custom words + localStorage, parser ROâ†’state, particule + conjugÄƒri
   ============================================================ */

/* =========================
   0) SAFE DOM HELPERS
   ========================= */
const $ = (sel, root = document) => root.querySelector(sel);
const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
const on = (el, ev, fn) => el && el.addEventListener(ev, fn);
const text = (el, v) => { if (el) el.textContent = v; };
const show = (el) => el && el.classList.remove("hidden");
const hide = (el) => el && el.classList.add("hidden");

/* =========================
   1) DATA: LISTE + TRADUCERI (din codul tÄƒu)
   ========================= */

/* === LISTE DE CUVINTE (de bazÄƒ) === */
const subjects = [
  "ì €","ë‚˜","ë„ˆ","ìš°ë¦¬","ë„ˆí¬","ì‚¬ëŒ","í•™ìƒ","ì„ ìƒë‹˜","ì§ì›","ì „ë¬¸ê°€","ì§€ì›ì","ê´€ë¦¬ì",
  "ë¶€ëª¨ë‹˜","ì•„ì´","ì–´ë¥¸","ì‹œë¯¼","ê³ ê°","ì˜ì‚¬","ê°„í˜¸ì‚¬","ì—°êµ¬ì","ê´€ê³„ì","ëŒ€í‘œ","íšŒì¥",
  "ì‚¬ìš©ì","ì°¸ê°€ì","ìš´ì „ì","ì£¼ë¯¼","í™˜ì"
];
const subjectAdjectives = [
  "ì˜ˆìœ", "ì°©í•œ", "ë˜‘ë˜‘í•œ", "í‚¤ê°€ í°", "ì Šì€", "ëŠ™ì€"
];

const times = [
  "ì˜¤ëŠ˜","ì–´ì œ","ë‚´ì¼","ì§€ê¸ˆ","ë°©ê¸ˆ","ì¡°ê¸ˆ í›„ì—","ê³§","ìµœê·¼ì—","ìš”ì¦˜","ë§ˆì¹¨ë‚´","ê²°êµ­",
  "ì´ì „ì—","ì´í›„ì—","ë‹¹ì‹œì—","í•œë™ì•ˆ","ê³„ì†","ê°€ë”","í•­ìƒ","ìì£¼","ì ì ","ì°¨ì¸°","ì¼ì°","ëŠ¦ê²Œ"
];

const places = [
  "ì§‘","í•™êµ","íšŒì‚¬","ì‹ë‹¹","ì¹´í˜","ë„ì„œê´€","ë³‘ì›","ì‹œì¥","ë°±í™”ì ","ê³µí•­","ê¸°ì°¨ì—­",
  "ë²„ìŠ¤ì •ë¥˜ì¥","ì—°êµ¬ì†Œ","ê¸°ê´€","ì§€ì—­ì‚¬íšŒ","í™˜ê²½","ëŒ€ê¸°ì—…","íšŒì˜ì‹¤","ë²•ì›","ê²½ì°°ì„œ",
  "í•´ë³€","ì‚°","ê³µì›","ì€í–‰"
];

const mods = [
  "ì˜","ì—´ì‹¬íˆ","ì¡°ìš©íˆ","ì²œì²œíˆ","ë¹¨ë¦¬","ì •ë§","ì•„ì£¼","ë„ˆë¬´","ë§ì´","ì¡°ê¸ˆ","ê°‘ìê¸°","ë¯¸ë¦¬",
  "ë²Œì¨","ì•„ê¹Œ","ë°©ê¸ˆ","ê¸ˆë°©","ê³§","í•­ìƒ","ìì£¼","ê°€ë”","ë“œë¬¼ê²Œ","ìƒë‹¹íˆ","ê½¤","ë„ëŒ€ì²´","ì ˆëŒ€ë¡œ",
  "ì ê·¹ì ìœ¼ë¡œ","ì¶©ë¶„íˆ","íŠ¹íˆ","ì˜¤íˆë ¤","ì ì ","ì°¨ì¸°","ê³„ì†"
];

const objectAdjectives = [
  "ì˜ˆìœ", "ë§›ìˆëŠ”", "í°", "ì‘ì€", "ìƒˆë¡œìš´", "ì˜¤ë˜ëœ"
];
    const objects = [
  "ì±…","ì»¤í”¼","ë¬¼","ìŒì‹","ì˜í™”","ê°€ë°©","ì „í™”","ì˜·","ìë£Œ","ë°ì´í„°","ê³„íš","ì¡°ê±´","ìƒí™©","ë¬¸ì œ",
  "í•´ê²°ì±…","ìš”ì•½","ë³´ê³ ì„œ","ë¬¸ì„œ","ì»´í“¨í„°","ë…¸íŠ¸ë¶","í¸ì§€","ì„ ë¬¼","ì˜ê²¬","ì •ë³´","ê´€ê³„","ê²°ê³¼",
  "ì›ì¸","ë°©ë²•","ì œí’ˆ","ì„œë¹„ìŠ¤","ì •ì±…","ë¬¸í™”","ì±„ì†Œ","ê²¬ê³¼ë¥˜"
];

const numerals = new Array(60).fill("");
const counters = [
  "ê°œ","ëª…","ê¶Œ","ì¥","ëŒ€","ë³‘","ì”","ë§ˆë¦¬","ë²ˆ","ì‚´","ì†¡ì´","ì¤„","ì ","ê±´","íšŒ","ê°€ì§€","ìª½"
];

const verbs = [
  "ê°€ë‹¤","ì˜¤ë‹¤","ë¨¹ë‹¤","ë§ˆì‹œë‹¤","ë³´ë‹¤","ì½ë‹¤","ì“°ë‹¤","ë°°ìš°ë‹¤","ì‚¬ë‹¤","ì£¼ë‹¤","ë°›ë‹¤","ì¼í•˜ë‹¤",
  "ê³µë¶€í•˜ë‹¤","ìš”ë¦¬í•˜ë‹¤","ì²­ì†Œí•˜ë‹¤","ì¤€ë¹„í•˜ë‹¤","ë„ì™€ì£¼ë‹¤","ì‚¬ìš©í•˜ë‹¤","í•„ìš”í•˜ë‹¤","ì¢‹ì•„í•˜ë‹¤",
  "ì‹«ì–´í•˜ë‹¤","ê¸°ë‹¤ë¦¬ë‹¤","ì‰¬ë‹¤","ë§Œë‚˜ë‹¤","ê±·ë‹¤","ë‹¬ë¦¬ë‹¤","ì•‰ë‹¤","ì„œë‹¤","ê²°ì •í•˜ë‹¤","ì œì•ˆí•˜ë‹¤",
  "ì „ë‹¬í•˜ë‹¤","ìœ ì§€í•˜ë‹¤","ë°œìƒí•˜ë‹¤","ì¦ê°€í•˜ë‹¤","ê°ì†Œí•˜ë‹¤","ì¸ì •í•˜ë‹¤","ë¶„ì„í•˜ë‹¤","ê´€ì°°í•˜ë‹¤",
  "í•´ê²°í•˜ë‹¤","ì—°êµ¬í•˜ë‹¤","í˜‘ë ¥í•˜ë‹¤","ìš”ì²­í•˜ë‹¤","ì¶©ì¡±í•˜ë‹¤","ë¹„êµí•˜ë‹¤","ì„¤ëª…í•˜ë‹¤","ì˜ˆìƒí•˜ë‹¤"
];

const conjugations = [
  "-ì•„ìš”/ì–´ìš”","-ì•˜ì–´ìš”/ì—ˆì–´ìš”","-ê³  ìˆì–´ìš”","-ê³  ì‹¶ì–´ìš”","-(ìœ¼)ì„¸ìš”","-(ìœ¼)ã„¹ ê±°ì˜ˆìš”",
  "-ê³ ","-ì§€ ë§ˆì„¸ìš”","-ì•„/ì–´ ì£¼ì„¸ìš”","-ì•„/ì–´ì•¼ ë¼ìš”","-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”","-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”",
  "-ë”ë¼ê³ ìš”","-ë„¤ìš”","-êµ°ìš”","-ê³  ë‚˜ì„œ","-ê¸° ì „ì—","-(ìœ¼)ë©´ì„œ","-(ìœ¼)ë©°",
  "-(ìœ¼)ã„¹ì§€ë„ ëª°ë¼ìš”","-(ìœ¼)ã„¹ê²Œìš”","-(ìœ¼)ã„¹ë˜ìš”?","-(ìœ¼)ã„¹ê¹Œìš”?","-ëŠ” ê²Œ ì–´ë•Œìš”?",
  "-ëŠ” ì¤‘ì´ì—ìš”","-ì•„/ì–´ë„ ë¼ìš”","-(ìœ¼)ë©´ ì•ˆ ë¼ìš”","-(ìœ¼)ë‚˜","-(ìœ¼)ë¯€ë¡œ","-(ìœ¼)ã„´/ëŠ” ë§Œí¼",
  "-(ìœ¼)ã„¹ìˆ˜ë¡","-(ìœ¼)ã„´/ëŠ”ë°ë„","-(ìœ¼)ã„¹ì§€ë¼ë„","-(ìœ¼)ã„´/ëŠ” ë°˜ë©´ì—","-ë„ë¡ í•˜ë‹¤",
  "-ê²Œ ë˜ë‹¤","-ì•„/ì–´ì§€ë‹¤","-ê¸° ë§ˆë ¨ì´ë‹¤","-ê¸°ì—","-ê¸¸ë˜","-ê³  ë§ë‹¤","-ê³ ì í•˜ë‹¤","-(ìœ¼)ã„¹ ë¿ì´ë‹¤"
];

/* === TRADUCERI (coreeanÄƒ â†’ romÃ¢nÄƒ) === */
const translations = {
  subject:{ "ì €":"eu (formal)","ë‚˜":"eu (informal)","ë„ˆ":"tu","ìš°ë¦¬":"noi","ë„ˆí¬":"voi",
    "ì‚¬ëŒ":"persoanÄƒ","í•™ìƒ":"student/Äƒ","ì„ ìƒë‹˜":"profesor","ì§ì›":"angajat",
    "ë¶€ëª¨ë‹˜":"pÄƒrinÈ›i","ì•„ì´":"copil","ì–´ë¥¸":"adult","ê³ ê°":"client","ì˜ì‚¬":"medic",
    "ê°„í˜¸ì‚¬":"asistentÄƒ","ì—°êµ¬ì":"cercetÄƒtor","ëŒ€í‘œ":"reprezentant","í™˜ì":"pacient"
  },
  time:{ "ì˜¤ëŠ˜":"astÄƒzi","ì–´ì œ":"ieri","ë‚´ì¼":"mÃ¢ine","ì§€ê¸ˆ":"acum","ë°©ê¸ˆ":"tocmai acum",
    "ì¡°ê¸ˆ í›„ì—":"puÈ›in mai tÃ¢rziu","ê³§":"Ã®n curÃ¢nd","ìµœê·¼ì—":"recent","ìš”ì¦˜":"Ã®n ultima vreme",
    "ë§ˆì¹¨ë‚´":"Ã®n cele din urmÄƒ","ê²°êµ­":"pÃ¢nÄƒ la urmÄƒ","ì´ì „ì—":"Ã®nainte","ì´í›„ì—":"dupÄƒ",
    "ë‹¹ì‹œì—":"atunci","í•œë™ì•ˆ":"o perioadÄƒ","ê³„ì†":"continuÄƒ","ê°€ë”":"din cÃ¢nd Ã®n cÃ¢nd",
    "í•­ìƒ":"Ã®ntotdeauna","ìì£¼":"des","ì ì ":"din ce Ã®n ce","ì°¨ì¸°":"treptat",
    "ì¼ì°":"devreme","ëŠ¦ê²Œ":"tÃ¢rziu"
  },
  place:{ "ì§‘":"acasÄƒ","í•™êµ":"È™coalÄƒ","íšŒì‚¬":"firmÄƒ / companie","ì‹ë‹¹":"restaurant","ì¹´í˜":"cafenea",
    "ë„ì„œê´€":"bibliotecÄƒ","ë³‘ì›":"spital","ì‹œì¥":"piaÈ›Äƒ","ë°±í™”ì ":"magazin universal",
    "ê³µí•­":"aeroport","ê¸°ì°¨ì—­":"garÄƒ","ë²„ìŠ¤ì •ë¥˜ì¥":"staÈ›ie de autobuz","ì—°êµ¬ì†Œ":"laborator",
    "ê¸°ê´€":"instituÈ›ie","ì§€ì—­ì‚¬íšŒ":"comunitate","í™˜ê²½":"mediu","ëŒ€ê¸°ì—…":"corporaÈ›ie mare",
    "íšŒì˜ì‹¤":"salÄƒ de È™edinÈ›e","ë²•ì›":"instanÈ›Äƒ","ê²½ì°°ì„œ":"secÈ›ie de poliÈ›ie",
    "í•´ë³€":"plajÄƒ","ì‚°":"munte","ê³µì›":"parc","ì€í–‰":"bancÄƒ"
  },
  mod:{ "ì˜":"bine","ì—´ì‹¬íˆ":"cu sÃ¢rguinÈ›Äƒ","ì¡°ìš©íˆ":"Ã®n liniÈ™te","ì²œì²œíˆ":"Ã®ncet",
    "ë¹¨ë¦¬":"repede","ì •ë§":"cu adevÄƒrat","ì•„ì£¼":"foarte","ë„ˆë¬´":"prea / foarte",
    "ë§ì´":"mult","ì¡°ê¸ˆ":"puÈ›in","ê°‘ìê¸°":"brusc","ë¯¸ë¦¬":"Ã®n avans","ë²Œì¨":"deja",
    "ì•„ê¹Œ":"mai devreme","ë°©ê¸ˆ":"chiar acum","ê¸ˆë°©":"imediat","ê³§":"Ã®n curÃ¢nd",
    "í•­ìƒ":"mereu","ìì£¼":"des","ê°€ë”":"din cÃ¢nd Ã®n cÃ¢nd","ë“œë¬¼ê²Œ":"rar",
    "ìƒë‹¹íˆ":"destul de","ê½¤":"biniÈ™or","ë„ëŒ€ì²´":"(deloc / Ã®n Ã®ntrebÄƒri)",
    "ì ˆëŒ€ë¡œ":"niciodatÄƒ (interdicÈ›ie)","ì ê·¹ì ìœ¼ë¡œ":"activ","ì¶©ë¶„íˆ":"suficient",
    "íŠ¹íˆ":"Ã®n special","ì˜¤íˆë ¤":"mai degrabÄƒ","ì ì ":"din ce Ã®n ce","ì°¨ì¸°":"treptat",
    "ê³„ì†":"Ã®n mod continuu"
  },
  object:{
    "ì±…":"carte","ì»¤í”¼":"cafea","ë¬¼":"apÄƒ","ìŒì‹":"mÃ¢ncare","ì˜í™”":"film",
    "ê°€ë°©":"geantÄƒ","ì „í™”":"telefon","ì˜·":"haine","ìë£Œ":"materiale","ë°ì´í„°":"date",
    "ê³„íš":"plan","ì¡°ê±´":"condiÈ›ie","ìƒí™©":"situaÈ›ie","ë¬¸ì œ":"problemÄƒ",
    "í•´ê²°ì±…":"soluÈ›ie","ìš”ì•½":"rezumat","ë³´ê³ ì„œ":"raport","ë¬¸ì„œ":"document",
    "ì»´í“¨í„°":"calculator","ë…¸íŠ¸ë¶":"laptop","í¸ì§€":"scrisoare","ì„ ë¬¼":"cadou",
    "ì˜ê²¬":"opinie","ì •ë³´":"informaÈ›ie","ê´€ê³„":"relaÈ›ie","ê²°ê³¼":"rezultat",
    "ì›ì¸":"cauzÄƒ","ë°©ë²•":"metodÄƒ","ì œí’ˆ":"produs","ì„œë¹„ìŠ¤":"serviciu",
    "ì •ì±…":"politicÄƒ","ë¬¸í™”":"culturÄƒ","ì±„ì†Œ":"legume","ê²¬ê³¼ë¥˜":"alune / nuci"
  },
  numeral:{},
  counter:{ "ê°œ":"bucatÄƒ","ëª…":"persoanÄƒ","ê¶Œ":"volum (carte)","ì¥":"foaie / paginÄƒ",
    "ëŒ€":"aparat / vehicul","ë³‘":"sticlÄƒ","ì”":"canÄƒ / pahar",
    "ë§ˆë¦¬":"animal","ë²ˆ":"datÄƒ","ì‚´":"ani (vÃ¢rstÄƒ)","ì†¡ì´":"buchet / ciorchine",
    "ì¤„":"rÃ¢nd / È™ir","ì ":"punct","ê±´":"caz","íšŒ":"datÄƒ (ocazie)",
    "ê°€ì§€":"fel / tip","ìª½":"paginÄƒ / direcÈ›ie"
  },
  verb:{
    "ê°€ë‹¤":"a merge","ì˜¤ë‹¤":"a veni","ë¨¹ë‹¤":"a mÃ¢nca","ë§ˆì‹œë‹¤":"a bea","ë³´ë‹¤":"a vedea / a se uita",
    "ì½ë‹¤":"a citi","ì“°ë‹¤":"a scrie","ë°°ìš°ë‹¤":"a Ã®nvÄƒÈ›a","ì‚¬ë‹¤":"a cumpÄƒra","ì£¼ë‹¤":"a da",
    "ë°›ë‹¤":"a primi","ì¼í•˜ë‹¤":"a lucra","ê³µë¶€í•˜ë‹¤":"a studia","ìš”ë¦¬í•˜ë‹¤":"a gÄƒti",
    "ì²­ì†Œí•˜ë‹¤":"a face curat","ì¤€ë¹„í•˜ë‹¤":"a pregÄƒti","ë„ì™€ì£¼ë‹¤":"a ajuta",
    "ì‚¬ìš©í•˜ë‹¤":"a folosi","í•„ìš”í•˜ë‹¤":"a fi necesar","ì¢‹ì•„í•˜ë‹¤":"a plÄƒcea",
    "ì‹«ì–´í•˜ë‹¤":"a nu plÄƒcea / a urÃ®","ê¸°ë‹¤ë¦¬ë‹¤":"a aÈ™tepta","ì‰¬ë‹¤":"a se odihni",
    "ë§Œë‚˜ë‹¤":"a se Ã®ntÃ¢lni","ê±·ë‹¤":"a merge pe jos","ë‹¬ë¦¬ë‹¤":"a alerga",
    "ì•‰ë‹¤":"a se aÈ™eza","ì„œë‹¤":"a sta Ã®n picioare","ê²°ì •í•˜ë‹¤":"a decide",
    "ì œì•ˆí•˜ë‹¤":"a propune","ì „ë‹¬í•˜ë‹¤":"a transmite","ìœ ì§€í•˜ë‹¤":"a menÈ›ine",
    "ë°œìƒí•˜ë‹¤":"a se produce","ì¦ê°€í•˜ë‹¤":"a creÈ™te","ê°ì†Œí•˜ë‹¤":"a scÄƒdea",
    "ì¸ì •í•˜ë‹¤":"a recunoaÈ™te","ë¶„ì„í•˜ë‹¤":"a analiza","ê´€ì°°í•˜ë‹¤":"a observa",
    "í•´ê²°í•˜ë‹¤":"a rezolva","ì—°êµ¬í•˜ë‹¤":"a cerceta","í˜‘ë ¥í•˜ë‹¤":"a colabora",
    "ìš”ì²­í•˜ë‹¤":"a solicita","ì¶©ì¡±í•˜ë‹¤":"a satisface","ë¹„êµí•˜ë‹¤":"a compara",
    "ì„¤ëª…í•˜ë‹¤":"a explica","ì˜ˆìƒí•˜ë‹¤":"a anticipa"
  },
  conjug:{
    "-ì•„ìš”/ì–´ìš”":"prezent politicos",
    "-ì•˜ì–´ìš”/ì—ˆì–´ìš”":"trecut politicos",
    "-ê³  ìˆì–´ìš”":"acÈ›iune Ã®n desfÄƒÈ™urare",
    "-ê³  ì‹¶ì–´ìš”":"vreau sÄƒ...",
    "-ê³ ":"È™i",
    "-(ìœ¼)ì„¸ìš”":"imperativ / onorific",
    "-(ìœ¼)ã„¹ ê±°ì˜ˆìš”":"viitor",
    "-ì§€ ë§ˆì„¸ìš”":"nu faceÈ›i..., vÄƒ rog",
    "-ì•„/ì–´ ì£¼ì„¸ìš”":"vÄƒ rog sÄƒ...",
    "-ì•„/ì–´ì•¼ ë¼ìš”":"trebuie sÄƒ...",
    "-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”":"pot sÄƒ...",
    "-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”":"nu pot sÄƒ...",
    "-ë”ë¼ê³ ìš”":"am observat cÄƒ...",
    "-ë„¤ìš”":"exclamativ (observaÈ›ie surprinsÄƒ)",
    "-êµ°ìš”":"exclamativ (constatare)",
    "-ê³  ë‚˜ì„œ":"dupÄƒ ce...",
    "-ê¸° ì „ì—":"Ã®nainte sÄƒ...",
    "-(ìœ¼)ë©´ì„œ":"Ã®n timp ce...",
    "-(ìœ¼)ë©°":"È™i (Ã®n timp ce)",
    "-(ìœ¼)ã„¹ì§€ë„ ëª°ë¼ìš”":"s-ar putea sÄƒ...",
    "-(ìœ¼)ã„¹ê²Œìš”":"voi face (pentru tine)",
    "-(ìœ¼)ã„¹ë˜ìš”?":"ai chef sÄƒ...? / vreau sÄƒ...",
    "-(ìœ¼)ã„¹ê¹Œìš”?":"sÄƒ facem...?",
    "-ëŠ” ê²Œ ì–´ë•Œìš”?":"ce-ar fi sÄƒ...?",
    "-ëŠ” ì¤‘ì´ì—ìš”":"sunt Ã®n mijlocul acÈ›iunii",
    "-ì•„/ì–´ë„ ë¼ìš”":"poÈ›i sÄƒ..., e Ã®n regulÄƒ",
    "-(ìœ¼)ë©´ ì•ˆ ë¼ìš”":"nu ai voie sÄƒ...",
    "-ë„ë¡ í•˜ë‹¤":"sÄƒ faci Ã®n aÈ™a fel Ã®ncÃ¢t sÄƒ...",
    "-ê²Œ ë˜ë‹¤":"ajungi sÄƒ...",
    "-ì•„/ì–´ì§€ë‹¤":"a deveni...",
    "-ê¸°ì—":"pentru cÄƒ..., fiindcÄƒ",
    "-ê¸¸ë˜":"pentru cÄƒ (am vÄƒzut / simÈ›it eu)",
    "-ê³  ë§ë‹¤":"Ã®n cele din urmÄƒ ajunge sÄƒ...",
    "-ê³ ì í•˜ë‹¤":"a intenÈ›iona sÄƒ...",
    "-(ìœ¼)ã„¹ ë¿ì´ë‹¤":"doar..., nimic altceva"
  }
};

/* =========================
   2) STORAGE: CUSTOM WORDS
   ========================= */
const STORAGE_KEY = "ralucaKoreanCustomWords_v2";
const customData = {
  subject:[],time:[],place:[],mod:[],object:[],
  numeral:[],counter:[],verb:[],conjug:[]
};

function loadCustomData(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const saved = JSON.parse(raw);
    Object.keys(customData).forEach(k=>{
      if(Array.isArray(saved[k])) customData[k] = saved[k];
    });

    // inject Ã®n liste + translations
    Object.entries(customData).forEach(([key,arr])=>{
      arr.forEach(entry=>{
        if(!entry || !entry.word) return;
        const w = entry.word;
        const ro = entry.ro || "";

        const listMap = {
          subject: subjects, time: times, place: places, mod: mods, object: objects,
          numeral: numerals, counter: counters, verb: verbs, conjug: conjugations
        };
        const list = listMap[key];
        if(list && !list.includes(w)) list.push(w);

        if(!translations[key]) translations[key] = {};
        if(ro) translations[key][w] = ro;
      });
    });
  }catch(e){}
}

function saveCustomData(){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(customData)); }catch(e){}
}

loadCustomData();

/* =========================
   3) COLUMNS CONFIG
   ========================= */

  const columns = [
  {key:"subject", title:"SUBJECT", ko:"ì£¼ì–´", data:subjects, hint:"Cine?", allowCustom:true},

  // âœ… NOU
  {key:"subjectAdj", title:"ADJ (SUBJECT)", ko:"í˜•ìš©ì‚¬", data:subjectAdjectives, hint:"Cum este subiectul?", allowCustom:true},

  {key:"time", title:"TIME", ko:"ì‹œê°„", data:times, hint:"CÃ¢nd?", allowCustom:true},
  {key:"place", title:"PLACE", ko:"ì¥ì†Œ", data:places, hint:"Unde?", allowCustom:true},
  {key:"mod", title:"MOD", ko:"ë°©ë²•", data:mods, hint:"Cum?", allowCustom:true},
  {key:"object", title:"OBJECT", ko:"ëª©ì ì–´", data:objects, hint:"Ce?", allowCustom:true},

  // âœ… NOU
  {key:"objectAdj", title:"ADJ (OBJECT)", ko:"í˜•ìš©ì‚¬", data:objectAdjectives, hint:"Cum este obiectul?", allowCustom:true},

  {key:"numeral", title:"NUMERAL", ko:"", data:numerals, hint:"NumÄƒr", allowCustom:true},
  {key:"counter", title:"COUNTER", ko:"ìˆ˜ëŸ‰ì‚¬", data:counters, hint:"Clasificator", allowCustom:true},
  {key:"verb", title:"VERB", ko:"ë™ì‚¬", data:verbs, hint:"AcÈ›iune", allowCustom:true},
  {key:"conjug", title:"CONJUGÄ‚RI", ko:"", data:conjugations, hint:"FormÄƒ verbalÄƒ", allowCustom:true}
];
    const MULTI_VALUE_SLOTS = new Set(["subject"]);
    const maxLen = Math.max(...columns.map(c => c.data.length));
    // ===== CLAUSE ENGINE (GENERALIZARE P1 / P2) =====
const clauses = [
  { id: 1, state: {}, active: {} },
  { id: 2, state: {}, active: {} }
];

// aliasuri TEMPORARE (NU schimbÄƒ nimic Ã®n restul codului)
const stateP1  = clauses[0].state;
const activeP1 = clauses[0].active;

const stateP2  = clauses[1].state;
const activeP2 = clauses[1].active;
    /* =========================
   4) DOM (nu presupunem nimic: doar id-uri dacÄƒ existÄƒ)
   ========================= */
const DOM = {
  // builder tables (din HTML-ul tÄƒu)
  tableP1: $("#tableP1"),
  tableP2: $("#tableP2"),
  titleP2: $("#titleP2"),
  enableP2: $("#enableP2"),

  togglesP1: $("#togglesP1"),
  togglesP2: $("#togglesP2"),

  prevBtn: $("#prevBtn"),
  nextBtn: $("#nextBtn"),
  resetBtn: $("#resetBtn"),
  pageInfoEl: $("#pageInfo"),

  previewKo: $("#previewKo"),

  previewRo: $("#previewRo"),

  naturalHint: $("#naturalHint"),
  toggleRoBtn: $("#toggleRoBtn"),

  randomBtn: $("#randomBtn"),
  speakBtn: $("#speakBtn"),
  favBtn: $("#favBtn"),
  favoritesListEl: $("#favoritesList"),

  overlay: $("#overlay"),
  panelTitle: $("#panelTitle"),
  panelSub: $("#panelSub"),
  panelList: $("#panelList"),
  closePanelBtn: $("#closePanelBtn"),
  panelSearchInput: $("#panelSearchInput"),
  newWordInput: $("#newWordInput"),
  newWordTransInput: $("#newWordTransInput"),
  addWordBtn: $("#addWordBtn"),

  // Roâ†’Ko block
  roInput: $("#roInput"),
  roTranslateBtn: $("#roTranslateBtn"),
  roToKoResult: $("#roToKoResult"),
  roCorrected: $("#roCorrected"),

  // input language switch (ro/en)
  inputLangRadio: $$('input[name="inputLang"]'),

  // mode buttons
  modeButtons: $$(".small-mode-btn")
};

/* =========================
   5) APP STATE (IMPORTANT)
   - PropoziÈ›ii dinamice (1..N)
   ========================= */
let indexModelRow = 0;
    

    function makeEmptySentence(){
  const s = {};
  columns.forEach(col => s[col.key] = col.data[0] || "");
  return s;
}

// sentences[0] = propoziÈ›ia 1, sentences[1] = propoziÈ›ia 2, etc.
let sentences = [ makeEmptySentence() ];

// activeMap per sentence: ce coloane sunt ON/OFF
let actives = [ makeAllActive() ];

function makeAllActive(){
  const a = {};
  columns.forEach(col => a[col.key] = true);
  return a;
}

let showRo = true;
    let showExtraClauses = false;    
let currentMode = "topik"; // topik vs simple
const simpleColumnsSet = {subject:true,time:true,object:true,verb:true,conjug:true};

/* =========================
   6) MODE: ce coloane se vÄƒd
   ========================= */
function isColumnVisible(key){
  if(currentMode === "topik") return true;
  return !!simpleColumnsSet[key];
}

/* =========================
   7) LINKING CONJUGATIONS
   ========================= */
const linkingConjugations = new Set([
  "-ê³ ","-ê³  ë‚˜ì„œ","-ê¸° ì „ì—","-(ìœ¼)ë©´ì„œ","-(ìœ¼)ë©°",
  "-(ìœ¼)ë‚˜","-(ìœ¼)ë¯€ë¡œ","-(ìœ¼)ã„´/ëŠ” ë§Œí¼",
  "-(ìœ¼)ã„¹ìˆ˜ë¡","-(ìœ¼)ã„´/ëŠ”ë°ë„","-(ìœ¼)ã„¹ì§€ë¼ë„",
  "-(ìœ¼)ã„´/ëŠ” ë°˜ë©´ì—","-ë„ë¡ í•˜ë‹¤","-ê¸°ì—","-ê¸¸ë˜","-ê³  ë§ë‹¤","-ê³ ì í•˜ë‹¤"
]);
const isLinkingConj = (v) => linkingConjugations.has(v);

/* =========================
   8) HANGUL HELPERS (batchim, conjugare)
   ========================= */
const H_BASE = 0xAC00;
const JONG = ["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€",
              "ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
const JUNG = ["ã…","ã…","ã…‘","ã…’","ã…“","ã…”","ã…•","ã…–","ã…—","ã…˜","ã…™","ã…š","ã…›",
              "ã…œ","ã…","ã…","ã…Ÿ","ã… ","ã…¡","ã…¢","ã…£"];

function decomposeLastSyl(word){
  if(!word) return null;
  const ch = word.charCodeAt(word.length-1);
  const code = ch - H_BASE;
  if(code < 0 || code > 11171) return null;
  const jong = code % 28;
  const jung = ((code - jong)/28) % 21;
  const cho = Math.floor((code - jong)/28/21);
  return { cho, jung, jong, prefix: word.slice(0,-1) };
}
function hasBatchim(s){
  const d = decomposeLastSyl(s);
  return d ? d.jong !== 0 : false;
}
function getVerbStem(dict){
  if(!dict) return "";
  return dict.endsWith("ë‹¤") ? dict.slice(0,-1) : dict;
}

const specialVerbMap = {
  "ê°€ë‹¤":{present:"ê°€ìš”",past:"ê°”ì–´ìš”"},
  "ì˜¤ë‹¤":{present:"ì™€ìš”",past:"ì™”ì–´ìš”"},
  "ë³´ë‹¤":{present:"ë´ìš”",past:"ë´¤ì–´ìš”"},
  "í•˜ë‹¤":{present:"í•´ìš”",past:"í–ˆì–´ìš”"},
  "ë¨¹ë‹¤":{past:"ë¨¹ì—ˆì–´ìš”"},
  "ì½ë‹¤":{past:"ì½ì—ˆì–´ìš”"},
  "ë§ˆì‹œë‹¤":{past:"ë§ˆì…¨ì–´ìš”"},
  "ì‚´ë‹¤":{past:"ì‚´ì•˜ì–´ìš”"}
};

function presentPolite(dict){
  if(specialVerbMap[dict]?.present) return specialVerbMap[dict].present;
  if(dict === "í•˜ë‹¤") return "í•´ìš”";
  const stem = getVerbStem(dict);
  const d = decomposeLastSyl(stem);
  if(!d) return stem + "ìš”";
  const v = JUNG[d.jung];
  const aGroup = ["ã…","ã…‘","ã…—","ã…›","ã…˜","ã…™","ã…š"].includes(v);
  if(stem.length === 1 && aGroup) return stem + "ìš”";
  return stem + (aGroup ? "ì•„ìš”" : "ì–´ìš”");
}
function pastPolite(dict){
  if(specialVerbMap[dict]?.past) return specialVerbMap[dict].past;
  if(dict === "í•˜ë‹¤") return "í–ˆì–´ìš”";
  const stem = getVerbStem(dict);
  const d = decomposeLastSyl(stem);
  if(!d) return stem + "ì—ˆì–´ìš”";
  const v = JUNG[d.jung];
  const aGroup = ["ã…","ã…‘","ã…—","ã…›","ã…˜","ã…™","ã…š"].includes(v);
  return stem + (aGroup ? "ì•˜ì–´ìš”" : "ì—ˆì–´ìš”");
}
function stemPlusAeo(dict){
  if(dict === "í•˜ë‹¤") return "í•´";
  const stem = getVerbStem(dict);
  const d = decomposeLastSyl(stem);
  if(!d) return stem;
  const v = JUNG[d.jung];
  const aGroup = ["ã…","ã…‘","ã…—","ã…›","ã…˜","ã…™","ã…š"].includes(v);
  if(stem.length === 1 && aGroup) return stem;
  return stem + (aGroup ? "ì•„" : "ì–´");
}
function futureL(dict){
  const stem = getVerbStem(dict);
  const d = decomposeLastSyl(stem);
  if(!d) return stem + "á†¯";
  if(d.jong === 0){
    const newCode = H_BASE + d.cho*21*28 + d.jung*28 + 8; // ã„¹ ë°›ì¹¨
    return d.prefix + String.fromCharCode(newCode);
  }
  return stem + "ì„";
}

function buildVerbPhrase(dictVerb, cj) {

  if (!dictVerb && !cj) return "";

  if (!dictVerb) return cj || "";

  if (!cj) return dictVerb;

  if(cj === "-ì•„ìš”/ì–´ìš”") return presentPolite(dictVerb);
  if(cj === "-ì•˜ì–´ìš”/ì—ˆì–´ìš”") return pastPolite(dictVerb);
  if(cj === "-(ìœ¼)ì„¸ìš”") return futureL(dictVerb) + "ì„¸ìš”";
  if(cj === "-(ìœ¼)ã„¹ ê±°ì˜ˆìš”") return futureL(dictVerb) + " ê±°ì˜ˆìš”";
  if(cj === "-(ìœ¼)ã„¹ê²Œìš”") return futureL(dictVerb) + "ê²Œìš”";
  if(cj === "-(ìœ¼)ã„¹ë˜ìš”?") return futureL(dictVerb) + "ë˜ìš”?";
  if(cj === "-(ìœ¼)ã„¹ê¹Œìš”?") return futureL(dictVerb) + "ê¹Œìš”?";
  if(cj === "-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”") return futureL(dictVerb) + " ìˆ˜ ìˆì–´ìš”";
  if(cj === "-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”") return futureL(dictVerb) + " ìˆ˜ ì—†ì–´ìš”";
  if(cj === "-(ìœ¼)ã„¹ì§€ë„ ëª°ë¼ìš”") return futureL(dictVerb) + "ì§€ë„ ëª°ë¼ìš”";

  if(cj === "-ê³  ìˆì–´ìš”") return getVerbStem(dictVerb) + "ê³  ìˆì–´ìš”";
  if(cj === "-ê³  ì‹¶ì–´ìš”") return getVerbStem(dictVerb) + "ê³  ì‹¶ì–´ìš”";
  if(cj === "-ì§€ ë§ˆì„¸ìš”") return getVerbStem(dictVerb) + "ì§€ ë§ˆì„¸ìš”";
  if(cj === "-ì•„/ì–´ ì£¼ì„¸ìš”") return stemPlusAeo(dictVerb) + " ì£¼ì„¸ìš”";
  if(cj === "-ì•„/ì–´ì•¼ ë¼ìš”") return stemPlusAeo(dictVerb) + "ì•¼ ë¼ìš”";
  if(cj === "-ëŠ” ì¤‘ì´ì—ìš”") return getVerbStem(dictVerb) + "ëŠ” ì¤‘ì´ì—ìš”";
  if(cj === "-ì•„/ì–´ë„ ë¼ìš”") return stemPlusAeo(dictVerb) + "ë„ ë¼ìš”";
  if(isLinkingConj(cj)){
    if(cj === "-ê³ ") return getVerbStem(dictVerb) + "ê³ ";
    if(cj === "-ê³  ë‚˜ì„œ") return getVerbStem(dictVerb) + "ê³  ë‚˜ì„œ";
    if(cj === "-ê¸° ì „ì—") return getVerbStem(dictVerb) + "ê¸° ì „ì—";
    if(cj.includes("ë©´ì„œ")) return getVerbStem(dictVerb) + "ë©´ì„œ";
    if(cj.includes("ë©°")) return getVerbStem(dictVerb) + "ë©°";
    if(cj === "-ë„ë¡ í•˜ë‹¤") return getVerbStem(dictVerb) + "ë„ë¡ í•´ìš”";
    if(cj === "-ê³  ë§ë‹¤") return getVerbStem(dictVerb) + "ê³  ë§ì•˜ì–´ìš”";
    if(cj === "-ê³ ì í•˜ë‹¤") return getVerbStem(dictVerb) + "ê³ ì í•´ìš”";
    if(cj === "-ê¸°ì—") return getVerbStem(dictVerb) + "ê¸°ì—";
    if(cj === "-ê¸¸ë˜") return getVerbStem(dictVerb) + "ê¸¸ë˜";
  }

  // âœ… FALLBACK SIGUR
  return dictVerb;
}
function getSafeFinalConjugation(cj, isLast){

  if(!isLast) return cj;

  if(isLinkingConj(cj)){
    return "-ì•„ìš”/ì–´ìš”";   // sau "" dacÄƒ vrei propoziÈ›ie neutrÄƒ
  }

  return cj;
}
    function preventDoubleLinking(prevCj, currentCj){

  if(isLinkingConj(prevCj) && isLinkingConj(currentCj)){
    return "";   // eliminÄƒm linking-ul curent
  }

  return currentCj;
}
    /* =========================
   9) PARTICLE HELPERS
   ========================= */
const pronouns = new Set(["ì €","ë‚˜","ë„ˆ","ìš°ë¦¬","ë„ˆí¬"]);
const timeAdverbsNoParticle = new Set(["ì˜¤ëŠ˜","ì–´ì œ","ë‚´ì¼","ì§€ê¸ˆ","ë°©ê¸ˆ","ìš”ì¦˜","í•­ìƒ","ìì£¼","ê°€ë”","ê³„ì†","ì ì ","ì°¨ì¸°"]);

function addSubjectWithParticle(subjectValue){
  if (!subjectValue) return "";

  // ARRAY SUBJECT
  if (Array.isArray(subjectValue)) {
    const joined = subjectValue.join("ê³¼ ");
    return joined + "ì´";  
    // simplificare stabilÄƒ TOPIK (plural logic)
  }

  const b = hasBatchim(subjectValue);
  if (pronouns.has(subjectValue)) {
    return subjectValue + (b ? "ì€" : "ëŠ”");
  }

  return subjectValue + (b ? "ì´" : "ê°€");
}
function addTimeWithParticle(word){
  if(!word) return "";
  if(timeAdverbsNoParticle.has(word)) return word;
  return word + "ì—";
}

function addPlaceWithParticle(word, verbKo){
  if(!word) return "";
  const motionVerbs = new Set(["ê°€ë‹¤","ì˜¤ë‹¤","ë‚˜ê°€ë‹¤","ë“¤ì–´ê°€ë‹¤","ëŒì•„ê°€ë‹¤","ëŒì•„ì˜¤ë‹¤"]);
  if(verbKo && motionVerbs.has(verbKo)) return word + "ì—";
  return word + "ì—ì„œ";
}

function addObjectWithParticle(word){
  if(!word) return "";
  return word + (hasBatchim(word) ? "ì„" : "ë¥¼");
}
function formatSubject(subjectValue){
  if (!subjectValue) return "";

  // dacÄƒ e array â†’ Ana + Vasile
  if (Array.isArray(subjectValue)) {
    return subjectValue.join(" + ");
  }

  return subjectValue;
}
    function fixKoreanSpacing(text){
  if(!text) return "";

  return text
    // eliminÄƒ spaÈ›ii Ã®nainte de particule uzuale
    .replace(/\s+(ì€|ëŠ”|ì´|ê°€|ì„|ë¥¼|ì—|ì—ì„œ|ìœ¼ë¡œ|ë¡œ|ì™€|ê³¼)/g, "$1")
    // curÄƒÈ›Äƒ spaÈ›ii multiple
    .replace(/\s{2,}/g, " ")
    .trim();
}
    /* =========================
   10) BUILD ONE CLAUSE (KO + RO)
   ========================= */
const labelsRo = {
  subject:"SUBJECT", time:"TIME", place:"PLACE", mod:"MOD",
  object:"OBJECT", numeral:"NUMÄ‚R", counter:"COUNTER", verb:"VERB"
};

 function buildClauseSentence(state, activeMap){
  const koParts = [];
  const roSegs  = [];

  const use = (key) => activeMap[key] !== false && isColumnVisible(key);

  const v  = state.verb || "";

  const cj = state.conjug || "";
   
/* SUBJECT (+ adjectiv) */
if(use("subject")){

  let subj = state.subject || "";

  if(state.subjectAdj){
    subj = state.subjectAdj + " " + subj;
  }

  // âœ… FIX FLUIDITATE
  const prevSubj = window.__prevSubject;
  const shouldHide =
    prevSubj &&
    prevSubj === subj &&
    state.__clauseIndex > 0;

  if(subj && !shouldHide){
    koParts.push(addSubjectWithParticle(subj));
  }

  window.__prevSubject = subj;
}
  /* PLACE */
  if(state.place && use("place")){
    koParts.push(addPlaceWithParticle(state.place, v));
    roSegs.push(`${labelsRo.place}: ${(translations.place?.[state.place] || state.place)}`);
  }

  /* MOD */
  if(state.mod && use("mod")){
    koParts.push(state.mod);
    roSegs.push(`${labelsRo.mod}: ${(translations.mod?.[state.mod] || state.mod)}`);
  }

  /* OBJECT (+ adjectiv) */
  if(use("object")){
    let obj = state.object || "";
    if(state.objectAdj){
      obj = state.objectAdj + " " + obj;
    }
    if(obj){
      koParts.push(addObjectWithParticle(obj));
    }
  }

  /* NUMERAL */
  if(state.numeral && use("numeral")){
    koParts.push(state.numeral);
    roSegs.push(`${labelsRo.numeral}: ${(translations.numeral?.[state.numeral] || state.numeral)}`);
  }

  /* COUNTER */
  if(state.counter && use("counter")){
    koParts.push(state.counter);
    roSegs.push(`${labelsRo.counter}: ${(translations.counter?.[state.counter] || state.counter)}`);
  }
/* VERB + CONJUG */
/* VERB + CONJUG â€” SAFE */
if(v && use("verb")){

  const vp = buildVerbPhrase(v, cj);

  if(vp){
    koParts.push(vp);
  }else{
    // fallback de siguranÈ›Äƒ
    koParts.push(v);
  }

  const roVerb = translations.verb?.[v] || v;
  const cjExp  = translations.conjug?.[cj] || "";

  let combined = roVerb;
  if(cjExp) combined += ` ${cjExp}`;

  roSegs.push(`${labelsRo.verb}: ${combined}`.trim());
}
   return {
    ko: fixKoreanSpacing(koParts.join(" ")),
    roText: roSegs.join(" / ").trim(),
    conj: cj
  };
}
    /* =========================
   11) NATURAL ROMANIAN (keep-ul tÄƒu, simplificat dar corect)
   ========================= */

// Conjugare RO minimalÄƒ (din codul tÄƒu)
const RO_FORMS = {
  "a merge":   { "1sg":"merg","2sg":"mergi","3sg":"merge","1pl":"mergem","2pl":"mergeÈ›i","3pl":"merg" },
  "a veni":    { "1sg":"vin","2sg":"vii","3sg":"vine","1pl":"venim","2pl":"veniÈ›i","3pl":"vin" },
  "a mÃ¢nca":   { "1sg":"mÄƒnÃ¢nc","2sg":"mÄƒnÃ¢nci","3sg":"mÄƒnÃ¢ncÄƒ","1pl":"mÃ¢ncÄƒm","2pl":"mÃ¢ncaÈ›i","3pl":"mÄƒnÃ¢ncÄƒ" },
  "a bea":     { "1sg":"beau","2sg":"bei","3sg":"bea","1pl":"bem","2pl":"beÈ›i","3pl":"beau" },
  "a citi":    { "1sg":"citesc","2sg":"citeÈ™ti","3sg":"citeÈ™te","1pl":"citim","2pl":"citiÈ›i","3pl":"citesc" },
  "a scrie":   { "1sg":"scriu","2sg":"scrii","3sg":"scrie","1pl":"scriem","2pl":"scrieÈ›i","3pl":"scriu" },
  "a merge pe jos": {
    "1sg":"merg pe jos","2sg":"mergi pe jos","3sg":"merge pe jos",
    "1pl":"mergem pe jos","2pl":"mergeÈ›i pe jos","3pl":"merg pe jos"
  }
};
function stripInfinitive(roVerb){ return (roVerb || "").replace(/^\s*a\s+/i, "").trim(); }
function roPersonFromSubjectKo(subjKo){
  if(subjKo==="ì €"||subjKo==="ë‚˜") return "1sg";
  if(subjKo==="ë„ˆ") return "2sg";
  if(subjKo==="ìš°ë¦¬") return "1pl";
  if(subjKo==="ë„ˆí¬") return "2pl";
  return "3sg";
}
function roAgreeVerb(roVerbInf, subjKo){
  const inf = (roVerbInf || "").trim().toLowerCase();
  const person = roPersonFromSubjectKo(subjKo);
  const forms = RO_FORMS[inf];
  if(forms && forms[person]) return forms[person];
  return stripInfinitive(roVerbInf);
}
function buildRoVerbPhrase(roVerbInf, cj, subjKo){
  const v = roAgreeVerb(roVerbInf, subjKo);
  if(!cj) return v;
  const map = {
    "-ì•„ìš”/ì–´ìš”":         vv => `${vv}`,
    "-ì•˜ì–´ìš”/ì—ˆì–´ìš”":     vv => `${vv} (Ã®n trecut)`,
    "-ê³  ìˆì–´ìš”":         vv => `${vv} acum`,
    "-ê³  ì‹¶ì–´ìš”":         vv => `vreau sÄƒ ${vv}`,
    "-(ìœ¼)ã„¹ ê±°ì˜ˆìš”":      vv => `voi ${vv}`,
    "-ì§€ ë§ˆì„¸ìš”":         vv => `nu ${vv}, te rog`,
    "-ì•„/ì–´ì•¼ ë¼ìš”":       vv => `trebuie sÄƒ ${vv}`,
    "-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”":   vv => `pot sÄƒ ${vv}`,
    "-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”":   vv => `nu pot sÄƒ ${vv}`,
    "-ê¸° ì „ì—":           vv => `Ã®nainte sÄƒ ${vv}`,
    "-ê³  ë‚˜ì„œ":           vv => `dupÄƒ ce ${vv}`,
    "-(ìœ¼)ë©´ì„œ":           vv => `Ã®n timp ce ${vv}`,
    "-(ìœ¼)ã„¹ê¹Œìš”?":        vv => `sÄƒ ${vv}?`,
    "-ê³ ":                vv => `${vv} È™i`
  };
  const fn = map[cj];
  if(fn) return fn(v || "(verbul)");
  const cjExp = translations.conjug?.[cj] || cj;
  return (v ? v + " " : "") + `(${cjExp})`;
}

function buildNaturalRomanian(state, activeMap){
  const use = (key) => activeMap[key] !== false && isColumnVisible(key) && state[key];

  const getRo = (catKey, stateKey) => {
    const raw = state[stateKey];
    if(!raw) return "";
    return translations[catKey]?.[raw] || raw;
  };

  const timeRo   = use("time") ? getRo("time","time") : "";
  const subjRo   = use("subject") ? getRo("subject","subject") : "";
  const placeRo  = use("place") ? getRo("place","place") : "";
  const modRo    = use("mod") ? getRo("mod","mod") : "";
  const objRo    = use("object") ? getRo("object","object") : "";
  const numRo    = use("numeral") ? (state.numeral || "") : "";

  let objPhrase = "";
  if(objRo){
    const arr = [];
    if(numRo) arr.push(numRo);
    arr.push(objRo);
    objPhrase = arr.join(" ");
  }

  const verbKo   = state.verb || "";
  const verbRoInf = translations.verb?.[verbKo] || verbKo || "";
  const conjUsed = (use("conjug") ? (state.conjug || "") : "");
  const verbPhrase = (use("verb") ? buildRoVerbPhrase(verbRoInf, conjUsed, state.subject) : "");

  const parts = [];
  if(timeRo) parts.push(timeRo);
  if(subjRo) parts.push(subjRo);
  if(placeRo) parts.push(placeRo);
  if(modRo) parts.push(modRo);
  if(objPhrase) parts.push(objPhrase);
  if(verbPhrase) parts.push(verbPhrase);

  if(!parts.length) return "";
  let sentence = parts.join(" ").replace(/\s+/g," ").trim();
  sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1);
  if(!/[.!?]$/.test(sentence)) sentence += ".";
  return sentence;
}

/* =========================
   12) RENDER: TABLE (1 propoziÈ›ie)
   - IMPORTANT: nu mai facem coduri care se bat cap Ã®n cap
   ========================= */
function renderClauseRow(container, activeMap, state, clauseIndex){
  if(!container) return;
  container.innerHTML = "";

  columns.forEach(col=>{
    if(!isColumnVisible(col.key)) return;

    const colDiv = document.createElement("div");
    colDiv.className = "col";
    colDiv.dataset.key = col.key;
    colDiv.dataset.clauseIndex = String(clauseIndex);

    if(activeMap[col.key] === false) colDiv.classList.add("dimmed");

    // header
    const header = document.createElement("div");
    header.className = "col-header";

    const titleSpan = document.createElement("span");
    titleSpan.textContent = col.title + (col.ko ? ` (${col.ko})` : "");
    header.appendChild(titleSpan);

    // toggle mic ON/OFF
    const toggle = document.createElement("input");
    toggle.type = "checkbox";
    toggle.className = "col-toggle";
    toggle.checked = activeMap[col.key] !== false;
    toggle.addEventListener("change", ()=>{
      activeMap[col.key] = toggle.checked;
      renderAll();
    });

    header.appendChild(toggle);
    colDiv.appendChild(header);

    // label
    const label = document.createElement("div");
    label.className = "col-body-label";
    label.textContent = col.hint || "";
    colDiv.appendChild(label);

    // main
    const main = document.createElement("div");
    main.className = "col-body-main";
    main.textContent = state[col.key] || "";
    colDiv.appendChild(main);

    // extra
    const extra = document.createElement("div");
    extra.className = "col-body-extra";
    if(col.key === "conjug" && state[col.key] && isLinkingConj(state[col.key])){
      extra.textContent = "â­ cere propoziÈ›ia 2";
    }
    colDiv.appendChild(extra);

    container.appendChild(colDiv);
  });
}
function createClauseTable(clauseIndex){
  const wrap = document.createElement("div");
  wrap.className = "table-block clause-extra";
  wrap.dataset.clauseIndex = clauseIndex;

  const title = document.createElement("div");
  title.className = "table-title";
  title.innerHTML = `<span>PropoziÈ›ia ${clauseIndex + 1}</span>`;

  const table = document.createElement("div");
  table.className = "table-horizontal";

  wrap.appendChild(title);

  // hint (DOAR dacÄƒ propoziÈ›ia anterioarÄƒ are conjugare de legÄƒturÄƒ)
  if (sentences[clauseIndex - 1]?.conjug && isLinkingConj(sentences[clauseIndex - 1].conjug)) {
    const hint = document.createElement("div");
    hint.className = "small-label";
    hint.textContent = "â†³ continuare logicÄƒ (conjugare de legÄƒturÄƒ)";
    wrap.appendChild(hint);
  }

  wrap.appendChild(table);

  return { wrap, table };
}
    /* =========================
   13) PREVIEW: KO + RO pentru N propoziÈ›ii
   ========================= */
function ensureLinkedSentences(){
  // dacÄƒ o propoziÈ›ie are conjugare de legÄƒturÄƒ, trebuie sÄƒ existe Ã®ncÄƒ una dupÄƒ ea
  for(let i=0; i<sentences.length; i++){
    const cj = sentences[i].conjug;
    if(cj && isLinkingConj(cj)){
      if(!sentences[i+1]){
        sentences.push(makeEmptySentence());
        actives.push(makeAllActive());
      }
    }
  }

  // dacÄƒ user a debifat enableP2 È™i are doar HTML cu 2 tabele,
  // Ã®l respectÄƒm: pÄƒstrÄƒm max 2 pentru UI, dar state intern rÄƒmÃ¢ne N
}
function updatePreview(){

  if(!DOM.previewKo || !DOM.previewRo) return;

  ensureLinkedSentences();

  const koParts = [];
  const roParts = [];

  let prevCjRaw = "";

  for(let i = 0; i < sentences.length; i++){

    const isLast = (i === sentences.length - 1);

    const cjRaw = sentences[i].conjug || "";

    /* =========================
       1ï¸âƒ£ PREVENT DOUBLE LINKING
       ========================= */
    let cj = cjRaw;

    if(isLinkingConj(prevCjRaw) && isLinkingConj(cjRaw)){
      cj = "";   // eliminÄƒm linking-ul curent
    }

    /* =========================
       2ï¸âƒ£ SAFE FINAL CONJUGATION
       ========================= */
    cj = getSafeFinalConjugation(cj, isLast);

    /* =========================
       3ï¸âƒ£ BUILD KO
       ========================= */
    const built = buildClauseSentence(
      sentences[i],
      actives[i],
      cj   // ğŸ”’ snapshot final
    );

    if(built?.ko){
      koParts.push(built.ko);
    }

    /* =========================
       4ï¸âƒ£ BUILD RO
       ========================= */
    const roNat = buildNaturalRomanian(
      sentences[i],
      actives[i]
    );

    if(roNat){
      roParts.push(roNat);
    }

    /* =========================
       5ï¸âƒ£ STORE RAW (NU override)
       ========================= */
    prevCjRaw = cjRaw;
  }

  const fullKo = koParts.join(" ").trim();

  if(!fullKo){
    DOM.previewKo.textContent = "(alege cuvinte din tabel)";
    DOM.previewRo.textContent = "";
    DOM.naturalHint && (DOM.naturalHint.textContent = "");
    return;
  }

 DOM.previewKo.textContent = fixKoreanSpacing(fullKo);
  const fullRo = roParts.join(" ").trim();
  DOM.previewRo.textContent = showRo ? fullRo : "Â·Â·Â· traducere ascunsÄƒ Â·Â·Â·";

  DOM.naturalHint && (DOM.naturalHint.textContent =
    "âœ… PropoziÈ›ie (dupÄƒ regulile simple din aplicaÈ›ie).");
}
    /* =========================
   14) MODEL ROW (prev/next): ca Ã®nainte (tabel model)
   ========================= */
function loadModelRow(i){
  // aplicÄƒm acelaÈ™i rÃ¢nd-model pe propoziÈ›ia 1 (ca Ã®n versiunea ta)
  const s = sentences[0];
  columns.forEach(col => { s[col.key] = col.data[i] || ""; });
}

function updateModelNav(){
  if(DOM.pageInfoEl) DOM.pageInfoEl.textContent = `RÃ¢nd model: ${indexModelRow+1} / ${maxLen}`;
  if(DOM.prevBtn) DOM.prevBtn.disabled = (indexModelRow === 0);
  if(DOM.nextBtn) DOM.nextBtn.disabled = (indexModelRow === maxLen-1);
}

/* =========================
   15) CHIPS (togglesP1/togglesP2) â€“ compat cu HTML tÄƒu
   - IMPORTANT: nu dublÄƒm toggles Ã®n col+chip; ambele rÄƒmÃ¢n funcÈ›ionale
   ========================= */
function createToggleChips(){
  if(!DOM.togglesP1 || !DOM.togglesP2) return;

  DOM.togglesP1.innerHTML = "";
  DOM.togglesP2.innerHTML = "";

  const createFor = (wrapper, clauseIndex) => {
    columns.forEach(col=>{
      const chip = document.createElement("label");
      chip.className = "chip";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = actives[clauseIndex]?.[col.key] !== false;
      cb.dataset.key = col.key;
      cb.dataset.clauseIndex = String(clauseIndex);

      chip.appendChild(cb);
      chip.append(col.title);
      wrapper.appendChild(chip);
    });

    wrapper.addEventListener("change", (e)=>{
      const cb = e.target;
      if(!cb || cb.tagName !== "INPUT") return;
      const key = cb.dataset.key;
      const idx = Number(cb.dataset.clauseIndex);
      if(!actives[idx]) return;
      actives[idx][key] = cb.checked;
      cb.parentElement.classList.toggle("chip-off", !cb.checked);
      renderAll();
    });

    // set initial class
    $$("input[type='checkbox']", wrapper).forEach(cb=>{
      cb.parentElement.classList.toggle("chip-off", !cb.checked);
    });
  };

  createFor(DOM.togglesP1, 0);
  createFor(DOM.togglesP2, 1);
}

/* =========================
   16) PANEL (long press) â€“ complet, safe
   ========================= */
let panelClauseIndex = 0;
let panelKey = "subject";

function renderPanelList(col){
  if(!DOM.panelList) return;
  DOM.panelList.innerHTML = "";

  const key = col.key;
  const map = translations[key] || {};
  const filter = (DOM.panelSearchInput?.value || "").trim().toLowerCase();

  const words = col.data.filter(w=>{
    if(!w) return false;
    if(!filter) return true;
    return w.toLowerCase().startsWith(filter);
  });

  if(!words.length){
    const empty = document.createElement("div");
    empty.className = "panel-item";
    empty.textContent = "Nu existÄƒ cuvinte pentru filtrul introdus.";
    DOM.panelList.appendChild(empty);
    return;
  }

  words.forEach(word=>{
    const item = document.createElement("div");
    item.className = "panel-item";

    const main = document.createElement("div");
    main.className = "panel-item-main";
    main.textContent = word;
    item.appendChild(main);

    const extra = document.createElement("div");
    extra.className = "panel-item-extra";

    const ro = map[word];
    if(ro){
      const tag = document.createElement("div");
      tag.className = "panel-item-tag";
      tag.textContent = ro;
      extra.appendChild(tag);
    }

    if(key==="conjug" && isLinkingConj(word)){
      const star = document.createElement("div");
      star.className = "panel-item-tag";
      star.textContent = "â­ P2";
      extra.appendChild(star);
    }

    item.appendChild(extra);
// â• suport valori multiple (ex: Ana + Vasile)
if (key === "subject") {
  const addBtn = document.createElement("button");
  addBtn.textContent = "â•";
  addBtn.className = "panel-add-btn";

  addBtn.addEventListener("click", (e)=>{
    e.stopPropagation(); // NU declanÈ™eazÄƒ click-ul principal

    if(!sentences[panelClauseIndex]){
      sentences[panelClauseIndex] = makeEmptySentence();
      actives[panelClauseIndex] = makeAllActive();
    }

    let current = sentences[panelClauseIndex][key];

    if (!current) {
      sentences[panelClauseIndex][key] = [word];
    } else if (Array.isArray(current)) {
      if (!current.includes(word)) current.push(word);
    } else {
      if (current !== word) {
        sentences[panelClauseIndex][key] = [current, word];
      }
    }

    hide(DOM.overlay);
    renderAll();
  });

  item.appendChild(addBtn);
}
    // â• suport ATRIBUTE multiple (ex: frumoasÄƒ + grasÄƒ)
if (key === "attribute") {
  const addBtn = document.createElement("button");
  addBtn.textContent = "â•";
  addBtn.className = "panel-add-btn";

  addBtn.addEventListener("click", (e)=>{
    e.stopPropagation(); // NU declanÈ™eazÄƒ click-ul principal

    if(!sentences[panelClauseIndex]){
      sentences[panelClauseIndex] = makeEmptySentence();
      actives[panelClauseIndex] = makeAllActive();
    }

    let current = sentences[panelClauseIndex][key];

    if (!current) {
      sentences[panelClauseIndex][key] = [word];
    } else if (Array.isArray(current)) {
      if (!current.includes(word)) current.push(word);
    } else {
      if (current !== word) {
        sentences[panelClauseIndex][key] = [current, word];
      }
    }

    hide(DOM.overlay);
    renderAll();
  });

  item.appendChild(addBtn);
}
    item.addEventListener("click", ()=>{
      if(!sentences[panelClauseIndex]){
        sentences[panelClauseIndex] = makeEmptySentence();
        actives[panelClauseIndex] = makeAllActive();
      }
      sentences[panelClauseIndex][key] = word;

      // dacÄƒ e linking conj -> asigurÄƒm propoziÈ›ie urmÄƒtoare + enableP2 on (dacÄƒ existÄƒ)
      if(key === "conjug" && isLinkingConj(word)){
  showExtraClauses = true;   // ğŸ‘ˆ ASTA E CHEIA
  ensureLinkedSentences();

        if(DOM.enableP2){
          DOM.enableP2.checked = true;
          DOM.enableP2.dispatchEvent(new Event("change"));
        }
      }

      hide(DOM.overlay);
      renderAll();
    });

    DOM.panelList.appendChild(item);
  });
}

function openPanel(clauseIndex, key){
  panelClauseIndex = clauseIndex;
  panelKey = key;
  const col = columns.find(c=>c.key===key);
  if(!col) return;

  if(DOM.panelTitle) DOM.panelTitle.textContent = `PropoziÈ›ia ${clauseIndex+1} â€“ ${col.title}`;
  if(DOM.panelSub) DOM.panelSub.textContent = col.hint || "";

  if(DOM.panelSearchInput) DOM.panelSearchInput.value = "";
  if(DOM.newWordInput) DOM.newWordInput.value = "";
  if(DOM.newWordTransInput) DOM.newWordTransInput.value = "";

  renderPanelList(col);
  show(DOM.overlay);

  DOM.panelSearchInput && DOM.panelSearchInput.focus();
}

/* =========================
   17) CLICK / LONG-PRESS pe coloanÄƒ
   ========================= */
function cycleColumnValue(clauseIndex, key){
  const col = columns.find(c=>c.key===key);
  if(!col) return;
  const arr = col.data;
  const state = sentences[clauseIndex];
  if(!state) return;

  const cur = state[key];
  let idx = arr.indexOf(cur);
  if(idx === -1) idx = 0;
  const nextIdx = (idx + 1) % arr.length;
  state[key] = arr[nextIdx] || "";

  // dacÄƒ schimb conj Ã®n linking -> asigur propoziÈ›ie urmÄƒtoare
  if(key === "conjug" && isLinkingConj(state[key])){
    ensureLinkedSentences();
    if(DOM.enableP2){
      DOM.enableP2.checked = true;
      DOM.enableP2.dispatchEvent(new Event("change"));
    }
  }

  renderAll();
}

function attachPressHandlers(tableEl, clauseIndex){
  if(!tableEl) return;

  let longPressTimer = null;
  let pressTarget = null;

  tableEl.addEventListener("pointerdown", (e)=>{
    const colDiv = e.target.closest(".col");
    if(!colDiv) return;

    // dacÄƒ e checkbox, nu intervenim
    if(e.target && e.target.matches("input.col-toggle")) return;

    e.preventDefault();
    pressTarget = colDiv;

    longPressTimer = setTimeout(()=>{
      if(pressTarget === colDiv){
        openPanel(clauseIndex, colDiv.dataset.key);
        pressTarget = null;
      }
    }, 450);
  });

  tableEl.addEventListener("pointerup", (e)=>{
    const colDiv = e.target.closest(".col");

    if(e.target && e.target.matches("input.col-toggle")){
      if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null; }
      pressTarget = null;
      return;
    }

    if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null; }
    if(pressTarget && colDiv === pressTarget){
      cycleColumnValue(clauseIndex, colDiv.dataset.key);
    }
    pressTarget = null;
  });

  tableEl.addEventListener("pointerleave", ()=>{
    if(longPressTimer){ clearTimeout(longPressTimer); longPressTimer=null; }
    pressTarget = null;
  });
}

/* =========================
   18) FAVORITES
   ========================= */
const favorites = [];

function renderFavorites(){
  if(!DOM.favoritesListEl) return;
  DOM.favoritesListEl.innerHTML = "";
  if(!favorites.length){
    const div = document.createElement("div");
    div.className = "small-label";
    div.textContent = "Nu ai salvat Ã®ncÄƒ nicio propoziÈ›ie.";
    DOM.favoritesListEl.appendChild(div);
    return;
  }
  favorites.forEach(f=>{
    const item = document.createElement("div");
    item.className = "fav-item";

    const ko = document.createElement("div");
    ko.className = "fav-ko";
    ko.textContent = f.ko;

    const ro = document.createElement("div");
    ro.className = "fav-ro";
    ro.textContent = f.ro;

    item.appendChild(ko);
    item.appendChild(ro);
    DOM.favoritesListEl.appendChild(item);
  });
}

/* =========================
   19) AUDIO (WebSpeech)
   ========================= */
function speakKorean(textToSpeak){
  if(!("speechSynthesis" in window)) return;
  const t = (textToSpeak || "").trim();
  if(!t) return;

  const u = new SpeechSynthesisUtterance(t);
  u.lang = "ko-KR";

  const voices = window.speechSynthesis.getVoices();
  const koVoices = voices.filter(v => (v.lang || "").toLowerCase().startsWith("ko"));
  if(koVoices.length) u.voice = koVoices[0];

  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

/* =========================
   20) RO PARSER (din codul tÄƒu, minimal stabil)
   ========================= */
function stripDiacritics(s){
  return (s||"")
    .replace(/Äƒ/g,"a").replace(/Ã¢/g,"a").replace(/Ã®/g,"i")
    .replace(/È™/g,"s").replace(/ÅŸ/g,"s")
    .replace(/È›/g,"t").replace(/Å£/g,"t");
}
function normRo(s){
  return stripDiacritics((s||"").toLowerCase().replace(/[.,!?;]/g," "))
    .replace(/\s+/g," ").trim();
}

// reverse map RO -> KO (din translations)
function buildReverseMap(){
  const rev = { subject:{}, time:{}, place:{}, mod:{}, object:{}, counter:{}, verb:{}, conjug:{} };
  Object.entries(translations).forEach(([cat, map])=>{
    if(!rev[cat]) return;
    Object.entries(map).forEach(([ko, ro])=>{
      if(!ro) return;
      const n = normRo(ro);
      if(!rev[cat][n]) rev[cat][n] = ko;

      // suport "a ___" -> stem
      if(n.startsWith("a ")){
        const base = n.replace(/^a\s+/, "");
        if(base){
          const stem = base.replace(/[aei]$/, "");
          if(stem){
            if(!rev[cat][stem]) rev[cat][stem] = ko;
            const saKey = "sa " + stem;
            if(!rev[cat][saKey]) rev[cat][saKey] = ko;
          }
        }
      }
    });
  });
  return rev;
}
let REV = buildReverseMap();

// detect conj din romÃ¢nÄƒ (pÄƒstrat din codul tÄƒu, dar curÄƒÈ›at)
function detectConjFromRo(ro){
  const t = normRo(ro);

  // linking / conectori
  if(/\bdupa ce\b/.test(t)) return "-ê³  ë‚˜ì„œ";
  if(/\binainte sa\b/.test(t)) return "-ê¸° ì „ì—";
  if(/\bin timp ce\b/.test(t)) return "-(ìœ¼)ë©´ì„œ";
  if(/\bpentru ca\b|\bdeoarece\b|\bfiindca\b/.test(t)) return "-ê¸°ì—";
  if(/\bdesi\b|\bchiar daca\b/.test(t)) return "-(ìœ¼)ã„´/ëŠ”ë°ë„";
  if(/\bpe masura ce\b|\bcu cat\b/.test(t)) return "-(ìœ¼)ã„¹ìˆ˜ë¡";

  // intenÈ›ie/obligaÈ›ie/abilitate
  if(/\bvreau sa\b/.test(t)) return "-ê³  ì‹¶ì–´ìš”";
  if(/\btrebuie sa\b/.test(t)) return "-ì•„/ì–´ì•¼ ë¼ìš”";
  if(/\bnu pot sa\b/.test(t)) return "-(ìœ¼)ã„¹ ìˆ˜ ì—†ì–´ìš”";
  if(/\bpot sa\b/.test(t)) return "-(ìœ¼)ã„¹ ìˆ˜ ìˆì–´ìš”";

  // viitor
  if(/\bmaine\b|\bvoi\b|\bo sa\b/.test(t)) return "-(ìœ¼)ã„¹ ê±°ì˜ˆìš”";

  // trecut
  if(/\bieri\b|\bdeja\b|\btocmai\b|\bam\b/.test(t)) return "-ì•˜ì–´ìš”/ì—ˆì–´ìš”";

  // "È™i" -> -ê³  (doar dacÄƒ e Ã®ntre acÈ›iuni; noi o tratÄƒm Ã®n split)
  // fallback prezent
  return "-ì•„ìš”/ì–´ìš”";
}

// split RO Ã®n 2 (strict pentru butonul roTranslate; builder suportÄƒ N, dar aici e util)
function splitRoIntoClauses(txt){
  if(!txt) return null;
  const re = /\s+(È™i|si|iar|apoi)\s+/i;
  const m  = txt.match(re);
  if(!m) return null;
  const first  = txt.slice(0, m.index).trim();
  const second = txt.slice(m.index + m[0].length).trim();
  if(!first || !second) return null;
  return { first, second, link: (m[1] || "").toLowerCase() };
}

// find best KO by RO include
function findKoByRo(cat, text){
  const t = normRo(text);
  const keys = Object.keys(REV[cat] || {}).sort((a,b)=>b.length-a.length);
  for(const k of keys){
    if(k && t.includes(k)) return REV[cat][k];
  }
  return "";
}

// forme conjugate -> infinitiv
const RO_FORM_TO_INF = {
  "plec":"a merge","pleci":"a merge","pleaca":"a merge","pleacÄƒ":"a merge","plecam":"a merge","plecati":"a merge","plecaÈ›i":"a merge",
  "merg":"a merge","mergi":"a merge","merge":"a merge","mergem":"a merge","mergeti":"a merge","mergeÈ›i":"a merge",
  "vin":"a veni","vii":"a veni","vine":"a veni","venim":"a veni","veniti":"a veni","veniÈ›i":"a veni",
  "mananc":"a mÃ¢nca","mÄƒnÃ¢nc":"a mÃ¢nca","mananci":"a mÃ¢nca","mÄƒnÃ¢nci":"a mÃ¢nca","mananca":"a mÃ¢nca","mÄƒnÃ¢ncÄƒ":"a mÃ¢nca",
  "beau":"a bea","bei":"a bea","bea":"a bea","bem":"a bea","beti":"a bea","beÈ›i":"a bea",
  "citesc":"a citi","citesti":"a citi","citeÈ™ti":"a citi","citeste":"a citi","citeÈ™te":"a citi","citim":"a citi","cititi":"a citi","citiÈ›i":"a citi",
  "scriu":"a scrie","scrii":"a scrie","scrie":"a scrie","scriem":"a scrie","scrieti":"a scrie","scrieÈ›i":"a scrie"
};

function parseRoToState(roSentence){
  const t = normRo(roSentence);

  // subject
  let subj = "";
  if(/\beu\b/.test(t)) subj = "ì €";
  else if(/\btu\b/.test(t)) subj = "ë„ˆ";
  else if(/\bnoi\b/.test(t)) subj = "ìš°ë¦¬";
  else if(/\bvoi\b/.test(t)) subj = "ë„ˆí¬";

  // time/place/mod/object/verb
  const time   = findKoByRo("time", roSentence) || (/\bastazi\b/.test(t) ? "ì˜¤ëŠ˜" : "") || (/\bmaine\b/.test(t) ? "ë‚´ì¼" : "") || (/\bieri\b/.test(t) ? "ì–´ì œ" : "");
  const place  = findKoByRo("place", roSentence) || (/\bbanc(a|Äƒ)\b/.test(t) ? "ì€í–‰" : "") || (/\bpiat(a|Äƒ)\b/.test(t) ? "ì‹œì¥" : "");
  const mod    = findKoByRo("mod", roSentence);
  const object = findKoByRo("object", roSentence);

  let verb = findKoByRo("verb", roSentence);

  // infinitiv "a ___"
  if(!verb){
    const m = t.match(/\ba\s+([a-zÄƒÃ¢Ã®È™È›]+)/i);
    if(m){
      const inf = ("a " + m[1]).toLowerCase();
      verb = REV.verb?.[normRo(inf)] || "";
    }
  }

  // forme conjugate
  if(!verb){
    for(const w of t.split(" ")){
      const inf = RO_FORM_TO_INF[w];
      if(inf){
        const ko = REV.verb?.[normRo(inf)];
        if(ko){ verb = ko; break; }
      }
    }
  }

  // sinonime simple
  if(!verb){
    if(/\bpleca\b|\bplec\b|\bpleci\b/.test(t)) verb = "ê°€ë‹¤";
    else if(/\bsosi\b|\bajunge\b|\bajuns\b/.test(t)) verb = "ì˜¤ë‹¤";
  }

  const conj = detectConjFromRo(roSentence);

  return {
    subject: subj || "ì €",
    time: time || "",
    place: place || "",
    mod: mod || "",
    object: object || "",
    numeral: "",
    counter: "",
    verb: verb || "",
    conjug: conj || "-ì•„ìš”/ì–´ìš”"
  };
}

/* =========================
   21) RO -> KO (butonul "Tradu Ã®n coreeanÄƒ")
   - IMPORTANT: aici doar umple builder-ul, nu e â€motor separatâ€
   ========================= */
function translateRoToKo(roText){
  const original = (roText || "").trim();
  if(!original) return { ko:"", roFixed:"" };

  // 1) split pe "È™i/iar/apoi" -> P1 -ê³  + P2
  const split = splitRoIntoClauses(original);
  if(split){
    sentences = [ makeEmptySentence(), makeEmptySentence() ];
    actives   = [ makeAllActive(), makeAllActive() ];

    const s1 = parseRoToState(split.first);
    const s2 = parseRoToState(split.second);

    sentences[0] = s1;
    sentences[0].conjug = "-ê³ "; // forÈ›Äƒm legÄƒtura
    sentences[1] = s2;

    if(DOM.enableP2){
      DOM.enableP2.checked = true;
      DOM.enableP2.dispatchEvent(new Event("change"));
    }
  }else{
    // 2) o propoziÈ›ie
    sentences = [ makeEmptySentence() ];
    actives   = [ makeAllActive() ];
    sentences[0] = parseRoToState(original);

    if(DOM.enableP2){
      DOM.enableP2.checked = false;
      DOM.enableP2.dispatchEvent(new Event("change"));
    }
  }

  const builtKo = buildClauseSentence(sentences[0], actives[0]).ko;
  const roFixed = buildNaturalRomanian(sentences[0], actives[0]);

  return { ko: builtKo || "(nu am putut construi propoziÈ›ia)", roFixed: roFixed || original };
}

/* =========================
   22) UI EVENTS
   ========================= */
function setupUI(){
  // Mode buttons
  DOM.modeButtons.forEach(btn=>{
    on(btn, "click", ()=>{
      currentMode = btn.dataset.mode || "topik";
      DOM.modeButtons.forEach(b => b.classList.toggle("active", b === btn));
      renderAll();
    });
  });

  // Prev/Next model row
  on(DOM.prevBtn, "click", ()=>{
    if(indexModelRow > 0){
      indexModelRow--;
      loadModelRow(indexModelRow);
      renderAll();
    }
  });
  on(DOM.nextBtn, "click", ()=>{
    if(indexModelRow < maxLen-1){
      indexModelRow++;
      loadModelRow(indexModelRow);
      renderAll();
    }
  });

  // Reset toggles
  on(DOM.resetBtn, "click", ()=>{
    actives = actives.map(()=>makeAllActive());
    // resync chips UI
    createToggleChips();
    renderAll();
  });

  // Show/Hide RO
  on(DOM.toggleRoBtn, "click", ()=>{
    showRo = !showRo;
    if(DOM.toggleRoBtn) DOM.toggleRoBtn.textContent = showRo ? "Ascunde traducerea" : "AratÄƒ traducerea";
    updatePreview();
  });

  // Random (pe propoziÈ›ia 1, doar coloanele active)
  on(DOM.randomBtn, "click", ()=>{
    const s = sentences[0];
    const a = actives[0];
    columns.forEach(col=>{
      if(!isColumnVisible(col.key)) return;
      if(a[col.key] === false) return;
      const arr = col.data.filter(x => x !== "" && x != null);
      if(!arr.length) return;
      s[col.key] = arr[Math.floor(Math.random()*arr.length)];
    });
    renderAll();
  });

  // Speak
  on(DOM.speakBtn, "click", ()=>{
    const ko = (DOM.previewKo?.textContent || "").trim();
    if(!ko || ko.includes("alege cuvinte")) return;
    speakKorean(ko);
  });

  // Favorite
  on(DOM.favBtn, "click", ()=>{
    const ko = (DOM.previewKo?.textContent || "").trim();
    let ro = (DOM.previewRo?.textContent || "").trim();
    if(!ko || ko.includes("alege cuvinte")) return;
    if(ro.startsWith("Â·Â·Â·")) ro = "";

    const exists = favorites.some(f => f.ko === ko && f.ro === ro);
    if(!exists) favorites.push({ko,ro});

    renderFavorites();
    if(DOM.favBtn){
      DOM.favBtn.textContent = "â­ Salvat!";
      setTimeout(()=>{ if(DOM.favBtn) DOM.favBtn.textContent="â­ SalveazÄƒ propoziÈ›ia"; }, 800);
    }
  });

  // Overlay / Panel close
  on(DOM.closePanelBtn, "click", ()=> hide(DOM.overlay));
  on(DOM.overlay, "click", (e)=>{ if(e.target === DOM.overlay) hide(DOM.overlay); });

  // Panel search
  on(DOM.panelSearchInput, "input", ()=>{
    const col = columns.find(c=>c.key===panelKey);
    if(col) renderPanelList(col);
  });

  // Add new word
  on(DOM.addWordBtn, "click", ()=>{
    const txt = (DOM.newWordInput?.value || "").trim();
    if(!txt) return;
    const roTxt = (DOM.newWordTransInput?.value || "").trim();

    const col = columns.find(c=>c.key===panelKey);
    if(!col || !col.allowCustom) return;

    if(!col.data.includes(txt)) col.data.push(txt);
    if(!translations[panelKey]) translations[panelKey] = {};
    if(roTxt) translations[panelKey][txt] = roTxt;

    if(!customData[panelKey]) customData[panelKey] = [];
    const exists = customData[panelKey].some(e=>e.word===txt);
    if(!exists) customData[panelKey].push({word:txt,ro:roTxt});
    else customData[panelKey].forEach(e=>{ if(e.word===txt) e.ro = roTxt; });

    saveCustomData();
    REV = buildReverseMap();

    if(DOM.newWordInput) DOM.newWordInput.value = "";
    if(DOM.newWordTransInput) DOM.newWordTransInput.value = "";

    renderPanelList(col);
  });

  // Enable P2 (doar UI pentru tabelul 2, ca Ã®n HTML-ul tÄƒu)
on(DOM.enableP2, "change", ()=>{
  const onOff = DOM.enableP2.checked;

  // ğŸ”´ FIX CRITIC: creeazÄƒ propoziÈ›ia 2 la bifare
  if (onOff) {
    if (!sentences[1]) {
      sentences[1] = makeEmptySentence();
      actives[1]   = makeAllActive();
    }
  }

  if(DOM.tableP2){
    onOff ? show(DOM.tableP2) : hide(DOM.tableP2);
  }
  if(DOM.titleP2){
    onOff ? show(DOM.titleP2) : hide(DOM.titleP2);
  }

  renderAll();
});
  // RO Translate button
  on(DOM.roTranslateBtn, "click", ()=>{
    const txt = (DOM.roInput?.value || "").trim();

    // 1) Umple builder state
    const res = translateRoToKo(txt);

    // 2) Render builder + preview
    renderAll();

    // 3) Rezultate RO->KO bloc (dacÄƒ existÄƒ)
    if(DOM.roToKoResult) DOM.roToKoResult.textContent = res.ko || "";
    if(DOM.roCorrected) DOM.roCorrected.textContent = res.roFixed || "";
  });
}

/* =========================
   23) RENDER ALL (fixeazÄƒ â€œtabelele nu suntâ€)
   - NU mai referim variabile inexistente: screens/navButtons/setScreen etc.
   ========================= */
function renderAll(){
  ensureLinkedSentences();

  if(DOM.tableP1 && sentences[0] && actives[0]){
    renderClauseRow(DOM.tableP1, actives[0], sentences[0], 0);
  }
if (!sentences.length) return;
  // P2 = apare AUTOMAT dacÄƒ existÄƒ showExtraClauses
if (DOM.tableP2 && sentences[1] && actives[1]) {
  if (showExtraClauses) {
    show(DOM.tableP2);
    DOM.titleP2 && show(DOM.titleP2);
    renderClauseRow(DOM.tableP2, actives[1], sentences[1], 1);
  } else {
    hide(DOM.tableP2);
    DOM.titleP2 && hide(DOM.titleP2);
  }
}
  renderExtraClauses();   // ğŸ‘ˆ AICI
  const lastClause = document.querySelector(
  `.clause-extra[data-clause-index="${sentences.length-1}"]`
);
if (lastClause) {
  lastClause.scrollIntoView({ behavior: "smooth", block: "start" });
}
  // ===== EXTRA CLAUSES (P3+) =====
const extra = $("#extra-clauses");
if (extra) {
  extra.innerHTML = "";

  for (let i = 2; i < sentences.length; i++) {
    const { wrap, table } = createClauseTable(i);
    extra.appendChild(wrap);

    renderClauseRow(table, actives[i], sentences[i], i);
    attachPressHandlers(table, i);
  }
}

updateModelNav();
updatePreview();  
}
/* =========================
   24) BOOTSTRAP
   ========================= */
document.addEventListener("DOMContentLoaded", ()=>{
  // init state
  loadModelRow(indexModelRow);

  // chips
  createToggleChips();

  // attach long-press handlers (P1/P2)
  attachPressHandlers(DOM.tableP1, 0);
  attachPressHandlers(DOM.tableP2, 1);

  // UI events
  setupUI();

  // favorites initial
  renderFavorites();

  // first render
  renderAll();
});
  function renderExtraClauses() {
  if (!DOM.extraClauses) return;

  DOM.extraClauses.innerHTML = "";

  // Ã®ncepem de la propoziÈ›ia 3 (index 2)
  for (let i = 2; i < sentences.length; i++) {
    const wrapper = document.createElement("div");
    wrapper.className = "table-block";

    const title = document.createElement("div");
    title.className = "table-title";
    title.innerHTML = `<span>PropoziÈ›ia ${i + 1}</span>`;
    wrapper.appendChild(title);

    const table = document.createElement("div");
    table.className = "table-horizontal";
    wrapper.appendChild(table);

    DOM.extraClauses.appendChild(wrapper);

    // render tabelul EXACT ca P1 / P2
    renderClauseRow(table, actives[i], sentences[i], i);

    // long-press + click
    attachPressHandlers(table, i);
  }
}
  </script>
</body>
</html> 
