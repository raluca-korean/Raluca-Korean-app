<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Raluca Korean – Builder FINAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  *{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(120deg,#e8f0ff,#ffe9ff,#e9fff5);
  color:#2f343b;
}
.app{
  max-width:1100px;
  margin:0 auto;
  padding:16px 16px 80px;
}
.header{
  padding:16px;
  border-radius:24px;
  background:linear-gradient(120deg,#6fb8ff,#a774ff,#ff7fd1);
  color:#fff;
  box-shadow:0 18px 40px rgba(0,0,0,.25);
}
.header h1{margin:0;font-size:22px}
.header p{margin:6px 0 0;font-size:13px;opacity:.95}

.card{
  margin-top:16px;
  padding:16px;
  border-radius:22px;
  background:#ffffffcc;
  box-shadow:0 16px 32px rgba(0,0,0,.12);
}

textarea{
  width:100%;
  min-height:80px;
  padding:12px;
  border-radius:16px;
  border:1px solid #ddd;
  font-size:14px;
}

.actions{
  margin-top:10px;
  display:flex;
  gap:10px;
}
button{
  border:none;
  border-radius:999px;
  padding:8px 18px;
  font-weight:800;
  color:#fff;
  cursor:pointer;
  background:linear-gradient(135deg,#6b8cff,#9b6bff);
}
button.secondary{
  background:linear-gradient(135deg,#ff9a6c,#ff5f8c);
}

.table-block{
  margin-top:14px;
  padding:12px;
  border-radius:20px;
  background:#ffffffcc;
  box-shadow:0 14px 28px rgba(0,0,0,.12);
}

.table-title{
  font-weight:900;
  font-size:13px;
  margin-bottom:6px;
}

.table{
  display:flex;
  gap:8px;
  overflow-x:auto;
}

.col{
  min-width:120px;
  padding:8px;
  border-radius:16px;
  background:#fdfbf7;
  border:1px solid #e2d7c8;
}
.col-header{
  font-size:10px;
  font-weight:900;
  color:#7b5dff;
  margin-bottom:4px;
}
.col-body{
  min-height:1.6em;
  font-size:15px;
  font-weight:900;
}
.col-body[contenteditable]{
  outline:none;
}

.preview{
  margin-top:18px;
}
.sentence{
  font-size:24px;
  font-weight:900;
  margin-top:10px;
}
.polite{
  font-size:12px;
  font-weight:800;
}
  
</head>
</style>  
<body>
  <div class="app">

    <header class="header">
      <h1>Raluca Korean – Builder FINAL</h1>
      <p>Construcție propoziții coreene – multi-clause, particles corecte</p>
    </header>

    <!-- INPUT -->
    <section class="card">
      <textarea id="inputText"
        placeholder="Ex: Astăzi merg la cafenea și citesc o carte și beau o cafea."></textarea>
      <div class="actions">
        <button id="autoFill">Auto-fill</button>
        <button id="resetAll" class="secondary">Reset</button>
      </div>
    </section>

    <!-- CLAUSES -->
    <div id="clausesHost"></div>

    <!-- PREVIEW -->
    <section class="card preview">
      <label class="polite">
        <input type="checkbox" id="politeToggle">
        Politețe (doar ultima clauză)
      </label>
      <div id="previewSentence" class="sentence">저 가요</div>
    </section>

  </div>
 <script> 
(() => {
  "use strict";

  /* =========================
     HELPERS – HANGUL
  ========================= */
  function hasBatchim(word) {
    if (!word) return false;
    const ch = word[word.length - 1];
    const code = ch.charCodeAt(0);
    if (code < 0xac00 || code > 0xd7a3) return false;
    return (code - 0xac00) % 28 !== 0;
  }

  /* =========================
     PARTICLES
  ========================= */
  function subjectParticle(word) {
    return word + (hasBatchim(word) ? "은" : "는");
  }

  function objectParticle(word) {
    return word + (hasBatchim(word) ? "을" : "를");
  }

  function placeParticle(place, verb) {
    if (!place) return "";
    if (verb === "가다" || verb === "오다") return place + "에";
    return place + "에서";
  }

  /* =========================
     VERB ENDINGS
  ========================= */
  function attachEnding(verb, ending) {
    if (!verb || !verb.endsWith("다")) return verb;
    if (!ending) return verb;

    const stem = verb.slice(0, -1);

    if (ending === "-고") return stem + "고";
    if (ending === "-지만") return stem + "지만";
    if (ending === "-아서") return stem + "아서";
    if (ending === "-어서") return stem + "어서";

    if (ending === "-(으)면")
      return stem + (hasBatchim(stem) ? "으면" : "면");

    if (ending === "-(으)ㄹ 때")
      return stem + (hasBatchim(stem) ? "을 때" : "ㄹ 때");

    // conector standalone
    if (["그리고", "하지만", "그래서"].includes(ending))
      return verb + " " + ending;

    return stem + ending;
  }

  function politePresent(verb) {
    if (!verb.endsWith("다")) return verb;
    const stem = verb.slice(0, -1);
    if (stem.endsWith("하")) return stem.slice(0, -1) + "해요";
    return stem + (hasBatchim(stem) ? "어요" : "아요");
  }

  /* =========================
     DOM HELPERS
  ========================= */
  function getCell(block, key) {
    return block.querySelector(`.col[data-key="${key}"] div`)?.textContent.trim() || "";
  }

  function setCell(block, key, value) {
    const el = block.querySelector(`.col[data-key="${key}"] div`);
    if (el) el.textContent = value;
  }

  /* =========================
     BUILD CLAUSE
  ========================= */
  function buildClause(block, isLast, polite) {
    const subject = getCell(block, "subject");
    const time = getCell(block, "time");
    const placeBase = getCell(block, "place");
    const mod = getCell(block, "mod");
    const object = getCell(block, "object");
    const numeral = getCell(block, "numeral");
    const counter = getCell(block, "counter");
    const verbInf = getCell(block, "verb");
    const conj = getCell(block, "conj");

    let out = [];

    if (subject) out.push(subjectParticle(subject));
    if (time) out.push(time);
    if (placeBase) out.push(placeParticle(placeBase, verbInf));
    if (mod) out.push(mod);

    if (object) {
      let obj = object;
      if (numeral && counter) obj += ` ${numeral}${counter}`;
      out.push(objectParticle(obj));
    }

    let verbOut = verbInf;
    if (conj) verbOut = attachEnding(verbInf, conj);
    if (polite && isLast && !conj) verbOut = politePresent(verbInf);

    if (verbOut) out.push(verbOut);

    return out.join(" ");
  }

  /* =========================
     REBUILD PREVIEW
  ========================= */
  function rebuild() {
    const blocks = [...document.querySelectorAll(".table-block")];
    const polite = document.getElementById("politeToggle")?.checked;
    const result = [];

    blocks.forEach((b, i) => {
      const clause = buildClause(b, i === blocks.length - 1, polite);
      if (clause) result.push(clause);
    });

    document.getElementById("previewSentence").textContent =
      result.join(" ") || "저 가요";
  }

  /* =========================
     ADD / REMOVE CLAUSES
  ========================= */
  function clauseHTML(index) {
    return `
    <section class="table-block" data-index="${index}">
      <div class="table-horizontal">

        <div class="col" data-key="subject"><label>SUBJECT</label><div contenteditable></div></div>
        <div class="col" data-key="time"><label>TIME</label><div contenteditable></div></div>
        <div class="col" data-key="place"><label>PLACE</label><div contenteditable></div></div>
        <div class="col" data-key="mod"><label>MOD</label><div contenteditable></div></div>
        <div class="col" data-key="object"><label>OBJECT</label><div contenteditable></div></div>
        <div class="col" data-key="numeral"><label>NUMERAL</label><div contenteditable></div></div>
        <div class="col" data-key="counter"><label>COUNTER</label><div contenteditable></div></div>
        <div class="col" data-key="verb"><label>VERB (…다)</label><div contenteditable></div></div>
        <div class="col" data-key="conj"><label>CONJ / ENDING</label><div contenteditable></div></div>

      </div>
    </section>`;
  }

  function ensureClauseCount(n) {
    const host = document.getElementById("clausesHost");
    while (host.children.length < n)
      host.insertAdjacentHTML("beforeend", clauseHTML(host.children.length));
    while (host.children.length > n)
      host.lastElementChild.remove();
  }

  /* =========================
     EVENTS
  ========================= */
  document.addEventListener("input", e => {
    if (e.target.closest(".col")) rebuild();
  });

  document.getElementById("politeToggle")?.addEventListener("change", rebuild);

  /* =========================
     INIT
  ========================= */
  function init() {
    ensureClauseCount(1);
    const first = document.querySelector(".table-block");
    setCell(first, "subject", "저");
    setCell(first, "verb", "가다");
    rebuild();
  }

  window.addEventListener("DOMContentLoaded", init);
})();
</script>
</body>
</html>
